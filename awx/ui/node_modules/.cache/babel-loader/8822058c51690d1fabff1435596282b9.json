{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5;import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";/* eslint-disable react/jsx-no-useless-fragment */import React,{useCallback,useEffect,useRef,useState}from'react';import{useHistory,useLocation}from'react-router-dom';import styled from'styled-components';import{AutoSizer,CellMeasurer,CellMeasurerCache,InfiniteLoader,List}from'react-virtualized';import{Button}from'@patternfly/react-core';import AlertModal from'components/AlertModal';import{CardBody as _CardBody}from'components/Card';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import ErrorDetail from'components/ErrorDetail';import StatusLabel from'components/StatusLabel';import{JobsAPI}from'api';import{getJobModel,isJobRunning}from'util/jobs';import useRequest,{useDismissableError}from'hooks/useRequest';import useInterval from'hooks/useInterval';import{parseQueryString,getQSConfig}from'util/qs';import useIsMounted from'hooks/useIsMounted';import JobEvent from'./JobEvent';import JobEventSkeleton from'./JobEventSkeleton';import PageControls from'./PageControls';import HostEventModal from'./HostEventModal';import JobOutputSearch from'./JobOutputSearch';import EmptyOutput from'./EmptyOutput';import{HostStatusBar,OutputToolbar}from'./shared';import getLineTextHtml from'./getLineTextHtml';import connectJobSocket,{closeWebSocket}from'./connectJobSocket';import getEventRequestParams from'./getEventRequestParams';import isHostEvent from'./isHostEvent';import{prependTraceback}from'./loadJobEvents';import useJobEvents from'./useJobEvents';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('job_output',{order_by:'counter'});var CardBody=styled(_CardBody)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-flow: column;\\n  height: calc(100vh - 267px);\\n\"])));var HeaderTitle=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  display: inline-flex;\\n  align-items: center;\\n  h1 {\\n    margin-right: 10px;\\n    font-weight: var(--pf-global--FontWeight--bold);\\n  }\\n\"])));var OutputHeader=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: space-between;\\n\"])));var OutputWrapper=styled.div(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  background-color: #ffffff;\\n  display: flex;\\n  flex-direction: column;\\n  flex: 1 1 auto;\\n  font-family: monospace;\\n  font-size: 15px;\\n  outline: 1px solid #d7d7d7;\\n  \",\"\\n\"])),function(_ref){var cssMap=_ref.cssMap;return Object.keys(cssMap).map(function(className){return\".\".concat(className,\"{\").concat(cssMap[className],\"}\");});});var OutputFooter=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  background-color: #ebebeb;\\n  border-right: 1px solid #d7d7d7;\\n  width: 75px;\\n  flex: 1;\\n\"])));var cache=new CellMeasurerCache({fixedWidth:true,defaultHeight:25});function JobOutput(_ref2){var _job$status;var job=_ref2.job,eventRelatedSearchableKeys=_ref2.eventRelatedSearchableKeys,eventSearchableKeys=_ref2.eventSearchableKeys;var location=useLocation();var listRef=useRef(null);var previousWidth=useRef(0);var jobSocketCounter=useRef(0);var isMounted=useIsMounted();var scrollTop=useRef(0);var scrollHeight=useRef(0);var history=useHistory();var eventByUuidRequests=useRef([]);var fetchEventByUuid=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(uuid){var promise,_yield$promise,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:promise=eventByUuidRequests.current[uuid];if(!promise){promise=getJobModel(job.type).readEvents(job.id,{uuid:uuid});eventByUuidRequests.current[uuid]=promise;}_context.next=4;return promise;case 4:_yield$promise=_context.sent;data=_yield$promise.data;eventByUuidRequests.current[uuid]=null;return _context.abrupt(\"return\",data.results[0]||null);case 8:case\"end\":return _context.stop();}}},_callee);}));return function fetchEventByUuid(_x){return _ref3.apply(this,arguments);};}();var fetchChildrenSummary=function fetchChildrenSummary(){return JobsAPI.readChildrenSummary(job.id);};var _useState=useState((_job$status=job.status)!==null&&_job$status!==void 0?_job$status:'waiting'),_useState2=_slicedToArray(_useState,2),jobStatus=_useState2[0],setJobStatus=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),forceFlatMode=_useState4[0],setForceFlatMode=_useState4[1];var isFlatMode=isJobRunning(jobStatus)||location.search.length>1||job.type!=='job';var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isTreeReady=_useState6[0],setIsTreeReady=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),onReadyEvents=_useState8[0],setOnReadyEvents=_useState8[1];var _useJobEvents=useJobEvents({fetchEventByUuid:fetchEventByUuid,fetchChildrenSummary:fetchChildrenSummary,setForceFlatMode:setForceFlatMode,setJobTreeReady:function setJobTreeReady(){return setIsTreeReady(true);}},job.id,isFlatMode||forceFlatMode),addEvents=_useJobEvents.addEvents,toggleNodeIsCollapsed=_useJobEvents.toggleNodeIsCollapsed,toggleCollapseAll=_useJobEvents.toggleCollapseAll,getEventForRow=_useJobEvents.getEventForRow,getNumCollapsedEvents=_useJobEvents.getNumCollapsedEvents,getCounterForRow=_useJobEvents.getCounterForRow,getEvent=_useJobEvents.getEvent,clearLoadedEvents=_useJobEvents.clearLoadedEvents,rebuildEventsTree=_useJobEvents.rebuildEventsTree,isAllCollapsed=_useJobEvents.isAllCollapsed;var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),wsEvents=_useState10[0],setWsEvents=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),cssMap=_useState12[0],setCssMap=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),remoteRowCount=_useState14[0],setRemoteRowCount=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),contentError=_useState16[0],setContentError=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),currentlyLoading=_useState18[0],setCurrentlyLoading=_useState18[1];var _useState19=useState(true),_useState20=_slicedToArray(_useState19,2),hasContentLoading=_useState20[0],setHasContentLoading=_useState20[1];var _useState21=useState({}),_useState22=_slicedToArray(_useState21,2),hostEvent=_useState22[0],setHostEvent=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),isHostModalOpen=_useState24[0],setIsHostModalOpen=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),showCancelModal=_useState26[0],setShowCancelModal=_useState26[1];var _useState27=useState(0),_useState28=_slicedToArray(_useState27,2),highestLoadedCounter=_useState28[0],setHighestLoadedCounter=_useState28[1];var _useState29=useState(isJobRunning(job.status)),_useState30=_slicedToArray(_useState29,2),isFollowModeEnabled=_useState30[0],setIsFollowModeEnabled=_useState30[1];var _useState31=useState(false),_useState32=_slicedToArray(_useState31,2),isMonitoringWebsocket=_useState32[0],setIsMonitoringWebsocket=_useState32[1];var _useState33=useState(0),_useState34=_slicedToArray(_useState33,2),lastScrollPosition=_useState34[0],setLastScrollPosition=_useState34[1];useEffect(function(){if(!isTreeReady||!onReadyEvents.length){return;}addEvents(onReadyEvents);setOnReadyEvents([]);if(isFollowModeEnabled){setTimeout(function(){scrollToEnd();},0);}},[isTreeReady,onReadyEvents]);// eslint-disable-line react-hooks/exhaustive-deps\nvar totalNonCollapsedRows=Math.max(remoteRowCount-getNumCollapsedEvents(),0);useInterval(function(){monitorJobSocketCounter();},isMonitoringWebsocket?5000:null);useEffect(function(){var pendingRequests=Object.values(eventByUuidRequests.current||{});setHasContentLoading(true);// prevents \"no content found\" screen from flashing\nPromise.allSettled(pendingRequests).then(function(){setRemoteRowCount(0);clearLoadedEvents();loadJobEvents();});},[location.search]);// eslint-disable-line react-hooks/exhaustive-deps\nuseEffect(function(){rebuildEventsTree();},[isFlatMode]);// eslint-disable-line react-hooks/exhaustive-deps\nuseEffect(function(){if(!isJobRunning(jobStatus)){setTimeout(function(){loadJobEvents().then(function(){setWsEvents([]);scrollToRow(lastScrollPosition);});},500);return;}var batchTimeout;var batchedEvents=[];connectJobSocket(job,function(data){var addBatchedEvents=function addBatchedEvents(){var min;var max;var newCssMap;batchedEvents.forEach(function(event){if(!min||event.counter<min){min=event.counter;}if(!max||event.counter>max){max=event.counter;}var _getLineTextHtml=getLineTextHtml(event),lineCssMap=_getLineTextHtml.lineCssMap;newCssMap=_objectSpread(_objectSpread({},newCssMap),lineCssMap);});setWsEvents(function(oldWsEvents){var updated=oldWsEvents.concat(batchedEvents);jobSocketCounter.current=updated.length;return updated.sort(function(a,b){return a.counter-b.counter;});});setCssMap(function(prevCssMap){return _objectSpread(_objectSpread({},prevCssMap),newCssMap);});if(max>jobSocketCounter.current){jobSocketCounter.current=max;}batchedEvents=[];};if(data.group_name===\"\".concat(job.type,\"_events\")){batchedEvents.push(data);clearTimeout(batchTimeout);if(batchedEvents.length>=10){addBatchedEvents();}else{batchTimeout=setTimeout(addBatchedEvents,500);}}if(data.group_name==='jobs'&&data.unified_job_id===job.id){if(data.final_counter){jobSocketCounter.current=data.final_counter;}if(data.status){setJobStatus(data.status);}}});setIsMonitoringWebsocket(true);// eslint-disable-next-line consistent-return\nreturn function cleanup(){clearTimeout(batchTimeout);closeWebSocket();setIsMonitoringWebsocket(false);isMounted.current=false;};},[isJobRunning(jobStatus)]);// eslint-disable-line react-hooks/exhaustive-deps\nuseEffect(function(){if(isFollowModeEnabled){scrollToEnd();}},[wsEvents.length,isFollowModeEnabled]);// eslint-disable-line react-hooks/exhaustive-deps\nuseEffect(function(){var _listRef$current;if((_listRef$current=listRef.current)!==null&&_listRef$current!==void 0&&_listRef$current.recomputeRowHeights){listRef.current.recomputeRowHeights();}},[currentlyLoading,cssMap,remoteRowCount,wsEvents.length]);useEffect(function(){if(!jobStatus||isJobRunning(jobStatus)){return;}if(isMonitoringWebsocket){setIsMonitoringWebsocket(false);}if(isFollowModeEnabled){setTimeout(function(){return setIsFollowModeEnabled(false);},1000);}},[jobStatus]);// eslint-disable-line react-hooks/exhaustive-deps\nvar _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getJobModel(job.type).cancel(job.id);case 2:case\"end\":return _context2.stop();}}},_callee2);})),[job.id,job.type]),{}),cancelError=_useRequest.error,isCancelling=_useRequest.isLoading,cancelJob=_useRequest.request;var _useDismissableError=useDismissableError(cancelError),dismissableCancelError=_useDismissableError.error,dismissCancelError=_useDismissableError.dismissError;var _useRequest2=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return getJobModel(job.type).destroy(job.id);case 2:history.push('/jobs');case 3:case\"end\":return _context3.stop();}}},_callee3);})),[job.type,job.id,history])),deleteJob=_useRequest2.request,isDeleting=_useRequest2.isLoading,deleteError=_useRequest2.error;var _useDismissableError2=useDismissableError(deleteError),dismissableDeleteError=_useDismissableError2.error,dismissDeleteError=_useDismissableError2.dismissError;var monitorJobSocketCounter=function monitorJobSocketCounter(){if(jobSocketCounter.current===remoteRowCount&&!isJobRunning(job.status)){setIsMonitoringWebsocket(false);}};var loadJobEvents=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _getEventRequestParam,_getEventRequestParam2,params,loadRange,qsParams,eventPromise,_events,_yield$eventPromise,_yield$eventPromise$d,count,_yield$eventPromise$d2,fetchedEvents,newCssMap,rowNumber,_prependTraceback,events,countOffset,lastCounter;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_getEventRequestParam=getEventRequestParams(job,50,[1,50]),_getEventRequestParam2=_slicedToArray(_getEventRequestParam,2),params=_getEventRequestParam2[0],loadRange=_getEventRequestParam2[1];if(isMounted.current){setHasContentLoading(true);setCurrentlyLoading(function(prevCurrentlyLoading){return prevCurrentlyLoading.concat(loadRange);});}if(isFlatMode){params.not__stdout='';}qsParams=parseQueryString(QS_CONFIG,location.search);eventPromise=getJobModel(job.type).readEvents(job.id,_objectSpread(_objectSpread({},params),qsParams));_context4.prev=5;_context4.next=8;return eventPromise;case 8:_yield$eventPromise=_context4.sent;_yield$eventPromise$d=_yield$eventPromise.data;count=_yield$eventPromise$d.count;_yield$eventPromise$d2=_yield$eventPromise$d.results;fetchedEvents=_yield$eventPromise$d2===void 0?[]:_yield$eventPromise$d2;if(isMounted.current){_context4.next=15;break;}return _context4.abrupt(\"return\");case 15:rowNumber=0;_prependTraceback=prependTraceback(job,fetchedEvents),events=_prependTraceback.events,countOffset=_prependTraceback.countOffset;events.forEach(function(event){event.rowNumber=rowNumber;rowNumber++;var _getLineTextHtml2=getLineTextHtml(event),lineCssMap=_getLineTextHtml2.lineCssMap;newCssMap=_objectSpread(_objectSpread({},newCssMap),lineCssMap);});setCssMap(function(prevCssMap){return _objectSpread(_objectSpread({},prevCssMap),newCssMap);});lastCounter=((_events=events[events.length-1])===null||_events===void 0?void 0:_events.counter)||50;if(isTreeReady){addEvents(events);}else{setOnReadyEvents(function(prev){return prev.concat(events);});}setHighestLoadedCounter(lastCounter);setRemoteRowCount(count+countOffset);_context4.next=28;break;case 25:_context4.prev=25;_context4.t0=_context4[\"catch\"](5);setContentError(_context4.t0);case 28:_context4.prev=28;if(isMounted.current){setHasContentLoading(false);setCurrentlyLoading(function(prevCurrentlyLoading){return prevCurrentlyLoading.filter(function(n){return!loadRange.includes(n);});});loadRange.forEach(function(n){cache.clear(n);});}return _context4.finish(28);case 31:case\"end\":return _context4.stop();}}},_callee4,null,[[5,25,28,31]]);}));return function loadJobEvents(){return _ref6.apply(this,arguments);};}();var isRowLoaded=function isRowLoaded(_ref7){var index=_ref7.index;var counter;try{counter=getCounterForRow(index);}catch(e){console.error(e);// eslint-disable-line no-console\nreturn false;}if(getEvent(counter)){return true;}if(index>remoteRowCount&&index<remoteRowCount+wsEvents.length){return true;}return currentlyLoading.includes(counter);};var handleHostEventClick=function handleHostEventClick(hostEventToOpen){setHostEvent(hostEventToOpen);setIsHostModalOpen(true);};var handleHostModalClose=function handleHostModalClose(){setIsHostModalOpen(false);};var rowRenderer=function rowRenderer(_ref8){var index=_ref8.index,parent=_ref8.parent,key=_ref8.key,style=_ref8.style;var event;var node;try{var eventForRow=getEventForRow(index)||{};event=eventForRow.event;node=eventForRow.node;}catch(e){event=null;}if(!event&&index>remoteRowCount&&index<remoteRowCount+wsEvents.length){var _event;event=wsEvents[index-remoteRowCount];node={eventIndex:(_event=event)===null||_event===void 0?void 0:_event.counter,isCollapsed:false,children:[]};}var actualLineTextHtml=[];if(event){var _getLineTextHtml3=getLineTextHtml(event),lineTextHtml=_getLineTextHtml3.lineTextHtml;actualLineTextHtml=lineTextHtml;}return/*#__PURE__*/_jsx(CellMeasurer,{cache:cache,parent:parent,rowIndex:index,columnIndex:0,children:function children(_ref9){var measure=_ref9.measure;return event?/*#__PURE__*/_jsx(JobEvent,{isClickable:isHostEvent(event),onJobEventClick:function onJobEventClick(){return handleHostEventClick(event);},className:\"row\",style:style,lineTextHtml:actualLineTextHtml,index:index,event:event,measure:measure,isCollapsed:node.isCollapsed,hasChildren:node.children.length,onToggleCollapsed:function onToggleCollapsed(){toggleNodeIsCollapsed(event.uuid,!node.isCollapsed);},jobStatus:jobStatus}):/*#__PURE__*/_jsx(JobEventSkeleton,{className:\"row\",style:style,counter:index,contentLength:80,measure:measure});}},key);};var loadMoreRows=/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(_ref10){var _events2;var startIndex,stopIndex,range,diff,startCounter,_getEventRequestParam3,_getEventRequestParam4,requestParams,loadRange,qs,params,model,response,events,firstIndex,newCssMap,rowNumber,lastCounter;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:startIndex=_ref10.startIndex,stopIndex=_ref10.stopIndex;if(isMounted.current){_context5.next=3;break;}return _context5.abrupt(\"return\");case 3:if(!(startIndex===0&&stopIndex===0)){_context5.next=5;break;}return _context5.abrupt(\"return\");case 5:if(isMounted.current){setCurrentlyLoading(function(prevCurrentlyLoading){return prevCurrentlyLoading.concat(loadRange);});}range=[startIndex,stopIndex];if(!isFlatMode){diff=stopIndex-startIndex;startCounter=getCounterForRow(startIndex);range=[startCounter,startCounter+diff];}_getEventRequestParam3=getEventRequestParams(job,remoteRowCount,range),_getEventRequestParam4=_slicedToArray(_getEventRequestParam3,2),requestParams=_getEventRequestParam4[0],loadRange=_getEventRequestParam4[1];qs=parseQueryString(QS_CONFIG,location.search);params=_objectSpread(_objectSpread({},requestParams),qs);if(isFlatMode){params.not__stdout='';}model=getJobModel(job.type);_context5.prev=13;_context5.next=16;return model.readEvents(job.id,params);case 16:response=_context5.sent;_context5.next=24;break;case 19:_context5.prev=19;_context5.t0=_context5[\"catch\"](13);if(!(_context5.t0.response.status===404)){_context5.next=23;break;}return _context5.abrupt(\"return\");case 23:throw _context5.t0;case 24:if(isMounted.current){_context5.next=26;break;}return _context5.abrupt(\"return\");case 26:events=response.data.results;firstIndex=(params.page-1)*params.page_size;rowNumber=firstIndex;events.forEach(function(event){event.rowNumber=rowNumber;rowNumber++;var _getLineTextHtml4=getLineTextHtml(event),lineCssMap=_getLineTextHtml4.lineCssMap;newCssMap=_objectSpread(_objectSpread({},newCssMap),lineCssMap);});setCssMap(function(prevCssMap){return _objectSpread(_objectSpread({},prevCssMap),newCssMap);});lastCounter=((_events2=events[events.length-1])===null||_events2===void 0?void 0:_events2.counter)||50;addEvents(events);if(lastCounter>highestLoadedCounter){setHighestLoadedCounter(lastCounter);}setCurrentlyLoading(function(prevCurrentlyLoading){return prevCurrentlyLoading.filter(function(n){return!loadRange.includes(n);});});loadRange.forEach(function(n){cache.clear(n);});if(isFollowModeEnabled){scrollToEnd();}case 37:case\"end\":return _context5.stop();}}},_callee5,null,[[13,19]]);}));return function loadMoreRows(_x2){return _ref11.apply(this,arguments);};}();var scrollToRow=function scrollToRow(rowIndex){setLastScrollPosition(rowIndex);if(listRef.current){listRef.current.scrollToRow(rowIndex);}};var handleScrollPrevious=function handleScrollPrevious(){var startIndex=listRef.current.Grid._renderedRowStartIndex;var stopIndex=listRef.current.Grid._renderedRowStopIndex;var scrollRange=stopIndex-startIndex;scrollToRow(Math.max(0,startIndex-scrollRange));setIsFollowModeEnabled(false);};var handleScrollNext=function handleScrollNext(){var startIndex=listRef.current.Grid._renderedRowStartIndex;var stopIndex=listRef.current.Grid._renderedRowStopIndex;var scrollRange=stopIndex-startIndex;scrollToRow(stopIndex+scrollRange);};var handleScrollFirst=function handleScrollFirst(){scrollToRow(0);setIsFollowModeEnabled(false);};var scrollToEnd=function scrollToEnd(){scrollToRow(-1);setTimeout(function(){return scrollToRow(-1);},100);};var handleScrollLast=function handleScrollLast(){scrollToEnd();setIsFollowModeEnabled(true);};var handleResize=function handleResize(_ref12){var width=_ref12.width;if(width!==previousWidth){var _listRef$current2;cache.clearAll();if((_listRef$current2=listRef.current)!==null&&_listRef$current2!==void 0&&_listRef$current2.recomputeRowHeights){listRef.current.recomputeRowHeights();}}previousWidth.current=width;};var handleScroll=function handleScroll(e){if(isFollowModeEnabled&&scrollTop.current>e.scrollTop&&scrollHeight.current===e.scrollHeight){setIsFollowModeEnabled(false);}scrollTop.current=e.scrollTop;scrollHeight.current=e.scrollHeight;if(e.scrollTop+e.clientHeight>=e.scrollHeight){setIsFollowModeEnabled(true);}};var handleExpandCollapseAll=function handleExpandCollapseAll(){toggleCollapseAll(!isAllCollapsed);};if(contentError){return/*#__PURE__*/_jsx(ContentError,{error:contentError});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(CardBody,{children:[isHostModalOpen&&/*#__PURE__*/_jsx(HostEventModal,{onClose:handleHostModalClose,isOpen:isHostModalOpen,hostEvent:hostEvent}),/*#__PURE__*/_jsxs(OutputHeader,{children:[/*#__PURE__*/_jsxs(HeaderTitle,{children:[/*#__PURE__*/_jsx(\"h1\",{children:job.name}),/*#__PURE__*/_jsx(StatusLabel,{status:job.status})]}),/*#__PURE__*/_jsx(OutputToolbar,{job:job,jobStatus:jobStatus,onCancel:function onCancel(){return setShowCancelModal(true);},onDelete:deleteJob,isDeleteDisabled:isDeleting})]}),/*#__PURE__*/_jsx(HostStatusBar,{counts:job.host_status_counts||{}}),/*#__PURE__*/_jsx(JobOutputSearch,{qsConfig:QS_CONFIG,job:job,eventRelatedSearchableKeys:eventRelatedSearchableKeys,eventSearchableKeys:eventSearchableKeys,scrollToEnd:scrollToEnd,isFollowModeEnabled:isFollowModeEnabled,setIsFollowModeEnabled:setIsFollowModeEnabled}),/*#__PURE__*/_jsx(PageControls,{onScrollFirst:handleScrollFirst,onScrollLast:handleScrollLast,onScrollNext:handleScrollNext,onScrollPrevious:handleScrollPrevious,toggleExpandCollapseAll:handleExpandCollapseAll,isFlatMode:isFlatMode||forceFlatMode,isTemplateJob:job.type==='job',isAllCollapsed:isAllCollapsed}),/*#__PURE__*/_jsxs(OutputWrapper,{cssMap:cssMap,children:[/*#__PURE__*/_jsx(InfiniteLoader,{isRowLoaded:isRowLoaded,loadMoreRows:loadMoreRows,rowCount:totalNonCollapsedRows+wsEvents.length,minimumBatchSize:50,children:function children(_ref13){var onRowsRendered=_ref13.onRowsRendered,registerChild=_ref13.registerChild;if(!hasContentLoading&&remoteRowCount+wsEvents.length===0){return/*#__PURE__*/_jsx(EmptyOutput,{job:job,hasQueryParams:location.search.length>1,isJobRunning:isJobRunning(jobStatus),onUnmount:function onUnmount(){var _listRef$current3;if((_listRef$current3=listRef.current)!==null&&_listRef$current3!==void 0&&_listRef$current3.recomputeRowHeights){listRef.current.recomputeRowHeights();}}});}return/*#__PURE__*/_jsx(AutoSizer,{nonce:window.NONCE_ID,onResize:handleResize,children:function children(_ref14){var width=_ref14.width,height=_ref14.height;return/*#__PURE__*/_jsx(_Fragment,{children:hasContentLoading?/*#__PURE__*/_jsx(\"div\",{style:{width:width},children:/*#__PURE__*/_jsx(ContentLoading,{})}):/*#__PURE__*/_jsx(List,{ref:function ref(_ref15){registerChild(_ref15);listRef.current=_ref15;},deferredMeasurementCache:cache,height:height||1,onRowsRendered:onRowsRendered,rowCount:totalNonCollapsedRows+wsEvents.length,rowHeight:cache.rowHeight,rowRenderer:rowRenderer,width:width||1,overscanRowCount:20,onScroll:handleScroll})});}});}}),/*#__PURE__*/_jsx(OutputFooter,{})]})]}),showCancelModal&&isJobRunning(job.status)&&/*#__PURE__*/_jsx(AlertModal,{isOpen:showCancelModal,variant:\"danger\",onClose:function onClose(){return setShowCancelModal(false);},title:/*i18n*/i18n._(\"Cancel Job\"),label:/*i18n*/i18n._(\"Cancel Job\"),actions:[/*#__PURE__*/_jsx(Button,{id:\"cancel-job-confirm-button\",variant:\"danger\",isDisabled:isCancelling,\"aria-label\":/*i18n*/i18n._(\"Cancel job\"),onClick:cancelJob,children:/*i18n*/i18n._(\"Cancel job\")},\"delete\"),/*#__PURE__*/_jsx(Button,{id:\"cancel-job-return-button\",variant:\"secondary\",\"aria-label\":/*i18n*/i18n._(\"Return\"),onClick:function onClick(){return setShowCancelModal(false);},children:/*i18n*/i18n._(\"Return\")},\"cancel\")],children:/*i18n*/i18n._(\"Are you sure you want to submit the request to cancel this job?\")}),dismissableDeleteError&&/*#__PURE__*/_jsx(AlertModal,{isOpen:dismissableDeleteError,variant:\"danger\",onClose:dismissDeleteError,title:/*i18n*/i18n._(\"Job Delete Error\"),label:/*i18n*/i18n._(\"Job Delete Error\"),children:/*#__PURE__*/_jsx(ErrorDetail,{error:dismissableDeleteError})}),dismissableCancelError&&/*#__PURE__*/_jsx(AlertModal,{isOpen:dismissableCancelError,variant:\"danger\",onClose:dismissCancelError,title:/*i18n*/i18n._(\"Job Cancel Error\"),label:/*i18n*/i18n._(\"Job Cancel Error\"),children:/*#__PURE__*/_jsx(ErrorDetail,{error:dismissableCancelError})})]});}export default JobOutput;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Job/JobOutput/JobOutput.js"],"names":["React","useCallback","useEffect","useRef","useState","useHistory","useLocation","styled","AutoSizer","CellMeasurer","CellMeasurerCache","InfiniteLoader","List","Button","AlertModal","CardBody","_CardBody","ContentError","ContentLoading","ErrorDetail","StatusLabel","JobsAPI","getJobModel","isJobRunning","useRequest","useDismissableError","useInterval","parseQueryString","getQSConfig","useIsMounted","JobEvent","JobEventSkeleton","PageControls","HostEventModal","JobOutputSearch","EmptyOutput","HostStatusBar","OutputToolbar","getLineTextHtml","connectJobSocket","closeWebSocket","getEventRequestParams","isHostEvent","prependTraceback","useJobEvents","QS_CONFIG","order_by","HeaderTitle","div","OutputHeader","OutputWrapper","cssMap","Object","keys","map","className","OutputFooter","cache","fixedWidth","defaultHeight","JobOutput","job","eventRelatedSearchableKeys","eventSearchableKeys","location","listRef","previousWidth","jobSocketCounter","isMounted","scrollTop","scrollHeight","history","eventByUuidRequests","fetchEventByUuid","uuid","promise","current","type","readEvents","id","data","results","fetchChildrenSummary","readChildrenSummary","status","jobStatus","setJobStatus","forceFlatMode","setForceFlatMode","isFlatMode","search","length","isTreeReady","setIsTreeReady","onReadyEvents","setOnReadyEvents","setJobTreeReady","addEvents","toggleNodeIsCollapsed","toggleCollapseAll","getEventForRow","getNumCollapsedEvents","getCounterForRow","getEvent","clearLoadedEvents","rebuildEventsTree","isAllCollapsed","wsEvents","setWsEvents","setCssMap","remoteRowCount","setRemoteRowCount","contentError","setContentError","currentlyLoading","setCurrentlyLoading","hasContentLoading","setHasContentLoading","hostEvent","setHostEvent","isHostModalOpen","setIsHostModalOpen","showCancelModal","setShowCancelModal","highestLoadedCounter","setHighestLoadedCounter","isFollowModeEnabled","setIsFollowModeEnabled","isMonitoringWebsocket","setIsMonitoringWebsocket","lastScrollPosition","setLastScrollPosition","setTimeout","scrollToEnd","totalNonCollapsedRows","Math","max","monitorJobSocketCounter","pendingRequests","values","Promise","allSettled","then","loadJobEvents","scrollToRow","batchTimeout","batchedEvents","addBatchedEvents","min","newCssMap","forEach","event","counter","lineCssMap","oldWsEvents","updated","concat","sort","a","b","prevCssMap","group_name","push","clearTimeout","unified_job_id","final_counter","cleanup","recomputeRowHeights","cancel","cancelError","error","isCancelling","isLoading","cancelJob","request","dismissableCancelError","dismissCancelError","dismissError","destroy","deleteJob","isDeleting","deleteError","dismissableDeleteError","dismissDeleteError","params","loadRange","prevCurrentlyLoading","not__stdout","qsParams","eventPromise","count","fetchedEvents","rowNumber","events","countOffset","lastCounter","prev","filter","n","includes","clear","isRowLoaded","index","e","console","handleHostEventClick","hostEventToOpen","handleHostModalClose","rowRenderer","parent","key","style","node","eventForRow","eventIndex","isCollapsed","children","actualLineTextHtml","lineTextHtml","measure","loadMoreRows","startIndex","stopIndex","range","diff","startCounter","requestParams","qs","model","response","firstIndex","page","page_size","rowIndex","handleScrollPrevious","Grid","_renderedRowStartIndex","_renderedRowStopIndex","scrollRange","handleScrollNext","handleScrollFirst","handleScrollLast","handleResize","width","clearAll","handleScroll","clientHeight","handleExpandCollapseAll","name","host_status_counts","onRowsRendered","registerChild","window","NONCE_ID","height","ref","rowHeight"],"mappings":"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","sourcesContent":["/* eslint-disable react/jsx-no-useless-fragment */\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport styled from 'styled-components';\nimport {\n  AutoSizer,\n  CellMeasurer,\n  CellMeasurerCache,\n  InfiniteLoader,\n  List,\n} from 'react-virtualized';\nimport { Button } from '@patternfly/react-core';\n\nimport AlertModal from 'components/AlertModal';\nimport { CardBody as _CardBody } from 'components/Card';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport ErrorDetail from 'components/ErrorDetail';\nimport StatusLabel from 'components/StatusLabel';\nimport { JobsAPI } from 'api';\n\nimport { getJobModel, isJobRunning } from 'util/jobs';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport useInterval from 'hooks/useInterval';\nimport { parseQueryString, getQSConfig } from 'util/qs';\nimport useIsMounted from 'hooks/useIsMounted';\nimport JobEvent from './JobEvent';\nimport JobEventSkeleton from './JobEventSkeleton';\nimport PageControls from './PageControls';\nimport HostEventModal from './HostEventModal';\nimport JobOutputSearch from './JobOutputSearch';\nimport EmptyOutput from './EmptyOutput';\nimport { HostStatusBar, OutputToolbar } from './shared';\nimport getLineTextHtml from './getLineTextHtml';\nimport connectJobSocket, { closeWebSocket } from './connectJobSocket';\nimport getEventRequestParams from './getEventRequestParams';\nimport isHostEvent from './isHostEvent';\nimport { prependTraceback } from './loadJobEvents';\nimport useJobEvents from './useJobEvents';\n\nconst QS_CONFIG = getQSConfig('job_output', {\n  order_by: 'counter',\n});\n\nconst CardBody = styled(_CardBody)`\n  display: flex;\n  flex-flow: column;\n  height: calc(100vh - 267px);\n`;\n\nconst HeaderTitle = styled.div`\n  display: inline-flex;\n  align-items: center;\n  h1 {\n    margin-right: 10px;\n    font-weight: var(--pf-global--FontWeight--bold);\n  }\n`;\n\nconst OutputHeader = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\n\nconst OutputWrapper = styled.div`\n  background-color: #ffffff;\n  display: flex;\n  flex-direction: column;\n  flex: 1 1 auto;\n  font-family: monospace;\n  font-size: 15px;\n  outline: 1px solid #d7d7d7;\n  ${({ cssMap }) =>\n    Object.keys(cssMap).map(\n      (className) => `.${className}{${cssMap[className]}}`\n    )}\n`;\n\nconst OutputFooter = styled.div`\n  background-color: #ebebeb;\n  border-right: 1px solid #d7d7d7;\n  width: 75px;\n  flex: 1;\n`;\n\nconst cache = new CellMeasurerCache({\n  fixedWidth: true,\n  defaultHeight: 25,\n});\n\nfunction JobOutput({ job, eventRelatedSearchableKeys, eventSearchableKeys }) {\n  const location = useLocation();\n  const listRef = useRef(null);\n  const previousWidth = useRef(0);\n  const jobSocketCounter = useRef(0);\n  const isMounted = useIsMounted();\n  const scrollTop = useRef(0);\n  const scrollHeight = useRef(0);\n  const history = useHistory();\n  const eventByUuidRequests = useRef([]);\n\n  const fetchEventByUuid = async (uuid) => {\n    let promise = eventByUuidRequests.current[uuid];\n    if (!promise) {\n      promise = getJobModel(job.type).readEvents(job.id, { uuid });\n      eventByUuidRequests.current[uuid] = promise;\n    }\n    const { data } = await promise;\n    eventByUuidRequests.current[uuid] = null;\n    return data.results[0] || null;\n  };\n\n  const fetchChildrenSummary = () => JobsAPI.readChildrenSummary(job.id);\n\n  const [jobStatus, setJobStatus] = useState(job.status ?? 'waiting');\n  const [forceFlatMode, setForceFlatMode] = useState(false);\n  const isFlatMode =\n    isJobRunning(jobStatus) || location.search.length > 1 || job.type !== 'job';\n  const [isTreeReady, setIsTreeReady] = useState(false);\n  const [onReadyEvents, setOnReadyEvents] = useState([]);\n\n  const {\n    addEvents,\n    toggleNodeIsCollapsed,\n    toggleCollapseAll,\n    getEventForRow,\n    getNumCollapsedEvents,\n    getCounterForRow,\n    getEvent,\n    clearLoadedEvents,\n    rebuildEventsTree,\n    isAllCollapsed,\n  } = useJobEvents(\n    {\n      fetchEventByUuid,\n      fetchChildrenSummary,\n      setForceFlatMode,\n      setJobTreeReady: () => setIsTreeReady(true),\n    },\n    job.id,\n    isFlatMode || forceFlatMode\n  );\n  const [wsEvents, setWsEvents] = useState([]);\n  const [cssMap, setCssMap] = useState({});\n  const [remoteRowCount, setRemoteRowCount] = useState(0);\n  const [contentError, setContentError] = useState(null);\n  const [currentlyLoading, setCurrentlyLoading] = useState([]);\n  const [hasContentLoading, setHasContentLoading] = useState(true);\n  const [hostEvent, setHostEvent] = useState({});\n  const [isHostModalOpen, setIsHostModalOpen] = useState(false);\n  const [showCancelModal, setShowCancelModal] = useState(false);\n  const [highestLoadedCounter, setHighestLoadedCounter] = useState(0);\n  const [isFollowModeEnabled, setIsFollowModeEnabled] = useState(\n    isJobRunning(job.status)\n  );\n  const [isMonitoringWebsocket, setIsMonitoringWebsocket] = useState(false);\n  const [lastScrollPosition, setLastScrollPosition] = useState(0);\n\n  useEffect(() => {\n    if (!isTreeReady || !onReadyEvents.length) {\n      return;\n    }\n    addEvents(onReadyEvents);\n    setOnReadyEvents([]);\n    if (isFollowModeEnabled) {\n      setTimeout(() => {\n        scrollToEnd();\n      }, 0);\n    }\n  }, [isTreeReady, onReadyEvents]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const totalNonCollapsedRows = Math.max(\n    remoteRowCount - getNumCollapsedEvents(),\n    0\n  );\n\n  useInterval(\n    () => {\n      monitorJobSocketCounter();\n    },\n    isMonitoringWebsocket ? 5000 : null\n  );\n\n  useEffect(() => {\n    const pendingRequests = Object.values(eventByUuidRequests.current || {});\n    setHasContentLoading(true); // prevents \"no content found\" screen from flashing\n    Promise.allSettled(pendingRequests).then(() => {\n      setRemoteRowCount(0);\n      clearLoadedEvents();\n      loadJobEvents();\n    });\n  }, [location.search]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(() => {\n    rebuildEventsTree();\n  }, [isFlatMode]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(() => {\n    if (!isJobRunning(jobStatus)) {\n      setTimeout(() => {\n        loadJobEvents().then(() => {\n          setWsEvents([]);\n          scrollToRow(lastScrollPosition);\n        });\n      }, 500);\n      return;\n    }\n    let batchTimeout;\n    let batchedEvents = [];\n    connectJobSocket(job, (data) => {\n      const addBatchedEvents = () => {\n        let min;\n        let max;\n        let newCssMap;\n        batchedEvents.forEach((event) => {\n          if (!min || event.counter < min) {\n            min = event.counter;\n          }\n          if (!max || event.counter > max) {\n            max = event.counter;\n          }\n          const { lineCssMap } = getLineTextHtml(event);\n          newCssMap = {\n            ...newCssMap,\n            ...lineCssMap,\n          };\n        });\n        setWsEvents((oldWsEvents) => {\n          const updated = oldWsEvents.concat(batchedEvents);\n          jobSocketCounter.current = updated.length;\n          return updated.sort((a, b) => a.counter - b.counter);\n        });\n        setCssMap((prevCssMap) => ({\n          ...prevCssMap,\n          ...newCssMap,\n        }));\n        if (max > jobSocketCounter.current) {\n          jobSocketCounter.current = max;\n        }\n        batchedEvents = [];\n      };\n\n      if (data.group_name === `${job.type}_events`) {\n        batchedEvents.push(data);\n        clearTimeout(batchTimeout);\n        if (batchedEvents.length >= 10) {\n          addBatchedEvents();\n        } else {\n          batchTimeout = setTimeout(addBatchedEvents, 500);\n        }\n      }\n      if (data.group_name === 'jobs' && data.unified_job_id === job.id) {\n        if (data.final_counter) {\n          jobSocketCounter.current = data.final_counter;\n        }\n        if (data.status) {\n          setJobStatus(data.status);\n        }\n      }\n    });\n    setIsMonitoringWebsocket(true);\n\n    // eslint-disable-next-line consistent-return\n    return function cleanup() {\n      clearTimeout(batchTimeout);\n      closeWebSocket();\n      setIsMonitoringWebsocket(false);\n      isMounted.current = false;\n    };\n  }, [isJobRunning(jobStatus)]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(() => {\n    if (isFollowModeEnabled) {\n      scrollToEnd();\n    }\n  }, [wsEvents.length, isFollowModeEnabled]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(() => {\n    if (listRef.current?.recomputeRowHeights) {\n      listRef.current.recomputeRowHeights();\n    }\n  }, [currentlyLoading, cssMap, remoteRowCount, wsEvents.length]);\n\n  useEffect(() => {\n    if (!jobStatus || isJobRunning(jobStatus)) {\n      return;\n    }\n\n    if (isMonitoringWebsocket) {\n      setIsMonitoringWebsocket(false);\n    }\n\n    if (isFollowModeEnabled) {\n      setTimeout(() => setIsFollowModeEnabled(false), 1000);\n    }\n  }, [jobStatus]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const {\n    error: cancelError,\n    isLoading: isCancelling,\n    request: cancelJob,\n  } = useRequest(\n    useCallback(async () => {\n      await getJobModel(job.type).cancel(job.id);\n    }, [job.id, job.type]),\n    {}\n  );\n\n  const { error: dismissableCancelError, dismissError: dismissCancelError } =\n    useDismissableError(cancelError);\n\n  const {\n    request: deleteJob,\n    isLoading: isDeleting,\n    error: deleteError,\n  } = useRequest(\n    useCallback(async () => {\n      await getJobModel(job.type).destroy(job.id);\n\n      history.push('/jobs');\n    }, [job.type, job.id, history])\n  );\n\n  const { error: dismissableDeleteError, dismissError: dismissDeleteError } =\n    useDismissableError(deleteError);\n\n  const monitorJobSocketCounter = () => {\n    if (\n      jobSocketCounter.current === remoteRowCount &&\n      !isJobRunning(job.status)\n    ) {\n      setIsMonitoringWebsocket(false);\n    }\n  };\n\n  const loadJobEvents = async () => {\n    const [params, loadRange] = getEventRequestParams(job, 50, [1, 50]);\n\n    if (isMounted.current) {\n      setHasContentLoading(true);\n      setCurrentlyLoading((prevCurrentlyLoading) =>\n        prevCurrentlyLoading.concat(loadRange)\n      );\n    }\n\n    if (isFlatMode) {\n      params.not__stdout = '';\n    }\n    const qsParams = parseQueryString(QS_CONFIG, location.search);\n    const eventPromise = getJobModel(job.type).readEvents(job.id, {\n      ...params,\n      ...qsParams,\n    });\n\n    try {\n      const {\n        data: { count, results: fetchedEvents = [] },\n      } = await eventPromise;\n\n      if (!isMounted.current) {\n        return;\n      }\n      let newCssMap;\n      let rowNumber = 0;\n      const { events, countOffset } = prependTraceback(job, fetchedEvents);\n      events.forEach((event) => {\n        event.rowNumber = rowNumber;\n        rowNumber++;\n        const { lineCssMap } = getLineTextHtml(event);\n        newCssMap = {\n          ...newCssMap,\n          ...lineCssMap,\n        };\n      });\n      setCssMap((prevCssMap) => ({\n        ...prevCssMap,\n        ...newCssMap,\n      }));\n      const lastCounter = events[events.length - 1]?.counter || 50;\n      if (isTreeReady) {\n        addEvents(events);\n      } else {\n        setOnReadyEvents((prev) => prev.concat(events));\n      }\n      setHighestLoadedCounter(lastCounter);\n      setRemoteRowCount(count + countOffset);\n    } catch (err) {\n      setContentError(err);\n    } finally {\n      if (isMounted.current) {\n        setHasContentLoading(false);\n        setCurrentlyLoading((prevCurrentlyLoading) =>\n          prevCurrentlyLoading.filter((n) => !loadRange.includes(n))\n        );\n        loadRange.forEach((n) => {\n          cache.clear(n);\n        });\n      }\n    }\n  };\n\n  const isRowLoaded = ({ index }) => {\n    let counter;\n    try {\n      counter = getCounterForRow(index);\n    } catch (e) {\n      console.error(e); // eslint-disable-line no-console\n      return false;\n    }\n    if (getEvent(counter)) {\n      return true;\n    }\n    if (index > remoteRowCount && index < remoteRowCount + wsEvents.length) {\n      return true;\n    }\n    return currentlyLoading.includes(counter);\n  };\n\n  const handleHostEventClick = (hostEventToOpen) => {\n    setHostEvent(hostEventToOpen);\n    setIsHostModalOpen(true);\n  };\n\n  const handleHostModalClose = () => {\n    setIsHostModalOpen(false);\n  };\n\n  const rowRenderer = ({ index, parent, key, style }) => {\n    let event;\n    let node;\n    try {\n      const eventForRow = getEventForRow(index) || {};\n      event = eventForRow.event;\n      node = eventForRow.node;\n    } catch (e) {\n      event = null;\n    }\n    if (\n      !event &&\n      index > remoteRowCount &&\n      index < remoteRowCount + wsEvents.length\n    ) {\n      event = wsEvents[index - remoteRowCount];\n      node = {\n        eventIndex: event?.counter,\n        isCollapsed: false,\n        children: [],\n      };\n    }\n    let actualLineTextHtml = [];\n    if (event) {\n      const { lineTextHtml } = getLineTextHtml(event);\n      actualLineTextHtml = lineTextHtml;\n    }\n\n    return (\n      <CellMeasurer\n        key={key}\n        cache={cache}\n        parent={parent}\n        rowIndex={index}\n        columnIndex={0}\n      >\n        {({ measure }) =>\n          event ? (\n            <JobEvent\n              isClickable={isHostEvent(event)}\n              onJobEventClick={() => handleHostEventClick(event)}\n              className=\"row\"\n              style={style}\n              lineTextHtml={actualLineTextHtml}\n              index={index}\n              event={event}\n              measure={measure}\n              isCollapsed={node.isCollapsed}\n              hasChildren={node.children.length}\n              onToggleCollapsed={() => {\n                toggleNodeIsCollapsed(event.uuid, !node.isCollapsed);\n              }}\n              jobStatus={jobStatus}\n            />\n          ) : (\n            <JobEventSkeleton\n              className=\"row\"\n              style={style}\n              counter={index}\n              contentLength={80}\n              measure={measure}\n            />\n          )\n        }\n      </CellMeasurer>\n    );\n  };\n\n  const loadMoreRows = async ({ startIndex, stopIndex }) => {\n    if (!isMounted.current) {\n      return;\n    }\n    if (startIndex === 0 && stopIndex === 0) {\n      return;\n    }\n\n    if (isMounted.current) {\n      setCurrentlyLoading((prevCurrentlyLoading) =>\n        prevCurrentlyLoading.concat(loadRange)\n      );\n    }\n\n    let range = [startIndex, stopIndex];\n    if (!isFlatMode) {\n      const diff = stopIndex - startIndex;\n      const startCounter = getCounterForRow(startIndex);\n      range = [startCounter, startCounter + diff];\n    }\n\n    const [requestParams, loadRange] = getEventRequestParams(\n      job,\n      remoteRowCount,\n      range\n    );\n    const qs = parseQueryString(QS_CONFIG, location.search);\n    const params = {\n      ...requestParams,\n      ...qs,\n    };\n    if (isFlatMode) {\n      params.not__stdout = '';\n    }\n\n    const model = getJobModel(job.type);\n\n    let response;\n    try {\n      response = await model.readEvents(job.id, params);\n    } catch (error) {\n      if (error.response.status === 404) {\n        return;\n      }\n      throw error;\n    }\n    if (!isMounted.current) {\n      return;\n    }\n    const events = response.data.results;\n    const firstIndex = (params.page - 1) * params.page_size;\n\n    let newCssMap;\n    let rowNumber = firstIndex;\n    events.forEach((event) => {\n      event.rowNumber = rowNumber;\n      rowNumber++;\n      const { lineCssMap } = getLineTextHtml(event);\n      newCssMap = {\n        ...newCssMap,\n        ...lineCssMap,\n      };\n    });\n    setCssMap((prevCssMap) => ({\n      ...prevCssMap,\n      ...newCssMap,\n    }));\n\n    const lastCounter = events[events.length - 1]?.counter || 50;\n    addEvents(events);\n    if (lastCounter > highestLoadedCounter) {\n      setHighestLoadedCounter(lastCounter);\n    }\n    setCurrentlyLoading((prevCurrentlyLoading) =>\n      prevCurrentlyLoading.filter((n) => !loadRange.includes(n))\n    );\n    loadRange.forEach((n) => {\n      cache.clear(n);\n    });\n    if (isFollowModeEnabled) {\n      scrollToEnd();\n    }\n  };\n\n  const scrollToRow = (rowIndex) => {\n    setLastScrollPosition(rowIndex);\n    if (listRef.current) {\n      listRef.current.scrollToRow(rowIndex);\n    }\n  };\n\n  const handleScrollPrevious = () => {\n    const startIndex = listRef.current.Grid._renderedRowStartIndex;\n    const stopIndex = listRef.current.Grid._renderedRowStopIndex;\n    const scrollRange = stopIndex - startIndex;\n    scrollToRow(Math.max(0, startIndex - scrollRange));\n    setIsFollowModeEnabled(false);\n  };\n\n  const handleScrollNext = () => {\n    const startIndex = listRef.current.Grid._renderedRowStartIndex;\n    const stopIndex = listRef.current.Grid._renderedRowStopIndex;\n    const scrollRange = stopIndex - startIndex;\n    scrollToRow(stopIndex + scrollRange);\n  };\n\n  const handleScrollFirst = () => {\n    scrollToRow(0);\n    setIsFollowModeEnabled(false);\n  };\n\n  const scrollToEnd = () => {\n    scrollToRow(-1);\n    setTimeout(() => scrollToRow(-1), 100);\n  };\n\n  const handleScrollLast = () => {\n    scrollToEnd();\n    setIsFollowModeEnabled(true);\n  };\n\n  const handleResize = ({ width }) => {\n    if (width !== previousWidth) {\n      cache.clearAll();\n      if (listRef.current?.recomputeRowHeights) {\n        listRef.current.recomputeRowHeights();\n      }\n    }\n    previousWidth.current = width;\n  };\n\n  const handleScroll = (e) => {\n    if (\n      isFollowModeEnabled &&\n      scrollTop.current > e.scrollTop &&\n      scrollHeight.current === e.scrollHeight\n    ) {\n      setIsFollowModeEnabled(false);\n    }\n    scrollTop.current = e.scrollTop;\n    scrollHeight.current = e.scrollHeight;\n    if (e.scrollTop + e.clientHeight >= e.scrollHeight) {\n      setIsFollowModeEnabled(true);\n    }\n  };\n\n  const handleExpandCollapseAll = () => {\n    toggleCollapseAll(!isAllCollapsed);\n  };\n\n  if (contentError) {\n    return <ContentError error={contentError} />;\n  }\n\n  return (\n    <>\n      <CardBody>\n        {isHostModalOpen && (\n          <HostEventModal\n            onClose={handleHostModalClose}\n            isOpen={isHostModalOpen}\n            hostEvent={hostEvent}\n          />\n        )}\n        <OutputHeader>\n          <HeaderTitle>\n            <h1>{job.name}</h1>\n            <StatusLabel status={job.status} />\n          </HeaderTitle>\n          <OutputToolbar\n            job={job}\n            jobStatus={jobStatus}\n            onCancel={() => setShowCancelModal(true)}\n            onDelete={deleteJob}\n            isDeleteDisabled={isDeleting}\n          />\n        </OutputHeader>\n        <HostStatusBar counts={job.host_status_counts || {}} />\n        <JobOutputSearch\n          qsConfig={QS_CONFIG}\n          job={job}\n          eventRelatedSearchableKeys={eventRelatedSearchableKeys}\n          eventSearchableKeys={eventSearchableKeys}\n          scrollToEnd={scrollToEnd}\n          isFollowModeEnabled={isFollowModeEnabled}\n          setIsFollowModeEnabled={setIsFollowModeEnabled}\n        />\n        <PageControls\n          onScrollFirst={handleScrollFirst}\n          onScrollLast={handleScrollLast}\n          onScrollNext={handleScrollNext}\n          onScrollPrevious={handleScrollPrevious}\n          toggleExpandCollapseAll={handleExpandCollapseAll}\n          isFlatMode={isFlatMode || forceFlatMode}\n          isTemplateJob={job.type === 'job'}\n          isAllCollapsed={isAllCollapsed}\n        />\n        <OutputWrapper cssMap={cssMap}>\n          <InfiniteLoader\n            isRowLoaded={isRowLoaded}\n            loadMoreRows={loadMoreRows}\n            rowCount={totalNonCollapsedRows + wsEvents.length}\n            minimumBatchSize={50}\n          >\n            {({ onRowsRendered, registerChild }) => {\n              if (\n                !hasContentLoading &&\n                remoteRowCount + wsEvents.length === 0\n              ) {\n                return (\n                  <EmptyOutput\n                    job={job}\n                    hasQueryParams={location.search.length > 1}\n                    isJobRunning={isJobRunning(jobStatus)}\n                    onUnmount={() => {\n                      if (listRef.current?.recomputeRowHeights) {\n                        listRef.current.recomputeRowHeights();\n                      }\n                    }}\n                  />\n                );\n              }\n              return (\n                <AutoSizer nonce={window.NONCE_ID} onResize={handleResize}>\n                  {({ width, height }) => (\n                    <>\n                      {hasContentLoading ? (\n                        <div style={{ width }}>\n                          <ContentLoading />\n                        </div>\n                      ) : (\n                        <List\n                          ref={(ref) => {\n                            registerChild(ref);\n                            listRef.current = ref;\n                          }}\n                          deferredMeasurementCache={cache}\n                          height={height || 1}\n                          onRowsRendered={onRowsRendered}\n                          rowCount={totalNonCollapsedRows + wsEvents.length}\n                          rowHeight={cache.rowHeight}\n                          rowRenderer={rowRenderer}\n                          width={width || 1}\n                          overscanRowCount={20}\n                          onScroll={handleScroll}\n                        />\n                      )}\n                    </>\n                  )}\n                </AutoSizer>\n              );\n            }}\n          </InfiniteLoader>\n          <OutputFooter />\n        </OutputWrapper>\n      </CardBody>\n      {showCancelModal && isJobRunning(job.status) && (\n        <AlertModal\n          isOpen={showCancelModal}\n          variant=\"danger\"\n          onClose={() => setShowCancelModal(false)}\n          title={t`Cancel Job`}\n          label={t`Cancel Job`}\n          actions={[\n            <Button\n              id=\"cancel-job-confirm-button\"\n              key=\"delete\"\n              variant=\"danger\"\n              isDisabled={isCancelling}\n              aria-label={t`Cancel job`}\n              onClick={cancelJob}\n            >\n              {t`Cancel job`}\n            </Button>,\n            <Button\n              id=\"cancel-job-return-button\"\n              key=\"cancel\"\n              variant=\"secondary\"\n              aria-label={t`Return`}\n              onClick={() => setShowCancelModal(false)}\n            >\n              {t`Return`}\n            </Button>,\n          ]}\n        >\n          {t`Are you sure you want to submit the request to cancel this job?`}\n        </AlertModal>\n      )}\n      {dismissableDeleteError && (\n        <AlertModal\n          isOpen={dismissableDeleteError}\n          variant=\"danger\"\n          onClose={dismissDeleteError}\n          title={t`Job Delete Error`}\n          label={t`Job Delete Error`}\n        >\n          <ErrorDetail error={dismissableDeleteError} />\n        </AlertModal>\n      )}\n      {dismissableCancelError && (\n        <AlertModal\n          isOpen={dismissableCancelError}\n          variant=\"danger\"\n          onClose={dismissCancelError}\n          title={t`Job Cancel Error`}\n          label={t`Job Cancel Error`}\n        >\n          <ErrorDetail error={dismissableCancelError} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nexport default JobOutput;\n"]},"metadata":{},"sourceType":"module"}