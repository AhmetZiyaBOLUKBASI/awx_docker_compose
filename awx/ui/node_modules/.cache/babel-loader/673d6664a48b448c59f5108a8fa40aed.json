{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{Formik}from'formik';import{Form}from'@patternfly/react-core';import{CardBody}from'components/Card';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import{FormSubmitError}from'components/FormField';import{FormColumnLayout}from'components/FormLayout';import{useSettings}from'contexts/Settings';import useModal from'hooks/useModal';import useRequest from'hooks/useRequest';import{SettingsAPI,ExecutionEnvironmentsAPI}from'api';import{BooleanField,EncryptedField,ExecutionEnvField,InputField,ObjectField,RevertAllAlert,RevertFormActionGroup}from'../../shared';import{pluck,formatJson}from'../../shared/settingUtils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function MiscSystemEdit(){var _system$DEFAULT_EXECU;var history=useHistory();var _useModal=useModal(),isModalOpen=_useModal.isModalOpen,toggleModal=_useModal.toggleModal,closeModal=_useModal.closeModal;var _useSettings=useSettings(),options=_useSettings.PUT;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$SettingsAPI$re,data,systemData,mergedData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return SettingsAPI.readCategory('system');case 2:_yield$SettingsAPI$re=_context.sent;data=_yield$SettingsAPI$re.data;systemData=pluck(data,'ACTIVITY_STREAM_ENABLED','ACTIVITY_STREAM_ENABLED_FOR_INVENTORY_SYNC','AUTOMATION_ANALYTICS_GATHER_INTERVAL','AUTOMATION_ANALYTICS_URL','AUTOMATION_ANALYTICS_LAST_ENTRIES','INSIGHTS_TRACKING_STATE','MANAGE_ORGANIZATION_AUTH','ORG_ADMINS_CAN_SEE_ALL_USERS','REDHAT_USERNAME','REDHAT_PASSWORD','SUBSCRIPTIONS_USERNAME','SUBSCRIPTIONS_PASSWORD','REMOTE_HOST_HEADERS','TOWER_URL_BASE','DEFAULT_EXECUTION_ENVIRONMENT','PROXY_IP_ALLOWED_LIST');mergedData={};Object.keys(systemData).forEach(function(key){if(!options[key]){return;}mergedData[key]=options[key];mergedData[key].value=systemData[key];});return _context.abrupt(\"return\",mergedData);case 8:case\"end\":return _context.stop();}}},_callee);})),[options]),null),isLoading=_useRequest.isLoading,error=_useRequest.error,fetchSystem=_useRequest.request,system=_useRequest.result;useEffect(function(){fetchSystem();},[fetchSystem]);var _useRequest2=useRequest(useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return SettingsAPI.updateAll(values);case 2:history.push('/settings/miscellaneous_system/details');case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}(),[history]),null),submitError=_useRequest2.error,submitForm=_useRequest2.request;var _useRequest3=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return SettingsAPI.revertCategory('system');case 2:case\"end\":return _context3.stop();}}},_callee3);})),[]),null),revertError=_useRequest3.error,revertAll=_useRequest3.request;var handleSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(form){var _form$DEFAULT_EXECUTI;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return submitForm(_objectSpread(_objectSpread({},form),{},{PROXY_IP_ALLOWED_LIST:formatJson(form.PROXY_IP_ALLOWED_LIST),REMOTE_HOST_HEADERS:formatJson(form.REMOTE_HOST_HEADERS),DEFAULT_EXECUTION_ENVIRONMENT:((_form$DEFAULT_EXECUTI=form.DEFAULT_EXECUTION_ENVIRONMENT)===null||_form$DEFAULT_EXECUTI===void 0?void 0:_form$DEFAULT_EXECUTI.id)||null}));case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function handleSubmit(_x2){return _ref4.apply(this,arguments);};}();var handleRevertAll=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return revertAll();case 2:closeModal();history.push('/settings/miscellaneous_system/details');case 4:case\"end\":return _context5.stop();}}},_callee5);}));return function handleRevertAll(){return _ref5.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push('/settings/miscellaneous_system/details');};var initialValues=function initialValues(fields){return Object.keys(fields).reduce(function(acc,key){if(fields[key].type==='list'){acc[key]=JSON.stringify(fields[key].value,null,2);}else{var _fields$key$value;acc[key]=(_fields$key$value=fields[key].value)!==null&&_fields$key$value!==void 0?_fields$key$value:'';}return acc;},{});};var executionEnvironmentId=(system===null||system===void 0?void 0:(_system$DEFAULT_EXECU=system.DEFAULT_EXECUTION_ENVIRONMENT)===null||_system$DEFAULT_EXECU===void 0?void 0:_system$DEFAULT_EXECU.value)||null;var _useRequest4=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var _yield$ExecutionEnvir,data;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(executionEnvironmentId){_context6.next=2;break;}return _context6.abrupt(\"return\",'');case 2:_context6.next=4;return ExecutionEnvironmentsAPI.readDetail(executionEnvironmentId);case 4:_yield$ExecutionEnvir=_context6.sent;data=_yield$ExecutionEnvir.data;return _context6.abrupt(\"return\",data);case 7:case\"end\":return _context6.stop();}}},_callee6);})),[executionEnvironmentId])),isLoadingExecutionEnvironment=_useRequest4.isLoading,errorExecutionEnvironment=_useRequest4.error,fetchExecutionEnvironment=_useRequest4.request,executionEnvironment=_useRequest4.result;useEffect(function(){fetchExecutionEnvironment();},[fetchExecutionEnvironment]);return/*#__PURE__*/_jsxs(CardBody,{children:[(isLoading||isLoadingExecutionEnvironment)&&/*#__PURE__*/_jsx(ContentLoading,{}),!(isLoading||isLoadingExecutionEnvironment)&&error&&/*#__PURE__*/_jsx(ContentError,{error:error||errorExecutionEnvironment}),!(isLoading||isLoadingExecutionEnvironment)&&system&&/*#__PURE__*/_jsx(Formik,{initialValues:_objectSpread(_objectSpread({},initialValues(system)),{},{DEFAULT_EXECUTION_ENVIRONMENT:executionEnvironment?{id:executionEnvironment.id,name:executionEnvironment.name}:null}),onSubmit:handleSubmit,children:function children(formik){return/*#__PURE__*/_jsxs(Form,{autoComplete:\"off\",onSubmit:formik.handleSubmit,children:[/*#__PURE__*/_jsxs(FormColumnLayout,{children:[/*#__PURE__*/_jsx(BooleanField,{name:\"ACTIVITY_STREAM_ENABLED\",config:system.ACTIVITY_STREAM_ENABLED}),/*#__PURE__*/_jsx(BooleanField,{name:\"ACTIVITY_STREAM_ENABLED_FOR_INVENTORY_SYNC\",config:system.ACTIVITY_STREAM_ENABLED_FOR_INVENTORY_SYNC}),/*#__PURE__*/_jsx(ExecutionEnvField,{name:\"DEFAULT_EXECUTION_ENVIRONMENT\",config:system.DEFAULT_EXECUTION_ENVIRONMENT}),/*#__PURE__*/_jsx(InputField,{name:\"TOWER_URL_BASE\",config:system.TOWER_URL_BASE,isRequired:true,type:\"url\"}),/*#__PURE__*/_jsx(BooleanField,{name:\"ORG_ADMINS_CAN_SEE_ALL_USERS\",config:system.ORG_ADMINS_CAN_SEE_ALL_USERS}),/*#__PURE__*/_jsx(BooleanField,{name:\"MANAGE_ORGANIZATION_AUTH\",config:system.MANAGE_ORGANIZATION_AUTH}),/*#__PURE__*/_jsx(BooleanField,{name:\"INSIGHTS_TRACKING_STATE\",config:system.INSIGHTS_TRACKING_STATE}),/*#__PURE__*/_jsx(InputField,{name:\"REDHAT_USERNAME\",config:system.REDHAT_USERNAME}),/*#__PURE__*/_jsx(EncryptedField,{name:\"REDHAT_PASSWORD\",config:system.REDHAT_PASSWORD}),/*#__PURE__*/_jsx(InputField,{name:\"SUBSCRIPTIONS_USERNAME\",config:system.SUBSCRIPTIONS_USERNAME}),/*#__PURE__*/_jsx(EncryptedField,{name:\"SUBSCRIPTIONS_PASSWORD\",config:system.SUBSCRIPTIONS_PASSWORD}),/*#__PURE__*/_jsx(InputField,{name:\"AUTOMATION_ANALYTICS_URL\",config:system.AUTOMATION_ANALYTICS_URL,type:\"url\"}),/*#__PURE__*/_jsx(InputField,{name:\"AUTOMATION_ANALYTICS_GATHER_INTERVAL\",config:system.AUTOMATION_ANALYTICS_GATHER_INTERVAL,type:\"number\",isRequired:true}),/*#__PURE__*/_jsx(ObjectField,{name:\"AUTOMATION_ANALYTICS_LAST_ENTRIES\",config:system.AUTOMATION_ANALYTICS_LAST_ENTRIES,revertValue:system.AUTOMATION_ANALYTICS_LAST_ENTRIES.default}),/*#__PURE__*/_jsx(ObjectField,{name:\"REMOTE_HOST_HEADERS\",config:system.REMOTE_HOST_HEADERS,isRequired:true}),/*#__PURE__*/_jsx(ObjectField,{name:\"PROXY_IP_ALLOWED_LIST\",config:system.PROXY_IP_ALLOWED_LIST,isRequired:true}),submitError&&/*#__PURE__*/_jsx(FormSubmitError,{error:submitError}),revertError&&/*#__PURE__*/_jsx(FormSubmitError,{error:revertError})]}),/*#__PURE__*/_jsx(RevertFormActionGroup,{onCancel:handleCancel,onSubmit:formik.handleSubmit,onRevert:toggleModal}),isModalOpen&&/*#__PURE__*/_jsx(RevertAllAlert,{onClose:closeModal,onRevertAll:handleRevertAll})]});}})]});}export default MiscSystemEdit;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Setting/MiscSystem/MiscSystemEdit/MiscSystemEdit.js"],"names":["React","useCallback","useEffect","useHistory","Formik","Form","CardBody","ContentError","ContentLoading","FormSubmitError","FormColumnLayout","useSettings","useModal","useRequest","SettingsAPI","ExecutionEnvironmentsAPI","BooleanField","EncryptedField","ExecutionEnvField","InputField","ObjectField","RevertAllAlert","RevertFormActionGroup","pluck","formatJson","MiscSystemEdit","history","isModalOpen","toggleModal","closeModal","options","PUT","readCategory","data","systemData","mergedData","Object","keys","forEach","key","value","isLoading","error","fetchSystem","request","system","result","values","updateAll","push","submitError","submitForm","revertCategory","revertError","revertAll","handleSubmit","form","PROXY_IP_ALLOWED_LIST","REMOTE_HOST_HEADERS","DEFAULT_EXECUTION_ENVIRONMENT","id","handleRevertAll","handleCancel","initialValues","fields","reduce","acc","type","JSON","stringify","executionEnvironmentId","readDetail","isLoadingExecutionEnvironment","errorExecutionEnvironment","fetchExecutionEnvironment","executionEnvironment","name","formik","ACTIVITY_STREAM_ENABLED","ACTIVITY_STREAM_ENABLED_FOR_INVENTORY_SYNC","TOWER_URL_BASE","ORG_ADMINS_CAN_SEE_ALL_USERS","MANAGE_ORGANIZATION_AUTH","INSIGHTS_TRACKING_STATE","REDHAT_USERNAME","REDHAT_PASSWORD","SUBSCRIPTIONS_USERNAME","SUBSCRIPTIONS_PASSWORD","AUTOMATION_ANALYTICS_URL","AUTOMATION_ANALYTICS_GATHER_INTERVAL","AUTOMATION_ANALYTICS_LAST_ENTRIES","default"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Formik } from 'formik';\nimport { Form } from '@patternfly/react-core';\nimport { CardBody } from 'components/Card';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport { FormSubmitError } from 'components/FormField';\nimport { FormColumnLayout } from 'components/FormLayout';\nimport { useSettings } from 'contexts/Settings';\nimport useModal from 'hooks/useModal';\nimport useRequest from 'hooks/useRequest';\nimport { SettingsAPI, ExecutionEnvironmentsAPI } from 'api';\nimport {\n  BooleanField,\n  EncryptedField,\n  ExecutionEnvField,\n  InputField,\n  ObjectField,\n  RevertAllAlert,\n  RevertFormActionGroup,\n} from '../../shared';\nimport { pluck, formatJson } from '../../shared/settingUtils';\n\nfunction MiscSystemEdit() {\n  const history = useHistory();\n  const { isModalOpen, toggleModal, closeModal } = useModal();\n  const { PUT: options } = useSettings();\n\n  const {\n    isLoading,\n    error,\n    request: fetchSystem,\n    result: system,\n  } = useRequest(\n    useCallback(async () => {\n      const { data } = await SettingsAPI.readCategory('system');\n      const systemData = pluck(\n        data,\n        'ACTIVITY_STREAM_ENABLED',\n        'ACTIVITY_STREAM_ENABLED_FOR_INVENTORY_SYNC',\n        'AUTOMATION_ANALYTICS_GATHER_INTERVAL',\n        'AUTOMATION_ANALYTICS_URL',\n        'AUTOMATION_ANALYTICS_LAST_ENTRIES',\n        'INSIGHTS_TRACKING_STATE',\n        'MANAGE_ORGANIZATION_AUTH',\n        'ORG_ADMINS_CAN_SEE_ALL_USERS',\n        'REDHAT_USERNAME',\n        'REDHAT_PASSWORD',\n        'SUBSCRIPTIONS_USERNAME',\n        'SUBSCRIPTIONS_PASSWORD',\n        'REMOTE_HOST_HEADERS',\n        'TOWER_URL_BASE',\n        'DEFAULT_EXECUTION_ENVIRONMENT',\n        'PROXY_IP_ALLOWED_LIST'\n      );\n\n      const mergedData = {};\n      Object.keys(systemData).forEach((key) => {\n        if (!options[key]) {\n          return;\n        }\n        mergedData[key] = options[key];\n        mergedData[key].value = systemData[key];\n      });\n      return mergedData;\n    }, [options]),\n    null\n  );\n\n  useEffect(() => {\n    fetchSystem();\n  }, [fetchSystem]);\n\n  const { error: submitError, request: submitForm } = useRequest(\n    useCallback(\n      async (values) => {\n        await SettingsAPI.updateAll(values);\n        history.push('/settings/miscellaneous_system/details');\n      },\n      [history]\n    ),\n    null\n  );\n\n  const { error: revertError, request: revertAll } = useRequest(\n    useCallback(async () => {\n      await SettingsAPI.revertCategory('system');\n    }, []),\n    null\n  );\n\n  const handleSubmit = async (form) => {\n    await submitForm({\n      ...form,\n      PROXY_IP_ALLOWED_LIST: formatJson(form.PROXY_IP_ALLOWED_LIST),\n      REMOTE_HOST_HEADERS: formatJson(form.REMOTE_HOST_HEADERS),\n      DEFAULT_EXECUTION_ENVIRONMENT:\n        form.DEFAULT_EXECUTION_ENVIRONMENT?.id || null,\n    });\n  };\n\n  const handleRevertAll = async () => {\n    await revertAll();\n\n    closeModal();\n\n    history.push('/settings/miscellaneous_system/details');\n  };\n\n  const handleCancel = () => {\n    history.push('/settings/miscellaneous_system/details');\n  };\n\n  const initialValues = (fields) =>\n    Object.keys(fields).reduce((acc, key) => {\n      if (fields[key].type === 'list') {\n        acc[key] = JSON.stringify(fields[key].value, null, 2);\n      } else {\n        acc[key] = fields[key].value ?? '';\n      }\n      return acc;\n    }, {});\n\n  const executionEnvironmentId =\n    system?.DEFAULT_EXECUTION_ENVIRONMENT?.value || null;\n\n  const {\n    isLoading: isLoadingExecutionEnvironment,\n    error: errorExecutionEnvironment,\n    request: fetchExecutionEnvironment,\n    result: executionEnvironment,\n  } = useRequest(\n    useCallback(async () => {\n      if (!executionEnvironmentId) {\n        return '';\n      }\n      const { data } = await ExecutionEnvironmentsAPI.readDetail(\n        executionEnvironmentId\n      );\n      return data;\n    }, [executionEnvironmentId])\n  );\n\n  useEffect(() => {\n    fetchExecutionEnvironment();\n  }, [fetchExecutionEnvironment]);\n\n  return (\n    <CardBody>\n      {(isLoading || isLoadingExecutionEnvironment) && <ContentLoading />}\n      {!(isLoading || isLoadingExecutionEnvironment) && error && (\n        <ContentError error={error || errorExecutionEnvironment} />\n      )}\n      {!(isLoading || isLoadingExecutionEnvironment) && system && (\n        <Formik\n          initialValues={{\n            ...initialValues(system),\n            DEFAULT_EXECUTION_ENVIRONMENT: executionEnvironment\n              ? { id: executionEnvironment.id, name: executionEnvironment.name }\n              : null,\n          }}\n          onSubmit={handleSubmit}\n        >\n          {(formik) => (\n            <Form autoComplete=\"off\" onSubmit={formik.handleSubmit}>\n              <FormColumnLayout>\n                <BooleanField\n                  name=\"ACTIVITY_STREAM_ENABLED\"\n                  config={system.ACTIVITY_STREAM_ENABLED}\n                />\n                <BooleanField\n                  name=\"ACTIVITY_STREAM_ENABLED_FOR_INVENTORY_SYNC\"\n                  config={system.ACTIVITY_STREAM_ENABLED_FOR_INVENTORY_SYNC}\n                />\n                <ExecutionEnvField\n                  name=\"DEFAULT_EXECUTION_ENVIRONMENT\"\n                  config={system.DEFAULT_EXECUTION_ENVIRONMENT}\n                />\n                <InputField\n                  name=\"TOWER_URL_BASE\"\n                  config={system.TOWER_URL_BASE}\n                  isRequired\n                  type=\"url\"\n                />\n                <BooleanField\n                  name=\"ORG_ADMINS_CAN_SEE_ALL_USERS\"\n                  config={system.ORG_ADMINS_CAN_SEE_ALL_USERS}\n                />\n                <BooleanField\n                  name=\"MANAGE_ORGANIZATION_AUTH\"\n                  config={system.MANAGE_ORGANIZATION_AUTH}\n                />\n                <BooleanField\n                  name=\"INSIGHTS_TRACKING_STATE\"\n                  config={system.INSIGHTS_TRACKING_STATE}\n                />\n                <InputField\n                  name=\"REDHAT_USERNAME\"\n                  config={system.REDHAT_USERNAME}\n                />\n                <EncryptedField\n                  name=\"REDHAT_PASSWORD\"\n                  config={system.REDHAT_PASSWORD}\n                />\n                <InputField\n                  name=\"SUBSCRIPTIONS_USERNAME\"\n                  config={system.SUBSCRIPTIONS_USERNAME}\n                />\n                <EncryptedField\n                  name=\"SUBSCRIPTIONS_PASSWORD\"\n                  config={system.SUBSCRIPTIONS_PASSWORD}\n                />\n                <InputField\n                  name=\"AUTOMATION_ANALYTICS_URL\"\n                  config={system.AUTOMATION_ANALYTICS_URL}\n                  type=\"url\"\n                />\n                <InputField\n                  name=\"AUTOMATION_ANALYTICS_GATHER_INTERVAL\"\n                  config={system.AUTOMATION_ANALYTICS_GATHER_INTERVAL}\n                  type=\"number\"\n                  isRequired\n                />\n                <ObjectField\n                  name=\"AUTOMATION_ANALYTICS_LAST_ENTRIES\"\n                  config={system.AUTOMATION_ANALYTICS_LAST_ENTRIES}\n                  revertValue={system.AUTOMATION_ANALYTICS_LAST_ENTRIES.default}\n                />\n                <ObjectField\n                  name=\"REMOTE_HOST_HEADERS\"\n                  config={system.REMOTE_HOST_HEADERS}\n                  isRequired\n                />\n                <ObjectField\n                  name=\"PROXY_IP_ALLOWED_LIST\"\n                  config={system.PROXY_IP_ALLOWED_LIST}\n                  isRequired\n                />\n                {submitError && <FormSubmitError error={submitError} />}\n                {revertError && <FormSubmitError error={revertError} />}\n              </FormColumnLayout>\n              <RevertFormActionGroup\n                onCancel={handleCancel}\n                onSubmit={formik.handleSubmit}\n                onRevert={toggleModal}\n              />\n              {isModalOpen && (\n                <RevertAllAlert\n                  onClose={closeModal}\n                  onRevertAll={handleRevertAll}\n                />\n              )}\n            </Form>\n          )}\n        </Formik>\n      )}\n    </CardBody>\n  );\n}\n\nexport default MiscSystemEdit;\n"]},"metadata":{},"sourceType":"module"}