{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState}from'react';import{Link,useHistory}from'react-router-dom';import{Button,Tooltip}from'@patternfly/react-core';import{Tr,Td}from'@patternfly/react-table';import{RocketIcon}from'@patternfly/react-icons';import{SystemJobTemplatesAPI}from'api';import AlertModal from'components/AlertModal';import ErrorDetail from'components/ErrorDetail';import{ActionsTd,ActionItem}from'components/PaginatedTable';import LaunchManagementPrompt from'./LaunchManagementPrompt';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ManagementJobListItem(_ref){var onLaunchError=_ref.onLaunchError,isPrompted=_ref.isPrompted,isSuperUser=_ref.isSuperUser,id=_ref.id,jobType=_ref.jobType,name=_ref.name,description=_ref.description;var detailsUrl=\"/management_jobs/\".concat(id);var history=useHistory();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLaunchLoading=_useState2[0],setIsLaunchLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isManagementPromptOpen=_useState4[0],setIsManagementPromptOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isManagementPromptLoading=_useState6[0],setIsManagementPromptLoading=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),managementPromptError=_useState8[0],setManagementPromptError=_useState8[1];var handleManagementPromptClick=function handleManagementPromptClick(){return setIsManagementPromptOpen(true);};var handleManagementPromptClose=function handleManagementPromptClose(){return setIsManagementPromptOpen(false);};var handleManagementPromptConfirm=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(days){var _yield$SystemJobTempl,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsManagementPromptLoading(true);_context.prev=1;_context.next=4;return SystemJobTemplatesAPI.launch(id,{extra_vars:{days:days}});case 4:_yield$SystemJobTempl=_context.sent;data=_yield$SystemJobTempl.data;history.push(\"/jobs/management/\".concat(data.id,\"/output\"));_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);setManagementPromptError(_context.t0);case 12:_context.prev=12;setIsManagementPromptLoading(false);return _context.finish(12);case 15:case\"end\":return _context.stop();}}},_callee,null,[[1,9,12,15]]);}));return function handleManagementPromptConfirm(_x){return _ref2.apply(this,arguments);};}();var handleLaunch=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$SystemJobTempl2,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setIsLaunchLoading(true);_context2.prev=1;_context2.next=4;return SystemJobTemplatesAPI.launch(id);case 4:_yield$SystemJobTempl2=_context2.sent;data=_yield$SystemJobTempl2.data;history.push(\"/jobs/management/\".concat(data.id,\"/output\"));_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);onLaunchError(_context2.t0);case 12:_context2.prev=12;setIsLaunchLoading(false);return _context2.finish(12);case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9,12,15]]);}));return function handleLaunch(){return _ref3.apply(this,arguments);};}();var rowId=\"mgmt-jobs-row-\".concat(jobType?jobType.replace('_','-'):'');return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Tr,{id:rowId,ouiaId:rowId,children:[/*#__PURE__*/_jsx(Td,{}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Name\"),children:/*#__PURE__*/_jsx(Link,{to:\"\".concat(detailsUrl),children:/*#__PURE__*/_jsx(\"b\",{children:name})})}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Description\"),children:description}),/*#__PURE__*/_jsx(ActionsTd,{dataLabel:/*i18n*/i18n._(\"Actions\"),children:/*#__PURE__*/_jsx(ActionItem,{visible:isSuperUser,children:isSuperUser?/*#__PURE__*/_jsxs(_Fragment,{children:[isPrompted?/*#__PURE__*/_jsx(LaunchManagementPrompt,{isOpen:isManagementPromptOpen,isLoading:isManagementPromptLoading,onClick:handleManagementPromptClick,onClose:handleManagementPromptClose,onConfirm:handleManagementPromptConfirm,defaultDays:30}):/*#__PURE__*/_jsx(Tooltip,{content:/*i18n*/i18n._(\"Launch management job\"),position:\"left\",children:/*#__PURE__*/_jsx(Button,{ouiaId:\"\".concat(id,\"-launch-button\"),\"aria-label\":/*i18n*/i18n._(\"Launch management job\"),variant:\"plain\",onClick:handleLaunch,isDisabled:isLaunchLoading,children:/*#__PURE__*/_jsx(RocketIcon,{})})}),' ']}):null})})]}),managementPromptError&&/*#__PURE__*/_jsx(AlertModal,{isOpen:managementPromptError,variant:\"danger\",onClose:function onClose(){return setManagementPromptError(null);},title:/*i18n*/i18n._(\"Management job launch error\"),label:/*i18n*/i18n._(\"Management job launch error\"),children:/*#__PURE__*/_jsx(ErrorDetail,{error:managementPromptError})})]});}export default ManagementJobListItem;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/ManagementJob/ManagementJobList/ManagementJobListItem.js"],"names":["React","useState","Link","useHistory","Button","Tooltip","Tr","Td","RocketIcon","SystemJobTemplatesAPI","AlertModal","ErrorDetail","ActionsTd","ActionItem","LaunchManagementPrompt","ManagementJobListItem","onLaunchError","isPrompted","isSuperUser","id","jobType","name","description","detailsUrl","history","isLaunchLoading","setIsLaunchLoading","isManagementPromptOpen","setIsManagementPromptOpen","isManagementPromptLoading","setIsManagementPromptLoading","managementPromptError","setManagementPromptError","handleManagementPromptClick","handleManagementPromptClose","handleManagementPromptConfirm","days","launch","extra_vars","data","push","handleLaunch","rowId","replace"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\n\nimport { t } from '@lingui/macro';\nimport { Link, useHistory } from 'react-router-dom';\nimport { Button, Tooltip } from '@patternfly/react-core';\nimport { Tr, Td } from '@patternfly/react-table';\nimport { RocketIcon } from '@patternfly/react-icons';\n\nimport { SystemJobTemplatesAPI } from 'api';\nimport AlertModal from 'components/AlertModal';\nimport ErrorDetail from 'components/ErrorDetail';\nimport { ActionsTd, ActionItem } from 'components/PaginatedTable';\nimport LaunchManagementPrompt from './LaunchManagementPrompt';\n\nfunction ManagementJobListItem({\n  onLaunchError,\n  isPrompted,\n  isSuperUser,\n  id,\n  jobType,\n  name,\n  description,\n}) {\n  const detailsUrl = `/management_jobs/${id}`;\n\n  const history = useHistory();\n  const [isLaunchLoading, setIsLaunchLoading] = useState(false);\n\n  const [isManagementPromptOpen, setIsManagementPromptOpen] = useState(false);\n  const [isManagementPromptLoading, setIsManagementPromptLoading] =\n    useState(false);\n  const [managementPromptError, setManagementPromptError] = useState(null);\n  const handleManagementPromptClick = () => setIsManagementPromptOpen(true);\n  const handleManagementPromptClose = () => setIsManagementPromptOpen(false);\n\n  const handleManagementPromptConfirm = async (days) => {\n    setIsManagementPromptLoading(true);\n    try {\n      const { data } = await SystemJobTemplatesAPI.launch(id, {\n        extra_vars: { days },\n      });\n      history.push(`/jobs/management/${data.id}/output`);\n    } catch (error) {\n      setManagementPromptError(error);\n    } finally {\n      setIsManagementPromptLoading(false);\n    }\n  };\n\n  const handleLaunch = async () => {\n    setIsLaunchLoading(true);\n    try {\n      const { data } = await SystemJobTemplatesAPI.launch(id);\n      history.push(`/jobs/management/${data.id}/output`);\n    } catch (error) {\n      onLaunchError(error);\n    } finally {\n      setIsLaunchLoading(false);\n    }\n  };\n\n  const rowId = `mgmt-jobs-row-${jobType ? jobType.replace('_', '-') : ''}`;\n  return (\n    <>\n      <Tr id={rowId} ouiaId={rowId}>\n        <Td />\n        <Td dataLabel={t`Name`}>\n          <Link to={`${detailsUrl}`}>\n            <b>{name}</b>\n          </Link>\n        </Td>\n        <Td dataLabel={t`Description`}>{description}</Td>\n        <ActionsTd dataLabel={t`Actions`}>\n          <ActionItem visible={isSuperUser}>\n            {isSuperUser ? (\n              <>\n                {isPrompted ? (\n                  <LaunchManagementPrompt\n                    isOpen={isManagementPromptOpen}\n                    isLoading={isManagementPromptLoading}\n                    onClick={handleManagementPromptClick}\n                    onClose={handleManagementPromptClose}\n                    onConfirm={handleManagementPromptConfirm}\n                    defaultDays={30}\n                  />\n                ) : (\n                  <Tooltip content={t`Launch management job`} position=\"left\">\n                    <Button\n                      ouiaId={`${id}-launch-button`}\n                      aria-label={t`Launch management job`}\n                      variant=\"plain\"\n                      onClick={handleLaunch}\n                      isDisabled={isLaunchLoading}\n                    >\n                      <RocketIcon />\n                    </Button>\n                  </Tooltip>\n                )}{' '}\n              </>\n            ) : null}\n          </ActionItem>\n        </ActionsTd>\n      </Tr>\n      {managementPromptError && (\n        <AlertModal\n          isOpen={managementPromptError}\n          variant=\"danger\"\n          onClose={() => setManagementPromptError(null)}\n          title={t`Management job launch error`}\n          label={t`Management job launch error`}\n        >\n          <ErrorDetail error={managementPromptError} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nexport default ManagementJobListItem;\n"]},"metadata":{},"sourceType":"module"}