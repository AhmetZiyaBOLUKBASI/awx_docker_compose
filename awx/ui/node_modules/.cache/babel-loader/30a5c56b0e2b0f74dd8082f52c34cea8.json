{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect,useState}from'react';import{useLocation}from'react-router-dom';import{Button,EmptyState,EmptyStateBody,EmptyStateIcon,Title}from'@patternfly/react-core';import{CubesIcon}from'@patternfly/react-icons';import{TeamsAPI,RolesAPI,UsersAPI}from'api';import useRequest,{useDeleteItems}from'hooks/useRequest';import DataListToolbar from'components/DataListToolbar';import PaginatedTable,{HeaderCell,HeaderRow,ToolbarAddButton,getSearchableKeys}from'components/PaginatedTable';import{getQSConfig,parseQueryString}from'util/qs';import ErrorDetail from'components/ErrorDetail';import AlertModal from'components/AlertModal';import UserAndTeamAccessAdd from'components/UserAndTeamAccessAdd/UserAndTeamAccessAdd';import TeamRoleListItem from'./TeamRoleListItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('roles',{page:1,page_size:20,order_by:'id'});function TeamRolesList(_ref){var _team$summary_fields,_team$summary_fields$;var me=_ref.me,team=_ref.team;var _useLocation=useLocation(),search=_useLocation.search;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),roleToDisassociate=_useState2[0],setRoleToDisassociate=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showAddModal=_useState4[0],setShowAddModal=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),associateError=_useState6[0],setAssociateError=_useState6[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,results,count,orgAdminCount,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,search);_context.next=3;return Promise.all([TeamsAPI.readRoles(team.id,params),UsersAPI.readAdminOfOrganizations(me.id,{id:team.organization}),TeamsAPI.readRoleOptions(team.id)]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,3);_yield$Promise$all2$=_yield$Promise$all2[0].data;results=_yield$Promise$all2$.results;count=_yield$Promise$all2$.count;orgAdminCount=_yield$Promise$all2[1].count;actionsResponse=_yield$Promise$all2[2];return _context.abrupt(\"return\",{roleCount:count,roles:results,isAdminOfOrg:orgAdminCount>0,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 11:case\"end\":return _context.stop();}}},_callee);})),[me.id,team.id,team.organization,search]),{roles:[],roleCount:0,isAdminOfOrg:false,relatedSearchableKeys:[],searchableKeys:[]}),isLoading=_useRequest.isLoading,fetchRoles=_useRequest.request,contentError=_useRequest.error,_useRequest$result=_useRequest.result,roleCount=_useRequest$result.roleCount,roles=_useRequest$result.roles,isAdminOfOrg=_useRequest$result.isAdminOfOrg,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys;useEffect(function(){fetchRoles();},[fetchRoles]);var _useDeleteItems=useDeleteItems(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setRoleToDisassociate(null);_context2.next=3;return RolesAPI.disassociateTeamRole(roleToDisassociate.id,parseInt(team.id,10));case 3:case\"end\":return _context2.stop();}}},_callee2);})),[roleToDisassociate,team.id]),{qsConfig:QS_CONFIG,fetchItems:fetchRoles}),isDisassociateLoading=_useDeleteItems.isLoading,disassociateRole=_useDeleteItems.deleteItems,disassociationError=_useDeleteItems.deletionError,clearDisassociationError=_useDeleteItems.clearDeletionError;var canAdd=(team===null||team===void 0?void 0:(_team$summary_fields=team.summary_fields)===null||_team$summary_fields===void 0?void 0:(_team$summary_fields$=_team$summary_fields.user_capabilities)===null||_team$summary_fields$===void 0?void 0:_team$summary_fields$.edit)||isAdminOfOrg;var detailUrl=function detailUrl(role){var _role$summary_fields=role.summary_fields,resource_id=_role$summary_fields.resource_id,resource_type=_role$summary_fields.resource_type;if(!role||!resource_type){return null;}if(resource_type!==null&&resource_type!==void 0&&resource_type.includes('template')){return\"/templates/\".concat(resource_type,\"/\").concat(resource_id,\"/details\");}if(resource_type!==null&&resource_type!==void 0&&resource_type.includes('inventory')){return\"/inventories/\".concat(resource_type,\"/\").concat(resource_id,\"/details\");}return\"/\".concat(resource_type,\"s/\").concat(resource_id,\"/details\");};var isSysAdmin=roles.some(function(role){return role.name==='System Administrator';});if(isSysAdmin){return/*#__PURE__*/_jsxs(EmptyState,{variant:\"full\",children:[/*#__PURE__*/_jsx(EmptyStateIcon,{icon:CubesIcon}),/*#__PURE__*/_jsx(Title,{headingLevel:\"h5\",size:\"lg\",children:/*i18n*/i18n._(\"System Administrator\")}),/*#__PURE__*/_jsx(EmptyStateBody,{children:/*i18n*/i18n._(\"System administrators have unrestricted access to all resources.\")})]});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PaginatedTable,{contentError:contentError,hasContentLoading:isLoading||isDisassociateLoading,items:roles,itemCount:roleCount,pluralizedItemName:/*i18n*/i18n._(\"Team Roles\"),qsConfig:QS_CONFIG,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Role\"),key:'role_field__icontains',isDefault:true}],toolbarSortColumns:[{name:/*i18n*/i18n._(\"ID\"),key:'id'}],toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{qsConfig:QS_CONFIG,additionalControls:_toConsumableArray(canAdd?[/*#__PURE__*/_jsx(ToolbarAddButton,{ouiaId:\"role-add-button\",onClick:function onClick(){return setShowAddModal(true);}},\"add\")]:[])}));},headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,isSelectable:false,children:[/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Resource Name\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Type\")}),/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"id\",children:/*i18n*/i18n._(\"Role\")})]}),renderRow:function renderRow(role,index){return/*#__PURE__*/_jsx(TeamRoleListItem,{role:role,detailUrl:detailUrl(role),onDisassociate:setRoleToDisassociate,index:index},role.id);}}),showAddModal&&/*#__PURE__*/_jsx(UserAndTeamAccessAdd,{apiModel:TeamsAPI,onFetchData:function onFetchData(){setShowAddModal(false);fetchRoles();},title:/*i18n*/i18n._(\"Add team permissions\"),onClose:function onClose(){return setShowAddModal(false);},onError:function onError(err){return setAssociateError(err);}}),roleToDisassociate&&/*#__PURE__*/_jsx(AlertModal,{\"aria-label\":/*i18n*/i18n._(\"Disassociate role\"),isOpen:roleToDisassociate,variant:\"error\",title:/*i18n*/i18n._(\"Disassociate role!\"),onClose:function onClose(){return setRoleToDisassociate(null);},actions:[/*#__PURE__*/_jsx(Button,{ouiaId:\"disassociate-confirm-button\",variant:\"danger\",\"aria-label\":/*i18n*/i18n._(\"confirm disassociate\"),onClick:disassociateRole,children:/*i18n*/i18n._(\"Disassociate\")},\"disassociate\"),/*#__PURE__*/_jsx(Button,{ouiaId:\"disassociate-cancel-button\",variant:\"link\",\"aria-label\":/*i18n*/i18n._(\"Cancel\"),onClick:function onClick(){return setRoleToDisassociate(null);},children:/*i18n*/i18n._(\"Cancel\")},\"cancel\")],children:/*#__PURE__*/_jsxs(\"div\",{children:[/*i18n*/i18n._(\"This action will disassociate the following role from {0}:\",{0:roleToDisassociate.summary_fields.resource_name}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"strong\",{children:roleToDisassociate.name})]})}),associateError&&/*#__PURE__*/_jsxs(AlertModal,{\"aria-label\":/*i18n*/i18n._(\"Associate role error\"),isOpen:associateError,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:function onClose(){return setAssociateError(null);},children:[/*i18n*/i18n._(\"Failed to associate role\"),/*#__PURE__*/_jsx(ErrorDetail,{error:associateError})]}),disassociationError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:disassociationError,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:clearDisassociationError,children:[/*i18n*/i18n._(\"Failed to delete role.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:disassociationError})]})]});}export default TeamRolesList;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Team/TeamRoles/TeamRolesList.js"],"names":["React","useCallback","useEffect","useState","useLocation","Button","EmptyState","EmptyStateBody","EmptyStateIcon","Title","CubesIcon","TeamsAPI","RolesAPI","UsersAPI","useRequest","useDeleteItems","DataListToolbar","PaginatedTable","HeaderCell","HeaderRow","ToolbarAddButton","getSearchableKeys","getQSConfig","parseQueryString","ErrorDetail","AlertModal","UserAndTeamAccessAdd","TeamRoleListItem","QS_CONFIG","page","page_size","order_by","TeamRolesList","me","team","search","roleToDisassociate","setRoleToDisassociate","showAddModal","setShowAddModal","associateError","setAssociateError","params","Promise","all","readRoles","id","readAdminOfOrganizations","organization","readRoleOptions","data","results","count","orgAdminCount","actionsResponse","roleCount","roles","isAdminOfOrg","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","isLoading","fetchRoles","request","contentError","error","result","disassociateTeamRole","parseInt","qsConfig","fetchItems","isDisassociateLoading","disassociateRole","deleteItems","disassociationError","deletionError","clearDisassociationError","clearDeletionError","canAdd","summary_fields","user_capabilities","edit","detailUrl","role","resource_id","resource_type","includes","isSysAdmin","some","name","key","isDefault","props","index","err","resource_name"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport {\n  Button,\n  EmptyState,\n  EmptyStateBody,\n  EmptyStateIcon,\n  Title,\n} from '@patternfly/react-core';\nimport { CubesIcon } from '@patternfly/react-icons';\nimport { TeamsAPI, RolesAPI, UsersAPI } from 'api';\nimport useRequest, { useDeleteItems } from 'hooks/useRequest';\nimport DataListToolbar from 'components/DataListToolbar';\nimport PaginatedTable, {\n  HeaderCell,\n  HeaderRow,\n  ToolbarAddButton,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport ErrorDetail from 'components/ErrorDetail';\nimport AlertModal from 'components/AlertModal';\nimport UserAndTeamAccessAdd from 'components/UserAndTeamAccessAdd/UserAndTeamAccessAdd';\nimport TeamRoleListItem from './TeamRoleListItem';\n\nconst QS_CONFIG = getQSConfig('roles', {\n  page: 1,\n  page_size: 20,\n  order_by: 'id',\n});\n\nfunction TeamRolesList({ me, team }) {\n  const { search } = useLocation();\n  const [roleToDisassociate, setRoleToDisassociate] = useState(null);\n  const [showAddModal, setShowAddModal] = useState(false);\n  const [associateError, setAssociateError] = useState(null);\n\n  const {\n    isLoading,\n    request: fetchRoles,\n    error: contentError,\n    result: {\n      roleCount,\n      roles,\n      isAdminOfOrg,\n      relatedSearchableKeys,\n      searchableKeys,\n    },\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, search);\n      const [\n        {\n          data: { results, count },\n        },\n        { count: orgAdminCount },\n        actionsResponse,\n      ] = await Promise.all([\n        TeamsAPI.readRoles(team.id, params),\n        UsersAPI.readAdminOfOrganizations(me.id, {\n          id: team.organization,\n        }),\n        TeamsAPI.readRoleOptions(team.id),\n      ]);\n      return {\n        roleCount: count,\n        roles: results,\n        isAdminOfOrg: orgAdminCount > 0,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [me.id, team.id, team.organization, search]),\n    {\n      roles: [],\n      roleCount: 0,\n      isAdminOfOrg: false,\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchRoles();\n  }, [fetchRoles]);\n\n  const {\n    isLoading: isDisassociateLoading,\n    deleteItems: disassociateRole,\n    deletionError: disassociationError,\n    clearDeletionError: clearDisassociationError,\n  } = useDeleteItems(\n    useCallback(async () => {\n      setRoleToDisassociate(null);\n      await RolesAPI.disassociateTeamRole(\n        roleToDisassociate.id,\n        parseInt(team.id, 10)\n      );\n    }, [roleToDisassociate, team.id]),\n    { qsConfig: QS_CONFIG, fetchItems: fetchRoles }\n  );\n\n  const canAdd = team?.summary_fields?.user_capabilities?.edit || isAdminOfOrg;\n  const detailUrl = (role) => {\n    const { resource_id, resource_type } = role.summary_fields;\n\n    if (!role || !resource_type) {\n      return null;\n    }\n\n    if (resource_type?.includes('template')) {\n      return `/templates/${resource_type}/${resource_id}/details`;\n    }\n    if (resource_type?.includes('inventory')) {\n      return `/inventories/${resource_type}/${resource_id}/details`;\n    }\n    return `/${resource_type}s/${resource_id}/details`;\n  };\n\n  const isSysAdmin = roles.some((role) => role.name === 'System Administrator');\n  if (isSysAdmin) {\n    return (\n      <EmptyState variant=\"full\">\n        <EmptyStateIcon icon={CubesIcon} />\n        <Title headingLevel=\"h5\" size=\"lg\">\n          {t`System Administrator`}\n        </Title>\n        <EmptyStateBody>\n          {t`System administrators have unrestricted access to all resources.`}\n        </EmptyStateBody>\n      </EmptyState>\n    );\n  }\n\n  return (\n    <>\n      <PaginatedTable\n        contentError={contentError}\n        hasContentLoading={isLoading || isDisassociateLoading}\n        items={roles}\n        itemCount={roleCount}\n        pluralizedItemName={t`Team Roles`}\n        qsConfig={QS_CONFIG}\n        toolbarSearchColumns={[\n          {\n            name: t`Role`,\n            key: 'role_field__icontains',\n            isDefault: true,\n          },\n        ]}\n        toolbarSortColumns={[\n          {\n            name: t`ID`,\n            key: 'id',\n          },\n        ]}\n        toolbarSearchableKeys={searchableKeys}\n        toolbarRelatedSearchableKeys={relatedSearchableKeys}\n        renderToolbar={(props) => (\n          <DataListToolbar\n            {...props}\n            qsConfig={QS_CONFIG}\n            additionalControls={[\n              ...(canAdd\n                ? [\n                    <ToolbarAddButton\n                      ouiaId=\"role-add-button\"\n                      key=\"add\"\n                      onClick={() => setShowAddModal(true)}\n                    />,\n                  ]\n                : []),\n            ]}\n          />\n        )}\n        headerRow={\n          <HeaderRow qsConfig={QS_CONFIG} isSelectable={false}>\n            <HeaderCell>{t`Resource Name`}</HeaderCell>\n            <HeaderCell>{t`Type`}</HeaderCell>\n            <HeaderCell sortKey=\"id\">{t`Role`}</HeaderCell>\n          </HeaderRow>\n        }\n        renderRow={(role, index) => (\n          <TeamRoleListItem\n            key={role.id}\n            role={role}\n            detailUrl={detailUrl(role)}\n            onDisassociate={setRoleToDisassociate}\n            index={index}\n          />\n        )}\n      />\n      {showAddModal && (\n        <UserAndTeamAccessAdd\n          apiModel={TeamsAPI}\n          onFetchData={() => {\n            setShowAddModal(false);\n            fetchRoles();\n          }}\n          title={t`Add team permissions`}\n          onClose={() => setShowAddModal(false)}\n          onError={(err) => setAssociateError(err)}\n        />\n      )}\n      {roleToDisassociate && (\n        <AlertModal\n          aria-label={t`Disassociate role`}\n          isOpen={roleToDisassociate}\n          variant=\"error\"\n          title={t`Disassociate role!`}\n          onClose={() => setRoleToDisassociate(null)}\n          actions={[\n            <Button\n              ouiaId=\"disassociate-confirm-button\"\n              key=\"disassociate\"\n              variant=\"danger\"\n              aria-label={t`confirm disassociate`}\n              onClick={disassociateRole}\n            >\n              {t`Disassociate`}\n            </Button>,\n            <Button\n              ouiaId=\"disassociate-cancel-button\"\n              key=\"cancel\"\n              variant=\"link\"\n              aria-label={t`Cancel`}\n              onClick={() => setRoleToDisassociate(null)}\n            >\n              {t`Cancel`}\n            </Button>,\n          ]}\n        >\n          <div>\n            {t`This action will disassociate the following role from ${roleToDisassociate.summary_fields.resource_name}:`}\n            <br />\n            <strong>{roleToDisassociate.name}</strong>\n          </div>\n        </AlertModal>\n      )}\n      {associateError && (\n        <AlertModal\n          aria-label={t`Associate role error`}\n          isOpen={associateError}\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={() => setAssociateError(null)}\n        >\n          {t`Failed to associate role`}\n          <ErrorDetail error={associateError} />\n        </AlertModal>\n      )}\n      {disassociationError && (\n        <AlertModal\n          isOpen={disassociationError}\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={clearDisassociationError}\n        >\n          {t`Failed to delete role.`}\n          <ErrorDetail error={disassociationError} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\nexport default TeamRolesList;\n"]},"metadata":{},"sourceType":"module"}