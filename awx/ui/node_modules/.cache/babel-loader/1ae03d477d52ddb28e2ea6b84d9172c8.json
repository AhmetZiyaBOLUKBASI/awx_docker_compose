{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{useLocation}from'react-router-dom';import useRequest from'hooks/useRequest';import{SearchColumns,SortColumns}from'types';import{getQSConfig,parseQueryString}from'util/qs';import DataListToolbar from'../DataListToolbar';import CheckboxListItem from'../CheckboxListItem';import{SelectedList}from'../SelectedList';import PaginatedTable,{HeaderCell,HeaderRow,getSearchableKeys}from'../PaginatedTable';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var QS_Config=function QS_Config(sortColumns){return getQSConfig('resource',{page:1,page_size:5,order_by:\"\".concat(sortColumns.filter(function(col){return col.key==='name';}).length?'name':'username')});};function SelectResourceStep(_ref){var searchColumns=_ref.searchColumns,sortColumns=_ref.sortColumns,displayKey=_ref.displayKey,onRowClick=_ref.onRowClick,selectedLabel=_ref.selectedLabel,selectedResourceRows=_ref.selectedResourceRows,fetchItems=_ref.fetchItems,fetchOptions=_ref.fetchOptions;var location=useLocation();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var queryParams,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,count,results,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:queryParams=parseQueryString(QS_Config(sortColumns),location.search);_context.next=3;return Promise.all([fetchItems(queryParams),fetchOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);_yield$Promise$all2$=_yield$Promise$all2[0].data;count=_yield$Promise$all2$.count;results=_yield$Promise$all2$.results;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{resources:results,itemCount:count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 10:case\"end\":return _context.stop();}}},_callee);})),[location,fetchItems,fetchOptions,sortColumns]),{resources:[],itemCount:0,relatedSearchableKeys:[],searchableKeys:[]}),isLoading=_useRequest.isLoading,error=_useRequest.error,readResourceList=_useRequest.request,_useRequest$result=_useRequest.result,resources=_useRequest$result.resources,itemCount=_useRequest$result.itemCount,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys;useEffect(function(){readResourceList();},[readResourceList]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{children:/*i18n*/i18n._(\"Choose the resources that will be receiving new roles.  You'll be able to select the roles to apply in the next step.  Note that the resources chosen here will receive all roles chosen in the next step.\")}),selectedResourceRows.length>0&&/*#__PURE__*/_jsx(SelectedList,{displayKey:displayKey,label:selectedLabel,onRemove:onRowClick,selected:selectedResourceRows}),/*#__PURE__*/_jsx(PaginatedTable,{hasContentLoading:isLoading,contentError:error,items:resources,itemCount:itemCount,qsConfig:QS_Config(sortColumns),onRowClick:onRowClick,toolbarSearchColumns:searchColumns,toolbarSortColumns:sortColumns,toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,headerRow:/*#__PURE__*/_jsx(HeaderRow,{qsConfig:QS_Config(sortColumns),children:sortColumns.map(function(_ref3){var name=_ref3.name,key=_ref3.key;return/*#__PURE__*/_jsx(HeaderCell,{sortKey:key,children:name},key);})}),renderRow:function renderRow(item,index){return/*#__PURE__*/_jsx(CheckboxListItem,{isSelected:selectedResourceRows.some(function(i){return i.id===item.id;}),itemId:item.id,item:item,rowIndex:index,columns:sortColumns,name:item[displayKey],label:item[displayKey],onSelect:function onSelect(){return onRowClick(item);},onDeselect:function onDeselect(){return onRowClick(item);}},item.id);},renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{fillWidth:true}));},showPageSizeOptions:false})]});}SelectResourceStep.defaultProps={searchColumns:null,sortColumns:null,displayKey:'name',onRowClick:function onRowClick(){},selectedLabel:null,selectedResourceRows:[]};export{SelectResourceStep as _SelectResourceStep};export default SelectResourceStep;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/AddRole/SelectResourceStep.js"],"names":["React","useCallback","useEffect","useLocation","useRequest","SearchColumns","SortColumns","getQSConfig","parseQueryString","DataListToolbar","CheckboxListItem","SelectedList","PaginatedTable","HeaderCell","HeaderRow","getSearchableKeys","QS_Config","sortColumns","page","page_size","order_by","filter","col","key","length","SelectResourceStep","searchColumns","displayKey","onRowClick","selectedLabel","selectedResourceRows","fetchItems","fetchOptions","location","queryParams","search","Promise","all","data","count","results","actionsResponse","resources","itemCount","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","isLoading","error","readResourceList","request","result","name","item","index","some","i","id","props","defaultProps","_SelectResourceStep"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { useLocation } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport useRequest from 'hooks/useRequest';\nimport { SearchColumns, SortColumns } from 'types';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport DataListToolbar from '../DataListToolbar';\nimport CheckboxListItem from '../CheckboxListItem';\nimport { SelectedList } from '../SelectedList';\nimport PaginatedTable, {\n  HeaderCell,\n  HeaderRow,\n  getSearchableKeys,\n} from '../PaginatedTable';\n\nconst QS_Config = (sortColumns) =>\n  getQSConfig('resource', {\n    page: 1,\n    page_size: 5,\n    order_by: `${\n      sortColumns.filter((col) => col.key === 'name').length\n        ? 'name'\n        : 'username'\n    }`,\n  });\nfunction SelectResourceStep({\n  searchColumns,\n  sortColumns,\n  displayKey,\n  onRowClick,\n  selectedLabel,\n  selectedResourceRows,\n  fetchItems,\n  fetchOptions,\n}) {\n  const location = useLocation();\n\n  const {\n    isLoading,\n    error,\n    request: readResourceList,\n    result: { resources, itemCount, relatedSearchableKeys, searchableKeys },\n  } = useRequest(\n    useCallback(async () => {\n      const queryParams = parseQueryString(\n        QS_Config(sortColumns),\n        location.search\n      );\n\n      const [\n        {\n          data: { count, results },\n        },\n        actionsResponse,\n      ] = await Promise.all([fetchItems(queryParams), fetchOptions()]);\n      return {\n        resources: results,\n        itemCount: count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [location, fetchItems, fetchOptions, sortColumns]),\n    {\n      resources: [],\n      itemCount: 0,\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    readResourceList();\n  }, [readResourceList]);\n\n  return (\n    <>\n      <div>\n        {t`Choose the resources that will be receiving new roles.  You'll be able to select the roles to apply in the next step.  Note that the resources chosen here will receive all roles chosen in the next step.`}\n      </div>\n      {selectedResourceRows.length > 0 && (\n        <SelectedList\n          displayKey={displayKey}\n          label={selectedLabel}\n          onRemove={onRowClick}\n          selected={selectedResourceRows}\n        />\n      )}\n\n      <PaginatedTable\n        hasContentLoading={isLoading}\n        contentError={error}\n        items={resources}\n        itemCount={itemCount}\n        qsConfig={QS_Config(sortColumns)}\n        onRowClick={onRowClick}\n        toolbarSearchColumns={searchColumns}\n        toolbarSortColumns={sortColumns}\n        toolbarSearchableKeys={searchableKeys}\n        toolbarRelatedSearchableKeys={relatedSearchableKeys}\n        headerRow={\n          <HeaderRow qsConfig={QS_Config(sortColumns)}>\n            {sortColumns.map(({ name, key }) => (\n              <HeaderCell sortKey={key} key={key}>\n                {name}\n              </HeaderCell>\n            ))}\n          </HeaderRow>\n        }\n        renderRow={(item, index) => (\n          <CheckboxListItem\n            isSelected={selectedResourceRows.some((i) => i.id === item.id)}\n            itemId={item.id}\n            item={item}\n            rowIndex={index}\n            key={item.id}\n            columns={sortColumns}\n            name={item[displayKey]}\n            label={item[displayKey]}\n            onSelect={() => onRowClick(item)}\n            onDeselect={() => onRowClick(item)}\n          />\n        )}\n        renderToolbar={(props) => <DataListToolbar {...props} fillWidth />}\n        showPageSizeOptions={false}\n      />\n    </>\n  );\n}\n\nSelectResourceStep.propTypes = {\n  searchColumns: SearchColumns,\n  sortColumns: SortColumns,\n  displayKey: PropTypes.string,\n  onRowClick: PropTypes.func,\n  fetchItems: PropTypes.func.isRequired,\n  selectedLabel: PropTypes.string,\n  selectedResourceRows: PropTypes.arrayOf(PropTypes.object),\n};\n\nSelectResourceStep.defaultProps = {\n  searchColumns: null,\n  sortColumns: null,\n  displayKey: 'name',\n  onRowClick: () => {},\n  selectedLabel: null,\n  selectedResourceRows: [],\n};\n\nexport { SelectResourceStep as _SelectResourceStep };\nexport default SelectResourceStep;\n"]},"metadata":{},"sourceType":"module"}