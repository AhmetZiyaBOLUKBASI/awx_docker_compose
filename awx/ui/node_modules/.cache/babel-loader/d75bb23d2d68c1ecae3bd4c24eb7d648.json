{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{useLocation,useRouteMatch,Link}from'react-router-dom';import{Card,PageSection,DropdownItem}from'@patternfly/react-core';import{InstanceGroupsAPI}from'api';import{getQSConfig,parseQueryString}from'util/qs';import useRequest,{useDeleteItems}from'hooks/useRequest';import useSelected from'hooks/useSelected';import PaginatedTable,{HeaderRow,HeaderCell,ToolbarAddButton,ToolbarDeleteButton,getSearchableKeys}from'components/PaginatedTable';import ErrorDetail from'components/ErrorDetail';import AlertModal from'components/AlertModal';import DatalistToolbar from'components/DataListToolbar';import AddDropDownButton from'components/AddDropDownButton';import{relatedResourceDeleteRequests}from'util/getRelatedResourceDeleteDetails';import InstanceGroupListItem from'./InstanceGroupListItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('instance-group',{page:1,page_size:20});function InstanceGroupList(_ref){var isKubernetes=_ref.isKubernetes,isSettingsRequestLoading=_ref.isSettingsRequestLoading,settingsRequestError=_ref.settingsRequestError;var location=useLocation();var match=useRouteMatch();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _responseActions$data,_responseActions$data2;var params,_yield$Promise$all,_yield$Promise$all2,response,responseActions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,location.search);_context.next=3;return Promise.all([InstanceGroupsAPI.read(params),InstanceGroupsAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);response=_yield$Promise$all2[0];responseActions=_yield$Promise$all2[1];return _context.abrupt(\"return\",{instanceGroups:response.data.results,instanceGroupsCount:response.data.count,actions:responseActions.data.actions,relatedSearchableKeys:((responseActions===null||responseActions===void 0?void 0:(_responseActions$data=responseActions.data)===null||_responseActions$data===void 0?void 0:_responseActions$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_responseActions$data2=responseActions.data.actions)===null||_responseActions$data2===void 0?void 0:_responseActions$data2.GET)});case 8:case\"end\":return _context.stop();}}},_callee);})),[location]),{instanceGroups:[],instanceGroupsCount:0,actions:{},relatedSearchableKeys:[],searchableKeys:[]}),contentError=_useRequest.error,isLoading=_useRequest.isLoading,fetchInstanceGroups=_useRequest.request,_useRequest$result=_useRequest.result,instanceGroups=_useRequest$result.instanceGroups,instanceGroupsCount=_useRequest$result.instanceGroupsCount,actions=_useRequest$result.actions,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys;useEffect(function(){fetchInstanceGroups();},[fetchInstanceGroups]);var _useSelected=useSelected(instanceGroups),selected=_useSelected.selected,isAllSelected=_useSelected.isAllSelected,handleSelect=_useSelected.handleSelect,clearSelected=_useSelected.clearSelected,selectAll=_useSelected.selectAll;var _useDeleteItems=useDeleteItems(useCallback(function(){return Promise.all(selected.map(function(_ref3){var id=_ref3.id;return InstanceGroupsAPI.destroy(id);}));},[selected]),{qsConfig:QS_CONFIG,allItemsSelected:isAllSelected,fetchItems:fetchInstanceGroups}),deleteLoading=_useDeleteItems.isLoading,deletionError=_useDeleteItems.deletionError,deleteInstanceGroups=_useDeleteItems.deleteItems,clearDeletionError=_useDeleteItems.clearDeletionError;var handleDelete=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return deleteInstanceGroups();case 2:clearSelected();case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleDelete(){return _ref4.apply(this,arguments);};}();var canAdd=actions&&actions.POST;var cannotDelete=function cannotDelete(item){return!item.summary_fields.user_capabilities.delete;};var pluralizedItemName=/*i18n*/i18n._(\"Instance Groups\");var addContainerGroup=/*i18n*/i18n._(\"Add container group\");var addInstanceGroup=/*i18n*/i18n._(\"Add instance group\");var addButton=!isSettingsRequestLoading&&!isKubernetes?/*#__PURE__*/_jsx(AddDropDownButton,{ouiaId:\"add-instance-group-button\",dropdownItems:[/*#__PURE__*/_jsx(DropdownItem,{ouiaId:\"add-container-group-item\",to:\"/instance_groups/container_group/add\",component:Link,\"aria-label\":addContainerGroup,children:addContainerGroup},addContainerGroup),/*#__PURE__*/_jsx(DropdownItem,{ouiaId:\"add-instance-group-item\",to:\"/instance_groups/add\",component:Link,\"aria-label\":addInstanceGroup,children:addInstanceGroup},addInstanceGroup)]},\"add\"):/*#__PURE__*/_jsx(ToolbarAddButton,{ouiaId:\"add-container-group-button\",linkTo:\"\".concat(match.url,\"/container_group/add\")},\"add\");var getDetailUrl=function getDetailUrl(item){return item.is_container_group?\"\".concat(match.url,\"/container_group/\").concat(item.id,\"/details\"):\"\".concat(match.url,\"/\").concat(item.id,\"/details\");};var deleteDetailsRequests=relatedResourceDeleteRequests.instanceGroup(selected[0]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(PaginatedTable,{contentError:contentError||settingsRequestError,hasContentLoading:isLoading||deleteLoading||isSettingsRequestLoading,items:instanceGroups,itemCount:instanceGroupsCount,pluralizedItemName:pluralizedItemName,qsConfig:QS_CONFIG,clearSelected:clearSelected,toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true}],renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DatalistToolbar,_objectSpread(_objectSpread({},props),{},{isAllSelected:isAllSelected,onSelectAll:selectAll,qsConfig:QS_CONFIG,additionalControls:[].concat(_toConsumableArray(canAdd?[addButton]:[]),[/*#__PURE__*/_jsx(ToolbarDeleteButton,{onDelete:handleDelete,cannotDelete:cannotDelete,itemsToDelete:selected,pluralizedItemName:/*i18n*/i18n._(\"Instance Groups\"),deleteDetailsRequests:deleteDetailsRequests,deleteMessage:/*#__PURE__*/_jsx(Trans,{id:\"{0, plural, one {This instance group is currently being by other resources. Are you sure you want to delete it?} other {Deleting these instance groups could impact other resources that rely on them. Are you sure you want to delete anyway?}}\",values:{0:selected.length}})},\"delete\")])}));},headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Type\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Running Jobs\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Total Jobs\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Instances\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Capacity\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Actions\")})]}),renderRow:function renderRow(instanceGroup,index){return/*#__PURE__*/_jsx(InstanceGroupListItem,{value:instanceGroup.name,instanceGroup:instanceGroup,detailUrl:getDetailUrl(instanceGroup),onSelect:function onSelect(){return handleSelect(instanceGroup);},isSelected:selected.some(function(row){return row.id===instanceGroup.id;}),rowIndex:index},instanceGroup.id);},emptyStateControls:canAdd&&addButton})})}),/*#__PURE__*/_jsxs(AlertModal,{\"aria-label\":/*i18n*/i18n._(\"Deletion error\"),isOpen:deletionError,onClose:clearDeletionError,title:/*i18n*/i18n._(\"Error\"),variant:\"error\",children:[/*i18n*/i18n._(\"Failed to delete one or more instance groups.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:deletionError})]})]});}export default InstanceGroupList;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/InstanceGroup/InstanceGroupList/InstanceGroupList.js"],"names":["React","useEffect","useCallback","useLocation","useRouteMatch","Link","Card","PageSection","DropdownItem","InstanceGroupsAPI","getQSConfig","parseQueryString","useRequest","useDeleteItems","useSelected","PaginatedTable","HeaderRow","HeaderCell","ToolbarAddButton","ToolbarDeleteButton","getSearchableKeys","ErrorDetail","AlertModal","DatalistToolbar","AddDropDownButton","relatedResourceDeleteRequests","InstanceGroupListItem","QS_CONFIG","page","page_size","InstanceGroupList","isKubernetes","isSettingsRequestLoading","settingsRequestError","location","match","params","search","Promise","all","read","readOptions","response","responseActions","instanceGroups","data","results","instanceGroupsCount","count","actions","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","GET","contentError","error","isLoading","fetchInstanceGroups","request","result","selected","isAllSelected","handleSelect","clearSelected","selectAll","id","destroy","qsConfig","allItemsSelected","fetchItems","deleteLoading","deletionError","deleteInstanceGroups","deleteItems","clearDeletionError","handleDelete","canAdd","POST","cannotDelete","item","summary_fields","user_capabilities","delete","pluralizedItemName","addContainerGroup","addInstanceGroup","addButton","url","getDetailUrl","is_container_group","deleteDetailsRequests","instanceGroup","name","key","isDefault","props","length","index","some","row"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { useLocation, useRouteMatch, Link } from 'react-router-dom';\n\nimport { t, Plural } from '@lingui/macro';\nimport { Card, PageSection, DropdownItem } from '@patternfly/react-core';\n\nimport { InstanceGroupsAPI } from 'api';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport useRequest, { useDeleteItems } from 'hooks/useRequest';\nimport useSelected from 'hooks/useSelected';\nimport PaginatedTable, {\n  HeaderRow,\n  HeaderCell,\n  ToolbarAddButton,\n  ToolbarDeleteButton,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\nimport ErrorDetail from 'components/ErrorDetail';\nimport AlertModal from 'components/AlertModal';\nimport DatalistToolbar from 'components/DataListToolbar';\nimport AddDropDownButton from 'components/AddDropDownButton';\nimport { relatedResourceDeleteRequests } from 'util/getRelatedResourceDeleteDetails';\nimport InstanceGroupListItem from './InstanceGroupListItem';\n\nconst QS_CONFIG = getQSConfig('instance-group', {\n  page: 1,\n  page_size: 20,\n});\n\nfunction InstanceGroupList({\n  isKubernetes,\n  isSettingsRequestLoading,\n  settingsRequestError,\n}) {\n  const location = useLocation();\n  const match = useRouteMatch();\n\n  const {\n    error: contentError,\n    isLoading,\n    request: fetchInstanceGroups,\n    result: {\n      instanceGroups,\n      instanceGroupsCount,\n      actions,\n      relatedSearchableKeys,\n      searchableKeys,\n    },\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, location.search);\n\n      const [response, responseActions] = await Promise.all([\n        InstanceGroupsAPI.read(params),\n        InstanceGroupsAPI.readOptions(),\n      ]);\n\n      return {\n        instanceGroups: response.data.results,\n        instanceGroupsCount: response.data.count,\n        actions: responseActions.data.actions,\n        relatedSearchableKeys: (\n          responseActions?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(responseActions.data.actions?.GET),\n      };\n    }, [location]),\n    {\n      instanceGroups: [],\n      instanceGroupsCount: 0,\n      actions: {},\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchInstanceGroups();\n  }, [fetchInstanceGroups]);\n\n  const { selected, isAllSelected, handleSelect, clearSelected, selectAll } =\n    useSelected(instanceGroups);\n\n  const {\n    isLoading: deleteLoading,\n    deletionError,\n    deleteItems: deleteInstanceGroups,\n    clearDeletionError,\n  } = useDeleteItems(\n    useCallback(\n      () =>\n        Promise.all(selected.map(({ id }) => InstanceGroupsAPI.destroy(id))),\n      [selected]\n    ),\n    {\n      qsConfig: QS_CONFIG,\n      allItemsSelected: isAllSelected,\n      fetchItems: fetchInstanceGroups,\n    }\n  );\n\n  const handleDelete = async () => {\n    await deleteInstanceGroups();\n    clearSelected();\n  };\n\n  const canAdd = actions && actions.POST;\n\n  const cannotDelete = (item) => !item.summary_fields.user_capabilities.delete;\n\n  const pluralizedItemName = t`Instance Groups`;\n\n  const addContainerGroup = t`Add container group`;\n  const addInstanceGroup = t`Add instance group`;\n\n  const addButton =\n    !isSettingsRequestLoading && !isKubernetes ? (\n      <AddDropDownButton\n        ouiaId=\"add-instance-group-button\"\n        key=\"add\"\n        dropdownItems={[\n          <DropdownItem\n            ouiaId=\"add-container-group-item\"\n            to=\"/instance_groups/container_group/add\"\n            component={Link}\n            key={addContainerGroup}\n            aria-label={addContainerGroup}\n          >\n            {addContainerGroup}\n          </DropdownItem>,\n          <DropdownItem\n            ouiaId=\"add-instance-group-item\"\n            to=\"/instance_groups/add\"\n            component={Link}\n            key={addInstanceGroup}\n            aria-label={addInstanceGroup}\n          >\n            {addInstanceGroup}\n          </DropdownItem>,\n        ]}\n      />\n    ) : (\n      <ToolbarAddButton\n        key=\"add\"\n        ouiaId=\"add-container-group-button\"\n        linkTo={`${match.url}/container_group/add`}\n      />\n    );\n\n  const getDetailUrl = (item) =>\n    item.is_container_group\n      ? `${match.url}/container_group/${item.id}/details`\n      : `${match.url}/${item.id}/details`;\n  const deleteDetailsRequests = relatedResourceDeleteRequests.instanceGroup(\n    selected[0]\n  );\n  return (\n    <>\n      <PageSection>\n        <Card>\n          <PaginatedTable\n            contentError={contentError || settingsRequestError}\n            hasContentLoading={\n              isLoading || deleteLoading || isSettingsRequestLoading\n            }\n            items={instanceGroups}\n            itemCount={instanceGroupsCount}\n            pluralizedItemName={pluralizedItemName}\n            qsConfig={QS_CONFIG}\n            clearSelected={clearSelected}\n            toolbarSearchableKeys={searchableKeys}\n            toolbarRelatedSearchableKeys={relatedSearchableKeys}\n            toolbarSearchColumns={[\n              {\n                name: t`Name`,\n                key: 'name__icontains',\n                isDefault: true,\n              },\n            ]}\n            renderToolbar={(props) => (\n              <DatalistToolbar\n                {...props}\n                isAllSelected={isAllSelected}\n                onSelectAll={selectAll}\n                qsConfig={QS_CONFIG}\n                additionalControls={[\n                  ...(canAdd ? [addButton] : []),\n                  <ToolbarDeleteButton\n                    key=\"delete\"\n                    onDelete={handleDelete}\n                    cannotDelete={cannotDelete}\n                    itemsToDelete={selected}\n                    pluralizedItemName={t`Instance Groups`}\n                    deleteDetailsRequests={deleteDetailsRequests}\n                    deleteMessage={\n                      <Plural\n                        value={selected.length}\n                        one=\"This instance group is currently being by other resources. Are you sure you want to delete it?\"\n                        other=\"Deleting these instance groups could impact other resources that rely on them. Are you sure you want to delete anyway?\"\n                      />\n                    }\n                  />,\n                ]}\n              />\n            )}\n            headerRow={\n              <HeaderRow qsConfig={QS_CONFIG}>\n                <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n                <HeaderCell>{t`Type`}</HeaderCell>\n                <HeaderCell>{t`Running Jobs`}</HeaderCell>\n                <HeaderCell>{t`Total Jobs`}</HeaderCell>\n                <HeaderCell>{t`Instances`}</HeaderCell>\n                <HeaderCell>{t`Capacity`}</HeaderCell>\n                <HeaderCell>{t`Actions`}</HeaderCell>\n              </HeaderRow>\n            }\n            renderRow={(instanceGroup, index) => (\n              <InstanceGroupListItem\n                key={instanceGroup.id}\n                value={instanceGroup.name}\n                instanceGroup={instanceGroup}\n                detailUrl={getDetailUrl(instanceGroup)}\n                onSelect={() => handleSelect(instanceGroup)}\n                isSelected={selected.some((row) => row.id === instanceGroup.id)}\n                rowIndex={index}\n              />\n            )}\n            emptyStateControls={canAdd && addButton}\n          />\n        </Card>\n      </PageSection>\n      <AlertModal\n        aria-label={t`Deletion error`}\n        isOpen={deletionError}\n        onClose={clearDeletionError}\n        title={t`Error`}\n        variant=\"error\"\n      >\n        {t`Failed to delete one or more instance groups.`}\n        <ErrorDetail error={deletionError} />\n      </AlertModal>\n    </>\n  );\n}\n\nexport default InstanceGroupList;\n"]},"metadata":{},"sourceType":"module"}