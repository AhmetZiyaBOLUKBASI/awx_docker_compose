{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _styled from\"styled-components\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState,useEffect,useCallback}from'react';import{Switch,Tooltip}from'@patternfly/react-core';import useRequest from'hooks/useRequest';import{HostsAPI}from'api';import AlertModal from'../AlertModal';import ErrorDetail from'../ErrorDetail';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var _StyledSwitch=_styled(Switch).withConfig({displayName:\"HostToggle___StyledSwitch\",componentId:\"sc-18nbgru-0\"})([\"display:inline-flex;\"]);function HostToggle(_ref){var className=_ref.className,host=_ref.host,_ref$isDisabled=_ref.isDisabled,isDisabled=_ref$isDisabled===void 0?false:_ref$isDisabled,onToggle=_ref.onToggle,_ref$tooltip=_ref.tooltip,tooltip=_ref$tooltip===void 0?/*i18n*/i18n._(\"Indicates if a host is available and should be included in running\\njobs.  For hosts that are part of an external inventory, this may be\\nreset by the inventory sync process.\"):_ref$tooltip;var _useState=useState(host.enabled),_useState2=_slicedToArray(_useState,2),isEnabled=_useState2[0],setIsEnabled=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showError=_useState4[0],setShowError=_useState4[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return HostsAPI.update(host.id,{enabled:!isEnabled});case 2:return _context.abrupt(\"return\",!isEnabled);case 3:case\"end\":return _context.stop();}}},_callee);})),[host,isEnabled]),host.enabled),result=_useRequest.result,isLoading=_useRequest.isLoading,error=_useRequest.error,toggleHost=_useRequest.request;useEffect(function(){if(result!==isEnabled){setIsEnabled(result);if(onToggle){onToggle(result);}}},[result,isEnabled,onToggle]);useEffect(function(){if(error){setShowError(true);}},[error]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Tooltip,{content:tooltip,position:\"top\",children:/*#__PURE__*/_jsx(_StyledSwitch,{className:className,id:\"host-\".concat(host.id,\"-toggle\"),label:/*i18n*/i18n._(\"On\"),labelOff:/*i18n*/i18n._(\"Off\"),isChecked:isEnabled,isDisabled:isLoading||isDisabled||!host.summary_fields.user_capabilities.edit,onChange:toggleHost,ouiaId:\"host-\".concat(host.id,\"-toggle\"),\"aria-label\":/*i18n*/i18n._(\"Toggle host\")})}),showError&&error&&!isLoading&&/*#__PURE__*/_jsxs(AlertModal,{variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),isOpen:error&&!isLoading,onClose:function onClose(){return setShowError(false);},children:[/*i18n*/i18n._(\"Failed to toggle host.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]})]});}export default HostToggle;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/HostToggle/HostToggle.js"],"names":["React","useState","useEffect","useCallback","Switch","Tooltip","useRequest","HostsAPI","AlertModal","ErrorDetail","HostToggle","className","host","isDisabled","onToggle","tooltip","enabled","isEnabled","setIsEnabled","showError","setShowError","update","id","result","isLoading","error","toggleHost","request","summary_fields","user_capabilities","edit"],"mappings":"8XACA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAqCC,WAArC,KAAwD,OAAxD,CAGA,OAASC,MAAT,CAAiBC,OAAjB,KAAgC,wBAAhC,CACA,MAAOC,CAAAA,UAAP,KAAuB,kBAAvB,CACA,OAASC,QAAT,KAAyB,KAAzB,CACA,MAAOC,CAAAA,UAAP,KAAuB,eAAvB,CACA,MAAOC,CAAAA,WAAP,KAAwB,gBAAxB,C,0RAEA,QAASC,CAAAA,UAAT,MAQG,IAPDC,CAAAA,SAOC,MAPDA,SAOC,CANDC,IAMC,MANDA,IAMC,sBALDC,UAKC,CALDA,UAKC,0BALY,KAKZ,iBAJDC,QAIC,MAJDA,QAIC,mBAHDC,OAGC,CAHDA,OAGC,+BAHS,wLAGT,cACD,cAAkCd,QAAQ,CAACW,IAAI,CAACI,OAAN,CAA1C,wCAAOC,SAAP,eAAkBC,YAAlB,eACA,eAAkCjB,QAAQ,CAAC,KAAD,CAA1C,yCAAOkB,SAAP,eAAkBC,YAAlB,eAEA,gBAKId,UAAU,CACZH,WAAW,sEAAC,yJACJI,CAAAA,QAAQ,CAACc,MAAT,CAAgBT,IAAI,CAACU,EAArB,CAAyB,CAC7BN,OAAO,CAAE,CAACC,SADmB,CAAzB,CADI,wCAIH,CAACA,SAJE,wDAAD,GAKR,CAACL,IAAD,CAAOK,SAAP,CALQ,CADC,CAOZL,IAAI,CAACI,OAPO,CALd,CACEO,MADF,aACEA,MADF,CAEEC,SAFF,aAEEA,SAFF,CAGEC,KAHF,aAGEA,KAHF,CAIWC,UAJX,aAIEC,OAJF,CAeAzB,SAAS,CAAC,UAAM,CACd,GAAIqB,MAAM,GAAKN,SAAf,CAA0B,CACxBC,YAAY,CAACK,MAAD,CAAZ,CACA,GAAIT,QAAJ,CAAc,CACZA,QAAQ,CAACS,MAAD,CAAR,CACD,CACF,CACF,CAPQ,CAON,CAACA,MAAD,CAASN,SAAT,CAAoBH,QAApB,CAPM,CAAT,CASAZ,SAAS,CAAC,UAAM,CACd,GAAIuB,KAAJ,CAAW,CACTL,YAAY,CAAC,IAAD,CAAZ,CACD,CACF,CAJQ,CAIN,CAACK,KAAD,CAJM,CAAT,CAMA,mBACE,wCACE,KAAC,OAAD,EAAS,OAAO,CAAEV,OAAlB,CAA2B,QAAQ,CAAC,KAApC,uBACE,oBACE,SAAS,CAAEJ,SADb,CAGE,EAAE,gBAAUC,IAAI,CAACU,EAAf,WAHJ,CAIE,KAAK,SAAE,YAJT,CAKE,QAAQ,SAAE,aALZ,CAME,SAAS,CAAEL,SANb,CAOE,UAAU,CACRO,SAAS,EACTX,UADA,EAEA,CAACD,IAAI,CAACgB,cAAL,CAAoBC,iBAApB,CAAsCC,IAV3C,CAYE,QAAQ,CAAEJ,UAZZ,CAaE,MAAM,gBAAUd,IAAI,CAACU,EAAf,WAbR,CAcE,qBAAY,qBAdd,EADF,EADF,CAmBGH,SAAS,EAAIM,KAAb,EAAsB,CAACD,SAAvB,eACC,MAAC,UAAD,EACE,OAAO,CAAC,OADV,CAEE,KAAK,SAAE,gBAFT,CAGE,MAAM,CAAEC,KAAK,EAAI,CAACD,SAHpB,CAIE,OAAO,CAAE,yBAAMJ,CAAAA,YAAY,CAAC,KAAD,CAAlB,EAJX,mBAMG,gCANH,cAOE,KAAC,WAAD,EAAa,KAAK,CAAEK,KAApB,EAPF,GApBJ,GADF,CAiCD,CAED,cAAef,CAAAA,UAAf","sourcesContent":["import 'styled-components/macro';\nimport React, { useState, useEffect, useCallback } from 'react';\n\nimport { t } from '@lingui/macro';\nimport { Switch, Tooltip } from '@patternfly/react-core';\nimport useRequest from 'hooks/useRequest';\nimport { HostsAPI } from 'api';\nimport AlertModal from '../AlertModal';\nimport ErrorDetail from '../ErrorDetail';\n\nfunction HostToggle({\n  className,\n  host,\n  isDisabled = false,\n  onToggle,\n  tooltip = t`Indicates if a host is available and should be included in running\n    jobs.  For hosts that are part of an external inventory, this may be\n    reset by the inventory sync process.`,\n}) {\n  const [isEnabled, setIsEnabled] = useState(host.enabled);\n  const [showError, setShowError] = useState(false);\n\n  const {\n    result,\n    isLoading,\n    error,\n    request: toggleHost,\n  } = useRequest(\n    useCallback(async () => {\n      await HostsAPI.update(host.id, {\n        enabled: !isEnabled,\n      });\n      return !isEnabled;\n    }, [host, isEnabled]),\n    host.enabled\n  );\n\n  useEffect(() => {\n    if (result !== isEnabled) {\n      setIsEnabled(result);\n      if (onToggle) {\n        onToggle(result);\n      }\n    }\n  }, [result, isEnabled, onToggle]);\n\n  useEffect(() => {\n    if (error) {\n      setShowError(true);\n    }\n  }, [error]);\n\n  return (\n    <>\n      <Tooltip content={tooltip} position=\"top\">\n        <Switch\n          className={className}\n          css=\"display: inline-flex;\"\n          id={`host-${host.id}-toggle`}\n          label={t`On`}\n          labelOff={t`Off`}\n          isChecked={isEnabled}\n          isDisabled={\n            isLoading ||\n            isDisabled ||\n            !host.summary_fields.user_capabilities.edit\n          }\n          onChange={toggleHost}\n          ouiaId={`host-${host.id}-toggle`}\n          aria-label={t`Toggle host`}\n        />\n      </Tooltip>\n      {showError && error && !isLoading && (\n        <AlertModal\n          variant=\"error\"\n          title={t`Error!`}\n          isOpen={error && !isLoading}\n          onClose={() => setShowError(false)}\n        >\n          {t`Failed to toggle host.`}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nexport default HostToggle;\n"]},"metadata":{},"sourceType":"module"}