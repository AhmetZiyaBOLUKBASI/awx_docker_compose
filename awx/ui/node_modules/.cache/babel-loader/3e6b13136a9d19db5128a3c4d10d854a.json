{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject;import{i18n}from\"@lingui/core\";import React,{useState,useEffect,useContext}from'react';import{Button,Tooltip,DropdownItem}from'@patternfly/react-core';import styled from'styled-components';import{KebabifiedContext}from'contexts/Kebabified';import AlertModal from'../AlertModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ModalNote=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin-bottom: var(--pf-global--spacer--xl);\\n\"])));function DisassociateButton(_ref){var _ref$itemsToDisassoci=_ref.itemsToDisassociate,itemsToDisassociate=_ref$itemsToDisassoci===void 0?[]:_ref$itemsToDisassoci,_ref$modalNote=_ref.modalNote,modalNote=_ref$modalNote===void 0?'':_ref$modalNote,_ref$modalTitle=_ref.modalTitle,modalTitle=_ref$modalTitle===void 0?/*i18n*/i18n._(\"Disassociate?\"):_ref$modalTitle,onDisassociate=_ref.onDisassociate,_ref$verifyCannotDisa=_ref.verifyCannotDisassociate,verifyCannotDisassociate=_ref$verifyCannotDisa===void 0?true:_ref$verifyCannotDisa,_ref$isProtectedInsta=_ref.isProtectedInstanceGroup,isProtectedInstanceGroup=_ref$isProtectedInsta===void 0?false:_ref$isProtectedInsta;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isOpen=_useState2[0],setIsOpen=_useState2[1];var _useContext=useContext(KebabifiedContext),isKebabified=_useContext.isKebabified,onKebabModalChange=_useContext.onKebabModalChange;var handleDisassociate=function handleDisassociate(){onDisassociate();setIsOpen(false);};useEffect(function(){if(isKebabified){onKebabModalChange(isOpen);}},[isKebabified,isOpen,onKebabModalChange]);function cannotDisassociateAllOthers(item){var _item$summary_fields,_item$summary_fields$;return!((_item$summary_fields=item.summary_fields)!==null&&_item$summary_fields!==void 0&&(_item$summary_fields$=_item$summary_fields.user_capabilities)!==null&&_item$summary_fields$!==void 0&&_item$summary_fields$.delete);}function cannotDisassociateInstances(item){return item.node_type==='control'||isProtectedInstanceGroup&&item.node_type==='hybrid';}var cannotDisassociate=itemsToDisassociate.some(function(i){return i.type==='instance';})?cannotDisassociateInstances:cannotDisassociateAllOthers;function renderTooltip(){if(verifyCannotDisassociate){var itemsUnableToDisassociate=itemsToDisassociate.filter(cannotDisassociate).map(function(item){var _item$name;return(_item$name=item.name)!==null&&_item$name!==void 0?_item$name:item.hostname;}).join(', ');if(cannotDisassociate?itemsToDisassociate.some(cannotDisassociateInstances):itemsToDisassociate.some(cannotDisassociateAllOthers)){return/*#__PURE__*/_jsx(\"div\",{children:/*i18n*/i18n._(\"You do not have permission to disassociate the following: {itemsUnableToDisassociate}\",{itemsUnableToDisassociate:itemsUnableToDisassociate})});}}if(itemsToDisassociate.length){return(/*i18n*/i18n._(\"Disassociate\"));}return(/*i18n*/i18n._(\"Select a row to disassociate\"));}var isDisabled=false;if(verifyCannotDisassociate){isDisabled=itemsToDisassociate.some(cannotDisassociate);}// NOTE: Once PF supports tooltips on disabled elements,\n// we can delete the extra <div> around the <DeleteButton> below.\n// See: https://github.com/patternfly/patternfly-react/issues/1894\nreturn/*#__PURE__*/_jsxs(_Fragment,{children:[isKebabified?/*#__PURE__*/_jsx(DropdownItem,{\"aria-label\":/*i18n*/i18n._(\"disassociate\"),isDisabled:isDisabled||!itemsToDisassociate.length,component:\"button\",ouiaId:\"disassociate-tooltip\",onClick:function onClick(){return setIsOpen(true);},children:/*i18n*/i18n._(\"Disassociate\")},\"add\"):/*#__PURE__*/_jsx(Tooltip,{content:renderTooltip(),ouiaId:\"disassociate-tooltip\",position:\"top\",children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Button,{ouiaId:\"disassociate-button\",variant:\"secondary\",\"aria-label\":/*i18n*/i18n._(\"Disassociate\"),onClick:function onClick(){return setIsOpen(true);},isDisabled:isDisabled||!itemsToDisassociate.length,children:/*i18n*/i18n._(\"Disassociate\")})})}),isOpen&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:isOpen,title:modalTitle,variant:\"warning\",onClose:function onClose(){return setIsOpen(false);},actions:[/*#__PURE__*/_jsx(Button,{ouiaId:\"disassociate-modal-confirm\",variant:\"danger\",\"aria-label\":/*i18n*/i18n._(\"confirm disassociate\"),onClick:handleDisassociate,children:/*i18n*/i18n._(\"Disassociate\")},\"disassociate\"),/*#__PURE__*/_jsx(Button,{ouiaId:\"disassociate-modal-cancel\",variant:\"link\",\"aria-label\":/*i18n*/i18n._(\"Cancel\"),onClick:function onClick(){return setIsOpen(false);},children:/*i18n*/i18n._(\"Cancel\")},\"cancel\")],children:[modalNote&&/*#__PURE__*/_jsx(ModalNote,{children:modalNote}),/*#__PURE__*/_jsx(\"div\",{children:/*i18n*/i18n._(\"This action will disassociate the following:\")}),itemsToDisassociate.map(function(item){return/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:item.hostname?item.hostname:item.name}),/*#__PURE__*/_jsx(\"br\",{})]},item.id);})]})]});}DisassociateButton.defaultProps={itemsToDisassociate:[],modalNote:'',modalTitle:''};export default DisassociateButton;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/DisassociateButton/DisassociateButton.js"],"names":["React","useState","useEffect","useContext","Button","Tooltip","DropdownItem","styled","KebabifiedContext","AlertModal","ModalNote","div","DisassociateButton","itemsToDisassociate","modalNote","modalTitle","onDisassociate","verifyCannotDisassociate","isProtectedInstanceGroup","isOpen","setIsOpen","isKebabified","onKebabModalChange","handleDisassociate","cannotDisassociateAllOthers","item","summary_fields","user_capabilities","delete","cannotDisassociateInstances","node_type","cannotDisassociate","some","i","type","renderTooltip","itemsUnableToDisassociate","filter","map","name","hostname","join","length","isDisabled","id","defaultProps"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\nimport { arrayOf, func, shape, string, oneOfType, number } from 'prop-types';\n\nimport { t } from '@lingui/macro';\nimport { Button, Tooltip, DropdownItem } from '@patternfly/react-core';\nimport styled from 'styled-components';\nimport { KebabifiedContext } from 'contexts/Kebabified';\n\nimport AlertModal from '../AlertModal';\n\nconst ModalNote = styled.div`\n  margin-bottom: var(--pf-global--spacer--xl);\n`;\n\nfunction DisassociateButton({\n  itemsToDisassociate = [],\n  modalNote = '',\n  modalTitle = t`Disassociate?`,\n  onDisassociate,\n  verifyCannotDisassociate = true,\n  isProtectedInstanceGroup = false,\n}) {\n  const [isOpen, setIsOpen] = useState(false);\n  const { isKebabified, onKebabModalChange } = useContext(KebabifiedContext);\n\n  const handleDisassociate = () => {\n    onDisassociate();\n    setIsOpen(false);\n  };\n\n  useEffect(() => {\n    if (isKebabified) {\n      onKebabModalChange(isOpen);\n    }\n  }, [isKebabified, isOpen, onKebabModalChange]);\n\n  function cannotDisassociateAllOthers(item) {\n    return !item.summary_fields?.user_capabilities?.delete;\n  }\n  function cannotDisassociateInstances(item) {\n    return (\n      item.node_type === 'control' ||\n      (isProtectedInstanceGroup && item.node_type === 'hybrid')\n    );\n  }\n\n  const cannotDisassociate = itemsToDisassociate.some(\n    (i) => i.type === 'instance'\n  )\n    ? cannotDisassociateInstances\n    : cannotDisassociateAllOthers;\n\n  function renderTooltip() {\n    if (verifyCannotDisassociate) {\n      const itemsUnableToDisassociate = itemsToDisassociate\n        .filter(cannotDisassociate)\n        .map((item) => item.name ?? item.hostname)\n        .join(', ');\n      if (\n        cannotDisassociate\n          ? itemsToDisassociate.some(cannotDisassociateInstances)\n          : itemsToDisassociate.some(cannotDisassociateAllOthers)\n      ) {\n        return (\n          <div>\n            {t`You do not have permission to disassociate the following: ${itemsUnableToDisassociate}`}\n          </div>\n        );\n      }\n    }\n\n    if (itemsToDisassociate.length) {\n      return t`Disassociate`;\n    }\n    return t`Select a row to disassociate`;\n  }\n\n  let isDisabled = false;\n  if (verifyCannotDisassociate) {\n    isDisabled = itemsToDisassociate.some(cannotDisassociate);\n  }\n\n  // NOTE: Once PF supports tooltips on disabled elements,\n  // we can delete the extra <div> around the <DeleteButton> below.\n  // See: https://github.com/patternfly/patternfly-react/issues/1894\n  return (\n    <>\n      {isKebabified ? (\n        <DropdownItem\n          key=\"add\"\n          aria-label={t`disassociate`}\n          isDisabled={isDisabled || !itemsToDisassociate.length}\n          component=\"button\"\n          ouiaId=\"disassociate-tooltip\"\n          onClick={() => setIsOpen(true)}\n        >\n          {t`Disassociate`}\n        </DropdownItem>\n      ) : (\n        <Tooltip\n          content={renderTooltip()}\n          ouiaId=\"disassociate-tooltip\"\n          position=\"top\"\n        >\n          <div>\n            <Button\n              ouiaId=\"disassociate-button\"\n              variant=\"secondary\"\n              aria-label={t`Disassociate`}\n              onClick={() => setIsOpen(true)}\n              isDisabled={isDisabled || !itemsToDisassociate.length}\n            >\n              {t`Disassociate`}\n            </Button>\n          </div>\n        </Tooltip>\n      )}\n\n      {isOpen && (\n        <AlertModal\n          isOpen={isOpen}\n          title={modalTitle}\n          variant=\"warning\"\n          onClose={() => setIsOpen(false)}\n          actions={[\n            <Button\n              ouiaId=\"disassociate-modal-confirm\"\n              key=\"disassociate\"\n              variant=\"danger\"\n              aria-label={t`confirm disassociate`}\n              onClick={handleDisassociate}\n            >\n              {t`Disassociate`}\n            </Button>,\n            <Button\n              ouiaId=\"disassociate-modal-cancel\"\n              key=\"cancel\"\n              variant=\"link\"\n              aria-label={t`Cancel`}\n              onClick={() => setIsOpen(false)}\n            >\n              {t`Cancel`}\n            </Button>,\n          ]}\n        >\n          {modalNote && <ModalNote>{modalNote}</ModalNote>}\n\n          <div>{t`This action will disassociate the following:`}</div>\n\n          {itemsToDisassociate.map((item) => (\n            <span key={item.id}>\n              <strong>{item.hostname ? item.hostname : item.name}</strong>\n              <br />\n            </span>\n          ))}\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nDisassociateButton.defaultProps = {\n  itemsToDisassociate: [],\n  modalNote: '',\n  modalTitle: '',\n};\n\nDisassociateButton.propTypes = {\n  itemsToDisassociate: oneOfType([\n    arrayOf(\n      shape({\n        id: number.isRequired,\n        name: string.isRequired,\n      })\n    ),\n    arrayOf(\n      shape({\n        id: number.isRequired,\n        hostname: string.isRequired,\n      })\n    ),\n  ]),\n  modalNote: string,\n  modalTitle: string,\n  onDisassociate: func.isRequired,\n};\n\nexport default DisassociateButton;\n"]},"metadata":{},"sourceType":"module"}