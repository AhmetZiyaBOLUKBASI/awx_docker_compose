{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject;import{i18n}from\"@lingui/core\";import React,{useContext,useEffect,useRef,useState}from'react';import styled from'styled-components';import{PencilAltIcon,PlusIcon,TrashAltIcon}from'@patternfly/react-icons';import{WorkflowDispatchContext,WorkflowStateContext}from'contexts/Workflow';import{generateLine,getLinePoints,getLinkOverlayPoints}from'components/Workflow/WorkflowUtils';import{WorkflowActionTooltip,WorkflowActionTooltipItem}from'components/Workflow';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LinkG=styled.g(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  pointer-events: \",\";\\n\"])),function(props){return props.ignorePointerEvents?'none':'auto';});function VisualizerLink(_ref){var link=_ref.link,updateLinkHelp=_ref.updateLinkHelp,readOnly=_ref.readOnly,updateHelpText=_ref.updateHelpText;var ref=useRef(null);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),hovering=_useState2[0],setHovering=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),pathD=_useState4[0],setPathD=_useState4[1];var _useState5=useState('#CCCCCC'),_useState6=_slicedToArray(_useState5,2),pathStroke=_useState6[0],setPathStroke=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),tooltipX=_useState8[0],setTooltipX=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),tooltipY=_useState10[0],setTooltipY=_useState10[1];var dispatch=useContext(WorkflowDispatchContext);var _useContext=useContext(WorkflowStateContext),addingLink=_useContext.addingLink,nodePositions=_useContext.nodePositions;var addNodeAction=/*#__PURE__*/_jsx(WorkflowActionTooltipItem,{id:\"link-add-node\",onClick:function onClick(){updateHelpText(null);setHovering(false);dispatch({type:'START_ADD_NODE',sourceNodeId:link.source.id,targetNodeId:link.target.id});},onMouseEnter:function onMouseEnter(){return updateHelpText(/*i18n*/i18n._(\"Add a new node between these two nodes\"));},onMouseLeave:function onMouseLeave(){return updateHelpText(null);},children:/*#__PURE__*/_jsx(PlusIcon,{})},\"add\");var tooltipActions=link.source.id===1?[addNodeAction]:[addNodeAction,/*#__PURE__*/_jsx(WorkflowActionTooltipItem,{id:\"link-edit\",onClick:function onClick(){updateHelpText(null);setHovering(false);dispatch({type:'SET_LINK_TO_EDIT',value:link});},onMouseEnter:function onMouseEnter(){return updateHelpText(/*i18n*/i18n._(\"Edit this link\"));},onMouseLeave:function onMouseLeave(){return updateHelpText(null);},children:/*#__PURE__*/_jsx(PencilAltIcon,{})},\"edit\"),/*#__PURE__*/_jsx(WorkflowActionTooltipItem,{id:\"link-delete\",onClick:function onClick(){updateHelpText(null);setHovering(false);dispatch({type:'START_DELETE_LINK',link:link});},onMouseEnter:function onMouseEnter(){return updateHelpText(/*i18n*/i18n._(\"Delete this link\"));},onMouseLeave:function onMouseLeave(){return updateHelpText(null);},children:/*#__PURE__*/_jsx(TrashAltIcon,{})},\"delete\")];var handleLinkMouseEnter=function handleLinkMouseEnter(){var startNode=document.getElementById('node-1');ref.current.parentNode.insertBefore(ref.current,startNode);setHovering(true);};var handleLinkMouseLeave=function handleLinkMouseLeave(){ref.current.parentNode.prepend(ref.current);setHovering(null);};useEffect(function(){if(link.linkType==='failure'){setPathStroke('#d9534f');}if(link.linkType==='success'){setPathStroke('#5cb85c');}if(link.linkType==='always'){setPathStroke('#337ab7');}},[link.linkType]);useEffect(function(){var linePoints=getLinePoints(link,nodePositions);setPathD(generateLine(linePoints));setTooltipX((linePoints[0].x+linePoints[1].x)/2);setTooltipY((linePoints[0].y+linePoints[1].y)/2);},[link,nodePositions]);return/*#__PURE__*/_jsxs(LinkG,{id:\"link-\".concat(link.source.id,\"-\").concat(link.target.id),ignorePointerEvents:addingLink,onMouseEnter:handleLinkMouseEnter,onMouseLeave:handleLinkMouseLeave,ref:ref,children:[/*#__PURE__*/_jsx(\"polygon\",{fill:\"#E1E1E1\",id:\"link-\".concat(link.source.id,\"-\").concat(link.target.id,\"-background\"),opacity:hovering?'1':'0',points:getLinkOverlayPoints(link,nodePositions)}),/*#__PURE__*/_jsx(\"path\",{d:pathD,stroke:pathStroke,strokeWidth:\"2px\"}),/*#__PURE__*/_jsx(\"polygon\",{id:\"link-\".concat(link.source.id,\"-\").concat(link.target.id,\"-overlay\"),onMouseEnter:function onMouseEnter(){return updateLinkHelp(link);},onMouseLeave:function onMouseLeave(){return updateLinkHelp(null);},opacity:\"0\",points:getLinkOverlayPoints(link,nodePositions)}),!readOnly&&hovering&&/*#__PURE__*/_jsx(WorkflowActionTooltip,{actions:tooltipActions,pointX:tooltipX,pointY:tooltipY})]});}export default VisualizerLink;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Template/WorkflowJobTemplateVisualizer/VisualizerLink.js"],"names":["React","useContext","useEffect","useRef","useState","styled","PencilAltIcon","PlusIcon","TrashAltIcon","WorkflowDispatchContext","WorkflowStateContext","generateLine","getLinePoints","getLinkOverlayPoints","WorkflowActionTooltip","WorkflowActionTooltipItem","LinkG","g","props","ignorePointerEvents","VisualizerLink","link","updateLinkHelp","readOnly","updateHelpText","ref","hovering","setHovering","pathD","setPathD","pathStroke","setPathStroke","tooltipX","setTooltipX","tooltipY","setTooltipY","dispatch","addingLink","nodePositions","addNodeAction","type","sourceNodeId","source","id","targetNodeId","target","tooltipActions","value","handleLinkMouseEnter","startNode","document","getElementById","current","parentNode","insertBefore","handleLinkMouseLeave","prepend","linkType","linePoints","x","y"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\n\nimport { t } from '@lingui/macro';\nimport { bool, func, shape } from 'prop-types';\nimport { PencilAltIcon, PlusIcon, TrashAltIcon } from '@patternfly/react-icons';\nimport {\n  WorkflowDispatchContext,\n  WorkflowStateContext,\n} from 'contexts/Workflow';\nimport {\n  generateLine,\n  getLinePoints,\n  getLinkOverlayPoints,\n} from 'components/Workflow/WorkflowUtils';\nimport {\n  WorkflowActionTooltip,\n  WorkflowActionTooltipItem,\n} from 'components/Workflow';\n\nconst LinkG = styled.g`\n  pointer-events: ${(props) => (props.ignorePointerEvents ? 'none' : 'auto')};\n`;\n\nfunction VisualizerLink({ link, updateLinkHelp, readOnly, updateHelpText }) {\n  const ref = useRef(null);\n  const [hovering, setHovering] = useState(false);\n  const [pathD, setPathD] = useState();\n  const [pathStroke, setPathStroke] = useState('#CCCCCC');\n  const [tooltipX, setTooltipX] = useState();\n  const [tooltipY, setTooltipY] = useState();\n  const dispatch = useContext(WorkflowDispatchContext);\n  const { addingLink, nodePositions } = useContext(WorkflowStateContext);\n\n  const addNodeAction = (\n    <WorkflowActionTooltipItem\n      id=\"link-add-node\"\n      key=\"add\"\n      onClick={() => {\n        updateHelpText(null);\n        setHovering(false);\n        dispatch({\n          type: 'START_ADD_NODE',\n          sourceNodeId: link.source.id,\n          targetNodeId: link.target.id,\n        });\n      }}\n      onMouseEnter={() =>\n        updateHelpText(t`Add a new node between these two nodes`)\n      }\n      onMouseLeave={() => updateHelpText(null)}\n    >\n      <PlusIcon />\n    </WorkflowActionTooltipItem>\n  );\n\n  const tooltipActions =\n    link.source.id === 1\n      ? [addNodeAction]\n      : [\n          addNodeAction,\n          <WorkflowActionTooltipItem\n            id=\"link-edit\"\n            key=\"edit\"\n            onClick={() => {\n              updateHelpText(null);\n              setHovering(false);\n              dispatch({ type: 'SET_LINK_TO_EDIT', value: link });\n            }}\n            onMouseEnter={() => updateHelpText(t`Edit this link`)}\n            onMouseLeave={() => updateHelpText(null)}\n          >\n            <PencilAltIcon />\n          </WorkflowActionTooltipItem>,\n          <WorkflowActionTooltipItem\n            id=\"link-delete\"\n            key=\"delete\"\n            onClick={() => {\n              updateHelpText(null);\n              setHovering(false);\n              dispatch({ type: 'START_DELETE_LINK', link });\n            }}\n            onMouseEnter={() => updateHelpText(t`Delete this link`)}\n            onMouseLeave={() => updateHelpText(null)}\n          >\n            <TrashAltIcon />\n          </WorkflowActionTooltipItem>,\n        ];\n\n  const handleLinkMouseEnter = () => {\n    const startNode = document.getElementById('node-1');\n    ref.current.parentNode.insertBefore(ref.current, startNode);\n    setHovering(true);\n  };\n\n  const handleLinkMouseLeave = () => {\n    ref.current.parentNode.prepend(ref.current);\n    setHovering(null);\n  };\n\n  useEffect(() => {\n    if (link.linkType === 'failure') {\n      setPathStroke('#d9534f');\n    }\n    if (link.linkType === 'success') {\n      setPathStroke('#5cb85c');\n    }\n    if (link.linkType === 'always') {\n      setPathStroke('#337ab7');\n    }\n  }, [link.linkType]);\n\n  useEffect(() => {\n    const linePoints = getLinePoints(link, nodePositions);\n    setPathD(generateLine(linePoints));\n    setTooltipX((linePoints[0].x + linePoints[1].x) / 2);\n    setTooltipY((linePoints[0].y + linePoints[1].y) / 2);\n  }, [link, nodePositions]);\n\n  return (\n    <LinkG\n      id={`link-${link.source.id}-${link.target.id}`}\n      ignorePointerEvents={addingLink}\n      onMouseEnter={handleLinkMouseEnter}\n      onMouseLeave={handleLinkMouseLeave}\n      ref={ref}\n    >\n      <polygon\n        fill=\"#E1E1E1\"\n        id={`link-${link.source.id}-${link.target.id}-background`}\n        opacity={hovering ? '1' : '0'}\n        points={getLinkOverlayPoints(link, nodePositions)}\n      />\n      <path d={pathD} stroke={pathStroke} strokeWidth=\"2px\" />\n      <polygon\n        id={`link-${link.source.id}-${link.target.id}-overlay`}\n        onMouseEnter={() => updateLinkHelp(link)}\n        onMouseLeave={() => updateLinkHelp(null)}\n        opacity=\"0\"\n        points={getLinkOverlayPoints(link, nodePositions)}\n      />\n      {!readOnly && hovering && (\n        <WorkflowActionTooltip\n          actions={tooltipActions}\n          pointX={tooltipX}\n          pointY={tooltipY}\n        />\n      )}\n    </LinkG>\n  );\n}\n\nVisualizerLink.propTypes = {\n  link: shape().isRequired,\n  readOnly: bool.isRequired,\n  updateHelpText: func.isRequired,\n  updateLinkHelp: func.isRequired,\n};\n\nexport default VisualizerLink;\n"]},"metadata":{},"sourceType":"module"}