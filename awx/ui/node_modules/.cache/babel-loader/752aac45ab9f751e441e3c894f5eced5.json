{"ast":null,"code":"import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{useLocation}from'react-router-dom';import{Card}from'@patternfly/react-core';import useRequest,{useDeleteItems,useDismissableError}from'hooks/useRequest';import{useConfig}from'contexts/Config';import useSelected from'hooks/useSelected';import useExpanded from'hooks/useExpanded';import{isJobRunning,getJobModel}from'util/jobs';import{getQSConfig,parseQueryString}from'util/qs';import{UnifiedJobsAPI,InventorySourcesAPI}from'api';import AlertModal from'../AlertModal';import DatalistToolbar from'../DataListToolbar';import ErrorDetail from'../ErrorDetail';import PaginatedTable,{HeaderRow,HeaderCell,ToolbarDeleteButton,getSearchableKeys}from'../PaginatedTable';import JobListItem from'./JobListItem';import JobListCancelButton from'./JobListCancelButton';import useWsJobs from'./useWsJobs';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function JobList(_ref){var defaultParams=_ref.defaultParams,_ref$showTypeColumn=_ref.showTypeColumn,showTypeColumn=_ref$showTypeColumn===void 0?false:_ref$showTypeColumn,_ref$additionalRelate=_ref.additionalRelatedSearchableKeys,additionalRelatedSearchableKeys=_ref$additionalRelate===void 0?[]:_ref$additionalRelate;var qsConfig=getQSConfig('job',_objectSpread({page:1,page_size:20,order_by:'-finished',not__launch_type:'sync'},defaultParams),['id','page','page_size']);var _useConfig=useConfig(),me=_useConfig.me;var location=useLocation();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,response,actionsResponse,choices;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(qsConfig,location.search);_context.next=3;return Promise.all([UnifiedJobsAPI.read(_objectSpread({},params)),UnifiedJobsAPI.readOptions(),InventorySourcesAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,3);response=_yield$Promise$all2[0];actionsResponse=_yield$Promise$all2[1];choices=_yield$Promise$all2[2].data.actions.GET.source.choices;return _context.abrupt(\"return\",{results:response.data.results,count:response.data.count,inventorySourceChoices:choices,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 9:case\"end\":return _context.stop();}}},_callee);})),[location]// eslint-disable-line react-hooks/exhaustive-deps\n),{results:[],count:0,inventorySourceChoices:[],relatedSearchableKeys:[],searchableKeys:[]}),_useRequest$result=_useRequest.result,results=_useRequest$result.results,count=_useRequest$result.count,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,inventorySourceChoices=_useRequest$result.inventorySourceChoices,contentError=_useRequest.error,isLoading=_useRequest.isLoading,fetchJobs=_useRequest.request;useEffect(function(){fetchJobs();},[fetchJobs]);var fetchJobsById=useCallback(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(ids){var params,_yield$UnifiedJobsAPI,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:params=parseQueryString(qsConfig,location.search);params.id__in=ids.join(',');_context2.prev=2;_context2.next=5;return UnifiedJobsAPI.read(params);case 5:_yield$UnifiedJobsAPI=_context2.sent;data=_yield$UnifiedJobsAPI.data;return _context2.abrupt(\"return\",data.results);case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](2);return _context2.abrupt(\"return\",[]);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[2,10]]);}));return function(_x){return _ref3.apply(this,arguments);};}(),[location.search]// eslint-disable-line react-hooks/exhaustive-deps\n);var jobs=useWsJobs(results,fetchJobsById,qsConfig);var _useSelected=useSelected(jobs),selected=_useSelected.selected,isAllSelected=_useSelected.isAllSelected,handleSelect=_useSelected.handleSelect,selectAll=_useSelected.selectAll,clearSelected=_useSelected.clearSelected;var _useExpanded=useExpanded(jobs),expanded=_useExpanded.expanded,isAllExpanded=_useExpanded.isAllExpanded,handleExpand=_useExpanded.handleExpand,expandAll=_useExpanded.expandAll;var _useRequest2=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",Promise.all(selected.map(function(job){if(isJobRunning(job.status)){return getJobModel(job.type).cancel(job.id);}return Promise.resolve();})));case 1:case\"end\":return _context3.stop();}}},_callee3);})),[selected]),{}),cancelJobsError=_useRequest2.error,isCancelLoading=_useRequest2.isLoading,cancelJobs=_useRequest2.request;var _useDismissableError=useDismissableError(cancelJobsError),cancelError=_useDismissableError.error,dismissCancelError=_useDismissableError.dismissError;var _useDeleteItems=useDeleteItems(useCallback(function(){return Promise.all(selected.map(function(_ref5){var type=_ref5.type,id=_ref5.id;return getJobModel(type).destroy(id);}));},[selected]),{qsConfig:qsConfig,allItemsSelected:isAllSelected,fetchItems:fetchJobs}),isDeleteLoading=_useDeleteItems.isLoading,deleteJobs=_useDeleteItems.deleteItems,deletionError=_useDeleteItems.deletionError,clearDeletionError=_useDeleteItems.clearDeletionError;var handleJobCancel=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return cancelJobs();case 2:clearSelected();case 3:case\"end\":return _context4.stop();}}},_callee4);}));return function handleJobCancel(){return _ref6.apply(this,arguments);};}();var handleJobDelete=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return deleteJobs();case 2:clearSelected();case 3:case\"end\":return _context5.stop();}}},_callee5);}));return function handleJobDelete(){return _ref7.apply(this,arguments);};}();var cannotDeleteItems=selected.filter(function(job){return isJobRunning(job.status);});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(PaginatedTable,{contentError:contentError,hasContentLoading:isLoading||isDeleteLoading||isCancelLoading,items:jobs,itemCount:count,emptyContentMessage:/*i18n*/i18n._(\"Please run a job to populate this list.\"),pluralizedItemName:/*i18n*/i18n._(\"Jobs\"),qsConfig:qsConfig,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"ID\"),key:'id'},{name:/*i18n*/i18n._(\"Label Name\"),key:'labels__name__icontains'},{name:/*i18n*/i18n._(\"Job Type\"),key:\"or__type\",options:[[\"project_update\",/*i18n*/i18n._(\"Source Control Update\")],[\"inventory_update\",/*i18n*/i18n._(\"Inventory Sync\")],[\"job\",/*i18n*/i18n._(\"Playbook Run\")],[\"ad_hoc_command\",/*i18n*/i18n._(\"Command\")],[\"system_job\",/*i18n*/i18n._(\"Management Job\")],[\"workflow_job\",/*i18n*/i18n._(\"Workflow Job\")]]},{name:/*i18n*/i18n._(\"Launched By (Username)\"),key:'created_by__username__icontains'},{name:/*i18n*/i18n._(\"Status\"),key:'or__status',options:[[\"new\",/*i18n*/i18n._(\"New\")],[\"pending\",/*i18n*/i18n._(\"Pending\")],[\"waiting\",/*i18n*/i18n._(\"Waiting\")],[\"running\",/*i18n*/i18n._(\"Running\")],[\"successful\",/*i18n*/i18n._(\"Successful\")],[\"failed\",/*i18n*/i18n._(\"Failed\")],[\"error\",/*i18n*/i18n._(\"Error\")],[\"canceled\",/*i18n*/i18n._(\"Canceled\")]]},{name:/*i18n*/i18n._(\"Limit\"),key:'job__limit'}],headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:qsConfig,isExpandable:true,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"status\",children:/*i18n*/i18n._(\"Status\")}),showTypeColumn&&/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Type\")}),/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"started\",children:/*i18n*/i18n._(\"Start Time\")}),/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"finished\",children:/*i18n*/i18n._(\"Finish Time\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Actions\")})]}),clearSelected:clearSelected,toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:[].concat(_toConsumableArray(relatedSearchableKeys),_toConsumableArray(additionalRelatedSearchableKeys)),renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DatalistToolbar,_objectSpread(_objectSpread({},props),{},{isAllExpanded:isAllExpanded,onExpandAll:expandAll,isAllSelected:isAllSelected,onSelectAll:selectAll,qsConfig:qsConfig,additionalControls:[/*#__PURE__*/_jsx(ToolbarDeleteButton,{onDelete:handleJobDelete,itemsToDelete:selected.map(function(_ref8){var item=Object.assign({},_ref8);item.name=\"\".concat(item.id,\" - \").concat(item.name);return item;}),pluralizedItemName:/*i18n*/i18n._(\"Jobs\"),cannotDelete:function cannotDelete(item){return isJobRunning(item.status)||!item.summary_fields.user_capabilities.delete;},errorMessage:/*#__PURE__*/_jsx(Trans,{id:\"{0, plural, one {The selected job cannot be deleted due to insufficient permission or a running job status} other {The selected jobs cannot be deleted due to insufficient permissions or a running job status}}\",values:{0:cannotDeleteItems.length}})},\"delete\"),/*#__PURE__*/_jsx(JobListCancelButton,{onCancel:handleJobCancel,jobsToCancel:selected},\"cancel\")]}));},renderRow:function renderRow(job,index){return/*#__PURE__*/_jsx(JobListItem,{inventorySourceLabels:inventorySourceChoices,job:job,isExpanded:expanded.some(function(row){return row.id===job.id;}),onExpand:function onExpand(){return handleExpand(job);},isSuperUser:me===null||me===void 0?void 0:me.is_superuser,showTypeColumn:showTypeColumn,onSelect:function onSelect(){return handleSelect(job);},isSelected:selected.some(function(row){return row.id===job.id;}),rowIndex:index},job.id);}})}),deletionError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:true,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:clearDeletionError,children:[/*i18n*/i18n._(\"Failed to delete one or more jobs.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:deletionError})]}),cancelError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:true,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:dismissCancelError,children:[/*i18n*/i18n._(\"Failed to cancel one or more jobs.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:cancelError})]})]});}export default JobList;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/JobList/JobList.js"],"names":["React","useEffect","useCallback","useLocation","Card","useRequest","useDeleteItems","useDismissableError","useConfig","useSelected","useExpanded","isJobRunning","getJobModel","getQSConfig","parseQueryString","UnifiedJobsAPI","InventorySourcesAPI","AlertModal","DatalistToolbar","ErrorDetail","PaginatedTable","HeaderRow","HeaderCell","ToolbarDeleteButton","getSearchableKeys","JobListItem","JobListCancelButton","useWsJobs","JobList","defaultParams","showTypeColumn","additionalRelatedSearchableKeys","qsConfig","page","page_size","order_by","not__launch_type","me","location","params","search","Promise","all","read","readOptions","response","actionsResponse","choices","data","actions","GET","source","results","count","inventorySourceChoices","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","result","contentError","error","isLoading","fetchJobs","request","fetchJobsById","ids","id__in","join","jobs","selected","isAllSelected","handleSelect","selectAll","clearSelected","expanded","isAllExpanded","handleExpand","expandAll","job","status","type","cancel","id","resolve","cancelJobsError","isCancelLoading","cancelJobs","cancelError","dismissCancelError","dismissError","destroy","allItemsSelected","fetchItems","isDeleteLoading","deleteJobs","deleteItems","deletionError","clearDeletionError","handleJobCancel","handleJobDelete","cannotDeleteItems","filter","name","key","isDefault","options","props","item","summary_fields","user_capabilities","delete","length","index","some","row","is_superuser"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { t, Plural } from '@lingui/macro';\n\nimport { Card } from '@patternfly/react-core';\nimport useRequest, {\n  useDeleteItems,\n  useDismissableError,\n} from 'hooks/useRequest';\nimport { useConfig } from 'contexts/Config';\nimport useSelected from 'hooks/useSelected';\nimport useExpanded from 'hooks/useExpanded';\nimport { isJobRunning, getJobModel } from 'util/jobs';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport { UnifiedJobsAPI, InventorySourcesAPI } from 'api';\nimport AlertModal from '../AlertModal';\nimport DatalistToolbar from '../DataListToolbar';\nimport ErrorDetail from '../ErrorDetail';\nimport PaginatedTable, {\n  HeaderRow,\n  HeaderCell,\n  ToolbarDeleteButton,\n  getSearchableKeys,\n} from '../PaginatedTable';\nimport JobListItem from './JobListItem';\nimport JobListCancelButton from './JobListCancelButton';\nimport useWsJobs from './useWsJobs';\n\nfunction JobList({\n  defaultParams,\n  showTypeColumn = false,\n  additionalRelatedSearchableKeys = [],\n}) {\n  const qsConfig = getQSConfig(\n    'job',\n    {\n      page: 1,\n      page_size: 20,\n      order_by: '-finished',\n      not__launch_type: 'sync',\n      ...defaultParams,\n    },\n    ['id', 'page', 'page_size']\n  );\n\n  const { me } = useConfig();\n  const location = useLocation();\n  const {\n    result: {\n      results,\n      count,\n      relatedSearchableKeys,\n      searchableKeys,\n      inventorySourceChoices,\n    },\n    error: contentError,\n    isLoading,\n    request: fetchJobs,\n  } = useRequest(\n    useCallback(\n      async () => {\n        const params = parseQueryString(qsConfig, location.search);\n        const [\n          response,\n          actionsResponse,\n          {\n            data: {\n              actions: {\n                GET: {\n                  source: { choices },\n                },\n              },\n            },\n          },\n        ] = await Promise.all([\n          UnifiedJobsAPI.read({ ...params }),\n          UnifiedJobsAPI.readOptions(),\n          InventorySourcesAPI.readOptions(),\n        ]);\n\n        return {\n          results: response.data.results,\n          count: response.data.count,\n          inventorySourceChoices: choices,\n          relatedSearchableKeys: (\n            actionsResponse?.data?.related_search_fields || []\n          ).map((val) => val.slice(0, -8)),\n          searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n        };\n      },\n      [location] // eslint-disable-line react-hooks/exhaustive-deps\n    ),\n    {\n      results: [],\n      count: 0,\n      inventorySourceChoices: [],\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n  useEffect(() => {\n    fetchJobs();\n  }, [fetchJobs]);\n\n  const fetchJobsById = useCallback(\n    async (ids) => {\n      const params = parseQueryString(qsConfig, location.search);\n      params.id__in = ids.join(',');\n      try {\n        const { data } = await UnifiedJobsAPI.read(params);\n        return data.results;\n      } catch (e) {\n        return [];\n      }\n    },\n    [location.search] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n\n  const jobs = useWsJobs(results, fetchJobsById, qsConfig);\n\n  const { selected, isAllSelected, handleSelect, selectAll, clearSelected } =\n    useSelected(jobs);\n\n  const { expanded, isAllExpanded, handleExpand, expandAll } =\n    useExpanded(jobs);\n\n  const {\n    error: cancelJobsError,\n    isLoading: isCancelLoading,\n    request: cancelJobs,\n  } = useRequest(\n    useCallback(\n      async () =>\n        Promise.all(\n          selected.map((job) => {\n            if (isJobRunning(job.status)) {\n              return getJobModel(job.type).cancel(job.id);\n            }\n            return Promise.resolve();\n          })\n        ),\n      [selected]\n    ),\n    {}\n  );\n\n  const { error: cancelError, dismissError: dismissCancelError } =\n    useDismissableError(cancelJobsError);\n\n  const {\n    isLoading: isDeleteLoading,\n    deleteItems: deleteJobs,\n    deletionError,\n    clearDeletionError,\n  } = useDeleteItems(\n    useCallback(\n      () =>\n        Promise.all(\n          selected.map(({ type, id }) => getJobModel(type).destroy(id))\n        ),\n      [selected]\n    ),\n    {\n      qsConfig,\n      allItemsSelected: isAllSelected,\n      fetchItems: fetchJobs,\n    }\n  );\n\n  const handleJobCancel = async () => {\n    await cancelJobs();\n    clearSelected();\n  };\n\n  const handleJobDelete = async () => {\n    await deleteJobs();\n    clearSelected();\n  };\n\n  const cannotDeleteItems = selected.filter((job) => isJobRunning(job.status));\n\n  return (\n    <>\n      <Card>\n        <PaginatedTable\n          contentError={contentError}\n          hasContentLoading={isLoading || isDeleteLoading || isCancelLoading}\n          items={jobs}\n          itemCount={count}\n          emptyContentMessage={t`Please run a job to populate this list.`}\n          pluralizedItemName={t`Jobs`}\n          qsConfig={qsConfig}\n          toolbarSearchColumns={[\n            {\n              name: t`Name`,\n              key: 'name__icontains',\n              isDefault: true,\n            },\n            {\n              name: t`ID`,\n              key: 'id',\n            },\n            {\n              name: t`Label Name`,\n              key: 'labels__name__icontains',\n            },\n            {\n              name: t`Job Type`,\n              key: `or__type`,\n              options: [\n                [`project_update`, t`Source Control Update`],\n                [`inventory_update`, t`Inventory Sync`],\n                [`job`, t`Playbook Run`],\n                [`ad_hoc_command`, t`Command`],\n                [`system_job`, t`Management Job`],\n                [`workflow_job`, t`Workflow Job`],\n              ],\n            },\n            {\n              name: t`Launched By (Username)`,\n              key: 'created_by__username__icontains',\n            },\n            {\n              name: t`Status`,\n              key: 'or__status',\n              options: [\n                [`new`, t`New`],\n                [`pending`, t`Pending`],\n                [`waiting`, t`Waiting`],\n                [`running`, t`Running`],\n                [`successful`, t`Successful`],\n                [`failed`, t`Failed`],\n                [`error`, t`Error`],\n                [`canceled`, t`Canceled`],\n              ],\n            },\n            {\n              name: t`Limit`,\n              key: 'job__limit',\n            },\n          ]}\n          headerRow={\n            <HeaderRow qsConfig={qsConfig} isExpandable>\n              <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n              <HeaderCell sortKey=\"status\">{t`Status`}</HeaderCell>\n              {showTypeColumn && <HeaderCell>{t`Type`}</HeaderCell>}\n              <HeaderCell sortKey=\"started\">{t`Start Time`}</HeaderCell>\n              <HeaderCell sortKey=\"finished\">{t`Finish Time`}</HeaderCell>\n              <HeaderCell>{t`Actions`}</HeaderCell>\n            </HeaderRow>\n          }\n          clearSelected={clearSelected}\n          toolbarSearchableKeys={searchableKeys}\n          toolbarRelatedSearchableKeys={[\n            ...relatedSearchableKeys,\n            ...additionalRelatedSearchableKeys,\n          ]}\n          renderToolbar={(props) => (\n            <DatalistToolbar\n              {...props}\n              isAllExpanded={isAllExpanded}\n              onExpandAll={expandAll}\n              isAllSelected={isAllSelected}\n              onSelectAll={selectAll}\n              qsConfig={qsConfig}\n              additionalControls={[\n                <ToolbarDeleteButton\n                  key=\"delete\"\n                  onDelete={handleJobDelete}\n                  itemsToDelete={selected.map(({ ...item }) => {\n                    item.name = `${item.id} - ${item.name}`;\n                    return item;\n                  })}\n                  pluralizedItemName={t`Jobs`}\n                  cannotDelete={(item) =>\n                    isJobRunning(item.status) ||\n                    !item.summary_fields.user_capabilities.delete\n                  }\n                  errorMessage={\n                    <Plural\n                      value={cannotDeleteItems.length}\n                      one=\"The selected job cannot be deleted due to insufficient permission or a running job status\"\n                      other=\"The selected jobs cannot be deleted due to insufficient permissions or a running job status\"\n                    />\n                  }\n                />,\n                <JobListCancelButton\n                  key=\"cancel\"\n                  onCancel={handleJobCancel}\n                  jobsToCancel={selected}\n                />,\n              ]}\n            />\n          )}\n          renderRow={(job, index) => (\n            <JobListItem\n              key={job.id}\n              inventorySourceLabels={inventorySourceChoices}\n              job={job}\n              isExpanded={expanded.some((row) => row.id === job.id)}\n              onExpand={() => handleExpand(job)}\n              isSuperUser={me?.is_superuser}\n              showTypeColumn={showTypeColumn}\n              onSelect={() => handleSelect(job)}\n              isSelected={selected.some((row) => row.id === job.id)}\n              rowIndex={index}\n            />\n          )}\n        />\n      </Card>\n      {deletionError && (\n        <AlertModal\n          isOpen\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={clearDeletionError}\n        >\n          {t`Failed to delete one or more jobs.`}\n          <ErrorDetail error={deletionError} />\n        </AlertModal>\n      )}\n      {cancelError && (\n        <AlertModal\n          isOpen\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={dismissCancelError}\n        >\n          {t`Failed to cancel one or more jobs.`}\n          <ErrorDetail error={cancelError} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nexport default JobList;\n"]},"metadata":{},"sourceType":"module"}