{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import React,{useState,useCallback}from'react';import{Button,Label}from'@patternfly/react-core';import{Tr,Td}from'@patternfly/react-table';import{PencilAltIcon}from'@patternfly/react-icons';import{Link}from'react-router-dom';import{timeOfDay}from'util/dates';import{InventoriesAPI}from'api';import{Inventory}from'types';import{ActionsTd,ActionItem,TdBreakWord}from'components/PaginatedTable';import CopyButton from'components/CopyButton';import StatusLabel from'components/StatusLabel';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function InventoryListItem(_ref){var _inventory$summary_fi,_inventory$summary_fi2,_inventory$summary_fi3,_inventory$summary_fi4;var inventory=_ref.inventory,rowIndex=_ref.rowIndex,isSelected=_ref.isSelected,onSelect=_ref.onSelect,onCopy=_ref.onCopy,detailUrl=_ref.detailUrl,fetchInventories=_ref.fetchInventories;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isCopying=_useState2[0],setIsCopying=_useState2[1];var copyInventory=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return InventoriesAPI.copy(inventory.id,{name:\"\".concat(inventory.name,\" @ \").concat(timeOfDay())});case 2:response=_context.sent;if(response.status===201){onCopy(response.data.id);}_context.next=6;return fetchInventories();case 6:case\"end\":return _context.stop();}}},_callee);})),[inventory.id,inventory.name,fetchInventories,onCopy]);var handleCopyStart=useCallback(function(){setIsCopying(true);},[]);var handleCopyFinish=useCallback(function(){setIsCopying(false);},[]);var labelId=\"check-action-\".concat(inventory.id);var syncStatus='disabled';if(inventory.isSourceSyncRunning){syncStatus='syncing';}else if(inventory.has_inventory_sources){syncStatus=inventory.inventory_sources_with_failures>0?'error':'success';}var tooltipContent='';if(inventory.has_inventory_sources){if(inventory.inventory_sources_with_failures>0){tooltipContent=/*#__PURE__*/_jsx(Trans,{id:\"{0, plural, one {# source with sync failures.} other {# sources with sync failures.}}\",values:{0:inventory.inventory_sources_with_failures}});}else{tooltipContent=/*i18n*/i18n._(\"No inventory sync failures.\");}}else{tooltipContent=/*i18n*/i18n._(\"Not configured for inventory sync.\");}return/*#__PURE__*/_jsxs(Tr,{id:inventory.id,\"aria-labelledby\":labelId,ouiaId:\"inventory-row-\".concat(inventory.id),children:[/*#__PURE__*/_jsx(Td,{select:{rowIndex:rowIndex,isSelected:isSelected,onSelect:onSelect},dataLabel:/*i18n*/i18n._(\"Selected\")}),/*#__PURE__*/_jsx(TdBreakWord,{id:labelId,dataLabel:/*i18n*/i18n._(\"Name\"),children:inventory.pending_deletion?/*#__PURE__*/_jsx(\"b\",{children:inventory.name}):/*#__PURE__*/_jsx(Link,{to:\"\".concat(detailUrl),children:/*#__PURE__*/_jsx(\"b\",{children:inventory.name})})}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Status\"),children:inventory.kind!=='smart'&&(inventory.has_inventory_sources?/*#__PURE__*/_jsx(Link,{to:\"/inventories/inventory/\".concat(inventory.id,\"/jobs?job.or__inventoryupdate__inventory_source__inventory__id=\").concat(inventory.id),children:/*#__PURE__*/_jsx(StatusLabel,{status:syncStatus,tooltipContent:tooltipContent})}):/*#__PURE__*/_jsx(StatusLabel,{status:syncStatus,tooltipContent:tooltipContent}))}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Type\"),children:inventory.kind==='smart'?/*i18n*/i18n._(\"Smart Inventory\"):/*i18n*/i18n._(\"Inventory\")}),/*#__PURE__*/_jsx(TdBreakWord,{dataLabel:/*i18n*/i18n._(\"Organization\"),children:/*#__PURE__*/_jsx(Link,{to:\"/organizations/\".concat(inventory===null||inventory===void 0?void 0:(_inventory$summary_fi=inventory.summary_fields)===null||_inventory$summary_fi===void 0?void 0:(_inventory$summary_fi2=_inventory$summary_fi.organization)===null||_inventory$summary_fi2===void 0?void 0:_inventory$summary_fi2.id,\"/details\"),children:inventory===null||inventory===void 0?void 0:(_inventory$summary_fi3=inventory.summary_fields)===null||_inventory$summary_fi3===void 0?void 0:(_inventory$summary_fi4=_inventory$summary_fi3.organization)===null||_inventory$summary_fi4===void 0?void 0:_inventory$summary_fi4.name})},\"organization\"),inventory.pending_deletion?/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Groups\"),children:/*#__PURE__*/_jsx(Label,{color:\"red\",children:/*i18n*/i18n._(\"Pending delete\")})}):/*#__PURE__*/_jsxs(ActionsTd,{dataLabel:/*i18n*/i18n._(\"Actions\"),children:[/*#__PURE__*/_jsx(ActionItem,{visible:inventory.summary_fields.user_capabilities.edit,tooltip:/*i18n*/i18n._(\"Edit Inventory\"),children:/*#__PURE__*/_jsx(Button,{ouiaId:\"\".concat(inventory.id,\"-edit-button\"),isDisabled:isCopying,\"aria-label\":/*i18n*/i18n._(\"Edit Inventory\"),variant:\"plain\",component:Link,to:\"/inventories/\".concat(inventory.kind==='smart'?'smart_inventory':'inventory',\"/\").concat(inventory.id,\"/edit\"),children:/*#__PURE__*/_jsx(PencilAltIcon,{})})}),/*#__PURE__*/_jsx(ActionItem,{visible:inventory.summary_fields.user_capabilities.copy,tooltip:inventory.has_inventory_sources?/*i18n*/i18n._(\"Inventories with sources cannot be copied\"):/*i18n*/i18n._(\"Copy Inventory\"),children:/*#__PURE__*/_jsx(CopyButton,{copyItem:copyInventory,isDisabled:isCopying||inventory.has_inventory_sources,onCopyStart:handleCopyStart,onCopyFinish:handleCopyFinish,errorMessage:/*i18n*/i18n._(\"Failed to copy inventory.\"),ouiaId:\"\".concat(inventory.id,\"-copy-button\")})})]})]});}export default InventoryListItem;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Inventory/InventoryList/InventoryListItem.js"],"names":["React","useState","useCallback","Button","Label","Tr","Td","PencilAltIcon","Link","timeOfDay","InventoriesAPI","Inventory","ActionsTd","ActionItem","TdBreakWord","CopyButton","StatusLabel","InventoryListItem","inventory","rowIndex","isSelected","onSelect","onCopy","detailUrl","fetchInventories","isCopying","setIsCopying","copyInventory","copy","id","name","response","status","data","handleCopyStart","handleCopyFinish","labelId","syncStatus","isSourceSyncRunning","has_inventory_sources","inventory_sources_with_failures","tooltipContent","pending_deletion","kind","summary_fields","organization","user_capabilities","edit"],"mappings":"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","sourcesContent":["import React, { useState, useCallback } from 'react';\nimport { string, bool, func } from 'prop-types';\n\nimport { Button, Label } from '@patternfly/react-core';\nimport { Tr, Td } from '@patternfly/react-table';\nimport { PencilAltIcon } from '@patternfly/react-icons';\nimport { t, Plural } from '@lingui/macro';\nimport { Link } from 'react-router-dom';\nimport { timeOfDay } from 'util/dates';\nimport { InventoriesAPI } from 'api';\nimport { Inventory } from 'types';\nimport { ActionsTd, ActionItem, TdBreakWord } from 'components/PaginatedTable';\nimport CopyButton from 'components/CopyButton';\nimport StatusLabel from 'components/StatusLabel';\n\nfunction InventoryListItem({\n  inventory,\n  rowIndex,\n  isSelected,\n  onSelect,\n  onCopy,\n  detailUrl,\n  fetchInventories,\n}) {\n  InventoryListItem.propTypes = {\n    inventory: Inventory.isRequired,\n    detailUrl: string.isRequired,\n    isSelected: bool.isRequired,\n    onSelect: func.isRequired,\n  };\n  const [isCopying, setIsCopying] = useState(false);\n\n  const copyInventory = useCallback(async () => {\n    const response = await InventoriesAPI.copy(inventory.id, {\n      name: `${inventory.name} @ ${timeOfDay()}`,\n    });\n    if (response.status === 201) {\n      onCopy(response.data.id);\n    }\n    await fetchInventories();\n  }, [inventory.id, inventory.name, fetchInventories, onCopy]);\n\n  const handleCopyStart = useCallback(() => {\n    setIsCopying(true);\n  }, []);\n\n  const handleCopyFinish = useCallback(() => {\n    setIsCopying(false);\n  }, []);\n\n  const labelId = `check-action-${inventory.id}`;\n\n  let syncStatus = 'disabled';\n  if (inventory.isSourceSyncRunning) {\n    syncStatus = 'syncing';\n  } else if (inventory.has_inventory_sources) {\n    syncStatus =\n      inventory.inventory_sources_with_failures > 0 ? 'error' : 'success';\n  }\n\n  let tooltipContent = '';\n  if (inventory.has_inventory_sources) {\n    if (inventory.inventory_sources_with_failures > 0) {\n      tooltipContent = (\n        <Plural\n          value={inventory.inventory_sources_with_failures}\n          one=\"# source with sync failures.\"\n          other=\"# sources with sync failures.\"\n        />\n      );\n    } else {\n      tooltipContent = t`No inventory sync failures.`;\n    }\n  } else {\n    tooltipContent = t`Not configured for inventory sync.`;\n  }\n\n  return (\n    <Tr\n      id={inventory.id}\n      aria-labelledby={labelId}\n      ouiaId={`inventory-row-${inventory.id}`}\n    >\n      <Td\n        select={{\n          rowIndex,\n          isSelected,\n          onSelect,\n        }}\n        dataLabel={t`Selected`}\n      />\n      <TdBreakWord id={labelId} dataLabel={t`Name`}>\n        {inventory.pending_deletion ? (\n          <b>{inventory.name}</b>\n        ) : (\n          <Link to={`${detailUrl}`}>\n            <b>{inventory.name}</b>\n          </Link>\n        )}\n      </TdBreakWord>\n      <Td dataLabel={t`Status`}>\n        {inventory.kind !== 'smart' &&\n          (inventory.has_inventory_sources ? (\n            <Link\n              to={`/inventories/inventory/${inventory.id}/jobs?job.or__inventoryupdate__inventory_source__inventory__id=${inventory.id}`}\n            >\n              <StatusLabel\n                status={syncStatus}\n                tooltipContent={tooltipContent}\n              />\n            </Link>\n          ) : (\n            <StatusLabel status={syncStatus} tooltipContent={tooltipContent} />\n          ))}\n      </Td>\n      <Td dataLabel={t`Type`}>\n        {inventory.kind === 'smart' ? t`Smart Inventory` : t`Inventory`}\n      </Td>\n      <TdBreakWord key=\"organization\" dataLabel={t`Organization`}>\n        <Link\n          to={`/organizations/${inventory?.summary_fields?.organization?.id}/details`}\n        >\n          {inventory?.summary_fields?.organization?.name}\n        </Link>\n      </TdBreakWord>\n      {inventory.pending_deletion ? (\n        <Td dataLabel={t`Groups`}>\n          <Label color=\"red\">{t`Pending delete`}</Label>\n        </Td>\n      ) : (\n        <ActionsTd dataLabel={t`Actions`}>\n          <ActionItem\n            visible={inventory.summary_fields.user_capabilities.edit}\n            tooltip={t`Edit Inventory`}\n          >\n            <Button\n              ouiaId={`${inventory.id}-edit-button`}\n              isDisabled={isCopying}\n              aria-label={t`Edit Inventory`}\n              variant=\"plain\"\n              component={Link}\n              to={`/inventories/${\n                inventory.kind === 'smart' ? 'smart_inventory' : 'inventory'\n              }/${inventory.id}/edit`}\n            >\n              <PencilAltIcon />\n            </Button>\n          </ActionItem>\n          <ActionItem\n            visible={inventory.summary_fields.user_capabilities.copy}\n            tooltip={\n              inventory.has_inventory_sources\n                ? t`Inventories with sources cannot be copied`\n                : t`Copy Inventory`\n            }\n          >\n            <CopyButton\n              copyItem={copyInventory}\n              isDisabled={isCopying || inventory.has_inventory_sources}\n              onCopyStart={handleCopyStart}\n              onCopyFinish={handleCopyFinish}\n              errorMessage={t`Failed to copy inventory.`}\n              ouiaId={`${inventory.id}-copy-button`}\n            />\n          </ActionItem>\n        </ActionsTd>\n      )}\n    </Tr>\n  );\n}\nexport default InventoryListItem;\n"]},"metadata":{},"sourceType":"module"}