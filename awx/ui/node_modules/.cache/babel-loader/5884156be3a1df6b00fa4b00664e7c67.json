{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _styled7 from\"styled-components\";import _styled6 from\"styled-components\";import _styled5 from\"styled-components\";import _styled4 from\"styled-components\";import _styled3 from\"styled-components\";import _styled2 from\"styled-components\";import _styled from\"styled-components\";import{i18n}from\"@lingui/core\";import React,{useState}from'react';import{Split,SplitItem,TextListItemVariants,Button,Modal}from'@patternfly/react-core';import{ExpandArrowsAltIcon}from'@patternfly/react-icons';import{yamlToJson,jsonToYaml,isJsonObject,isJsonString}from'util/yaml';import{DetailName,DetailValue}from'../DetailList';import MultiButtonToggle from'../MultiButtonToggle';import Popover from'../Popover';import CodeEditor from'./CodeEditor';import{JSON_MODE,YAML_MODE}from'./constants';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var _StyledDetailName=_styled(DetailName).withConfig({displayName:\"VariablesDetail___StyledDetailName\",componentId:\"sc-1nj9x4t-0\"})([\"grid-column:1 / -1\"]);var _StyledDetailValue=_styled(DetailValue).withConfig({displayName:\"VariablesDetail___StyledDetailValue\",componentId:\"sc-1nj9x4t-1\"})([\"grid-column:1 / -1;margin-top:-20px\"]);var _StyledCodeEditor=_styled(CodeEditor).withConfig({displayName:\"VariablesDetail___StyledCodeEditor\",componentId:\"sc-1nj9x4t-2\"})([\"margin-top:10px\"]);var _StyledDiv=_styled(\"div\").withConfig({displayName:\"VariablesDetail___StyledDiv\",componentId:\"sc-1nj9x4t-3\"})([\"color:var(--pf-global--danger-color--100);font-size:var(--pf-global--FontSize--sm)\"]);var _StyledCodeEditor2=_styled(CodeEditor).withConfig({displayName:\"VariablesDetail___StyledCodeEditor2\",componentId:\"sc-1nj9x4t-4\"})([\"margin-top:10px\"]);function VariablesDetail(_ref){var dataCy=_ref.dataCy,helpText=_ref.helpText,value=_ref.value,label=_ref.label,rows=_ref.rows,fullHeight=_ref.fullHeight,name=_ref.name;var _useState=useState(isJsonObject(value)||isJsonString(value)?JSON_MODE:YAML_MODE),_useState2=_slicedToArray(_useState,2),mode=_useState2[0],setMode=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isExpanded=_useState4[0],setIsExpanded=_useState4[1];var currentValue=value;var error;var getValueInCurrentMode=function getValueInCurrentMode(){if(!value){if(mode===JSON_MODE){return'{}';}return'---';}var modeMatches=isJsonString(value)===(mode===JSON_MODE);if(modeMatches){if(mode===JSON_MODE){return JSON.stringify(JSON.parse(value),null,2);}return value;}return mode===YAML_MODE?jsonToYaml(value):yamlToJson(value);};try{currentValue=getValueInCurrentMode();}catch(err){error=err;}var labelCy=dataCy?\"\".concat(dataCy,\"-label\"):null;var valueCy=dataCy?\"\".concat(dataCy,\"-value\"):null;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(_StyledDetailName,{\"data-cy\":labelCy,id:dataCy,component:TextListItemVariants.dt,fullWidth:true,children:/*#__PURE__*/_jsx(ModeToggle,{id:\"\".concat(dataCy,\"-preview\"),label:label,helpText:helpText,dataCy:dataCy,mode:mode,setMode:setMode,currentValue:currentValue,onExpand:function onExpand(){return setIsExpanded(true);},name:name})}),/*#__PURE__*/_jsxs(_StyledDetailValue,{\"data-cy\":valueCy,component:TextListItemVariants.dd,fullWidth:true,children:[/*#__PURE__*/_jsx(_StyledCodeEditor,{id:\"\".concat(dataCy,\"-preview\"),mode:mode,value:currentValue,readOnly:true,rows:rows,fullHeight:fullHeight}),error&&/*#__PURE__*/_jsxs(_StyledDiv,{children:[/*i18n*/i18n._(\"Error:\"),\" \",error.message]})]}),/*#__PURE__*/_jsx(Modal,{variant:\"xlarge\",title:label,ouiaId:\"\".concat(dataCy,\"-modal\"),isOpen:isExpanded,onClose:function onClose(){return setIsExpanded(false);},actions:[/*#__PURE__*/_jsx(Button,{\"aria-label\":/*i18n*/i18n._(\"Done\"),variant:\"primary\",onClick:function onClick(){return setIsExpanded(false);},ouiaId:\"\".concat(dataCy,\"-unexpand\"),children:/*i18n*/i18n._(\"Done\")},\"select\")],children:/*#__PURE__*/_jsxs(\"div\",{className:\"pf-c-form\",children:[/*#__PURE__*/_jsx(ModeToggle,{id:\"\".concat(dataCy,\"-preview-expanded\"),label:label,helpText:helpText,dataCy:dataCy,mode:mode,setMode:setMode,currentValue:currentValue,name:name}),/*#__PURE__*/_jsx(_StyledCodeEditor2,{id:\"\".concat(dataCy,\"-preview-expanded\"),mode:mode,value:currentValue,readOnly:true,rows:rows,fullHeight:true})]})})]});}VariablesDetail.defaultProps={rows:null,dataCy:'',helpText:''};var _StyledSplit=_styled(Split).withConfig({displayName:\"VariablesDetail___StyledSplit\",componentId:\"sc-1nj9x4t-5\"})([\"align-items:baseline\"]);var _StyledSpan=_styled(\"span\").withConfig({displayName:\"VariablesDetail___StyledSpan\",componentId:\"sc-1nj9x4t-6\"})([\"font-weight:var(--pf-global--FontWeight--bold)\"]);function ModeToggle(_ref2){var id=_ref2.id,label=_ref2.label,helpText=_ref2.helpText,dataCy=_ref2.dataCy,mode=_ref2.mode,setMode=_ref2.setMode,onExpand=_ref2.onExpand,name=_ref2.name;return/*#__PURE__*/_jsxs(Split,{hasGutter:true,children:[/*#__PURE__*/_jsx(SplitItem,{isFilled:true,children:/*#__PURE__*/_jsxs(_StyledSplit,{hasGutter:true,children:[/*#__PURE__*/_jsx(SplitItem,{children:/*#__PURE__*/_jsxs(\"label\",{className:\"pf-c-form__label\",htmlFor:id,children:[/*#__PURE__*/_jsx(_StyledSpan,{className:\"pf-c-form__label-text\",children:label}),helpText&&/*#__PURE__*/_jsx(Popover,{header:label,content:helpText,id:dataCy})]})}),/*#__PURE__*/_jsx(SplitItem,{children:/*#__PURE__*/_jsx(MultiButtonToggle,{buttons:[[YAML_MODE,'YAML'],[JSON_MODE,'JSON']],value:mode,onChange:function onChange(newMode){setMode(newMode);},name:name})})]})}),onExpand&&/*#__PURE__*/_jsx(SplitItem,{children:/*#__PURE__*/_jsx(Button,{variant:\"plain\",\"aria-label\":/*i18n*/i18n._(\"Expand input\"),onClick:onExpand,ouiaId:\"\".concat(dataCy,\"-expand\"),children:/*#__PURE__*/_jsx(ExpandArrowsAltIcon,{})})})]});}export default VariablesDetail;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/CodeEditor/VariablesDetail.js"],"names":["React","useState","Split","SplitItem","TextListItemVariants","Button","Modal","ExpandArrowsAltIcon","yamlToJson","jsonToYaml","isJsonObject","isJsonString","DetailName","DetailValue","MultiButtonToggle","Popover","CodeEditor","JSON_MODE","YAML_MODE","VariablesDetail","dataCy","helpText","value","label","rows","fullHeight","name","mode","setMode","isExpanded","setIsExpanded","currentValue","error","getValueInCurrentMode","modeMatches","JSON","stringify","parse","err","labelCy","valueCy","dt","dd","message","defaultProps","ModeToggle","id","onExpand","newMode"],"mappings":"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","sourcesContent":["import 'styled-components/macro';\nimport React, { useState } from 'react';\nimport { node, number, oneOfType, shape, string, arrayOf } from 'prop-types';\n\nimport { t } from '@lingui/macro';\nimport {\n  Split,\n  SplitItem,\n  TextListItemVariants,\n  Button,\n  Modal,\n} from '@patternfly/react-core';\nimport { ExpandArrowsAltIcon } from '@patternfly/react-icons';\nimport { yamlToJson, jsonToYaml, isJsonObject, isJsonString } from 'util/yaml';\nimport { DetailName, DetailValue } from '../DetailList';\nimport MultiButtonToggle from '../MultiButtonToggle';\nimport Popover from '../Popover';\nimport CodeEditor from './CodeEditor';\nimport { JSON_MODE, YAML_MODE } from './constants';\n\nfunction VariablesDetail({\n  dataCy,\n  helpText,\n  value,\n  label,\n  rows,\n  fullHeight,\n  name,\n}) {\n  const [mode, setMode] = useState(\n    isJsonObject(value) || isJsonString(value) ? JSON_MODE : YAML_MODE\n  );\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  let currentValue = value;\n  let error;\n\n  const getValueInCurrentMode = () => {\n    if (!value) {\n      if (mode === JSON_MODE) {\n        return '{}';\n      }\n      return '---';\n    }\n    const modeMatches = isJsonString(value) === (mode === JSON_MODE);\n    if (modeMatches) {\n      if (mode === JSON_MODE) {\n        return JSON.stringify(JSON.parse(value), null, 2);\n      }\n      return value;\n    }\n    return mode === YAML_MODE ? jsonToYaml(value) : yamlToJson(value);\n  };\n\n  try {\n    currentValue = getValueInCurrentMode();\n  } catch (err) {\n    error = err;\n  }\n\n  const labelCy = dataCy ? `${dataCy}-label` : null;\n  const valueCy = dataCy ? `${dataCy}-value` : null;\n\n  return (\n    <>\n      <DetailName\n        data-cy={labelCy}\n        id={dataCy}\n        component={TextListItemVariants.dt}\n        fullWidth\n        css=\"grid-column: 1 / -1\"\n      >\n        <ModeToggle\n          id={`${dataCy}-preview`}\n          label={label}\n          helpText={helpText}\n          dataCy={dataCy}\n          mode={mode}\n          setMode={setMode}\n          currentValue={currentValue}\n          onExpand={() => setIsExpanded(true)}\n          name={name}\n        />\n      </DetailName>\n      <DetailValue\n        data-cy={valueCy}\n        component={TextListItemVariants.dd}\n        fullWidth\n        css=\"grid-column: 1 / -1; margin-top: -20px\"\n      >\n        <CodeEditor\n          id={`${dataCy}-preview`}\n          mode={mode}\n          value={currentValue}\n          readOnly\n          rows={rows}\n          fullHeight={fullHeight}\n          css=\"margin-top: 10px\"\n        />\n        {error && (\n          <div\n            css=\"color: var(--pf-global--danger-color--100);\n            font-size: var(--pf-global--FontSize--sm)\"\n          >\n            {t`Error:`} {error.message}\n          </div>\n        )}\n      </DetailValue>\n      <Modal\n        variant=\"xlarge\"\n        title={label}\n        ouiaId={`${dataCy}-modal`}\n        isOpen={isExpanded}\n        onClose={() => setIsExpanded(false)}\n        actions={[\n          <Button\n            aria-label={t`Done`}\n            key=\"select\"\n            variant=\"primary\"\n            onClick={() => setIsExpanded(false)}\n            ouiaId={`${dataCy}-unexpand`}\n          >\n            {t`Done`}\n          </Button>,\n        ]}\n      >\n        <div className=\"pf-c-form\">\n          <ModeToggle\n            id={`${dataCy}-preview-expanded`}\n            label={label}\n            helpText={helpText}\n            dataCy={dataCy}\n            mode={mode}\n            setMode={setMode}\n            currentValue={currentValue}\n            name={name}\n          />\n          <CodeEditor\n            id={`${dataCy}-preview-expanded`}\n            mode={mode}\n            value={currentValue}\n            readOnly\n            rows={rows}\n            fullHeight\n            css=\"margin-top: 10px\"\n          />\n        </div>\n      </Modal>\n    </>\n  );\n}\nVariablesDetail.propTypes = {\n  value: oneOfType([shape({}), arrayOf(string), string]).isRequired,\n  label: node.isRequired,\n  rows: oneOfType([number, string]),\n  dataCy: string,\n  helpText: oneOfType([node, string]),\n  name: string.isRequired,\n};\nVariablesDetail.defaultProps = {\n  rows: null,\n  dataCy: '',\n  helpText: '',\n};\n\nfunction ModeToggle({\n  id,\n  label,\n  helpText,\n  dataCy,\n  mode,\n  setMode,\n  onExpand,\n  name,\n}) {\n  return (\n    <Split hasGutter>\n      <SplitItem isFilled>\n        <Split hasGutter css=\"align-items: baseline\">\n          <SplitItem>\n            <label className=\"pf-c-form__label\" htmlFor={id}>\n              <span\n                className=\"pf-c-form__label-text\"\n                css=\"font-weight: var(--pf-global--FontWeight--bold)\"\n              >\n                {label}\n              </span>\n              {helpText && (\n                <Popover header={label} content={helpText} id={dataCy} />\n              )}\n            </label>\n          </SplitItem>\n          <SplitItem>\n            <MultiButtonToggle\n              buttons={[\n                [YAML_MODE, 'YAML'],\n                [JSON_MODE, 'JSON'],\n              ]}\n              value={mode}\n              onChange={(newMode) => {\n                setMode(newMode);\n              }}\n              name={name}\n            />\n          </SplitItem>\n        </Split>\n      </SplitItem>\n      {onExpand && (\n        <SplitItem>\n          <Button\n            variant=\"plain\"\n            aria-label={t`Expand input`}\n            onClick={onExpand}\n            ouiaId={`${dataCy}-expand`}\n          >\n            <ExpandArrowsAltIcon />\n          </Button>\n        </SplitItem>\n      )}\n    </Split>\n  );\n}\n\nexport default VariablesDetail;\n"]},"metadata":{},"sourceType":"module"}