{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import Ansi from'ansi-to-html';import hasAnsi from'has-ansi';import{encode}from'html-entities';var EVENT_START_TASK='playbook_on_task_start';var EVENT_START_PLAY='playbook_on_play_start';var EVENT_STATS_PLAY='playbook_on_stats';var TIME_EVENTS=[EVENT_START_TASK,EVENT_START_PLAY,EVENT_STATS_PLAY];var ansi=new Ansi({stream:true,colors:{0:'#000',1:'#A30000',2:'#486B00',3:'#795600',4:'#00A',5:'#A0A',6:'#004368',7:'#AAA',8:'#555',9:'#F55',10:'#5F5',11:'#FF5',12:'#55F',13:'#F5F',14:'#5FF',15:'#FFF'}});function getTimestamp(_ref){var created=_ref.created;var date=new Date(created);var dateHours=date.getHours();var dateMinutes=date.getMinutes();var dateSeconds=date.getSeconds();var stampHours=dateHours<10?\"0\".concat(dateHours):dateHours;var stampMinutes=dateMinutes<10?\"0\".concat(dateMinutes):dateMinutes;var stampSeconds=dateSeconds<10?\"0\".concat(dateSeconds):dateSeconds;return\"\".concat(stampHours,\":\").concat(stampMinutes,\":\").concat(stampSeconds);}function createStyleAttrHash(styleAttr){var hash=0;for(var i=0;i<styleAttr.length;i++){hash=(hash<<5)-hash;// eslint-disable-line no-bitwise\nhash+=styleAttr.charCodeAt(i);hash&=hash;// eslint-disable-line no-bitwise\n}return\"\".concat(hash);}var styleAttrPattern=new RegExp('style=\"[^\"]*\"','g');function replaceStyleAttrs(html){var allStyleAttrs=_toConsumableArray(new Set(html.match(styleAttrPattern)));var cssMap={};var result=html;for(var i=0;i<allStyleAttrs.length;i++){var styleAttr=allStyleAttrs[i];var cssClassName=\"output-\".concat(createStyleAttrHash(styleAttr));cssMap[cssClassName]=styleAttr.replace('style=\"','').slice(0,-1);result=result.split(styleAttr).join(\"class=\\\"\".concat(cssClassName,\"\\\"\"));}return{cssMap:cssMap,result:result};}export default function getLineTextHtml(_ref2){var created=_ref2.created,event=_ref2.event,startLine=_ref2.start_line,stdout=_ref2.stdout;var sanitized=encode(stdout);var lineCssMap={};var lineTextHtml=[];sanitized.split('\\r\\n').forEach(function(lineText,index){var html;if(hasAnsi(lineText)){var _replaceStyleAttrs=replaceStyleAttrs(ansi.toHtml(lineText)),cssMap=_replaceStyleAttrs.cssMap,result=_replaceStyleAttrs.result;html=result;lineCssMap=_objectSpread(_objectSpread({},lineCssMap),cssMap);}else{html=lineText;}if(index===1&&TIME_EVENTS.includes(event)){var time=getTimestamp({created:created});html+=\"<span class=\\\"time\\\">\".concat(time,\"</span>\");}lineTextHtml.push({lineNumber:startLine+index,html:html});});return{lineCssMap:lineCssMap,lineTextHtml:lineTextHtml};}","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Job/JobOutput/getLineTextHtml.js"],"names":["Ansi","hasAnsi","encode","EVENT_START_TASK","EVENT_START_PLAY","EVENT_STATS_PLAY","TIME_EVENTS","ansi","stream","colors","getTimestamp","created","date","Date","dateHours","getHours","dateMinutes","getMinutes","dateSeconds","getSeconds","stampHours","stampMinutes","stampSeconds","createStyleAttrHash","styleAttr","hash","i","length","charCodeAt","styleAttrPattern","RegExp","replaceStyleAttrs","html","allStyleAttrs","Set","match","cssMap","result","cssClassName","replace","slice","split","join","getLineTextHtml","event","startLine","start_line","stdout","sanitized","lineCssMap","lineTextHtml","forEach","lineText","index","toHtml","includes","time","push","lineNumber"],"mappings":"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","sourcesContent":["import Ansi from 'ansi-to-html';\nimport hasAnsi from 'has-ansi';\nimport { encode } from 'html-entities';\n\nconst EVENT_START_TASK = 'playbook_on_task_start';\nconst EVENT_START_PLAY = 'playbook_on_play_start';\nconst EVENT_STATS_PLAY = 'playbook_on_stats';\nconst TIME_EVENTS = [EVENT_START_TASK, EVENT_START_PLAY, EVENT_STATS_PLAY];\n\nconst ansi = new Ansi({\n  stream: true,\n  colors: {\n    0: '#000',\n    1: '#A30000',\n    2: '#486B00',\n    3: '#795600',\n    4: '#00A',\n    5: '#A0A',\n    6: '#004368',\n    7: '#AAA',\n    8: '#555',\n    9: '#F55',\n    10: '#5F5',\n    11: '#FF5',\n    12: '#55F',\n    13: '#F5F',\n    14: '#5FF',\n    15: '#FFF',\n  },\n});\n\nfunction getTimestamp({ created }) {\n  const date = new Date(created);\n\n  const dateHours = date.getHours();\n  const dateMinutes = date.getMinutes();\n  const dateSeconds = date.getSeconds();\n\n  const stampHours = dateHours < 10 ? `0${dateHours}` : dateHours;\n  const stampMinutes = dateMinutes < 10 ? `0${dateMinutes}` : dateMinutes;\n  const stampSeconds = dateSeconds < 10 ? `0${dateSeconds}` : dateSeconds;\n\n  return `${stampHours}:${stampMinutes}:${stampSeconds}`;\n}\n\nfunction createStyleAttrHash(styleAttr) {\n  let hash = 0;\n  for (let i = 0; i < styleAttr.length; i++) {\n    hash = (hash << 5) - hash; // eslint-disable-line no-bitwise\n    hash += styleAttr.charCodeAt(i);\n    hash &= hash; // eslint-disable-line no-bitwise\n  }\n  return `${hash}`;\n}\n\nconst styleAttrPattern = new RegExp('style=\"[^\"]*\"', 'g');\n\nfunction replaceStyleAttrs(html) {\n  const allStyleAttrs = [...new Set(html.match(styleAttrPattern))];\n  const cssMap = {};\n  let result = html;\n  for (let i = 0; i < allStyleAttrs.length; i++) {\n    const styleAttr = allStyleAttrs[i];\n    const cssClassName = `output-${createStyleAttrHash(styleAttr)}`;\n\n    cssMap[cssClassName] = styleAttr.replace('style=\"', '').slice(0, -1);\n    result = result.split(styleAttr).join(`class=\"${cssClassName}\"`);\n  }\n  return { cssMap, result };\n}\n\nexport default function getLineTextHtml({\n  created,\n  event,\n  start_line: startLine,\n  stdout,\n}) {\n  const sanitized = encode(stdout);\n  let lineCssMap = {};\n  const lineTextHtml = [];\n\n  sanitized.split('\\r\\n').forEach((lineText, index) => {\n    let html;\n    if (hasAnsi(lineText)) {\n      const { cssMap, result } = replaceStyleAttrs(ansi.toHtml(lineText));\n      html = result;\n      lineCssMap = { ...lineCssMap, ...cssMap };\n    } else {\n      html = lineText;\n    }\n\n    if (index === 1 && TIME_EVENTS.includes(event)) {\n      const time = getTimestamp({ created });\n      html += `<span class=\"time\">${time}</span>`;\n    }\n\n    lineTextHtml.push({\n      lineNumber: startLine + index,\n      html,\n    });\n  });\n\n  return {\n    lineCssMap,\n    lineTextHtml,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}