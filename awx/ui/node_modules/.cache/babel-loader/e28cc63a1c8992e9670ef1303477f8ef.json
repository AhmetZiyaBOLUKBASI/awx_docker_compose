{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState,useEffect,useCallback}from'react';import{useParams,useLocation}from'react-router-dom';import{getQSConfig,parseQueryString,mergeParams}from'util/qs';import useRequest,{useDismissableError,useDeleteItems}from'hooks/useRequest';import useSelected from'hooks/useSelected';import{HostsAPI,InventoriesAPI}from'api';import AlertModal from'components/AlertModal';import ErrorDetail from'components/ErrorDetail';import PaginatedTable,{HeaderCell,HeaderRow,ToolbarAddButton,getSearchableKeys}from'components/PaginatedTable';import AssociateModal from'components/AssociateModal';import DisassociateButton from'components/DisassociateButton';import DataListToolbar from'components/DataListToolbar';import HostGroupItem from'./HostGroupItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('group',{page:1,page_size:20,order_by:'name'});function HostGroupsList(_ref){var host=_ref.host;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isModalOpen=_useState2[0],setIsModalOpen=_useState2[1];var _useParams=useParams(),hostId=_useParams.id;var _useLocation=useLocation(),search=_useLocation.search;var invId=host.summary_fields.inventory.id;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,count,results,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,search);_context.next=3;return Promise.all([HostsAPI.readAllGroups(hostId,params),HostsAPI.readGroupsOptions(hostId)]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);_yield$Promise$all2$=_yield$Promise$all2[0].data;count=_yield$Promise$all2$.count;results=_yield$Promise$all2$.results;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{groups:results,itemCount:count,actions:actionsResponse.data.actions,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 10:case\"end\":return _context.stop();}}},_callee);})),[hostId,search]),{groups:[],itemCount:0,actions:{},relatedSearchableKeys:[],searchableKeys:[]}),_useRequest$result=_useRequest.result,groups=_useRequest$result.groups,itemCount=_useRequest$result.itemCount,actions=_useRequest$result.actions,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,contentError=_useRequest.error,isLoading=_useRequest.isLoading,fetchGroups=_useRequest.request;useEffect(function(){fetchGroups();},[fetchGroups]);var _useSelected=useSelected(groups),selected=_useSelected.selected,isAllSelected=_useSelected.isAllSelected,handleSelect=_useSelected.handleSelect,clearSelected=_useSelected.clearSelected,selectAll=_useSelected.selectAll;var _useDeleteItems=useDeleteItems(useCallback(function(){return Promise.all(selected.map(function(group){return HostsAPI.disassociateGroup(hostId,group);}));},[hostId,selected]),{qsConfig:QS_CONFIG,allItemsSelected:isAllSelected,fetchItems:fetchGroups}),isDisassociateLoading=_useDeleteItems.isLoading,disassociateHosts=_useDeleteItems.deleteItems,disassociateError=_useDeleteItems.deletionError;var handleDisassociate=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return disassociateHosts();case 2:clearSelected();case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleDisassociate(){return _ref3.apply(this,arguments);};}();var fetchGroupsToAssociate=useCallback(function(params){return InventoriesAPI.readGroups(invId,mergeParams(params,{not__hosts:hostId}));},[invId,hostId]);var fetchGroupsOptions=useCallback(function(){return InventoriesAPI.readGroupsOptions(invId);},[invId]);var _useRequest2=useRequest(useCallback(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(groupsToAssociate){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return Promise.all(groupsToAssociate.map(function(group){return HostsAPI.associateGroup(hostId,group.id);}));case 2:fetchGroups();case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x){return _ref4.apply(this,arguments);};}(),[hostId,fetchGroups])),handleAssociate=_useRequest2.request,associateError=_useRequest2.error;var _useDismissableError=useDismissableError(associateError||disassociateError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;var canAdd=actions&&Object.prototype.hasOwnProperty.call(actions,'POST');return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PaginatedTable,{contentError:contentError,hasContentLoading:isLoading||isDisassociateLoading,items:groups,itemCount:itemCount,qsConfig:QS_CONFIG,clearSelected:clearSelected,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username__icontains'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username__icontains'}],toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Actions\")})]}),renderRow:function renderRow(item,index){return/*#__PURE__*/_jsx(HostGroupItem,{group:item,hostId:hostId,inventoryId:item.summary_fields.inventory.id,isSelected:selected.some(function(row){return row.id===item.id;}),onSelect:function onSelect(){return handleSelect(item);},rowIndex:index},item.id);},renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{isAllSelected:isAllSelected,onSelectAll:selectAll,qsConfig:QS_CONFIG,additionalControls:[].concat(_toConsumableArray(canAdd?[/*#__PURE__*/_jsx(ToolbarAddButton,{ouiaId:\"host-groups-add-button\",onClick:function onClick(){return setIsModalOpen(true);}},\"add\")]:[]),[/*#__PURE__*/_jsx(DisassociateButton,{onDisassociate:handleDisassociate,itemsToDisassociate:selected,modalTitle:/*i18n*/i18n._(\"Disassociate group from host?\"),modalNote:/*i18n*/i18n._(\"Note that you may still see the group in the list after\\ndisassociating if the host is also a member of that group\\u2019s\\nchildren.  This list shows all groups the host is associated\\nwith directly and indirectly.\")},\"disassociate\")])}));},emptyStateControls:canAdd?/*#__PURE__*/_jsx(ToolbarAddButton,{onClick:function onClick(){return setIsModalOpen(true);}},\"add\"):null}),isModalOpen&&/*#__PURE__*/_jsx(AssociateModal,{ouiaId:\"associate-modal\",header:/*i18n*/i18n._(\"Groups\"),fetchRequest:fetchGroupsToAssociate,optionsRequest:fetchGroupsOptions,isModalOpen:isModalOpen,onAssociate:handleAssociate,onClose:function onClose(){return setIsModalOpen(false);},title:/*i18n*/i18n._(\"Select Groups\")}),error&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:error,onClose:dismissError,title:/*i18n*/i18n._(\"Error!\"),variant:\"error\",children:[associateError?/*i18n*/i18n._(\"Failed to associate.\"):/*i18n*/i18n._(\"Failed to disassociate one or more groups.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]})]});}export default HostGroupsList;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Host/HostGroups/HostGroupsList.js"],"names":["React","useState","useEffect","useCallback","useParams","useLocation","getQSConfig","parseQueryString","mergeParams","useRequest","useDismissableError","useDeleteItems","useSelected","HostsAPI","InventoriesAPI","AlertModal","ErrorDetail","PaginatedTable","HeaderCell","HeaderRow","ToolbarAddButton","getSearchableKeys","AssociateModal","DisassociateButton","DataListToolbar","HostGroupItem","QS_CONFIG","page","page_size","order_by","HostGroupsList","host","isModalOpen","setIsModalOpen","hostId","id","search","invId","summary_fields","inventory","params","Promise","all","readAllGroups","readGroupsOptions","data","count","results","actionsResponse","groups","itemCount","actions","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","GET","result","contentError","error","isLoading","fetchGroups","request","selected","isAllSelected","handleSelect","clearSelected","selectAll","group","disassociateGroup","qsConfig","allItemsSelected","fetchItems","isDisassociateLoading","disassociateHosts","deleteItems","disassociateError","deletionError","handleDisassociate","fetchGroupsToAssociate","readGroups","not__hosts","fetchGroupsOptions","groupsToAssociate","associateGroup","handleAssociate","associateError","dismissError","canAdd","Object","prototype","hasOwnProperty","call","name","key","isDefault","item","index","some","row","props"],"mappings":"4iBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAqCC,WAArC,KAAwD,OAAxD,CACA,OAASC,SAAT,CAAoBC,WAApB,KAAuC,kBAAvC,CAGA,OAASC,WAAT,CAAsBC,gBAAtB,CAAwCC,WAAxC,KAA2D,SAA3D,CACA,MAAOC,CAAAA,UAAP,EACEC,mBADF,CAEEC,cAFF,KAGO,kBAHP,CAIA,MAAOC,CAAAA,WAAP,KAAwB,mBAAxB,CACA,OAASC,QAAT,CAAmBC,cAAnB,KAAyC,KAAzC,CACA,MAAOC,CAAAA,UAAP,KAAuB,uBAAvB,CACA,MAAOC,CAAAA,WAAP,KAAwB,wBAAxB,CACA,MAAOC,CAAAA,cAAP,EACEC,UADF,CAEEC,SAFF,CAGEC,gBAHF,CAIEC,iBAJF,KAKO,2BALP,CAMA,MAAOC,CAAAA,cAAP,KAA2B,2BAA3B,CACA,MAAOC,CAAAA,kBAAP,KAA+B,+BAA/B,CACA,MAAOC,CAAAA,eAAP,KAA4B,4BAA5B,CACA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,C,6IAEA,GAAMC,CAAAA,SAAS,CAAGpB,WAAW,CAAC,OAAD,CAAU,CACrCqB,IAAI,CAAE,CAD+B,CAErCC,SAAS,CAAE,EAF0B,CAGrCC,QAAQ,CAAE,MAH2B,CAAV,CAA7B,CAMA,QAASC,CAAAA,cAAT,MAAkC,IAARC,CAAAA,IAAQ,MAARA,IAAQ,CAChC,cAAsC9B,QAAQ,CAAC,KAAD,CAA9C,wCAAO+B,WAAP,eAAoBC,cAApB,eAEA,eAAuB7B,SAAS,EAAhC,CAAY8B,MAAZ,YAAQC,EAAR,CACA,iBAAmB9B,WAAW,EAA9B,CAAQ+B,MAAR,cAAQA,MAAR,CACA,GAAMC,CAAAA,KAAK,CAAGN,IAAI,CAACO,cAAL,CAAoBC,SAApB,CAA8BJ,EAA5C,CAEA,gBAWI1B,UAAU,CACZN,WAAW,sEAAC,yRACJqC,MADI,CACKjC,gBAAgB,CAACmB,SAAD,CAAYU,MAAZ,CADrB,uBAQAK,CAAAA,OAAO,CAACC,GAAR,CAAY,CACpB7B,QAAQ,CAAC8B,aAAT,CAAuBT,MAAvB,CAA+BM,MAA/B,CADoB,CAEpB3B,QAAQ,CAAC+B,iBAAT,CAA2BV,MAA3B,CAFoB,CAAZ,CARA,8IAKNW,IALM,CAKEC,KALF,sBAKEA,KALF,CAKSC,OALT,sBAKSA,OALT,CAORC,eAPQ,wDAaH,CACLC,MAAM,CAAEF,OADH,CAELG,SAAS,CAAEJ,KAFN,CAGLK,OAAO,CAAEH,eAAe,CAACH,IAAhB,CAAqBM,OAHzB,CAILC,qBAAqB,CAAE,CACrB,CAAAJ,eAAe,OAAf,EAAAA,eAAe,SAAf,+BAAAA,eAAe,CAAEH,IAAjB,sEAAuBQ,qBAAvB,GAAgD,EAD3B,EAErBC,GAFqB,CAEjB,SAACC,GAAD,QAASA,CAAAA,GAAG,CAACC,KAAJ,CAAU,CAAV,CAAa,CAAC,CAAd,CAAT,EAFiB,CAJlB,CAOLC,cAAc,CAAEpC,iBAAiB,yBAAC2B,eAAe,CAACH,IAAhB,CAAqBM,OAAtB,iDAAC,uBAA8BO,GAA/B,CAP5B,CAbG,yDAAD,GAsBR,CAACxB,MAAD,CAASE,MAAT,CAtBQ,CADC,CAwBZ,CACEa,MAAM,CAAE,EADV,CAEEC,SAAS,CAAE,CAFb,CAGEC,OAAO,CAAE,EAHX,CAIEC,qBAAqB,CAAE,EAJzB,CAKEK,cAAc,CAAE,EALlB,CAxBY,CAXd,gCACEE,MADF,CAEIV,MAFJ,oBAEIA,MAFJ,CAGIC,SAHJ,oBAGIA,SAHJ,CAIIC,OAJJ,oBAIIA,OAJJ,CAKIC,qBALJ,oBAKIA,qBALJ,CAMIK,cANJ,oBAMIA,cANJ,CAQSG,YART,aAQEC,KARF,CASEC,SATF,aASEA,SATF,CAUWC,WAVX,aAUEC,OAVF,CA4CA9D,SAAS,CAAC,UAAM,CACd6D,WAAW,GACZ,CAFQ,CAEN,CAACA,WAAD,CAFM,CAAT,CAIA,iBACEnD,WAAW,CAACqC,MAAD,CADb,CAAQgB,QAAR,cAAQA,QAAR,CAAkBC,aAAlB,cAAkBA,aAAlB,CAAiCC,YAAjC,cAAiCA,YAAjC,CAA+CC,aAA/C,cAA+CA,aAA/C,CAA8DC,SAA9D,cAA8DA,SAA9D,CAGA,oBAII1D,cAAc,CAChBR,WAAW,CACT,iBACEsC,CAAAA,OAAO,CAACC,GAAR,CACEuB,QAAQ,CAACX,GAAT,CAAa,SAACgB,KAAD,QAAWzD,CAAAA,QAAQ,CAAC0D,iBAAT,CAA2BrC,MAA3B,CAAmCoC,KAAnC,CAAX,EAAb,CADF,CADF,EADS,CAKT,CAACpC,MAAD,CAAS+B,QAAT,CALS,CADK,CAQhB,CACEO,QAAQ,CAAE9C,SADZ,CAEE+C,gBAAgB,CAAEP,aAFpB,CAGEQ,UAAU,CAAEX,WAHd,CARgB,CAJlB,CACaY,qBADb,iBACEb,SADF,CAEec,iBAFf,iBAEEC,WAFF,CAGiBC,iBAHjB,iBAGEC,aAHF,CAmBA,GAAMC,CAAAA,kBAAkB,2FAAG,+JACnBJ,CAAAA,iBAAiB,EADE,QAEzBR,aAAa,GAFY,wDAAH,kBAAlBY,CAAAA,kBAAkB,2CAAxB,CAKA,GAAMC,CAAAA,sBAAsB,CAAG9E,WAAW,CACxC,SAACqC,MAAD,QACE1B,CAAAA,cAAc,CAACoE,UAAf,CACE7C,KADF,CAEE7B,WAAW,CAACgC,MAAD,CAAS,CAAE2C,UAAU,CAAEjD,MAAd,CAAT,CAFb,CADF,EADwC,CAMxC,CAACG,KAAD,CAAQH,MAAR,CANwC,CAA1C,CASA,GAAMkD,CAAAA,kBAAkB,CAAGjF,WAAW,CACpC,iBAAMW,CAAAA,cAAc,CAAC8B,iBAAf,CAAiCP,KAAjC,CAAN,EADoC,CAEpC,CAACA,KAAD,CAFoC,CAAtC,CAKA,iBAA4D5B,UAAU,CACpEN,WAAW,2FACT,kBAAOkF,iBAAP,6IACQ5C,CAAAA,OAAO,CAACC,GAAR,CACJ2C,iBAAiB,CAAC/B,GAAlB,CAAsB,SAACgB,KAAD,QACpBzD,CAAAA,QAAQ,CAACyE,cAAT,CAAwBpD,MAAxB,CAAgCoC,KAAK,CAACnC,EAAtC,CADoB,EAAtB,CADI,CADR,QAME4B,WAAW,GANb,wDADS,gEAST,CAAC7B,MAAD,CAAS6B,WAAT,CATS,CADyD,CAAtE,CAAiBwB,eAAjB,cAAQvB,OAAR,CAAyCwB,cAAzC,cAAkC3B,KAAlC,CAcA,yBAAgCnD,mBAAmB,CACjD8E,cAAc,EAAIV,iBAD+B,CAAnD,CAAQjB,KAAR,sBAAQA,KAAR,CAAe4B,YAAf,sBAAeA,YAAf,CAIA,GAAMC,CAAAA,MAAM,CACVvC,OAAO,EAAIwC,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqC3C,OAArC,CAA8C,MAA9C,CADb,CAGA,mBACE,wCACE,KAAC,cAAD,EACE,YAAY,CAAES,YADhB,CAEE,iBAAiB,CAAEE,SAAS,EAAIa,qBAFlC,CAGE,KAAK,CAAE1B,MAHT,CAIE,SAAS,CAAEC,SAJb,CAKE,QAAQ,CAAExB,SALZ,CAME,aAAa,CAAE0C,aANjB,CAOE,oBAAoB,CAAE,CACpB,CACE2B,IAAI,SAAE,cADR,CAEEC,GAAG,CAAE,iBAFP,CAGEC,SAAS,CAAE,IAHb,CADoB,CAMpB,CACEF,IAAI,SAAE,+BADR,CAEEC,GAAG,CAAE,iCAFP,CANoB,CAUpB,CACED,IAAI,SAAE,gCADR,CAEEC,GAAG,CAAE,kCAFP,CAVoB,CAPxB,CAsBE,qBAAqB,CAAEvC,cAtBzB,CAuBE,4BAA4B,CAAEL,qBAvBhC,CAwBE,SAAS,cACP,MAAC,SAAD,EAAW,QAAQ,CAAE1B,SAArB,wBACE,KAAC,UAAD,EAAY,OAAO,CAAC,MAApB,kBAA4B,cAA5B,EADF,cAEE,KAAC,UAAD,mBAAa,iBAAb,EAFF,GAzBJ,CA8BE,SAAS,CAAE,mBAACwE,IAAD,CAAOC,KAAP,qBACT,KAAC,aAAD,EAEE,KAAK,CAAED,IAFT,CAGE,MAAM,CAAEhE,MAHV,CAIE,WAAW,CAAEgE,IAAI,CAAC5D,cAAL,CAAoBC,SAApB,CAA8BJ,EAJ7C,CAKE,UAAU,CAAE8B,QAAQ,CAACmC,IAAT,CAAc,SAACC,GAAD,QAASA,CAAAA,GAAG,CAAClE,EAAJ,GAAW+D,IAAI,CAAC/D,EAAzB,EAAd,CALd,CAME,QAAQ,CAAE,0BAAMgC,CAAAA,YAAY,CAAC+B,IAAD,CAAlB,EANZ,CAOE,QAAQ,CAAEC,KAPZ,EACOD,IAAI,CAAC/D,EADZ,CADS,EA9Bb,CAyCE,aAAa,CAAE,uBAACmE,KAAD,qBACb,KAAC,eAAD,gCACMA,KADN,MAEE,aAAa,CAAEpC,aAFjB,CAGE,WAAW,CAAEG,SAHf,CAIE,QAAQ,CAAE3C,SAJZ,CAKE,kBAAkB,8BACZgE,MAAM,CACN,cACE,KAAC,gBAAD,EACE,MAAM,CAAC,wBADT,CAGE,OAAO,CAAE,yBAAMzD,CAAAA,cAAc,CAAC,IAAD,CAApB,EAHX,EAEM,KAFN,CADF,CADM,CAQN,EATY,gBAUhB,KAAC,kBAAD,EAEE,cAAc,CAAE+C,kBAFlB,CAGE,mBAAmB,CAAEf,QAHvB,CAIE,UAAU,SAAE,uCAJd,CAKE,SAAS,SAAE,gOALb,EACM,cADN,CAVgB,EALpB,GADa,EAzCjB,CAwEE,kBAAkB,CAChByB,MAAM,cACJ,KAAC,gBAAD,EAA4B,OAAO,CAAE,yBAAMzD,CAAAA,cAAc,CAAC,IAAD,CAApB,EAArC,EAAsB,KAAtB,CADI,CAEF,IA3ER,EADF,CA+EGD,WAAW,eACV,KAAC,cAAD,EACE,MAAM,CAAC,iBADT,CAEE,MAAM,SAAE,gBAFV,CAGE,YAAY,CAAEiD,sBAHhB,CAIE,cAAc,CAAEG,kBAJlB,CAKE,WAAW,CAAEpD,WALf,CAME,WAAW,CAAEuD,eANf,CAOE,OAAO,CAAE,yBAAMtD,CAAAA,cAAc,CAAC,KAAD,CAApB,EAPX,CAQE,KAAK,SAAE,uBART,EAhFJ,CA2FG4B,KAAK,eACJ,MAAC,UAAD,EACE,MAAM,CAAEA,KADV,CAEE,OAAO,CAAE4B,YAFX,CAGE,KAAK,SAAE,gBAHT,CAIE,OAAO,CAAC,OAJV,WAMGD,cAAc,SACX,8BADW,SAEX,oDARN,cASE,KAAC,WAAD,EAAa,KAAK,CAAE3B,KAApB,EATF,GA5FJ,GADF,CA2GD,CACD,cAAe/B,CAAAA,cAAf","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useParams, useLocation } from 'react-router-dom';\n\nimport { t } from '@lingui/macro';\nimport { getQSConfig, parseQueryString, mergeParams } from 'util/qs';\nimport useRequest, {\n  useDismissableError,\n  useDeleteItems,\n} from 'hooks/useRequest';\nimport useSelected from 'hooks/useSelected';\nimport { HostsAPI, InventoriesAPI } from 'api';\nimport AlertModal from 'components/AlertModal';\nimport ErrorDetail from 'components/ErrorDetail';\nimport PaginatedTable, {\n  HeaderCell,\n  HeaderRow,\n  ToolbarAddButton,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\nimport AssociateModal from 'components/AssociateModal';\nimport DisassociateButton from 'components/DisassociateButton';\nimport DataListToolbar from 'components/DataListToolbar';\nimport HostGroupItem from './HostGroupItem';\n\nconst QS_CONFIG = getQSConfig('group', {\n  page: 1,\n  page_size: 20,\n  order_by: 'name',\n});\n\nfunction HostGroupsList({ host }) {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  const { id: hostId } = useParams();\n  const { search } = useLocation();\n  const invId = host.summary_fields.inventory.id;\n\n  const {\n    result: {\n      groups,\n      itemCount,\n      actions,\n      relatedSearchableKeys,\n      searchableKeys,\n    },\n    error: contentError,\n    isLoading,\n    request: fetchGroups,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, search);\n\n      const [\n        {\n          data: { count, results },\n        },\n        actionsResponse,\n      ] = await Promise.all([\n        HostsAPI.readAllGroups(hostId, params),\n        HostsAPI.readGroupsOptions(hostId),\n      ]);\n\n      return {\n        groups: results,\n        itemCount: count,\n        actions: actionsResponse.data.actions,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [hostId, search]),\n    {\n      groups: [],\n      itemCount: 0,\n      actions: {},\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchGroups();\n  }, [fetchGroups]);\n\n  const { selected, isAllSelected, handleSelect, clearSelected, selectAll } =\n    useSelected(groups);\n\n  const {\n    isLoading: isDisassociateLoading,\n    deleteItems: disassociateHosts,\n    deletionError: disassociateError,\n  } = useDeleteItems(\n    useCallback(\n      () =>\n        Promise.all(\n          selected.map((group) => HostsAPI.disassociateGroup(hostId, group))\n        ),\n      [hostId, selected]\n    ),\n    {\n      qsConfig: QS_CONFIG,\n      allItemsSelected: isAllSelected,\n      fetchItems: fetchGroups,\n    }\n  );\n\n  const handleDisassociate = async () => {\n    await disassociateHosts();\n    clearSelected();\n  };\n\n  const fetchGroupsToAssociate = useCallback(\n    (params) =>\n      InventoriesAPI.readGroups(\n        invId,\n        mergeParams(params, { not__hosts: hostId })\n      ),\n    [invId, hostId]\n  );\n\n  const fetchGroupsOptions = useCallback(\n    () => InventoriesAPI.readGroupsOptions(invId),\n    [invId]\n  );\n\n  const { request: handleAssociate, error: associateError } = useRequest(\n    useCallback(\n      async (groupsToAssociate) => {\n        await Promise.all(\n          groupsToAssociate.map((group) =>\n            HostsAPI.associateGroup(hostId, group.id)\n          )\n        );\n        fetchGroups();\n      },\n      [hostId, fetchGroups]\n    )\n  );\n\n  const { error, dismissError } = useDismissableError(\n    associateError || disassociateError\n  );\n\n  const canAdd =\n    actions && Object.prototype.hasOwnProperty.call(actions, 'POST');\n\n  return (\n    <>\n      <PaginatedTable\n        contentError={contentError}\n        hasContentLoading={isLoading || isDisassociateLoading}\n        items={groups}\n        itemCount={itemCount}\n        qsConfig={QS_CONFIG}\n        clearSelected={clearSelected}\n        toolbarSearchColumns={[\n          {\n            name: t`Name`,\n            key: 'name__icontains',\n            isDefault: true,\n          },\n          {\n            name: t`Created By (Username)`,\n            key: 'created_by__username__icontains',\n          },\n          {\n            name: t`Modified By (Username)`,\n            key: 'modified_by__username__icontains',\n          },\n        ]}\n        toolbarSearchableKeys={searchableKeys}\n        toolbarRelatedSearchableKeys={relatedSearchableKeys}\n        headerRow={\n          <HeaderRow qsConfig={QS_CONFIG}>\n            <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n            <HeaderCell>{t`Actions`}</HeaderCell>\n          </HeaderRow>\n        }\n        renderRow={(item, index) => (\n          <HostGroupItem\n            key={item.id}\n            group={item}\n            hostId={hostId}\n            inventoryId={item.summary_fields.inventory.id}\n            isSelected={selected.some((row) => row.id === item.id)}\n            onSelect={() => handleSelect(item)}\n            rowIndex={index}\n          />\n        )}\n        renderToolbar={(props) => (\n          <DataListToolbar\n            {...props}\n            isAllSelected={isAllSelected}\n            onSelectAll={selectAll}\n            qsConfig={QS_CONFIG}\n            additionalControls={[\n              ...(canAdd\n                ? [\n                    <ToolbarAddButton\n                      ouiaId=\"host-groups-add-button\"\n                      key=\"add\"\n                      onClick={() => setIsModalOpen(true)}\n                    />,\n                  ]\n                : []),\n              <DisassociateButton\n                key=\"disassociate\"\n                onDisassociate={handleDisassociate}\n                itemsToDisassociate={selected}\n                modalTitle={t`Disassociate group from host?`}\n                modalNote={t`\n                  Note that you may still see the group in the list after\n                  disassociating if the host is also a member of that group’s\n                  children.  This list shows all groups the host is associated\n                  with directly and indirectly.\n                `}\n              />,\n            ]}\n          />\n        )}\n        emptyStateControls={\n          canAdd ? (\n            <ToolbarAddButton key=\"add\" onClick={() => setIsModalOpen(true)} />\n          ) : null\n        }\n      />\n      {isModalOpen && (\n        <AssociateModal\n          ouiaId=\"associate-modal\"\n          header={t`Groups`}\n          fetchRequest={fetchGroupsToAssociate}\n          optionsRequest={fetchGroupsOptions}\n          isModalOpen={isModalOpen}\n          onAssociate={handleAssociate}\n          onClose={() => setIsModalOpen(false)}\n          title={t`Select Groups`}\n        />\n      )}\n      {error && (\n        <AlertModal\n          isOpen={error}\n          onClose={dismissError}\n          title={t`Error!`}\n          variant=\"error\"\n        >\n          {associateError\n            ? t`Failed to associate.`\n            : t`Failed to disassociate one or more groups.`}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\nexport default HostGroupsList;\n"]},"metadata":{},"sourceType":"module"}