{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState,useCallback}from'react';import{Button,ClipboardCopy,Tooltip}from'@patternfly/react-core';import{Tr,Td,ExpandableRowContent}from'@patternfly/react-table';import{Link}from'react-router-dom';import{PencilAltIcon,ExclamationTriangleIcon as PFExclamationTriangleIcon,UndoIcon}from'@patternfly/react-icons';import styled from'styled-components';import{ActionsTd,ActionItem,TdBreakWord}from'components/PaginatedTable';import{formatDateString,timeOfDay}from'util/dates';import{ProjectsAPI}from'api';import{DetailList,Detail,DeletedDetail}from'components/DetailList';import ExecutionEnvironmentDetail from'components/ExecutionEnvironmentDetail';import StatusLabel from'components/StatusLabel';import{toTitleCase}from'util/strings';import{isJobRunning}from'util/jobs';import CopyButton from'components/CopyButton';import{Project}from'types';import JobCancelButton from'components/JobCancelButton';import ProjectSyncButton from'../shared/ProjectSyncButton';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Label=styled.span.withConfig({displayName:\"ProjectListItem__Label\",componentId:\"oa3u52-0\"})([\"color:var(--pf-global--disabled-color--100);\"]);var ExclamationTriangleIcon=styled(PFExclamationTriangleIcon).withConfig({displayName:\"ProjectListItem__ExclamationTriangleIcon\",componentId:\"oa3u52-1\"})([\"color:var(--pf-global--warning-color--100);margin-left:18px;\"]);function ProjectListItem(_ref){var _project$summary_fiel2,_project$summary_fiel3,_job,_job2,_project$summary_fiel4;var isExpanded=_ref.isExpanded,onExpand=_ref.onExpand,project=_ref.project,isSelected=_ref.isSelected,onSelect=_ref.onSelect,onCopy=_ref.onCopy,detailUrl=_ref.detailUrl,fetchProjects=_ref.fetchProjects,rowIndex=_ref.rowIndex,onRefreshRow=_ref.onRefreshRow;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isDisabled=_useState2[0],setIsDisabled=_useState2[1];var copyProject=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return ProjectsAPI.copy(project.id,{name:\"\".concat(project.name,\" @ \").concat(timeOfDay())});case 2:response=_context.sent;if(response.status===201){onCopy(response.data.id);}_context.next=6;return fetchProjects();case 6:case\"end\":return _context.stop();}}},_callee);})),[project.id,project.name,fetchProjects,onCopy]);var generateLastJobTooltip=function generateLastJobTooltip(job){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{children:/*i18n*/i18n._(\"MOST RECENT SYNC\")}),/*#__PURE__*/_jsxs(\"div\",{children:[/*i18n*/i18n._(\"JOB ID:\"),\" \",job.id]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*i18n*/i18n._(\"STATUS:\"),\" \",job.status.toUpperCase()]}),job.finished&&/*#__PURE__*/_jsxs(\"div\",{children:[/*i18n*/i18n._(\"FINISHED:\"),\" \",formatDateString(job.finished)]})]});};var handleCopyStart=useCallback(function(){setIsDisabled(true);},[]);var handleCopyFinish=useCallback(function(){setIsDisabled(false);},[]);var renderRevision=function renderRevision(){var _project$summary_fiel;if(!((_project$summary_fiel=project.summary_fields)!==null&&_project$summary_fiel!==void 0&&_project$summary_fiel.current_job)||project.scm_revision){return project.scm_revision?/*#__PURE__*/_jsx(ClipboardCopy,{\"data-cy\":\"project-copy-revision-\".concat(project.id),variant:\"inline-compact\",clickTip:/*i18n*/i18n._(\"Successfully copied to clipboard!\"),hoverTip:/*i18n*/i18n._(\"Copy full revision to clipboard.\"),onCopy:function onCopy(){return navigator.clipboard.writeText(project.scm_revision.toString());},children:project.scm_revision.substring(0,7)}):/*#__PURE__*/_jsx(Label,{\"aria-label\":/*i18n*/i18n._(\"The project must be synced before a revision is available.\"),children:/*i18n*/i18n._(\"Sync for revision\")});}if(isJobRunning(project.summary_fields.current_job.status)&&!project.scm_revision){return/*#__PURE__*/_jsx(Label,{\"aria-label\":/*i18n*/i18n._(\"The project is currently syncing and the revision will be available after the sync is complete.\"),children:/*i18n*/i18n._(\"Syncing\")});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Label,{\"aria-label\":/*i18n*/i18n._(\"The project revision is currently out of date.  Please refresh to fetch the most recent revision.\"),children:/*i18n*/i18n._(\"Refresh for revision\")}),/*#__PURE__*/_jsx(Tooltip,{content:/*i18n*/i18n._(\"Refresh project revision\"),children:/*#__PURE__*/_jsx(Button,{ouiaId:\"project-refresh-revision-\".concat(project.id),variant:\"plain\",onClick:function onClick(){return onRefreshRow(project.id);},children:/*#__PURE__*/_jsx(UndoIcon,{})})})]});};var labelId=\"check-action-\".concat(project.id);var missingExecutionEnvironment=project.custom_virtualenv&&!project.default_environment;var job=null;if((_project$summary_fiel2=project.summary_fields)!==null&&_project$summary_fiel2!==void 0&&_project$summary_fiel2.current_job){job=project.summary_fields.current_job;}else if((_project$summary_fiel3=project.summary_fields)!==null&&_project$summary_fiel3!==void 0&&_project$summary_fiel3.last_job){job=project.summary_fields.last_job;}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Tr,{id:\"\".concat(project.id),ouiaId:\"project-row-\".concat(project.id),children:[/*#__PURE__*/_jsx(Td,{expand:{rowIndex:rowIndex,isExpanded:isExpanded,onToggle:onExpand}}),/*#__PURE__*/_jsx(Td,{select:{rowIndex:rowIndex,isSelected:isSelected,onSelect:onSelect,disable:isJobRunning((_job=job)===null||_job===void 0?void 0:_job.status)},dataLabel:/*i18n*/i18n._(\"Selected\")}),/*#__PURE__*/_jsxs(TdBreakWord,{id:labelId,dataLabel:/*i18n*/i18n._(\"Name\"),children:[/*#__PURE__*/_jsx(\"span\",{children:/*#__PURE__*/_jsx(Link,{to:\"\".concat(detailUrl),children:/*#__PURE__*/_jsx(\"b\",{children:project.name})})}),missingExecutionEnvironment&&/*#__PURE__*/_jsx(\"span\",{children:/*#__PURE__*/_jsx(Tooltip,{content:/*i18n*/i18n._(\"Custom virtual environment {0} must be replaced by an execution environment.\",{0:project.custom_virtualenv}),position:\"right\",className:\"missing-execution-environment\",children:/*#__PURE__*/_jsx(ExclamationTriangleIcon,{})})})]}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Status\"),children:job?/*#__PURE__*/_jsx(Tooltip,{position:\"top\",content:generateLastJobTooltip(job),children:/*#__PURE__*/_jsx(Link,{to:\"/jobs/project/\".concat(job.id),children:/*#__PURE__*/_jsx(StatusLabel,{status:job.status})})},job.id):/*#__PURE__*/_jsx(Tooltip,{position:\"top\",content:/*i18n*/i18n._(\"Unable to load last job update\"),children:/*#__PURE__*/_jsx(StatusLabel,{status:project===null||project===void 0?void 0:project.status})},project.id)}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Type\"),children:project.scm_type===''?/*i18n*/i18n._(\"Manual\"):toTitleCase(project.scm_type)}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Revision\"),children:renderRevision()}),/*#__PURE__*/_jsxs(ActionsTd,{dataLabel:/*i18n*/i18n._(\"Actions\"),children:[['running','pending','waiting'].includes((_job2=job)===null||_job2===void 0?void 0:_job2.status)?/*#__PURE__*/_jsx(ActionItem,{visible:project.summary_fields.user_capabilities.start,children:/*#__PURE__*/_jsx(JobCancelButton,{job:{id:job.id,type:'project_update'},errorTitle:/*i18n*/i18n._(\"Project Sync Error\"),title:/*i18n*/i18n._(\"Cancel Project Sync\"),showIconButton:true,errorMessage:/*i18n*/i18n._(\"Failed to cancel Project Sync\")})}):/*#__PURE__*/_jsx(ActionItem,{visible:project.summary_fields.user_capabilities.start,tooltip:/*i18n*/i18n._(\"Sync Project\"),children:/*#__PURE__*/_jsx(ProjectSyncButton,{projectId:project.id,lastJobStatus:job&&job.status})}),/*#__PURE__*/_jsx(ActionItem,{visible:project.summary_fields.user_capabilities.edit,tooltip:/*i18n*/i18n._(\"Edit Project\"),children:/*#__PURE__*/_jsx(Button,{ouiaId:\"\".concat(project.id,\"-edit-button\"),isDisabled:isDisabled,\"aria-label\":/*i18n*/i18n._(\"Edit Project\"),variant:\"plain\",component:Link,to:\"/projects/\".concat(project.id,\"/edit\"),children:/*#__PURE__*/_jsx(PencilAltIcon,{})})}),/*#__PURE__*/_jsx(ActionItem,{tooltip:/*i18n*/i18n._(\"Copy Project\"),visible:project.summary_fields.user_capabilities.copy,children:/*#__PURE__*/_jsx(CopyButton,{copyItem:copyProject,isDisabled:isDisabled,onCopyStart:handleCopyStart,onCopyFinish:handleCopyFinish,errorMessage:/*i18n*/i18n._(\"Failed to copy project.\")})})]})]}),/*#__PURE__*/_jsxs(Tr,{isExpanded:isExpanded,id:\"expanded-project-row-\".concat(project.id),children:[/*#__PURE__*/_jsx(Td,{colSpan:2}),/*#__PURE__*/_jsx(Td,{colSpan:5,children:/*#__PURE__*/_jsx(ExpandableRowContent,{children:/*#__PURE__*/_jsxs(DetailList,{children:[/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Description\"),value:project.description,dataCy:\"project-\".concat(project.id,\"-description\")}),project.summary_fields.organization?/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Organization\"),value:/*#__PURE__*/_jsx(Link,{to:\"/organizations/\".concat(project.summary_fields.organization.id,\"/details\"),children:project.summary_fields.organization.name}),dataCy:\"project-\".concat(project.id,\"-organization\")}):/*#__PURE__*/_jsx(DeletedDetail,{label:/*i18n*/i18n._(\"Organization\")}),/*#__PURE__*/_jsx(ExecutionEnvironmentDetail,{virtualEnvironment:project.custom_virtualenv,executionEnvironment:(_project$summary_fiel4=project.summary_fields)===null||_project$summary_fiel4===void 0?void 0:_project$summary_fiel4.default_environment,isDefaultEnvironment:true}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Last modified\"),value:formatDateString(project.modified),dataCy:\"project-\".concat(project.id,\"-last-modified\")}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Last used\"),value:formatDateString(project.last_job_run),dataCy:\"project-\".concat(project.id,\"-last-used\")})]})})})]})]});}export default ProjectListItem;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Project/ProjectList/ProjectListItem.js"],"names":["React","useState","useCallback","Button","ClipboardCopy","Tooltip","Tr","Td","ExpandableRowContent","Link","PencilAltIcon","ExclamationTriangleIcon","PFExclamationTriangleIcon","UndoIcon","styled","ActionsTd","ActionItem","TdBreakWord","formatDateString","timeOfDay","ProjectsAPI","DetailList","Detail","DeletedDetail","ExecutionEnvironmentDetail","StatusLabel","toTitleCase","isJobRunning","CopyButton","Project","JobCancelButton","ProjectSyncButton","Label","span","ProjectListItem","isExpanded","onExpand","project","isSelected","onSelect","onCopy","detailUrl","fetchProjects","rowIndex","onRefreshRow","isDisabled","setIsDisabled","copyProject","copy","id","name","response","status","data","generateLastJobTooltip","job","toUpperCase","finished","handleCopyStart","handleCopyFinish","renderRevision","summary_fields","current_job","scm_revision","navigator","clipboard","writeText","toString","substring","labelId","missingExecutionEnvironment","custom_virtualenv","default_environment","last_job","onToggle","disable","scm_type","includes","user_capabilities","start","type","edit","description","organization","modified","last_job_run"],"mappings":"uVACA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,WAA1B,KAA6C,OAA7C,CAEA,OAASC,MAAT,CAAiBC,aAAjB,CAAgCC,OAAhC,KAA+C,wBAA/C,CACA,OAASC,EAAT,CAAaC,EAAb,CAAiBC,oBAAjB,KAA6C,yBAA7C,CAEA,OAASC,IAAT,KAAqB,kBAArB,CACA,OACEC,aADF,CAEEC,uBAAuB,GAAIC,CAAAA,yBAF7B,CAGEC,QAHF,KAIO,yBAJP,CAKA,MAAOC,CAAAA,MAAP,KAAmB,mBAAnB,CACA,OAASC,SAAT,CAAoBC,UAApB,CAAgCC,WAAhC,KAAmD,2BAAnD,CACA,OAASC,gBAAT,CAA2BC,SAA3B,KAA4C,YAA5C,CACA,OAASC,WAAT,KAA4B,KAA5B,CACA,OAASC,UAAT,CAAqBC,MAArB,CAA6BC,aAA7B,KAAkD,uBAAlD,CACA,MAAOC,CAAAA,0BAAP,KAAuC,uCAAvC,CACA,MAAOC,CAAAA,WAAP,KAAwB,wBAAxB,CACA,OAASC,WAAT,KAA4B,cAA5B,CACA,OAASC,YAAT,KAA6B,WAA7B,CACA,MAAOC,CAAAA,UAAP,KAAuB,uBAAvB,CACA,OAASC,OAAT,KAAwB,OAAxB,CACA,MAAOC,CAAAA,eAAP,KAA4B,4BAA5B,CACA,MAAOC,CAAAA,iBAAP,KAA8B,6BAA9B,C,6IAEA,GAAMC,CAAAA,KAAK,CAAGlB,MAAM,CAACmB,IAAV,4HAAX,CAIA,GAAMtB,CAAAA,uBAAuB,CAAGG,MAAM,CAACF,yBAAD,CAAT,8JAA7B,CAKA,QAASsB,CAAAA,eAAT,MAWG,wFAVDC,CAAAA,UAUC,MAVDA,UAUC,CATDC,QASC,MATDA,QASC,CARDC,OAQC,MARDA,OAQC,CAPDC,UAOC,MAPDA,UAOC,CANDC,QAMC,MANDA,QAMC,CALDC,MAKC,MALDA,MAKC,CAJDC,SAIC,MAJDA,SAIC,CAHDC,aAGC,MAHDA,aAGC,CAFDC,QAEC,MAFDA,QAEC,CADDC,YACC,MADDA,YACC,CACD,cAAoC3C,QAAQ,CAAC,KAAD,CAA5C,wCAAO4C,UAAP,eAAmBC,aAAnB,eAQA,GAAMC,CAAAA,WAAW,CAAG7C,WAAW,sEAAC,sKACPkB,CAAAA,WAAW,CAAC4B,IAAZ,CAAiBX,OAAO,CAACY,EAAzB,CAA6B,CAClDC,IAAI,WAAKb,OAAO,CAACa,IAAb,eAAuB/B,SAAS,EAAhC,CAD8C,CAA7B,CADO,QACxBgC,QADwB,eAI9B,GAAIA,QAAQ,CAACC,MAAT,GAAoB,GAAxB,CAA6B,CAC3BZ,MAAM,CAACW,QAAQ,CAACE,IAAT,CAAcJ,EAAf,CAAN,CACD,CAN6B,sBAOxBP,CAAAA,aAAa,EAPW,uDAAD,GAQ5B,CAACL,OAAO,CAACY,EAAT,CAAaZ,OAAO,CAACa,IAArB,CAA2BR,aAA3B,CAA0CF,MAA1C,CAR4B,CAA/B,CAUA,GAAMc,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,CAACC,GAAD,qBAC7B,wCACE,6BAAM,0BAAN,EADF,cAEE,+BACG,iBADH,KACgBA,GAAG,CAACN,EADpB,GAFF,cAKE,+BACG,iBADH,KACgBM,GAAG,CAACH,MAAJ,CAAWI,WAAX,EADhB,GALF,CAQGD,GAAG,CAACE,QAAJ,eACC,+BACG,mBADH,KACkBvC,gBAAgB,CAACqC,GAAG,CAACE,QAAL,CADlC,GATJ,GAD6B,EAA/B,CAiBA,GAAMC,CAAAA,eAAe,CAAGxD,WAAW,CAAC,UAAM,CACxC4C,aAAa,CAAC,IAAD,CAAb,CACD,CAFkC,CAEhC,EAFgC,CAAnC,CAIA,GAAMa,CAAAA,gBAAgB,CAAGzD,WAAW,CAAC,UAAM,CACzC4C,aAAa,CAAC,KAAD,CAAb,CACD,CAFmC,CAEjC,EAFiC,CAApC,CAIA,GAAMc,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,2BAC3B,GAAI,yBAACvB,OAAO,CAACwB,cAAT,0CAAC,sBAAwBC,WAAzB,GAAwCzB,OAAO,CAAC0B,YAApD,CAAkE,CAChE,MAAO1B,CAAAA,OAAO,CAAC0B,YAAR,cACL,KAAC,aAAD,EACE,0CAAkC1B,OAAO,CAACY,EAA1C,CADF,CAEE,OAAO,CAAC,gBAFV,CAGE,QAAQ,SAAE,2CAHZ,CAIE,QAAQ,SAAE,0CAJZ,CAKE,MAAM,CAAE,wBACNe,CAAAA,SAAS,CAACC,SAAV,CAAoBC,SAApB,CAA8B7B,OAAO,CAAC0B,YAAR,CAAqBI,QAArB,EAA9B,CADM,EALV,UASG9B,OAAO,CAAC0B,YAAR,CAAqBK,SAArB,CAA+B,CAA/B,CAAkC,CAAlC,CATH,EADK,cAaL,KAAC,KAAD,EACE,qBAAY,oEADd,kBAGG,2BAHH,EAbF,CAmBD,CAED,GACEzC,YAAY,CAACU,OAAO,CAACwB,cAAR,CAAuBC,WAAvB,CAAmCV,MAApC,CAAZ,EACA,CAACf,OAAO,CAAC0B,YAFX,CAGE,CACA,mBACE,KAAC,KAAD,EACE,qBAAY,yGADd,kBAGG,iBAHH,EADF,CAOD,CAED,mBACE,wCACE,KAAC,KAAD,EACE,qBAAY,2GADd,kBAGG,8BAHH,EADF,cAME,KAAC,OAAD,EAAS,OAAO,SAAE,kCAAlB,uBACE,KAAC,MAAD,EACE,MAAM,oCAA8B1B,OAAO,CAACY,EAAtC,CADR,CAEE,OAAO,CAAC,OAFV,CAGE,OAAO,CAAE,yBAAML,CAAAA,YAAY,CAACP,OAAO,CAACY,EAAT,CAAlB,EAHX,uBAKE,KAAC,QAAD,IALF,EADF,EANF,GADF,CAkBD,CAtDD,CAwDA,GAAMoB,CAAAA,OAAO,wBAAmBhC,OAAO,CAACY,EAA3B,CAAb,CAEA,GAAMqB,CAAAA,2BAA2B,CAC/BjC,OAAO,CAACkC,iBAAR,EAA6B,CAAClC,OAAO,CAACmC,mBADxC,CAGA,GAAIjB,CAAAA,GAAG,CAAG,IAAV,CAEA,2BAAIlB,OAAO,CAACwB,cAAZ,2CAAI,uBAAwBC,WAA5B,CAAyC,CACvCP,GAAG,CAAGlB,OAAO,CAACwB,cAAR,CAAuBC,WAA7B,CACD,CAFD,IAEO,4BAAIzB,OAAO,CAACwB,cAAZ,2CAAI,uBAAwBY,QAA5B,CAAsC,CAC3ClB,GAAG,CAAGlB,OAAO,CAACwB,cAAR,CAAuBY,QAA7B,CACD,CAED,mBACE,wCACE,MAAC,EAAD,EAAI,EAAE,WAAKpC,OAAO,CAACY,EAAb,CAAN,CAAyB,MAAM,uBAAiBZ,OAAO,CAACY,EAAzB,CAA/B,wBACE,KAAC,EAAD,EACE,MAAM,CAAE,CACNN,QAAQ,CAARA,QADM,CAENR,UAAU,CAAVA,UAFM,CAGNuC,QAAQ,CAAEtC,QAHJ,CADV,EADF,cAQE,KAAC,EAAD,EACE,MAAM,CAAE,CACNO,QAAQ,CAARA,QADM,CAENL,UAAU,CAAVA,UAFM,CAGNC,QAAQ,CAARA,QAHM,CAINoC,OAAO,CAAEhD,YAAY,OAAC4B,GAAD,+BAAC,KAAKH,MAAN,CAJf,CADV,CAOE,SAAS,SAAE,kBAPb,EARF,cAiBE,MAAC,WAAD,EAAa,EAAE,CAAEiB,OAAjB,CAA0B,SAAS,SAAE,cAArC,wBACE,mCACE,KAAC,IAAD,EAAM,EAAE,WAAK5B,SAAL,CAAR,uBACE,mBAAIJ,OAAO,CAACa,IAAZ,EADF,EADF,EADF,CAMGoB,2BAA2B,eAC1B,mCACE,KAAC,OAAD,EACE,OAAO,SAAE,yFAA+BjC,OAAO,CAACkC,iBAAvC,EADX,CAEE,QAAQ,CAAC,OAFX,CAGE,SAAS,CAAC,+BAHZ,uBAKE,KAAC,uBAAD,IALF,EADF,EAPJ,GAjBF,cAmCE,KAAC,EAAD,EAAI,SAAS,SAAE,gBAAf,UACGhB,GAAG,cACF,KAAC,OAAD,EACE,QAAQ,CAAC,KADX,CAEE,OAAO,CAAED,sBAAsB,CAACC,GAAD,CAFjC,uBAKE,KAAC,IAAD,EAAM,EAAE,yBAAmBA,GAAG,CAACN,EAAvB,CAAR,uBACE,KAAC,WAAD,EAAa,MAAM,CAAEM,GAAG,CAACH,MAAzB,EADF,EALF,EAGOG,GAAG,CAACN,EAHX,CADE,cAWF,KAAC,OAAD,EACE,QAAQ,CAAC,KADX,CAEE,OAAO,SAAE,wCAFX,uBAKE,KAAC,WAAD,EAAa,MAAM,CAAEZ,OAAF,SAAEA,OAAF,iBAAEA,OAAO,CAAEe,MAA9B,EALF,EAGOf,OAAO,CAACY,EAHf,CAZJ,EAnCF,cAwDE,KAAC,EAAD,EAAI,SAAS,SAAE,cAAf,UACGZ,OAAO,CAACuC,QAAR,GAAqB,EAArB,SAA0B,gBAA1B,CAAsClD,WAAW,CAACW,OAAO,CAACuC,QAAT,CADpD,EAxDF,cA2DE,KAAC,EAAD,EAAI,SAAS,SAAE,kBAAf,UAA6BhB,cAAc,EAA3C,EA3DF,cA4DE,MAAC,SAAD,EAAW,SAAS,SAAE,iBAAtB,WACG,CAAC,SAAD,CAAY,SAAZ,CAAuB,SAAvB,EAAkCiB,QAAlC,QAA2CtB,GAA3C,gCAA2C,MAAKH,MAAhD,eACC,KAAC,UAAD,EACE,OAAO,CAAEf,OAAO,CAACwB,cAAR,CAAuBiB,iBAAvB,CAAyCC,KADpD,uBAGE,KAAC,eAAD,EACE,GAAG,CAAE,CAAE9B,EAAE,CAAEM,GAAG,CAACN,EAAV,CAAc+B,IAAI,CAAE,gBAApB,CADP,CAEE,UAAU,SAAE,4BAFd,CAGE,KAAK,SAAE,6BAHT,CAIE,cAAc,KAJhB,CAKE,YAAY,SAAE,uCALhB,EAHF,EADD,cAaC,KAAC,UAAD,EACE,OAAO,CAAE3C,OAAO,CAACwB,cAAR,CAAuBiB,iBAAvB,CAAyCC,KADpD,CAEE,OAAO,SAAE,sBAFX,uBAIE,KAAC,iBAAD,EACE,SAAS,CAAE1C,OAAO,CAACY,EADrB,CAEE,aAAa,CAAEM,GAAG,EAAIA,GAAG,CAACH,MAF5B,EAJF,EAdJ,cAwBE,KAAC,UAAD,EACE,OAAO,CAAEf,OAAO,CAACwB,cAAR,CAAuBiB,iBAAvB,CAAyCG,IADpD,CAEE,OAAO,SAAE,sBAFX,uBAIE,KAAC,MAAD,EACE,MAAM,WAAK5C,OAAO,CAACY,EAAb,gBADR,CAEE,UAAU,CAAEJ,UAFd,CAGE,qBAAY,sBAHd,CAIE,OAAO,CAAC,OAJV,CAKE,SAAS,CAAEpC,IALb,CAME,EAAE,qBAAe4B,OAAO,CAACY,EAAvB,SANJ,uBAQE,KAAC,aAAD,IARF,EAJF,EAxBF,cAuCE,KAAC,UAAD,EACE,OAAO,SAAE,sBADX,CAEE,OAAO,CAAEZ,OAAO,CAACwB,cAAR,CAAuBiB,iBAAvB,CAAyC9B,IAFpD,uBAIE,KAAC,UAAD,EACE,QAAQ,CAAED,WADZ,CAEE,UAAU,CAAEF,UAFd,CAGE,WAAW,CAAEa,eAHf,CAIE,YAAY,CAAEC,gBAJhB,CAKE,YAAY,SAAE,iCALhB,EAJF,EAvCF,GA5DF,GADF,cAkHE,MAAC,EAAD,EAAI,UAAU,CAAExB,UAAhB,CAA4B,EAAE,gCAA0BE,OAAO,CAACY,EAAlC,CAA9B,wBACE,KAAC,EAAD,EAAI,OAAO,CAAE,CAAb,EADF,cAEE,KAAC,EAAD,EAAI,OAAO,CAAE,CAAb,uBACE,KAAC,oBAAD,wBACE,MAAC,UAAD,yBACE,KAAC,MAAD,EACE,KAAK,SAAE,qBADT,CAEE,KAAK,CAAEZ,OAAO,CAAC6C,WAFjB,CAGE,MAAM,mBAAa7C,OAAO,CAACY,EAArB,gBAHR,EADF,CAMGZ,OAAO,CAACwB,cAAR,CAAuBsB,YAAvB,cACC,KAAC,MAAD,EACE,KAAK,SAAE,sBADT,CAEE,KAAK,cACH,KAAC,IAAD,EACE,EAAE,0BAAoB9C,OAAO,CAACwB,cAAR,CAAuBsB,YAAvB,CAAoClC,EAAxD,YADJ,UAGGZ,OAAO,CAACwB,cAAR,CAAuBsB,YAAvB,CAAoCjC,IAHvC,EAHJ,CASE,MAAM,mBAAab,OAAO,CAACY,EAArB,iBATR,EADD,cAaC,KAAC,aAAD,EAAe,KAAK,SAAE,sBAAtB,EAnBJ,cAqBE,KAAC,0BAAD,EACE,kBAAkB,CAAEZ,OAAO,CAACkC,iBAD9B,CAEE,oBAAoB,yBAClBlC,OAAO,CAACwB,cADU,iDAClB,uBAAwBW,mBAH5B,CAKE,oBAAoB,KALtB,EArBF,cA4BE,KAAC,MAAD,EACE,KAAK,SAAE,uBADT,CAEE,KAAK,CAAEtD,gBAAgB,CAACmB,OAAO,CAAC+C,QAAT,CAFzB,CAGE,MAAM,mBAAa/C,OAAO,CAACY,EAArB,kBAHR,EA5BF,cAiCE,KAAC,MAAD,EACE,KAAK,SAAE,mBADT,CAEE,KAAK,CAAE/B,gBAAgB,CAACmB,OAAO,CAACgD,YAAT,CAFzB,CAGE,MAAM,mBAAahD,OAAO,CAACY,EAArB,cAHR,EAjCF,GADF,EADF,EAFF,GAlHF,GADF,CAmKD,CACD,cAAef,CAAAA,eAAf","sourcesContent":["import 'styled-components/macro';\nimport React, { useState, useCallback } from 'react';\nimport { string, bool, func } from 'prop-types';\nimport { Button, ClipboardCopy, Tooltip } from '@patternfly/react-core';\nimport { Tr, Td, ExpandableRowContent } from '@patternfly/react-table';\nimport { t } from '@lingui/macro';\nimport { Link } from 'react-router-dom';\nimport {\n  PencilAltIcon,\n  ExclamationTriangleIcon as PFExclamationTriangleIcon,\n  UndoIcon,\n} from '@patternfly/react-icons';\nimport styled from 'styled-components';\nimport { ActionsTd, ActionItem, TdBreakWord } from 'components/PaginatedTable';\nimport { formatDateString, timeOfDay } from 'util/dates';\nimport { ProjectsAPI } from 'api';\nimport { DetailList, Detail, DeletedDetail } from 'components/DetailList';\nimport ExecutionEnvironmentDetail from 'components/ExecutionEnvironmentDetail';\nimport StatusLabel from 'components/StatusLabel';\nimport { toTitleCase } from 'util/strings';\nimport { isJobRunning } from 'util/jobs';\nimport CopyButton from 'components/CopyButton';\nimport { Project } from 'types';\nimport JobCancelButton from 'components/JobCancelButton';\nimport ProjectSyncButton from '../shared/ProjectSyncButton';\n\nconst Label = styled.span`\n  color: var(--pf-global--disabled-color--100);\n`;\n\nconst ExclamationTriangleIcon = styled(PFExclamationTriangleIcon)`\n  color: var(--pf-global--warning-color--100);\n  margin-left: 18px;\n`;\n\nfunction ProjectListItem({\n  isExpanded,\n  onExpand,\n  project,\n  isSelected,\n  onSelect,\n  onCopy,\n  detailUrl,\n  fetchProjects,\n  rowIndex,\n  onRefreshRow,\n}) {\n  const [isDisabled, setIsDisabled] = useState(false);\n  ProjectListItem.propTypes = {\n    project: Project.isRequired,\n    detailUrl: string.isRequired,\n    isSelected: bool.isRequired,\n    onSelect: func.isRequired,\n  };\n\n  const copyProject = useCallback(async () => {\n    const response = await ProjectsAPI.copy(project.id, {\n      name: `${project.name} @ ${timeOfDay()}`,\n    });\n    if (response.status === 201) {\n      onCopy(response.data.id);\n    }\n    await fetchProjects();\n  }, [project.id, project.name, fetchProjects, onCopy]);\n\n  const generateLastJobTooltip = (job) => (\n    <>\n      <div>{t`MOST RECENT SYNC`}</div>\n      <div>\n        {t`JOB ID:`} {job.id}\n      </div>\n      <div>\n        {t`STATUS:`} {job.status.toUpperCase()}\n      </div>\n      {job.finished && (\n        <div>\n          {t`FINISHED:`} {formatDateString(job.finished)}\n        </div>\n      )}\n    </>\n  );\n\n  const handleCopyStart = useCallback(() => {\n    setIsDisabled(true);\n  }, []);\n\n  const handleCopyFinish = useCallback(() => {\n    setIsDisabled(false);\n  }, []);\n\n  const renderRevision = () => {\n    if (!project.summary_fields?.current_job || project.scm_revision) {\n      return project.scm_revision ? (\n        <ClipboardCopy\n          data-cy={`project-copy-revision-${project.id}`}\n          variant=\"inline-compact\"\n          clickTip={t`Successfully copied to clipboard!`}\n          hoverTip={t`Copy full revision to clipboard.`}\n          onCopy={() =>\n            navigator.clipboard.writeText(project.scm_revision.toString())\n          }\n        >\n          {project.scm_revision.substring(0, 7)}\n        </ClipboardCopy>\n      ) : (\n        <Label\n          aria-label={t`The project must be synced before a revision is available.`}\n        >\n          {t`Sync for revision`}\n        </Label>\n      );\n    }\n\n    if (\n      isJobRunning(project.summary_fields.current_job.status) &&\n      !project.scm_revision\n    ) {\n      return (\n        <Label\n          aria-label={t`The project is currently syncing and the revision will be available after the sync is complete.`}\n        >\n          {t`Syncing`}\n        </Label>\n      );\n    }\n\n    return (\n      <>\n        <Label\n          aria-label={t`The project revision is currently out of date.  Please refresh to fetch the most recent revision.`}\n        >\n          {t`Refresh for revision`}\n        </Label>\n        <Tooltip content={t`Refresh project revision`}>\n          <Button\n            ouiaId={`project-refresh-revision-${project.id}`}\n            variant=\"plain\"\n            onClick={() => onRefreshRow(project.id)}\n          >\n            <UndoIcon />\n          </Button>\n        </Tooltip>\n      </>\n    );\n  };\n\n  const labelId = `check-action-${project.id}`;\n\n  const missingExecutionEnvironment =\n    project.custom_virtualenv && !project.default_environment;\n\n  let job = null;\n\n  if (project.summary_fields?.current_job) {\n    job = project.summary_fields.current_job;\n  } else if (project.summary_fields?.last_job) {\n    job = project.summary_fields.last_job;\n  }\n\n  return (\n    <>\n      <Tr id={`${project.id}`} ouiaId={`project-row-${project.id}`}>\n        <Td\n          expand={{\n            rowIndex,\n            isExpanded,\n            onToggle: onExpand,\n          }}\n        />\n        <Td\n          select={{\n            rowIndex,\n            isSelected,\n            onSelect,\n            disable: isJobRunning(job?.status),\n          }}\n          dataLabel={t`Selected`}\n        />\n        <TdBreakWord id={labelId} dataLabel={t`Name`}>\n          <span>\n            <Link to={`${detailUrl}`}>\n              <b>{project.name}</b>\n            </Link>\n          </span>\n          {missingExecutionEnvironment && (\n            <span>\n              <Tooltip\n                content={t`Custom virtual environment ${project.custom_virtualenv} must be replaced by an execution environment.`}\n                position=\"right\"\n                className=\"missing-execution-environment\"\n              >\n                <ExclamationTriangleIcon />\n              </Tooltip>\n            </span>\n          )}\n        </TdBreakWord>\n        <Td dataLabel={t`Status`}>\n          {job ? (\n            <Tooltip\n              position=\"top\"\n              content={generateLastJobTooltip(job)}\n              key={job.id}\n            >\n              <Link to={`/jobs/project/${job.id}`}>\n                <StatusLabel status={job.status} />\n              </Link>\n            </Tooltip>\n          ) : (\n            <Tooltip\n              position=\"top\"\n              content={t`Unable to load last job update`}\n              key={project.id}\n            >\n              <StatusLabel status={project?.status} />\n            </Tooltip>\n          )}\n        </Td>\n        <Td dataLabel={t`Type`}>\n          {project.scm_type === '' ? t`Manual` : toTitleCase(project.scm_type)}\n        </Td>\n        <Td dataLabel={t`Revision`}>{renderRevision()}</Td>\n        <ActionsTd dataLabel={t`Actions`}>\n          {['running', 'pending', 'waiting'].includes(job?.status) ? (\n            <ActionItem\n              visible={project.summary_fields.user_capabilities.start}\n            >\n              <JobCancelButton\n                job={{ id: job.id, type: 'project_update' }}\n                errorTitle={t`Project Sync Error`}\n                title={t`Cancel Project Sync`}\n                showIconButton\n                errorMessage={t`Failed to cancel Project Sync`}\n              />\n            </ActionItem>\n          ) : (\n            <ActionItem\n              visible={project.summary_fields.user_capabilities.start}\n              tooltip={t`Sync Project`}\n            >\n              <ProjectSyncButton\n                projectId={project.id}\n                lastJobStatus={job && job.status}\n              />\n            </ActionItem>\n          )}\n          <ActionItem\n            visible={project.summary_fields.user_capabilities.edit}\n            tooltip={t`Edit Project`}\n          >\n            <Button\n              ouiaId={`${project.id}-edit-button`}\n              isDisabled={isDisabled}\n              aria-label={t`Edit Project`}\n              variant=\"plain\"\n              component={Link}\n              to={`/projects/${project.id}/edit`}\n            >\n              <PencilAltIcon />\n            </Button>\n          </ActionItem>\n          <ActionItem\n            tooltip={t`Copy Project`}\n            visible={project.summary_fields.user_capabilities.copy}\n          >\n            <CopyButton\n              copyItem={copyProject}\n              isDisabled={isDisabled}\n              onCopyStart={handleCopyStart}\n              onCopyFinish={handleCopyFinish}\n              errorMessage={t`Failed to copy project.`}\n            />\n          </ActionItem>\n        </ActionsTd>\n      </Tr>\n      <Tr isExpanded={isExpanded} id={`expanded-project-row-${project.id}`}>\n        <Td colSpan={2} />\n        <Td colSpan={5}>\n          <ExpandableRowContent>\n            <DetailList>\n              <Detail\n                label={t`Description`}\n                value={project.description}\n                dataCy={`project-${project.id}-description`}\n              />\n              {project.summary_fields.organization ? (\n                <Detail\n                  label={t`Organization`}\n                  value={\n                    <Link\n                      to={`/organizations/${project.summary_fields.organization.id}/details`}\n                    >\n                      {project.summary_fields.organization.name}\n                    </Link>\n                  }\n                  dataCy={`project-${project.id}-organization`}\n                />\n              ) : (\n                <DeletedDetail label={t`Organization`} />\n              )}\n              <ExecutionEnvironmentDetail\n                virtualEnvironment={project.custom_virtualenv}\n                executionEnvironment={\n                  project.summary_fields?.default_environment\n                }\n                isDefaultEnvironment\n              />\n              <Detail\n                label={t`Last modified`}\n                value={formatDateString(project.modified)}\n                dataCy={`project-${project.id}-last-modified`}\n              />\n              <Detail\n                label={t`Last used`}\n                value={formatDateString(project.last_job_run)}\n                dataCy={`project-${project.id}-last-used`}\n              />\n            </DetailList>\n          </ExpandableRowContent>\n        </Td>\n      </Tr>\n    </>\n  );\n}\nexport default ProjectListItem;\n"]},"metadata":{},"sourceType":"module"}