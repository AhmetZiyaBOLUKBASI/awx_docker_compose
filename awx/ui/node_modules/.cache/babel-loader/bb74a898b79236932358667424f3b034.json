{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{CaretLeftIcon}from'@patternfly/react-icons';import{Card,PageSection}from'@patternfly/react-core';import{Switch,Route,Redirect,Link,useLocation,useParams,useRouteMatch}from'react-router-dom';import RoutedTabs from'components/RoutedTabs';import{useConfig}from'contexts/Config';import useRequest from'hooks/useRequest';import ContentError from'components/ContentError';import JobList from'components/JobList';import NotificationList from'components/NotificationList';import{Schedules}from'components/Schedule';import{ResourceAccessList}from'components/ResourceAccessList';import{JobTemplatesAPI,OrganizationsAPI}from'api';import JobTemplateDetail from'./JobTemplateDetail';import JobTemplateEdit from'./JobTemplateEdit';import TemplateSurvey from'./TemplateSurvey';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Template(_ref){var _template$summary_fie,_template$summary_fie2,_match$params;var setBreadcrumb=_ref.setBreadcrumb;var match=useRouteMatch();var location=useLocation();var _useParams=useParams(),templateId=_useParams.id;var _useConfig=useConfig(),_useConfig$me=_useConfig.me,me=_useConfig$me===void 0?{}:_useConfig$me;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$Promise$all,_yield$Promise$all2,data,defaultCredentials,actions,notifAdminRes,launchConfiguration,surveyConfiguration,_yield$JobTemplatesAP,survey,_data$related,_yield$JobTemplatesAP2,webhook_key;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Promise.all([JobTemplatesAPI.readDetail(templateId),JobTemplatesAPI.readCredentials(templateId,{page_size:200}),JobTemplatesAPI.readTemplateOptions(templateId),OrganizationsAPI.read({page_size:1,role_level:'notification_admin_role'}),JobTemplatesAPI.readLaunch(templateId)]);case 2:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,5);data=_yield$Promise$all2[0].data;defaultCredentials=_yield$Promise$all2[1].data.results;actions=_yield$Promise$all2[2];notifAdminRes=_yield$Promise$all2[3];launchConfiguration=_yield$Promise$all2[4].data;surveyConfiguration={};if(!data.survey_enabled){_context.next=16;break;}_context.next=13;return JobTemplatesAPI.readSurvey(templateId);case 13:_yield$JobTemplatesAP=_context.sent;survey=_yield$JobTemplatesAP.data;surveyConfiguration=survey;case 16:if(data.summary_fields.credentials){data.summary_fields.credentials=defaultCredentials;}if(!actions.data.actions.PUT){_context.next=24;break;}if(!(data.webhook_service&&data!==null&&data!==void 0&&(_data$related=data.related)!==null&&_data$related!==void 0&&_data$related.webhook_key)){_context.next=24;break;}_context.next=21;return JobTemplatesAPI.readWebhookKey(templateId);case 21:_yield$JobTemplatesAP2=_context.sent;webhook_key=_yield$JobTemplatesAP2.data.webhook_key;data.webhook_key=webhook_key;case 24:return _context.abrupt(\"return\",{template:data,isNotifAdmin:notifAdminRes.data.results.length>0,surveyConfig:surveyConfiguration,launchConfig:launchConfiguration,resourceDefaultCredentials:defaultCredentials});case 25:case\"end\":return _context.stop();}}},_callee);})),[templateId]),{isNotifAdmin:false,template:null,resourceDefaultCredentials:[]}),_useRequest$result=_useRequest.result,isNotifAdmin=_useRequest$result.isNotifAdmin,template=_useRequest$result.template,surveyConfig=_useRequest$result.surveyConfig,launchConfig=_useRequest$result.launchConfig,resourceDefaultCredentials=_useRequest$result.resourceDefaultCredentials,isLoading=_useRequest.isLoading,contentError=_useRequest.error,loadTemplateAndRoles=_useRequest.request;useEffect(function(){loadTemplateAndRoles();},[loadTemplateAndRoles]);useEffect(function(){if(template){setBreadcrumb(template);}},[template,setBreadcrumb]);var loadScheduleOptions=useCallback(function(){return JobTemplatesAPI.readScheduleOptions(templateId);},[templateId]);var loadSchedules=useCallback(function(params){return JobTemplatesAPI.readSchedules(templateId,params);},[templateId]);var canSeeNotificationsTab=(me===null||me===void 0?void 0:me.is_system_auditor)||isNotifAdmin;var canAddAndEditSurvey=(template===null||template===void 0?void 0:(_template$summary_fie=template.summary_fields)===null||_template$summary_fie===void 0?void 0:_template$summary_fie.user_capabilities.edit)||(template===null||template===void 0?void 0:(_template$summary_fie2=template.summary_fields)===null||_template$summary_fie2===void 0?void 0:_template$summary_fie2.user_capabilities.delete);var tabsArray=[{name:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CaretLeftIcon,{}),/*i18n*/i18n._(\"Back to Templates\")]}),link:\"/templates\",isBackButton:true,id:99},{name:/*i18n*/i18n._(\"Details\"),link:\"\".concat(match.url,\"/details\")},{name:/*i18n*/i18n._(\"Access\"),link:\"\".concat(match.url,\"/access\")}];if(canSeeNotificationsTab){tabsArray.push({name:/*i18n*/i18n._(\"Notifications\"),link:\"\".concat(match.url,\"/notifications\")});}if(template){tabsArray.push({name:/*i18n*/i18n._(\"Schedules\"),link:\"\".concat(match.url,\"/schedules\")});}tabsArray.push({name:/*i18n*/i18n._(\"Jobs\"),link:\"\".concat(match.url,\"/jobs\")},{name:canAddAndEditSurvey?/*i18n*/i18n._(\"Survey\"):/*i18n*/i18n._(\"View Survey\"),link:\"\".concat(match.url,\"/survey\")});tabsArray.forEach(function(tab,n){tab.id=n;});if(contentError){var _contentError$respons;return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(ContentError,{error:contentError,children:((_contentError$respons=contentError.response)===null||_contentError$respons===void 0?void 0:_contentError$respons.status)===404&&/*#__PURE__*/_jsxs(\"span\",{children:[/*i18n*/i18n._(\"Template not found.\"),' ',/*#__PURE__*/_jsx(Link,{to:\"/templates\",children:/*i18n*/i18n._(\"View all Templates.\")})]})})})});}var showCardHeader=!(location.pathname.endsWith('edit')||location.pathname.includes('schedules/')||location.pathname.includes('survey/'));return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsxs(Card,{children:[showCardHeader&&/*#__PURE__*/_jsx(RoutedTabs,{tabsArray:tabsArray}),template&&/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Redirect,{from:\"/templates/:templateType/:id\",to:\"/templates/:templateType/:id/details\",exact:true}),/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/details\",children:/*#__PURE__*/_jsx(JobTemplateDetail,{hasTemplateLoading:isLoading,template:template})},\"details\"),/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/edit\",children:/*#__PURE__*/_jsx(JobTemplateEdit,{template:template,reloadTemplate:loadTemplateAndRoles})},\"edit\"),/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/access\",children:/*#__PURE__*/_jsx(ResourceAccessList,{resource:template,apiModel:JobTemplatesAPI})},\"access\"),/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/schedules\",children:/*#__PURE__*/_jsx(Schedules,{apiModel:JobTemplatesAPI,setBreadcrumb:setBreadcrumb,resource:template,loadSchedules:loadSchedules,loadScheduleOptions:loadScheduleOptions,surveyConfig:surveyConfig,launchConfig:launchConfig,resourceDefaultCredentials:resourceDefaultCredentials})},\"schedules\"),canSeeNotificationsTab&&/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/notifications\",children:/*#__PURE__*/_jsx(NotificationList,{id:Number(templateId),canToggleNotifications:isNotifAdmin,apiModel:JobTemplatesAPI})}),/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/jobs\",children:/*#__PURE__*/_jsx(JobList,{defaultParams:{job__job_template:template.id}})}),/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/survey\",children:/*#__PURE__*/_jsx(TemplateSurvey,{template:template,canEdit:canAddAndEditSurvey})}),!isLoading&&/*#__PURE__*/_jsx(Route,{path:\"*\",children:/*#__PURE__*/_jsx(ContentError,{isNotFound:true,children:match.params.id&&/*#__PURE__*/_jsx(Link,{to:\"/templates/\".concat(match===null||match===void 0?void 0:(_match$params=match.params)===null||_match$params===void 0?void 0:_match$params.templateType,\"/\").concat(templateId,\"/details\"),children:/*i18n*/i18n._(\"View Template Details\")})})},\"not-found\")]})]})});}export{Template as _Template};export default Template;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Template/Template.js"],"names":["React","useEffect","useCallback","CaretLeftIcon","Card","PageSection","Switch","Route","Redirect","Link","useLocation","useParams","useRouteMatch","RoutedTabs","useConfig","useRequest","ContentError","JobList","NotificationList","Schedules","ResourceAccessList","JobTemplatesAPI","OrganizationsAPI","JobTemplateDetail","JobTemplateEdit","TemplateSurvey","Template","setBreadcrumb","match","location","templateId","id","me","Promise","all","readDetail","readCredentials","page_size","readTemplateOptions","read","role_level","readLaunch","data","defaultCredentials","results","actions","notifAdminRes","launchConfiguration","surveyConfiguration","survey_enabled","readSurvey","survey","summary_fields","credentials","PUT","webhook_service","related","webhook_key","readWebhookKey","template","isNotifAdmin","length","surveyConfig","launchConfig","resourceDefaultCredentials","result","isLoading","contentError","error","loadTemplateAndRoles","request","loadScheduleOptions","readScheduleOptions","loadSchedules","params","readSchedules","canSeeNotificationsTab","is_system_auditor","canAddAndEditSurvey","user_capabilities","edit","delete","tabsArray","name","link","isBackButton","url","push","forEach","tab","n","response","status","showCardHeader","pathname","endsWith","includes","Number","job__job_template","templateType","_Template"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { t } from '@lingui/macro';\n\nimport { CaretLeftIcon } from '@patternfly/react-icons';\nimport { Card, PageSection } from '@patternfly/react-core';\nimport {\n  Switch,\n  Route,\n  Redirect,\n  Link,\n  useLocation,\n  useParams,\n  useRouteMatch,\n} from 'react-router-dom';\nimport RoutedTabs from 'components/RoutedTabs';\nimport { useConfig } from 'contexts/Config';\nimport useRequest from 'hooks/useRequest';\nimport ContentError from 'components/ContentError';\nimport JobList from 'components/JobList';\nimport NotificationList from 'components/NotificationList';\nimport { Schedules } from 'components/Schedule';\nimport { ResourceAccessList } from 'components/ResourceAccessList';\nimport { JobTemplatesAPI, OrganizationsAPI } from 'api';\nimport JobTemplateDetail from './JobTemplateDetail';\nimport JobTemplateEdit from './JobTemplateEdit';\nimport TemplateSurvey from './TemplateSurvey';\n\nfunction Template({ setBreadcrumb }) {\n  const match = useRouteMatch();\n  const location = useLocation();\n  const { id: templateId } = useParams();\n  const { me = {} } = useConfig();\n\n  const {\n    result: {\n      isNotifAdmin,\n      template,\n      surveyConfig,\n      launchConfig,\n      resourceDefaultCredentials,\n    },\n    isLoading,\n    error: contentError,\n    request: loadTemplateAndRoles,\n  } = useRequest(\n    useCallback(async () => {\n      const [\n        { data },\n        {\n          data: { results: defaultCredentials },\n        },\n        actions,\n        notifAdminRes,\n        { data: launchConfiguration },\n      ] = await Promise.all([\n        JobTemplatesAPI.readDetail(templateId),\n        JobTemplatesAPI.readCredentials(templateId, {\n          page_size: 200,\n        }),\n        JobTemplatesAPI.readTemplateOptions(templateId),\n        OrganizationsAPI.read({\n          page_size: 1,\n          role_level: 'notification_admin_role',\n        }),\n        JobTemplatesAPI.readLaunch(templateId),\n      ]);\n      let surveyConfiguration = {};\n\n      if (data.survey_enabled) {\n        const { data: survey } = await JobTemplatesAPI.readSurvey(templateId);\n\n        surveyConfiguration = survey;\n      }\n      if (data.summary_fields.credentials) {\n        data.summary_fields.credentials = defaultCredentials;\n      }\n\n      if (actions.data.actions.PUT) {\n        if (data.webhook_service && data?.related?.webhook_key) {\n          const {\n            data: { webhook_key },\n          } = await JobTemplatesAPI.readWebhookKey(templateId);\n\n          data.webhook_key = webhook_key;\n        }\n      }\n      return {\n        template: data,\n        isNotifAdmin: notifAdminRes.data.results.length > 0,\n        surveyConfig: surveyConfiguration,\n        launchConfig: launchConfiguration,\n        resourceDefaultCredentials: defaultCredentials,\n      };\n    }, [templateId]),\n    { isNotifAdmin: false, template: null, resourceDefaultCredentials: [] }\n  );\n\n  useEffect(() => {\n    loadTemplateAndRoles();\n  }, [loadTemplateAndRoles]);\n\n  useEffect(() => {\n    if (template) {\n      setBreadcrumb(template);\n    }\n  }, [template, setBreadcrumb]);\n\n  const loadScheduleOptions = useCallback(\n    () => JobTemplatesAPI.readScheduleOptions(templateId),\n    [templateId]\n  );\n\n  const loadSchedules = useCallback(\n    (params) => JobTemplatesAPI.readSchedules(templateId, params),\n    [templateId]\n  );\n\n  const canSeeNotificationsTab = me?.is_system_auditor || isNotifAdmin;\n  const canAddAndEditSurvey =\n    template?.summary_fields?.user_capabilities.edit ||\n    template?.summary_fields?.user_capabilities.delete;\n\n  const tabsArray = [\n    {\n      name: (\n        <>\n          <CaretLeftIcon />\n          {t`Back to Templates`}\n        </>\n      ),\n      link: `/templates`,\n      isBackButton: true,\n      id: 99,\n    },\n    { name: t`Details`, link: `${match.url}/details` },\n    { name: t`Access`, link: `${match.url}/access` },\n  ];\n\n  if (canSeeNotificationsTab) {\n    tabsArray.push({\n      name: t`Notifications`,\n      link: `${match.url}/notifications`,\n    });\n  }\n\n  if (template) {\n    tabsArray.push({\n      name: t`Schedules`,\n      link: `${match.url}/schedules`,\n    });\n  }\n\n  tabsArray.push(\n    {\n      name: t`Jobs`,\n      link: `${match.url}/jobs`,\n    },\n    {\n      name: canAddAndEditSurvey ? t`Survey` : t`View Survey`,\n      link: `${match.url}/survey`,\n    }\n  );\n\n  tabsArray.forEach((tab, n) => {\n    tab.id = n;\n  });\n\n  if (contentError) {\n    return (\n      <PageSection>\n        <Card>\n          <ContentError error={contentError}>\n            {contentError.response?.status === 404 && (\n              <span>\n                {t`Template not found.`}{' '}\n                <Link to=\"/templates\">{t`View all Templates.`}</Link>\n              </span>\n            )}\n          </ContentError>\n        </Card>\n      </PageSection>\n    );\n  }\n\n  const showCardHeader = !(\n    location.pathname.endsWith('edit') ||\n    location.pathname.includes('schedules/') ||\n    location.pathname.includes('survey/')\n  );\n\n  return (\n    <PageSection>\n      <Card>\n        {showCardHeader && <RoutedTabs tabsArray={tabsArray} />}\n        {template && (\n          <Switch>\n            <Redirect\n              from=\"/templates/:templateType/:id\"\n              to=\"/templates/:templateType/:id/details\"\n              exact\n            />\n            <Route key=\"details\" path=\"/templates/:templateType/:id/details\">\n              <JobTemplateDetail\n                hasTemplateLoading={isLoading}\n                template={template}\n              />\n            </Route>\n            <Route key=\"edit\" path=\"/templates/:templateType/:id/edit\">\n              <JobTemplateEdit\n                template={template}\n                reloadTemplate={loadTemplateAndRoles}\n              />\n            </Route>\n            <Route key=\"access\" path=\"/templates/:templateType/:id/access\">\n              <ResourceAccessList\n                resource={template}\n                apiModel={JobTemplatesAPI}\n              />\n            </Route>\n            <Route\n              key=\"schedules\"\n              path=\"/templates/:templateType/:id/schedules\"\n            >\n              <Schedules\n                apiModel={JobTemplatesAPI}\n                setBreadcrumb={setBreadcrumb}\n                resource={template}\n                loadSchedules={loadSchedules}\n                loadScheduleOptions={loadScheduleOptions}\n                surveyConfig={surveyConfig}\n                launchConfig={launchConfig}\n                resourceDefaultCredentials={resourceDefaultCredentials}\n              />\n            </Route>\n            {canSeeNotificationsTab && (\n              <Route path=\"/templates/:templateType/:id/notifications\">\n                <NotificationList\n                  id={Number(templateId)}\n                  canToggleNotifications={isNotifAdmin}\n                  apiModel={JobTemplatesAPI}\n                />\n              </Route>\n            )}\n            <Route path=\"/templates/:templateType/:id/jobs\">\n              <JobList defaultParams={{ job__job_template: template.id }} />\n            </Route>\n            <Route path=\"/templates/:templateType/:id/survey\">\n              <TemplateSurvey\n                template={template}\n                canEdit={canAddAndEditSurvey}\n              />\n            </Route>\n            {!isLoading && (\n              <Route key=\"not-found\" path=\"*\">\n                <ContentError isNotFound>\n                  {match.params.id && (\n                    <Link\n                      to={`/templates/${match?.params?.templateType}/${templateId}/details`}\n                    >\n                      {t`View Template Details`}\n                    </Link>\n                  )}\n                </ContentError>\n              </Route>\n            )}\n          </Switch>\n        )}\n      </Card>\n    </PageSection>\n  );\n}\n\nexport { Template as _Template };\nexport default Template;\n"]},"metadata":{},"sourceType":"module"}