{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject;import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState,useEffect,useCallback}from'react';import{useLocation,useHistory}from'react-router-dom';import styled from'styled-components';import{Card,PageSection,PageSectionVariants,SelectGroup,Select as PFSelect,SelectVariant,SelectOption,Title}from'@patternfly/react-core';import DatalistToolbar from'components/DataListToolbar';import PaginatedTable,{HeaderRow,HeaderCell,getSearchableKeys}from'components/PaginatedTable';import useRequest from'hooks/useRequest';import useTitle from'hooks/useTitle';import{getQSConfig,parseQueryString,updateQueryString}from'util/qs';import{ActivityStreamAPI}from'api';import ActivityStreamListItem from'./ActivityStreamListItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Select=styled(PFSelect)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  && {\\n    width: auto;\\n    white-space: nowrap;\\n    max-height: 480px;\\n  }\\n\"])));function ActivityStream(){var light=PageSectionVariants.light;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isTypeDropdownOpen=_useState2[0],setIsTypeDropdownOpen=_useState2[1];var location=useLocation();var history=useHistory();useTitle(/*i18n*/i18n._(\"Activity Stream\"));var urlParams=new URLSearchParams(location.search);var activityStreamType=urlParams.get('type')||'all';var typeParams={};if(activityStreamType!=='all'){typeParams={or__object1__in:activityStreamType,or__object2__in:activityStreamType};}var QS_CONFIG=getQSConfig('activity_stream',{page:1,page_size:20,order_by:'-timestamp'},['id','page','page_size']);var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,response,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,location.search);_context.next=3;return Promise.all([ActivityStreamAPI.read(_objectSpread(_objectSpread({},params),typeParams)),ActivityStreamAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);response=_yield$Promise$all2[0];actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{results:response.data.results,count:response.data.count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 8:case\"end\":return _context.stop();}}},_callee);})),[location]// eslint-disable-line react-hooks/exhaustive-deps\n),{results:[],count:0,relatedSearchableKeys:[],searchableKeys:[]}),_useRequest$result=_useRequest.result,results=_useRequest$result.results,count=_useRequest$result.count,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,contentError=_useRequest.error,isLoading=_useRequest.isLoading,fetchActivityStream=_useRequest.request;useEffect(function(){fetchActivityStream();},[fetchActivityStream]);var pushHistoryState=function pushHistoryState(urlParamsToAdd){var pageOneQs=updateQueryString(QS_CONFIG,location.search,{page:1});var qs=updateQueryString(null,pageOneQs,{type:urlParamsToAdd.get('type')});history.push(qs?\"\".concat(location.pathname,\"?\").concat(qs):location.pathname);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(PageSection,{variant:light,className:\"pf-m-condensed\",style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(Title,{size:\"2xl\",headingLevel:\"h2\",\"data-cy\":\"screen-title\",children:/*i18n*/i18n._(\"Activity Stream\")}),/*#__PURE__*/_jsx(\"span\",{id:\"grouped-type-select-id\",hidden:true,children:/*i18n*/i18n._(\"Activity Stream type selector\")}),/*#__PURE__*/_jsxs(Select,{variant:SelectVariant.single,\"aria-labelledby\":\"grouped-type-select-id\",typeAheadAriaLabel:/*i18n*/i18n._(\"Select an activity type\"),className:\"activityTypeSelect\",onToggle:setIsTypeDropdownOpen,onSelect:function onSelect(event,selection){if(selection){urlParams.set('type',selection);}setIsTypeDropdownOpen(false);pushHistoryState(urlParams);},selections:activityStreamType,isOpen:isTypeDropdownOpen,isGrouped:true,noResultsFoundText:/*i18n*/i18n._(\"No results found\"),ouiaId:\"activity-type-select\",children:[/*#__PURE__*/_jsxs(SelectGroup,{label:/*i18n*/i18n._(\"Views\"),children:[/*#__PURE__*/_jsx(SelectOption,{value:\"all\",children:/*i18n*/i18n._(\"Dashboard (all activity)\")},\"all_activity\"),/*#__PURE__*/_jsx(SelectOption,{value:\"job\",children:/*i18n*/i18n._(\"Jobs\")},\"jobs\"),/*#__PURE__*/_jsx(SelectOption,{value:\"schedule\",children:/*i18n*/i18n._(\"Schedules\")},\"schedules\"),/*#__PURE__*/_jsx(SelectOption,{value:\"workflow_approval\",children:/*i18n*/i18n._(\"Workflow Approvals\")},\"workflow_approvals\")]},\"views\"),/*#__PURE__*/_jsxs(SelectGroup,{label:/*i18n*/i18n._(\"Resources\"),children:[/*#__PURE__*/_jsx(SelectOption,{value:\"job_template,workflow_job_template,workflow_job_template_node\",children:/*i18n*/i18n._(\"Templates\")},\"templates\"),/*#__PURE__*/_jsx(SelectOption,{value:\"credential\",children:/*i18n*/i18n._(\"Credentials\")},\"credentials\"),/*#__PURE__*/_jsx(SelectOption,{value:\"project\",children:/*i18n*/i18n._(\"Projects\")},\"projects\"),/*#__PURE__*/_jsx(SelectOption,{value:\"inventory\",children:/*i18n*/i18n._(\"Inventories\")},\"inventories\"),/*#__PURE__*/_jsx(SelectOption,{value:\"host\",children:/*i18n*/i18n._(\"Hosts\")},\"hosts\")]},\"resources\"),/*#__PURE__*/_jsxs(SelectGroup,{label:/*i18n*/i18n._(\"Access\"),children:[/*#__PURE__*/_jsx(SelectOption,{value:\"organization\",children:/*i18n*/i18n._(\"Organizations\")},\"organizations\"),/*#__PURE__*/_jsx(SelectOption,{value:\"user\",children:/*i18n*/i18n._(\"Users\")},\"users\"),/*#__PURE__*/_jsx(SelectOption,{value:\"team\",children:/*i18n*/i18n._(\"Teams\")},\"teams\")]},\"access\"),/*#__PURE__*/_jsxs(SelectGroup,{label:/*i18n*/i18n._(\"Administration\"),children:[/*#__PURE__*/_jsx(SelectOption,{value:\"credential_type\",children:/*i18n*/i18n._(\"Credential Types\")},\"credential_types\"),/*#__PURE__*/_jsx(SelectOption,{value:\"notification_template\",children:/*i18n*/i18n._(\"Notification Templates\")},\"notification_templates\"),/*#__PURE__*/_jsx(SelectOption,{value:\"instance\",children:/*i18n*/i18n._(\"Instances\")},\"instance\"),/*#__PURE__*/_jsx(SelectOption,{value:\"instance_group\",children:/*i18n*/i18n._(\"Instance Groups\")},\"instance_groups\"),/*#__PURE__*/_jsx(SelectOption,{value:\"o_auth2_application,o_auth2_access_token\",children:/*i18n*/i18n._(\"Applications & Tokens\")},\"applications\"),/*#__PURE__*/_jsx(SelectOption,{value:\"execution_environment\",children:/*i18n*/i18n._(\"Execution Environments\")},\"execution_environments\")]},\"administration\"),/*#__PURE__*/_jsx(SelectGroup,{label:/*i18n*/i18n._(\"Settings\"),children:/*#__PURE__*/_jsx(SelectOption,{value:\"setting\",children:/*i18n*/i18n._(\"Settings\")},\"settings\")},\"settings\")]})]}),/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(PaginatedTable,{contentError:contentError,hasContentLoading:isLoading,items:results,itemCount:count,pluralizedItemName:/*i18n*/i18n._(\"Events\"),qsConfig:QS_CONFIG,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Keyword\"),key:'search',isDefault:true},{name:/*i18n*/i18n._(\"Initiated by (username)\"),key:'actor__username__icontains'}],toolbarSortColumns:[{name:/*i18n*/i18n._(\"Time\"),key:'timestamp'},{name:/*i18n*/i18n._(\"Initiated by\"),key:'actor__username'}],toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"timestamp\",children:/*i18n*/i18n._(\"Time\")}),/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"actor__username\",children:/*i18n*/i18n._(\"Initiated by\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Event\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Actions\")})]}),renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DatalistToolbar,_objectSpread(_objectSpread({},props),{},{qsConfig:QS_CONFIG}));},renderRow:function renderRow(streamItem,index){return/*#__PURE__*/_jsx(ActivityStreamListItem,{streamItem:streamItem},index);}})})})]});}export default ActivityStream;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/ActivityStream/ActivityStream.js"],"names":["React","useState","useEffect","useCallback","useLocation","useHistory","styled","Card","PageSection","PageSectionVariants","SelectGroup","Select","PFSelect","SelectVariant","SelectOption","Title","DatalistToolbar","PaginatedTable","HeaderRow","HeaderCell","getSearchableKeys","useRequest","useTitle","getQSConfig","parseQueryString","updateQueryString","ActivityStreamAPI","ActivityStreamListItem","ActivityStream","light","isTypeDropdownOpen","setIsTypeDropdownOpen","location","history","urlParams","URLSearchParams","search","activityStreamType","get","typeParams","or__object1__in","or__object2__in","QS_CONFIG","page","page_size","order_by","params","Promise","all","read","readOptions","response","actionsResponse","results","data","count","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","result","contentError","error","isLoading","fetchActivityStream","request","pushHistoryState","urlParamsToAdd","pageOneQs","qs","type","push","pathname","display","justifyContent","single","event","selection","set","name","key","isDefault","props","streamItem","index"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useLocation, useHistory } from 'react-router-dom';\nimport styled from 'styled-components';\nimport { t } from '@lingui/macro';\nimport {\n  Card,\n  PageSection,\n  PageSectionVariants,\n  SelectGroup,\n  Select as PFSelect,\n  SelectVariant,\n  SelectOption,\n  Title,\n} from '@patternfly/react-core';\n\nimport DatalistToolbar from 'components/DataListToolbar';\nimport PaginatedTable, {\n  HeaderRow,\n  HeaderCell,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\nimport useRequest from 'hooks/useRequest';\nimport useTitle from 'hooks/useTitle';\nimport { getQSConfig, parseQueryString, updateQueryString } from 'util/qs';\nimport { ActivityStreamAPI } from 'api';\n\nimport ActivityStreamListItem from './ActivityStreamListItem';\n\nconst Select = styled(PFSelect)`\n  && {\n    width: auto;\n    white-space: nowrap;\n    max-height: 480px;\n  }\n`;\n\nfunction ActivityStream() {\n  const { light } = PageSectionVariants;\n\n  const [isTypeDropdownOpen, setIsTypeDropdownOpen] = useState(false);\n  const location = useLocation();\n  const history = useHistory();\n  useTitle(t`Activity Stream`);\n  const urlParams = new URLSearchParams(location.search);\n\n  const activityStreamType = urlParams.get('type') || 'all';\n\n  let typeParams = {};\n\n  if (activityStreamType !== 'all') {\n    typeParams = {\n      or__object1__in: activityStreamType,\n      or__object2__in: activityStreamType,\n    };\n  }\n\n  const QS_CONFIG = getQSConfig(\n    'activity_stream',\n    {\n      page: 1,\n      page_size: 20,\n      order_by: '-timestamp',\n    },\n    ['id', 'page', 'page_size']\n  );\n\n  const {\n    result: { results, count, relatedSearchableKeys, searchableKeys },\n    error: contentError,\n    isLoading,\n    request: fetchActivityStream,\n  } = useRequest(\n    useCallback(\n      async () => {\n        const params = parseQueryString(QS_CONFIG, location.search);\n        const [response, actionsResponse] = await Promise.all([\n          ActivityStreamAPI.read({ ...params, ...typeParams }),\n          ActivityStreamAPI.readOptions(),\n        ]);\n        return {\n          results: response.data.results,\n          count: response.data.count,\n          relatedSearchableKeys: (\n            actionsResponse?.data?.related_search_fields || []\n          ).map((val) => val.slice(0, -8)),\n          searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n        };\n      },\n      [location] // eslint-disable-line react-hooks/exhaustive-deps\n    ),\n    {\n      results: [],\n      count: 0,\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n  useEffect(() => {\n    fetchActivityStream();\n  }, [fetchActivityStream]);\n\n  const pushHistoryState = (urlParamsToAdd) => {\n    const pageOneQs = updateQueryString(QS_CONFIG, location.search, {\n      page: 1,\n    });\n    const qs = updateQueryString(null, pageOneQs, {\n      type: urlParamsToAdd.get('type'),\n    });\n\n    history.push(qs ? `${location.pathname}?${qs}` : location.pathname);\n  };\n\n  return (\n    <>\n      <PageSection\n        variant={light}\n        className=\"pf-m-condensed\"\n        style={{ display: 'flex', justifyContent: 'space-between' }}\n      >\n        <Title size=\"2xl\" headingLevel=\"h2\" data-cy=\"screen-title\">\n          {t`Activity Stream`}\n        </Title>\n        <span id=\"grouped-type-select-id\" hidden>\n          {t`Activity Stream type selector`}\n        </span>\n        <Select\n          variant={SelectVariant.single}\n          aria-labelledby=\"grouped-type-select-id\"\n          typeAheadAriaLabel={t`Select an activity type`}\n          className=\"activityTypeSelect\"\n          onToggle={setIsTypeDropdownOpen}\n          onSelect={(event, selection) => {\n            if (selection) {\n              urlParams.set('type', selection);\n            }\n            setIsTypeDropdownOpen(false);\n            pushHistoryState(urlParams);\n          }}\n          selections={activityStreamType}\n          isOpen={isTypeDropdownOpen}\n          isGrouped\n          noResultsFoundText={t`No results found`}\n          ouiaId=\"activity-type-select\"\n        >\n          <SelectGroup label={t`Views`} key=\"views\">\n            <SelectOption key=\"all_activity\" value=\"all\">\n              {t`Dashboard (all activity)`}\n            </SelectOption>\n            <SelectOption key=\"jobs\" value=\"job\">\n              {t`Jobs`}\n            </SelectOption>\n            <SelectOption key=\"schedules\" value=\"schedule\">\n              {t`Schedules`}\n            </SelectOption>\n            <SelectOption key=\"workflow_approvals\" value=\"workflow_approval\">\n              {t`Workflow Approvals`}\n            </SelectOption>\n          </SelectGroup>\n          <SelectGroup label={t`Resources`} key=\"resources\">\n            <SelectOption\n              key=\"templates\"\n              value=\"job_template,workflow_job_template,workflow_job_template_node\"\n            >\n              {t`Templates`}\n            </SelectOption>\n            <SelectOption key=\"credentials\" value=\"credential\">\n              {t`Credentials`}\n            </SelectOption>\n            <SelectOption key=\"projects\" value=\"project\">\n              {t`Projects`}\n            </SelectOption>\n            <SelectOption key=\"inventories\" value=\"inventory\">\n              {t`Inventories`}\n            </SelectOption>\n            <SelectOption key=\"hosts\" value=\"host\">\n              {t`Hosts`}\n            </SelectOption>\n          </SelectGroup>\n          <SelectGroup label={t`Access`} key=\"access\">\n            <SelectOption key=\"organizations\" value=\"organization\">\n              {t`Organizations`}\n            </SelectOption>\n            <SelectOption key=\"users\" value=\"user\">\n              {t`Users`}\n            </SelectOption>\n            <SelectOption key=\"teams\" value=\"team\">\n              {t`Teams`}\n            </SelectOption>\n          </SelectGroup>\n          <SelectGroup label={t`Administration`} key=\"administration\">\n            <SelectOption key=\"credential_types\" value=\"credential_type\">\n              {t`Credential Types`}\n            </SelectOption>\n            <SelectOption\n              key=\"notification_templates\"\n              value=\"notification_template\"\n            >\n              {t`Notification Templates`}\n            </SelectOption>\n            <SelectOption\n              key=\"instance\"\n              value=\"instance\"\n            >{t`Instances`}</SelectOption>\n            <SelectOption key=\"instance_groups\" value=\"instance_group\">\n              {t`Instance Groups`}\n            </SelectOption>\n            <SelectOption\n              key=\"applications\"\n              value=\"o_auth2_application,o_auth2_access_token\"\n            >\n              {t`Applications & Tokens`}\n            </SelectOption>\n            <SelectOption\n              key=\"execution_environments\"\n              value=\"execution_environment\"\n            >\n              {t`Execution Environments`}\n            </SelectOption>\n          </SelectGroup>\n          <SelectGroup label={t`Settings`} key=\"settings\">\n            <SelectOption key=\"settings\" value=\"setting\">\n              {t`Settings`}\n            </SelectOption>\n          </SelectGroup>\n        </Select>\n      </PageSection>\n      <PageSection>\n        <Card>\n          <PaginatedTable\n            contentError={contentError}\n            hasContentLoading={isLoading}\n            items={results}\n            itemCount={count}\n            pluralizedItemName={t`Events`}\n            qsConfig={QS_CONFIG}\n            toolbarSearchColumns={[\n              {\n                name: t`Keyword`,\n                key: 'search',\n                isDefault: true,\n              },\n              {\n                name: t`Initiated by (username)`,\n                key: 'actor__username__icontains',\n              },\n            ]}\n            toolbarSortColumns={[\n              {\n                name: t`Time`,\n                key: 'timestamp',\n              },\n              {\n                name: t`Initiated by`,\n                key: 'actor__username',\n              },\n            ]}\n            toolbarSearchableKeys={searchableKeys}\n            toolbarRelatedSearchableKeys={relatedSearchableKeys}\n            headerRow={\n              <HeaderRow qsConfig={QS_CONFIG}>\n                <HeaderCell sortKey=\"timestamp\">{t`Time`}</HeaderCell>\n                <HeaderCell sortKey=\"actor__username\">\n                  {t`Initiated by`}\n                </HeaderCell>\n                <HeaderCell>{t`Event`}</HeaderCell>\n                <HeaderCell>{t`Actions`}</HeaderCell>\n              </HeaderRow>\n            }\n            renderToolbar={(props) => (\n              <DatalistToolbar {...props} qsConfig={QS_CONFIG} />\n            )}\n            renderRow={(streamItem, index) => (\n              <ActivityStreamListItem key={index} streamItem={streamItem} />\n            )}\n          />\n        </Card>\n      </PageSection>\n    </>\n  );\n}\n\nexport default ActivityStream;\n"]},"metadata":{},"sourceType":"module"}