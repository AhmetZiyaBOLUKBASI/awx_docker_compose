{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _createForOfIteratorHelper from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _excluded=[\"instance_groups\",\"organization\"];import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{Card,PageSection}from'@patternfly/react-core';import{CardBody}from'components/Card';import useRequest from'hooks/useRequest';import{InventoriesAPI}from'api';import SmartInventoryForm from'../shared/SmartInventoryForm';import parseHostFilter from'../shared/utils';import{jsx as _jsx}from\"react/jsx-runtime\";function SmartInventoryAdd(){var history=useHistory();var _useRequest=useRequest(useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values,groupsToAssociate){var _yield$InventoriesAPI,invId,_iterator,_step,group;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return InventoriesAPI.create(values);case 2:_yield$InventoriesAPI=_context.sent;invId=_yield$InventoriesAPI.data.id;/* eslint-disable no-await-in-loop, no-restricted-syntax */ // Resolve Promises sequentially to maintain order and avoid race condition\n_iterator=_createForOfIteratorHelper(groupsToAssociate);_context.prev=5;_iterator.s();case 7:if((_step=_iterator.n()).done){_context.next=13;break;}group=_step.value;_context.next=11;return InventoriesAPI.associateInstanceGroup(invId,group.id);case 11:_context.next=7;break;case 13:_context.next=18;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](5);_iterator.e(_context.t0);case 18:_context.prev=18;_iterator.f();return _context.finish(18);case 21:return _context.abrupt(\"return\",invId);case 22:case\"end\":return _context.stop();}}},_callee,null,[[5,15,18,21]]);}));return function(_x,_x2){return _ref.apply(this,arguments);};}(),[])),submitError=_useRequest.error,submitRequest=_useRequest.request,inventoryId=_useRequest.result;var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(form){var modifiedForm,instance_groups,organization,remainingForm;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:modifiedForm=parseHostFilter(form);instance_groups=modifiedForm.instance_groups,organization=modifiedForm.organization,remainingForm=_objectWithoutProperties(modifiedForm,_excluded);_context2.next=4;return submitRequest(_objectSpread({organization:organization===null||organization===void 0?void 0:organization.id},remainingForm),instance_groups);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x3){return _ref2.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push({pathname:'/inventories',search:''});};useEffect(function(){if(inventoryId){history.push({pathname:\"/inventories/smart_inventory/\".concat(inventoryId,\"/details\"),search:''});}},[inventoryId,history]);return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(SmartInventoryForm,{onCancel:handleCancel,onSubmit:handleSubmit,submitError:submitError})})})});}export default SmartInventoryAdd;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Inventory/SmartInventoryAdd/SmartInventoryAdd.js"],"names":["React","useCallback","useEffect","useHistory","Card","PageSection","CardBody","useRequest","InventoriesAPI","SmartInventoryForm","parseHostFilter","SmartInventoryAdd","history","values","groupsToAssociate","create","invId","data","id","group","associateInstanceGroup","submitError","error","submitRequest","request","inventoryId","result","handleSubmit","form","modifiedForm","instance_groups","organization","remainingForm","handleCancel","push","pathname","search"],"mappings":"kmBAAA,MAAOA,CAAAA,KAAP,EAAgBC,WAAhB,CAA6BC,SAA7B,KAA8C,OAA9C,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,IAAT,CAAeC,WAAf,KAAkC,wBAAlC,CACA,OAASC,QAAT,KAAyB,iBAAzB,CACA,MAAOC,CAAAA,UAAP,KAAuB,kBAAvB,CACA,OAASC,cAAT,KAA+B,KAA/B,CACA,MAAOC,CAAAA,kBAAP,KAA+B,8BAA/B,CACA,MAAOC,CAAAA,eAAP,KAA4B,iBAA5B,C,2CAEA,QAASC,CAAAA,iBAAT,EAA6B,CAC3B,GAAMC,CAAAA,OAAO,CAAGT,UAAU,EAA1B,CAEA,gBAIII,UAAU,CACZN,WAAW,0FAAC,iBAAOY,MAAP,CAAeC,iBAAf,8LAGAN,CAAAA,cAAc,CAACO,MAAf,CAAsBF,MAAtB,CAHA,4CAEIG,KAFJ,uBAERC,IAFQ,CAEAC,EAFA,CAKV,2DALU,CAMV;AANU,qCAOUJ,iBAPV,8FAOCK,KAPD,oCAQFX,CAAAA,cAAc,CAACY,sBAAf,CAAsCJ,KAAtC,CAA6CG,KAAK,CAACD,EAAnD,CARE,2PAWHF,KAXG,6EAAD,mEAYR,EAZQ,CADC,CAJd,CACSK,WADT,aACEC,KADF,CAEWC,aAFX,aAEEC,OAFF,CAGUC,WAHV,aAGEC,MAHF,CAoBA,GAAMC,CAAAA,YAAY,2FAAG,kBAAOC,IAAP,kLACbC,YADa,CACEnB,eAAe,CAACkB,IAAD,CADjB,CAGXE,eAHW,CAGyCD,YAHzC,CAGXC,eAHW,CAGMC,YAHN,CAGyCF,YAHzC,CAGME,YAHN,CAGuBC,aAHvB,0BAGyCH,YAHzC,mCAKbN,CAAAA,aAAa,gBAEfQ,YAAY,CAAEA,YAAF,SAAEA,YAAF,iBAAEA,YAAY,CAAEb,EAFb,EAGZc,aAHY,EAKjBF,eALiB,CALA,yDAAH,kBAAZH,CAAAA,YAAY,8CAAlB,CAcA,GAAMM,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CACzBrB,OAAO,CAACsB,IAAR,CAAa,CACXC,QAAQ,CAAE,cADC,CAEXC,MAAM,CAAE,EAFG,CAAb,EAID,CALD,CAOAlC,SAAS,CAAC,UAAM,CACd,GAAIuB,WAAJ,CAAiB,CACfb,OAAO,CAACsB,IAAR,CAAa,CACXC,QAAQ,wCAAkCV,WAAlC,YADG,CAEXW,MAAM,CAAE,EAFG,CAAb,EAID,CACF,CAPQ,CAON,CAACX,WAAD,CAAcb,OAAd,CAPM,CAAT,CASA,mBACE,KAAC,WAAD,wBACE,KAAC,IAAD,wBACE,KAAC,QAAD,wBACE,KAAC,kBAAD,EACE,QAAQ,CAAEqB,YADZ,CAEE,QAAQ,CAAEN,YAFZ,CAGE,WAAW,CAAEN,WAHf,EADF,EADF,EADF,EADF,CAaD,CAED,cAAeV,CAAAA,iBAAf","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Card, PageSection } from '@patternfly/react-core';\nimport { CardBody } from 'components/Card';\nimport useRequest from 'hooks/useRequest';\nimport { InventoriesAPI } from 'api';\nimport SmartInventoryForm from '../shared/SmartInventoryForm';\nimport parseHostFilter from '../shared/utils';\n\nfunction SmartInventoryAdd() {\n  const history = useHistory();\n\n  const {\n    error: submitError,\n    request: submitRequest,\n    result: inventoryId,\n  } = useRequest(\n    useCallback(async (values, groupsToAssociate) => {\n      const {\n        data: { id: invId },\n      } = await InventoriesAPI.create(values);\n\n      /* eslint-disable no-await-in-loop, no-restricted-syntax */\n      // Resolve Promises sequentially to maintain order and avoid race condition\n      for (const group of groupsToAssociate) {\n        await InventoriesAPI.associateInstanceGroup(invId, group.id);\n      }\n      /* eslint-enable no-await-in-loop, no-restricted-syntax */\n      return invId;\n    }, [])\n  );\n\n  const handleSubmit = async (form) => {\n    const modifiedForm = parseHostFilter(form);\n\n    const { instance_groups, organization, ...remainingForm } = modifiedForm;\n\n    await submitRequest(\n      {\n        organization: organization?.id,\n        ...remainingForm,\n      },\n      instance_groups\n    );\n  };\n\n  const handleCancel = () => {\n    history.push({\n      pathname: '/inventories',\n      search: '',\n    });\n  };\n\n  useEffect(() => {\n    if (inventoryId) {\n      history.push({\n        pathname: `/inventories/smart_inventory/${inventoryId}/details`,\n        search: '',\n      });\n    }\n  }, [inventoryId, history]);\n\n  return (\n    <PageSection>\n      <Card>\n        <CardBody>\n          <SmartInventoryForm\n            onCancel={handleCancel}\n            onSubmit={handleSubmit}\n            submitError={submitError}\n          />\n        </CardBody>\n      </Card>\n    </PageSection>\n  );\n}\n\nexport default SmartInventoryAdd;\n"]},"metadata":{},"sourceType":"module"}