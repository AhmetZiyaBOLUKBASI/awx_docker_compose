{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3;import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState,useEffect,useCallback}from'react';import{useHistory,useLocation}from'react-router-dom';import styled from'styled-components';import{SearchIcon}from'@patternfly/react-icons';import{Alert as PFAlert,Button,ButtonVariant,Chip,FormGroup,InputGroup,Modal,Tooltip}from'@patternfly/react-core';import{HostsAPI}from'api';import{getQSConfig,mergeParams,parseQueryString}from'util/qs';import getDocsBaseUrl from'util/getDocsBaseUrl';import{useConfig}from'contexts/Config';import useRequest,{useDismissableError}from'hooks/useRequest';import ChipGroup from'../ChipGroup';import Popover from'../Popover';import DataListToolbar from'../DataListToolbar';import LookupErrorMessage from'./shared/LookupErrorMessage';import PaginatedTable,{HeaderCell,HeaderRow,getSearchableKeys}from'../PaginatedTable';import HostListItem from'./HostListItem';import{removeDefaultParams,removeNamespacedKeys,toHostFilter,toQueryString,toSearchParams,modifyHostFilter}from'./shared/HostFilterUtils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Alert=styled(PFAlert)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  && {\\n    margin-bottom: 8px;\\n  }\\n\"])));var ChipHolder=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  && {\\n    --pf-c-form-control--Height: auto;\\n  }\\n  .pf-c-chip-group {\\n    margin-right: 8px;\\n  }\\n\"])));var ModalList=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  .pf-c-toolbar__content {\\n    padding: 0 !important;\\n  }\\n\"])));var useModal=function useModal(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isModalOpen=_useState2[0],setIsModalOpen=_useState2[1];function toggleModal(){setIsModalOpen(!isModalOpen);}function closeModal(){setIsModalOpen(false);}return{isModalOpen:isModalOpen,toggleModal:toggleModal,closeModal:closeModal};};var QS_CONFIG=getQSConfig('smart_hosts',{page:1,page_size:5,order_by:'name'},['id','page','page_size','inventory']);var buildSearchColumns=function buildSearchColumns(){return[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"ID\"),key:'id'},{name:/*i18n*/i18n._(\"Group\"),key:'groups__name__icontains'},{name:/*i18n*/i18n._(\"Inventory ID\"),key:'inventory'},{name:/*i18n*/i18n._(\"Enabled\"),key:'enabled',isBoolean:true},{name:/*i18n*/i18n._(\"Instance ID\"),key:'instance_id'},{name:/*i18n*/i18n._(\"Last job\"),key:'last_job'},{name:/*i18n*/i18n._(\"Insights system ID\"),key:'insights_system_id'}];};function HostFilterLookup(_ref){var helperTextInvalid=_ref.helperTextInvalid,isValid=_ref.isValid,isDisabled=_ref.isDisabled,onBlur=_ref.onBlur,onChange=_ref.onChange,organizationId=_ref.organizationId,value=_ref.value,enableNegativeFiltering=_ref.enableNegativeFiltering,enableRelatedFuzzyFiltering=_ref.enableRelatedFuzzyFiltering;var history=useHistory();var location=useLocation();var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),chips=_useState4[0],setChips=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),queryString=_useState6[0],setQueryString=_useState6[1];var _useModal=useModal(),isModalOpen=_useModal.isModalOpen,toggleModal=_useModal.toggleModal,closeModal=_useModal.closeModal;var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isAnsibleFactsSelected=_useState8[0],setIsAnsibleFactsSelected=_useState8[1];var searchColumns=buildSearchColumns();var config=useConfig();var parseRelatedSearchFields=function parseRelatedSearchFields(searchFields){if(searchFields.indexOf('__search')!==-1){return searchFields.slice(0,-8);}return searchFields;};var _useRequest=useRequest(useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(orgId){var params,_yield$Promise$all,_yield$Promise$all2,data,actions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,location.search);_context.next=3;return Promise.all([HostsAPI.read(mergeParams(params,{inventory__organization:orgId})),HostsAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);data=_yield$Promise$all2[0].data;actions=_yield$Promise$all2[1].data;return _context.abrupt(\"return\",{count:data.count,hosts:data.results,relatedSearchableKeys:((actions===null||actions===void 0?void 0:actions.related_search_fields)||[]).map(parseRelatedSearchFields),searchableKeys:getSearchableKeys(actions===null||actions===void 0?void 0:actions.actions.GET)});case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}(),[location.search]),{count:0,hosts:[],relatedSearchableKeys:[],searchableKeys:[]}),_useRequest$result=_useRequest.result,count=_useRequest$result.count,hosts=_useRequest$result.hosts,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,contentError=_useRequest.error,fetchHosts=_useRequest.request,isLoading=_useRequest.isLoading;var _useDismissableError=useDismissableError(contentError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;useEffect(function(){if(isModalOpen&&organizationId){dismissError();fetchHosts(organizationId);}},[fetchHosts,organizationId,isModalOpen]);// eslint-disable-line react-hooks/exhaustive-deps\nuseEffect(function(){var filters=toSearchParams(value);var modifiedFilters=modifyHostFilter(value,filters);setQueryString(toQueryString(QS_CONFIG,modifiedFilters));modifiedFilters=removeHostFilter(modifiedFilters);setChips(buildChips(modifiedFilters));},[value]);function qsToHostFilter(qs){var searchParams=toSearchParams(qs);var withoutNamespace=removeNamespacedKeys(QS_CONFIG,searchParams);var withoutDefaultParams=removeDefaultParams(QS_CONFIG,withoutNamespace);return toHostFilter(withoutDefaultParams);}var save=function save(){var hostFilterString=qsToHostFilter(location.search);onChange(hostFilterString);closeModal();history.replace({pathname:\"\".concat(location.pathname),search:''});};var removeHostFilter=function removeHostFilter(filter){if('host_filter'in filter){filter.ansible_facts=filter.host_filter.substring('ansible_facts__'.length);delete filter.host_filter;}return filter;};function buildChips(){var filter=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var inputGroupChips=Object.keys(filter).reduce(function(obj,param){var parsedKey=param.replace('or__','');var chipsArray=[];if(Array.isArray(filter[param])){filter[param].forEach(function(val){return chipsArray.push({key:\"\".concat(param,\":\").concat(val),node:\"\".concat(val)});});}else{chipsArray.push({key:\"\".concat(param,\":\").concat(filter[param]),node:\"\".concat(filter[param])});}obj[parsedKey]={key:parsedKey,label:filter[param],chips:[].concat(chipsArray)};return obj;},{});return inputGroupChips;}var handleOpenModal=function handleOpenModal(){history.replace({pathname:\"\".concat(location.pathname),search:queryString});fetchHosts(organizationId);toggleModal();};var handleClose=function handleClose(){closeModal();history.replace({pathname:\"\".concat(location.pathname),search:''});};var renderLookup=function renderLookup(){return/*#__PURE__*/_jsxs(InputGroup,{onBlur:onBlur,children:[/*#__PURE__*/_jsx(Button,{ouiaId:\"host-filter-search-button\",\"aria-label\":/*i18n*/i18n._(\"Search\"),id:\"host-filter\",isDisabled:isDisabled,onClick:handleOpenModal,variant:ButtonVariant.control,children:/*#__PURE__*/_jsx(SearchIcon,{})}),/*#__PURE__*/_jsxs(ChipHolder,{className:\"pf-c-form-control\",children:[searchColumns.map(function(_ref3){var _chips$key,_chips$key$chips,_chips$key2,_chips$key2$chips;var name=_ref3.name,key=_ref3.key;return/*#__PURE__*/_jsx(ChipGroup,{categoryName:name,numChips:5,totalChips:((_chips$key=chips[key])===null||_chips$key===void 0?void 0:(_chips$key$chips=_chips$key.chips)===null||_chips$key$chips===void 0?void 0:_chips$key$chips.length)||0,ouiaId:\"host-filter-search-chips\",children:(_chips$key2=chips[key])===null||_chips$key2===void 0?void 0:(_chips$key2$chips=_chips$key2.chips)===null||_chips$key2$chips===void 0?void 0:_chips$key2$chips.map(function(chip){return/*#__PURE__*/_jsx(Chip,{isReadOnly:true,children:chip.node},chip.key);})},name);}),Object.keys(chips).length>0&&Object.keys(chips).filter(function(val){return chips[val].chips.length>0;}).filter(function(val){return searchColumns.map(function(val2){return val2.key;}).indexOf(val)===-1;}).map(function(leftoverKey){var _chips$leftoverKey,_chips$leftoverKey$ch,_chips$leftoverKey2,_chips$leftoverKey2$c;return/*#__PURE__*/_jsx(ChipGroup,{categoryName:chips[leftoverKey].key,numChips:5,totalChips:((_chips$leftoverKey=chips[leftoverKey])===null||_chips$leftoverKey===void 0?void 0:(_chips$leftoverKey$ch=_chips$leftoverKey.chips)===null||_chips$leftoverKey$ch===void 0?void 0:_chips$leftoverKey$ch.length)||0,ouiaId:\"host-filter-advanced-search-chips\",children:(_chips$leftoverKey2=chips[leftoverKey])===null||_chips$leftoverKey2===void 0?void 0:(_chips$leftoverKey2$c=_chips$leftoverKey2.chips)===null||_chips$leftoverKey2$c===void 0?void 0:_chips$leftoverKey2$c.map(function(chip){return/*#__PURE__*/_jsx(Chip,{isReadOnly:true,children:chip.node},chip.key);})},chips[leftoverKey].key);})]})]});};return/*#__PURE__*/_jsxs(FormGroup,{fieldId:\"host-filter\",helperTextInvalid:helperTextInvalid,isRequired:true,label:/*i18n*/i18n._(\"Smart host filter\"),validated:isValid?'default':'error',labelIcon:/*#__PURE__*/_jsx(Popover,{content:/*i18n*/i18n._(\"Populate the hosts for this inventory by using a search\\nfilter. Example: ansible_facts__ansible_distribution:\\\"RedHat\\\".\\nRefer to the documentation for further syntax and\\nexamples.  Refer to the Ansible Controller documentation for further syntax and\\nexamples.\")}),children:[isDisabled?/*#__PURE__*/_jsx(Tooltip,{content:/*i18n*/i18n._(\"Please select an organization before editing the host filter\"),children:renderLookup()}):renderLookup(),/*#__PURE__*/_jsx(Modal,{\"aria-label\":/*i18n*/i18n._(\"Lookup modal\"),isOpen:isModalOpen,onClose:handleClose,title:/*i18n*/i18n._(\"Perform a search to define a host filter\"),variant:\"large\",actions:[/*#__PURE__*/_jsx(Button,{ouiaId:\"host-filter-modal-select-button\",isDisabled:!location.search,onClick:save,variant:\"primary\",children:/*i18n*/i18n._(\"Select\")},\"select\"),/*#__PURE__*/_jsx(Button,{ouiaId:\"host-filter-modal-cancel-button\",variant:\"link\",onClick:handleClose,children:/*i18n*/i18n._(\"Cancel\")},\"cancel\")],children:/*#__PURE__*/_jsxs(ModalList,{children:[isAnsibleFactsSelected&&/*#__PURE__*/_jsx(Alert,{variant:\"info\",title:/*#__PURE__*/_jsxs(_Fragment,{children:[/*i18n*/i18n._(\"Searching by ansible_facts requires special syntax. Refer to the\"),' ',/*#__PURE__*/_jsx(\"a\",{href:\"\".concat(getDocsBaseUrl(config),\"/html/userguide/inventories.html#smart-host-filter\"),target:\"_blank\",rel:\"noopener noreferrer\",children:/*i18n*/i18n._(\"documentation\")}),' ',/*i18n*/i18n._(\"for more info.\")]})}),/*#__PURE__*/_jsx(PaginatedTable,{contentError:error,hasContentLoading:isLoading,itemCount:count,items:hosts,pluralizedItemName:/*i18n*/i18n._(\"hosts\"),qsConfig:QS_CONFIG,headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,isSelectable:false,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"description\",children:/*i18n*/i18n._(\"Description\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Inventory\")})]}),renderRow:function renderRow(item){return/*#__PURE__*/_jsx(HostListItem,{item:item},item.id);},renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{fillWidth:true,enableNegativeFiltering:enableNegativeFiltering,enableRelatedFuzzyFiltering:enableRelatedFuzzyFiltering,handleIsAnsibleFactsSelected:setIsAnsibleFactsSelected}));},toolbarSearchColumns:searchColumns,toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys})]})}),/*#__PURE__*/_jsx(LookupErrorMessage,{error:error})]});}HostFilterLookup.defaultProps={isValid:true,onBlur:function onBlur(){},onChange:function onChange(){},organizationId:null,value:'',enableNegativeFiltering:true,enableRelatedFuzzyFiltering:true};export default HostFilterLookup;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/Lookup/HostFilterLookup.js"],"names":["React","useState","useEffect","useCallback","useHistory","useLocation","styled","SearchIcon","Alert","PFAlert","Button","ButtonVariant","Chip","FormGroup","InputGroup","Modal","Tooltip","HostsAPI","getQSConfig","mergeParams","parseQueryString","getDocsBaseUrl","useConfig","useRequest","useDismissableError","ChipGroup","Popover","DataListToolbar","LookupErrorMessage","PaginatedTable","HeaderCell","HeaderRow","getSearchableKeys","HostListItem","removeDefaultParams","removeNamespacedKeys","toHostFilter","toQueryString","toSearchParams","modifyHostFilter","ChipHolder","div","ModalList","useModal","isModalOpen","setIsModalOpen","toggleModal","closeModal","QS_CONFIG","page","page_size","order_by","buildSearchColumns","name","key","isDefault","isBoolean","HostFilterLookup","helperTextInvalid","isValid","isDisabled","onBlur","onChange","organizationId","value","enableNegativeFiltering","enableRelatedFuzzyFiltering","history","location","chips","setChips","queryString","setQueryString","isAnsibleFactsSelected","setIsAnsibleFactsSelected","searchColumns","config","parseRelatedSearchFields","searchFields","indexOf","slice","orgId","params","search","Promise","all","read","inventory__organization","readOptions","data","actions","count","hosts","results","relatedSearchableKeys","related_search_fields","map","searchableKeys","GET","result","contentError","error","fetchHosts","request","isLoading","dismissError","filters","modifiedFilters","removeHostFilter","buildChips","qsToHostFilter","qs","searchParams","withoutNamespace","withoutDefaultParams","save","hostFilterString","replace","pathname","filter","ansible_facts","host_filter","substring","length","inputGroupChips","Object","keys","reduce","obj","param","parsedKey","chipsArray","Array","isArray","forEach","val","push","node","label","handleOpenModal","handleClose","renderLookup","control","chip","val2","leftoverKey","item","id","props","defaultProps"],"mappings":"0mBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAqCC,WAArC,KAAwD,OAAxD,CACA,OAASC,UAAT,CAAqBC,WAArB,KAAwC,kBAAxC,CAGA,MAAOC,CAAAA,MAAP,KAAmB,mBAAnB,CAEA,OAASC,UAAT,KAA2B,yBAA3B,CACA,OACEC,KAAK,GAAIC,CAAAA,OADX,CAEEC,MAFF,CAGEC,aAHF,CAIEC,IAJF,CAKEC,SALF,CAMEC,UANF,CAOEC,KAPF,CAQEC,OARF,KASO,wBATP,CAUA,OAASC,QAAT,KAAyB,KAAzB,CACA,OAASC,WAAT,CAAsBC,WAAtB,CAAmCC,gBAAnC,KAA2D,SAA3D,CACA,MAAOC,CAAAA,cAAP,KAA2B,qBAA3B,CACA,OAASC,SAAT,KAA0B,iBAA1B,CACA,MAAOC,CAAAA,UAAP,EAAqBC,mBAArB,KAAgD,kBAAhD,CACA,MAAOC,CAAAA,SAAP,KAAsB,cAAtB,CACA,MAAOC,CAAAA,OAAP,KAAoB,YAApB,CACA,MAAOC,CAAAA,eAAP,KAA4B,oBAA5B,CACA,MAAOC,CAAAA,kBAAP,KAA+B,6BAA/B,CACA,MAAOC,CAAAA,cAAP,EACEC,UADF,CAEEC,SAFF,CAGEC,iBAHF,KAIO,mBAJP,CAKA,MAAOC,CAAAA,YAAP,KAAyB,gBAAzB,CACA,OACEC,mBADF,CAEEC,oBAFF,CAGEC,YAHF,CAIEC,aAJF,CAKEC,cALF,CAMEC,gBANF,KAOO,0BAPP,C,6IASA,GAAM/B,CAAAA,KAAK,CAAGF,MAAM,CAACG,OAAD,CAAT,yGAAX,CAMA,GAAM+B,CAAAA,UAAU,CAAGlC,MAAM,CAACmC,GAAV,6KAAhB,CASA,GAAMC,CAAAA,SAAS,CAAGpC,MAAM,CAACmC,GAAV,kIAAf,CAMA,GAAME,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,EAAM,CACrB,cAAsC1C,QAAQ,CAAC,KAAD,CAA9C,wCAAO2C,WAAP,eAAoBC,cAApB,eAEA,QAASC,CAAAA,WAAT,EAAuB,CACrBD,cAAc,CAAC,CAACD,WAAF,CAAd,CACD,CAED,QAASG,CAAAA,UAAT,EAAsB,CACpBF,cAAc,CAAC,KAAD,CAAd,CACD,CAED,MAAO,CACLD,WAAW,CAAXA,WADK,CAELE,WAAW,CAAXA,WAFK,CAGLC,UAAU,CAAVA,UAHK,CAAP,CAKD,CAhBD,CAkBA,GAAMC,CAAAA,SAAS,CAAG9B,WAAW,CAC3B,aAD2B,CAE3B,CACE+B,IAAI,CAAE,CADR,CAEEC,SAAS,CAAE,CAFb,CAGEC,QAAQ,CAAE,MAHZ,CAF2B,CAO3B,CAAC,IAAD,CAAO,MAAP,CAAe,WAAf,CAA4B,WAA5B,CAP2B,CAA7B,CAUA,GAAMC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,SAAM,CAC/B,CACEC,IAAI,SAAE,cADR,CAEEC,GAAG,CAAE,iBAFP,CAGEC,SAAS,CAAE,IAHb,CAD+B,CAM/B,CACEF,IAAI,SAAE,YADR,CAEEC,GAAG,CAAE,IAFP,CAN+B,CAU/B,CACED,IAAI,SAAE,eADR,CAEEC,GAAG,CAAE,yBAFP,CAV+B,CAc/B,CACED,IAAI,SAAE,sBADR,CAEEC,GAAG,CAAE,WAFP,CAd+B,CAkB/B,CACED,IAAI,SAAE,iBADR,CAEEC,GAAG,CAAE,SAFP,CAGEE,SAAS,CAAE,IAHb,CAlB+B,CAuB/B,CACEH,IAAI,SAAE,qBADR,CAEEC,GAAG,CAAE,aAFP,CAvB+B,CA2B/B,CACED,IAAI,SAAE,kBADR,CAEEC,GAAG,CAAE,UAFP,CA3B+B,CA+B/B,CACED,IAAI,SAAE,4BADR,CAEEC,GAAG,CAAE,oBAFP,CA/B+B,CAAN,EAA3B,CAqCA,QAASG,CAAAA,gBAAT,MAUG,IATDC,CAAAA,iBASC,MATDA,iBASC,CARDC,OAQC,MARDA,OAQC,CAPDC,UAOC,MAPDA,UAOC,CANDC,MAMC,MANDA,MAMC,CALDC,QAKC,MALDA,QAKC,CAJDC,cAIC,MAJDA,cAIC,CAHDC,KAGC,MAHDA,KAGC,CAFDC,uBAEC,MAFDA,uBAEC,CADDC,2BACC,MADDA,2BACC,CACD,GAAMC,CAAAA,OAAO,CAAG/D,UAAU,EAA1B,CACA,GAAMgE,CAAAA,QAAQ,CAAG/D,WAAW,EAA5B,CACA,eAA0BJ,QAAQ,CAAC,EAAD,CAAlC,yCAAOoE,KAAP,eAAcC,QAAd,eACA,eAAsCrE,QAAQ,CAAC,EAAD,CAA9C,yCAAOsE,WAAP,eAAoBC,cAApB,eACA,cAAiD7B,QAAQ,EAAzD,CAAQC,WAAR,WAAQA,WAAR,CAAqBE,WAArB,WAAqBA,WAArB,CAAkCC,UAAlC,WAAkCA,UAAlC,CACA,eAA4D9C,QAAQ,CAAC,KAAD,CAApE,yCAAOwE,sBAAP,eAA+BC,yBAA/B,eAEA,GAAMC,CAAAA,aAAa,CAAGvB,kBAAkB,EAAxC,CACA,GAAMwB,CAAAA,MAAM,CAAGtD,SAAS,EAAxB,CAEA,GAAMuD,CAAAA,wBAAwB,CAAG,QAA3BA,CAAAA,wBAA2B,CAACC,YAAD,CAAkB,CACjD,GAAIA,YAAY,CAACC,OAAb,CAAqB,UAArB,IAAqC,CAAC,CAA1C,CAA6C,CAC3C,MAAOD,CAAAA,YAAY,CAACE,KAAb,CAAmB,CAAnB,CAAsB,CAAC,CAAvB,CAAP,CACD,CACD,MAAOF,CAAAA,YAAP,CACD,CALD,CAOA,gBAKIvD,UAAU,CACZpB,WAAW,2FACT,iBAAO8E,KAAP,iLACQC,MADR,CACiB9D,gBAAgB,CAAC4B,SAAD,CAAYoB,QAAQ,CAACe,MAArB,CADjC,uBAE8CC,CAAAA,OAAO,CAACC,GAAR,CAAY,CACtDpE,QAAQ,CAACqE,IAAT,CACEnE,WAAW,CAAC+D,MAAD,CAAS,CAAEK,uBAAuB,CAAEN,KAA3B,CAAT,CADb,CADsD,CAItDhE,QAAQ,CAACuE,WAAT,EAJsD,CAAZ,CAF9C,kGAEWC,IAFX,wBAEWA,IAFX,CAE2BC,OAF3B,wBAEqBD,IAFrB,iCAQS,CACLE,KAAK,CAAEF,IAAI,CAACE,KADP,CAELC,KAAK,CAAEH,IAAI,CAACI,OAFP,CAGLC,qBAAqB,CAAE,CAAC,CAAAJ,OAAO,OAAP,EAAAA,OAAO,SAAP,QAAAA,OAAO,CAAEK,qBAAT,GAAkC,EAAnC,EAAuCC,GAAvC,CACrBnB,wBADqB,CAHlB,CAMLoB,cAAc,CAAEjE,iBAAiB,CAAC0D,OAAD,SAACA,OAAD,iBAACA,OAAO,CAAEA,OAAT,CAAiBQ,GAAlB,CAN5B,CART,wDADS,gEAkBT,CAAC9B,QAAQ,CAACe,MAAV,CAlBS,CADC,CAqBZ,CACEQ,KAAK,CAAE,CADT,CAEEC,KAAK,CAAE,EAFT,CAGEE,qBAAqB,CAAE,EAHzB,CAIEG,cAAc,CAAE,EAJlB,CArBY,CALd,gCACEE,MADF,CACYR,KADZ,oBACYA,KADZ,CACmBC,KADnB,oBACmBA,KADnB,CAC0BE,qBAD1B,oBAC0BA,qBAD1B,CACiDG,cADjD,oBACiDA,cADjD,CAESG,YAFT,aAEEC,KAFF,CAGWC,UAHX,aAGEC,OAHF,CAIEC,SAJF,aAIEA,SAJF,CAkCA,yBAAgChF,mBAAmB,CAAC4E,YAAD,CAAnD,CAAQC,KAAR,sBAAQA,KAAR,CAAeI,YAAf,sBAAeA,YAAf,CAEAvG,SAAS,CAAC,UAAM,CACd,GAAI0C,WAAW,EAAImB,cAAnB,CAAmC,CACjC0C,YAAY,GACZH,UAAU,CAACvC,cAAD,CAAV,CACD,CACF,CALQ,CAKN,CAACuC,UAAD,CAAavC,cAAb,CAA6BnB,WAA7B,CALM,CAAT,CAK+C;AAE/C1C,SAAS,CAAC,UAAM,CACd,GAAMwG,CAAAA,OAAO,CAAGpE,cAAc,CAAC0B,KAAD,CAA9B,CACA,GAAI2C,CAAAA,eAAe,CAAGpE,gBAAgB,CAACyB,KAAD,CAAQ0C,OAAR,CAAtC,CACAlC,cAAc,CAACnC,aAAa,CAACW,SAAD,CAAY2D,eAAZ,CAAd,CAAd,CACAA,eAAe,CAAGC,gBAAgB,CAACD,eAAD,CAAlC,CACArC,QAAQ,CAACuC,UAAU,CAACF,eAAD,CAAX,CAAR,CACD,CANQ,CAMN,CAAC3C,KAAD,CANM,CAAT,CAQA,QAAS8C,CAAAA,cAAT,CAAwBC,EAAxB,CAA4B,CAC1B,GAAMC,CAAAA,YAAY,CAAG1E,cAAc,CAACyE,EAAD,CAAnC,CACA,GAAME,CAAAA,gBAAgB,CAAG9E,oBAAoB,CAACa,SAAD,CAAYgE,YAAZ,CAA7C,CACA,GAAME,CAAAA,oBAAoB,CAAGhF,mBAAmB,CAC9Cc,SAD8C,CAE9CiE,gBAF8C,CAAhD,CAIA,MAAO7E,CAAAA,YAAY,CAAC8E,oBAAD,CAAnB,CACD,CAED,GAAMC,CAAAA,IAAI,CAAG,QAAPA,CAAAA,IAAO,EAAM,CACjB,GAAMC,CAAAA,gBAAgB,CAAGN,cAAc,CAAC1C,QAAQ,CAACe,MAAV,CAAvC,CACArB,QAAQ,CAACsD,gBAAD,CAAR,CACArE,UAAU,GACVoB,OAAO,CAACkD,OAAR,CAAgB,CACdC,QAAQ,WAAKlD,QAAQ,CAACkD,QAAd,CADM,CAEdnC,MAAM,CAAE,EAFM,CAAhB,EAID,CARD,CAUA,GAAMyB,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACW,MAAD,CAAY,CACnC,GAAI,eAAiBA,CAAAA,MAArB,CAA6B,CAC3BA,MAAM,CAACC,aAAP,CAAuBD,MAAM,CAACE,WAAP,CAAmBC,SAAnB,CACrB,kBAAkBC,MADG,CAAvB,CAGA,MAAOJ,CAAAA,MAAM,CAACE,WAAd,CACD,CAED,MAAOF,CAAAA,MAAP,CACD,CATD,CAWA,QAASV,CAAAA,UAAT,EAAiC,IAAbU,CAAAA,MAAa,2DAAJ,EAAI,CAC/B,GAAMK,CAAAA,eAAe,CAAGC,MAAM,CAACC,IAAP,CAAYP,MAAZ,EAAoBQ,MAApB,CAA2B,SAACC,GAAD,CAAMC,KAAN,CAAgB,CACjE,GAAMC,CAAAA,SAAS,CAAGD,KAAK,CAACZ,OAAN,CAAc,MAAd,CAAsB,EAAtB,CAAlB,CACA,GAAMc,CAAAA,UAAU,CAAG,EAAnB,CAEA,GAAIC,KAAK,CAACC,OAAN,CAAcd,MAAM,CAACU,KAAD,CAApB,CAAJ,CAAkC,CAChCV,MAAM,CAACU,KAAD,CAAN,CAAcK,OAAd,CAAsB,SAACC,GAAD,QACpBJ,CAAAA,UAAU,CAACK,IAAX,CAAgB,CACdlF,GAAG,WAAK2E,KAAL,aAAcM,GAAd,CADW,CAEdE,IAAI,WAAKF,GAAL,CAFU,CAAhB,CADoB,EAAtB,EAMD,CAPD,IAOO,CACLJ,UAAU,CAACK,IAAX,CAAgB,CACdlF,GAAG,WAAK2E,KAAL,aAAcV,MAAM,CAACU,KAAD,CAApB,CADW,CAEdQ,IAAI,WAAKlB,MAAM,CAACU,KAAD,CAAX,CAFU,CAAhB,EAID,CAEDD,GAAG,CAACE,SAAD,CAAH,CAAiB,CACf5E,GAAG,CAAE4E,SADU,CAEfQ,KAAK,CAAEnB,MAAM,CAACU,KAAD,CAFE,CAGf5D,KAAK,WAAM8D,UAAN,CAHU,CAAjB,CAMA,MAAOH,CAAAA,GAAP,CACD,CAzBuB,CAyBrB,EAzBqB,CAAxB,CA2BA,MAAOJ,CAAAA,eAAP,CACD,CAED,GAAMe,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,EAAM,CAC5BxE,OAAO,CAACkD,OAAR,CAAgB,CACdC,QAAQ,WAAKlD,QAAQ,CAACkD,QAAd,CADM,CAEdnC,MAAM,CAAEZ,WAFM,CAAhB,EAIA+B,UAAU,CAACvC,cAAD,CAAV,CACAjB,WAAW,GACZ,CAPD,CASA,GAAM8F,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CACxB7F,UAAU,GACVoB,OAAO,CAACkD,OAAR,CAAgB,CACdC,QAAQ,WAAKlD,QAAQ,CAACkD,QAAd,CADM,CAEdnC,MAAM,CAAE,EAFM,CAAhB,EAID,CAND,CAQA,GAAM0D,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,sBACnB,MAAC,UAAD,EAAY,MAAM,CAAEhF,MAApB,wBACE,KAAC,MAAD,EACE,MAAM,CAAC,2BADT,CAEE,qBAAY,gBAFd,CAGE,EAAE,CAAC,aAHL,CAIE,UAAU,CAAED,UAJd,CAKE,OAAO,CAAE+E,eALX,CAME,OAAO,CAAEhI,aAAa,CAACmI,OANzB,uBAQE,KAAC,UAAD,IARF,EADF,cAWE,MAAC,UAAD,EAAY,SAAS,CAAC,mBAAtB,WACGnE,aAAa,CAACqB,GAAd,CAAkB,iFAAG3C,CAAAA,IAAH,OAAGA,IAAH,CAASC,GAAT,OAASA,GAAT,oBACjB,KAAC,SAAD,EACE,YAAY,CAAED,IADhB,CAGE,QAAQ,CAAE,CAHZ,CAIE,UAAU,CAAE,aAAAgB,KAAK,CAACf,GAAD,CAAL,kEAAYe,KAAZ,4DAAmBsD,MAAnB,GAA6B,CAJ3C,CAKE,MAAM,CAAC,0BALT,uBAOGtD,KAAK,CAACf,GAAD,CAPR,yDAOG,YAAYe,KAPf,4CAOG,kBAAmB2B,GAAnB,CAAuB,SAAC+C,IAAD,qBACtB,KAAC,IAAD,EAAqB,UAAU,KAA/B,UACGA,IAAI,CAACN,IADR,EAAWM,IAAI,CAACzF,GAAhB,CADsB,EAAvB,CAPH,EAEOD,IAFP,CADiB,EAAlB,CADH,CAiBGwE,MAAM,CAACC,IAAP,CAAYzD,KAAZ,EAAmBsD,MAAnB,CAA4B,CAA5B,EACCE,MAAM,CAACC,IAAP,CAAYzD,KAAZ,EACGkD,MADH,CACU,SAACgB,GAAD,QAASlE,CAAAA,KAAK,CAACkE,GAAD,CAAL,CAAWlE,KAAX,CAAiBsD,MAAjB,CAA0B,CAAnC,EADV,EAEGJ,MAFH,CAGI,SAACgB,GAAD,QAAS5D,CAAAA,aAAa,CAACqB,GAAd,CAAkB,SAACgD,IAAD,QAAUA,CAAAA,IAAI,CAAC1F,GAAf,EAAlB,EAAsCyB,OAAtC,CAA8CwD,GAA9C,IAAuD,CAAC,CAAjE,EAHJ,EAKGvC,GALH,CAKO,SAACiD,WAAD,4GACH,KAAC,SAAD,EACE,YAAY,CAAE5E,KAAK,CAAC4E,WAAD,CAAL,CAAmB3F,GADnC,CAGE,QAAQ,CAAE,CAHZ,CAIE,UAAU,CAAE,qBAAAe,KAAK,CAAC4E,WAAD,CAAL,uFAAoB5E,KAApB,sEAA2BsD,MAA3B,GAAqC,CAJnD,CAKE,MAAM,CAAC,mCALT,+BAOGtD,KAAK,CAAC4E,WAAD,CAPR,qEAOG,oBAAoB5E,KAPvB,gDAOG,sBAA2B2B,GAA3B,CAA+B,SAAC+C,IAAD,qBAC9B,KAAC,IAAD,EAAqB,UAAU,KAA/B,UACGA,IAAI,CAACN,IADR,EAAWM,IAAI,CAACzF,GAAhB,CAD8B,EAA/B,CAPH,EAEOe,KAAK,CAAC4E,WAAD,CAAL,CAAmB3F,GAF1B,CADG,EALP,CAlBJ,GAXF,GADmB,EAArB,CAsDA,mBACE,MAAC,SAAD,EACE,OAAO,CAAC,aADV,CAEE,iBAAiB,CAAEI,iBAFrB,CAGE,UAAU,KAHZ,CAIE,KAAK,SAAE,2BAJT,CAKE,SAAS,CAAEC,OAAO,CAAG,SAAH,CAAe,OALnC,CAME,SAAS,cACP,KAAC,OAAD,EACE,OAAO,SAAE,kRADX,EAPJ,WAgBGC,UAAU,cACT,KAAC,OAAD,EACE,OAAO,SAAE,sEADX,UAGGiF,YAAY,EAHf,EADS,CAOTA,YAAY,EAvBhB,cAyBE,KAAC,KAAD,EACE,qBAAY,sBADd,CAEE,MAAM,CAAEjG,WAFV,CAGE,OAAO,CAAEgG,WAHX,CAIE,KAAK,SAAE,kDAJT,CAKE,OAAO,CAAC,OALV,CAME,OAAO,CAAE,cACP,KAAC,MAAD,EACE,MAAM,CAAC,iCADT,CAEE,UAAU,CAAE,CAACxE,QAAQ,CAACe,MAFxB,CAIE,OAAO,CAAEgC,IAJX,CAKE,OAAO,CAAC,SALV,kBAOG,gBAPH,EAGM,QAHN,CADO,cAUP,KAAC,MAAD,EACE,MAAM,CAAC,iCADT,CAGE,OAAO,CAAC,MAHV,CAIE,OAAO,CAAEyB,WAJX,kBAMG,gBANH,EAEM,QAFN,CAVO,CANX,uBA0BE,MAAC,SAAD,YACGnE,sBAAsB,eACrB,KAAC,KAAD,EACE,OAAO,CAAC,MADV,CAEE,KAAK,cACH,mCACG,0EADH,CACwE,GADxE,cAEE,UACE,IAAI,WAAKpD,cAAc,CACrBuD,MADqB,CAAnB,sDADN,CAIE,MAAM,CAAC,QAJT,CAKE,GAAG,CAAC,qBALN,kBAOG,uBAPH,EAFF,CAUO,GAVP,SAWG,wBAXH,GAHJ,EAFJ,cAqBE,KAAC,cAAD,EACE,YAAY,CAAEyB,KADhB,CAEE,iBAAiB,CAAEG,SAFrB,CAGE,SAAS,CAAEb,KAHb,CAIE,KAAK,CAAEC,KAJT,CAKE,kBAAkB,SAAE,eALtB,CAME,QAAQ,CAAE5C,SANZ,CAOE,SAAS,cACP,MAAC,SAAD,EAAW,QAAQ,CAAEA,SAArB,CAAgC,YAAY,CAAE,KAA9C,wBACE,KAAC,UAAD,EAAY,OAAO,CAAC,MAApB,kBAA4B,cAA5B,EADF,cAEE,KAAC,UAAD,EAAY,OAAO,CAAC,aAApB,kBAAmC,qBAAnC,EAFF,cAGE,KAAC,UAAD,mBAAa,mBAAb,EAHF,GARJ,CAcE,SAAS,CAAE,mBAACkG,IAAD,qBAAU,KAAC,YAAD,EAA4B,IAAI,CAAEA,IAAlC,EAAmBA,IAAI,CAACC,EAAxB,CAAV,EAdb,CAeE,aAAa,CAAE,uBAACC,KAAD,qBACb,KAAC,eAAD,gCACMA,KADN,MAEE,SAAS,KAFX,CAGE,uBAAuB,CAAEnF,uBAH3B,CAIE,2BAA2B,CAAEC,2BAJ/B,CAKE,4BAA4B,CAAEQ,yBALhC,GADa,EAfjB,CAwBE,oBAAoB,CAAEC,aAxBxB,CAyBE,qBAAqB,CAAEsB,cAzBzB,CA0BE,4BAA4B,CAAEH,qBA1BhC,EArBF,GA1BF,EAzBF,cAsGE,KAAC,kBAAD,EAAoB,KAAK,CAAEO,KAA3B,EAtGF,GADF,CA0GD,CAWD5C,gBAAgB,CAAC4F,YAAjB,CAAgC,CAC9B1F,OAAO,CAAE,IADqB,CAE9BE,MAAM,CAAE,iBAAM,CAAE,CAFc,CAG9BC,QAAQ,CAAE,mBAAM,CAAE,CAHY,CAI9BC,cAAc,CAAE,IAJc,CAK9BC,KAAK,CAAE,EALuB,CAM9BC,uBAAuB,CAAE,IANK,CAO9BC,2BAA2B,CAAE,IAPC,CAAhC,CAUA,cAAeT,CAAAA,gBAAf","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport { number, func, bool, string } from 'prop-types';\n\nimport styled from 'styled-components';\nimport { t } from '@lingui/macro';\nimport { SearchIcon } from '@patternfly/react-icons';\nimport {\n  Alert as PFAlert,\n  Button,\n  ButtonVariant,\n  Chip,\n  FormGroup,\n  InputGroup,\n  Modal,\n  Tooltip,\n} from '@patternfly/react-core';\nimport { HostsAPI } from 'api';\nimport { getQSConfig, mergeParams, parseQueryString } from 'util/qs';\nimport getDocsBaseUrl from 'util/getDocsBaseUrl';\nimport { useConfig } from 'contexts/Config';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport ChipGroup from '../ChipGroup';\nimport Popover from '../Popover';\nimport DataListToolbar from '../DataListToolbar';\nimport LookupErrorMessage from './shared/LookupErrorMessage';\nimport PaginatedTable, {\n  HeaderCell,\n  HeaderRow,\n  getSearchableKeys,\n} from '../PaginatedTable';\nimport HostListItem from './HostListItem';\nimport {\n  removeDefaultParams,\n  removeNamespacedKeys,\n  toHostFilter,\n  toQueryString,\n  toSearchParams,\n  modifyHostFilter,\n} from './shared/HostFilterUtils';\n\nconst Alert = styled(PFAlert)`\n  && {\n    margin-bottom: 8px;\n  }\n`;\n\nconst ChipHolder = styled.div`\n  && {\n    --pf-c-form-control--Height: auto;\n  }\n  .pf-c-chip-group {\n    margin-right: 8px;\n  }\n`;\n\nconst ModalList = styled.div`\n  .pf-c-toolbar__content {\n    padding: 0 !important;\n  }\n`;\n\nconst useModal = () => {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  function toggleModal() {\n    setIsModalOpen(!isModalOpen);\n  }\n\n  function closeModal() {\n    setIsModalOpen(false);\n  }\n\n  return {\n    isModalOpen,\n    toggleModal,\n    closeModal,\n  };\n};\n\nconst QS_CONFIG = getQSConfig(\n  'smart_hosts',\n  {\n    page: 1,\n    page_size: 5,\n    order_by: 'name',\n  },\n  ['id', 'page', 'page_size', 'inventory']\n);\n\nconst buildSearchColumns = () => [\n  {\n    name: t`Name`,\n    key: 'name__icontains',\n    isDefault: true,\n  },\n  {\n    name: t`ID`,\n    key: 'id',\n  },\n  {\n    name: t`Group`,\n    key: 'groups__name__icontains',\n  },\n  {\n    name: t`Inventory ID`,\n    key: 'inventory',\n  },\n  {\n    name: t`Enabled`,\n    key: 'enabled',\n    isBoolean: true,\n  },\n  {\n    name: t`Instance ID`,\n    key: 'instance_id',\n  },\n  {\n    name: t`Last job`,\n    key: 'last_job',\n  },\n  {\n    name: t`Insights system ID`,\n    key: 'insights_system_id',\n  },\n];\n\nfunction HostFilterLookup({\n  helperTextInvalid,\n  isValid,\n  isDisabled,\n  onBlur,\n  onChange,\n  organizationId,\n  value,\n  enableNegativeFiltering,\n  enableRelatedFuzzyFiltering,\n}) {\n  const history = useHistory();\n  const location = useLocation();\n  const [chips, setChips] = useState({});\n  const [queryString, setQueryString] = useState('');\n  const { isModalOpen, toggleModal, closeModal } = useModal();\n  const [isAnsibleFactsSelected, setIsAnsibleFactsSelected] = useState(false);\n\n  const searchColumns = buildSearchColumns();\n  const config = useConfig();\n\n  const parseRelatedSearchFields = (searchFields) => {\n    if (searchFields.indexOf('__search') !== -1) {\n      return searchFields.slice(0, -8);\n    }\n    return searchFields;\n  };\n\n  const {\n    result: { count, hosts, relatedSearchableKeys, searchableKeys },\n    error: contentError,\n    request: fetchHosts,\n    isLoading,\n  } = useRequest(\n    useCallback(\n      async (orgId) => {\n        const params = parseQueryString(QS_CONFIG, location.search);\n        const [{ data }, { data: actions }] = await Promise.all([\n          HostsAPI.read(\n            mergeParams(params, { inventory__organization: orgId })\n          ),\n          HostsAPI.readOptions(),\n        ]);\n        return {\n          count: data.count,\n          hosts: data.results,\n          relatedSearchableKeys: (actions?.related_search_fields || []).map(\n            parseRelatedSearchFields\n          ),\n          searchableKeys: getSearchableKeys(actions?.actions.GET),\n        };\n      },\n      [location.search]\n    ),\n    {\n      count: 0,\n      hosts: [],\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  const { error, dismissError } = useDismissableError(contentError);\n\n  useEffect(() => {\n    if (isModalOpen && organizationId) {\n      dismissError();\n      fetchHosts(organizationId);\n    }\n  }, [fetchHosts, organizationId, isModalOpen]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(() => {\n    const filters = toSearchParams(value);\n    let modifiedFilters = modifyHostFilter(value, filters);\n    setQueryString(toQueryString(QS_CONFIG, modifiedFilters));\n    modifiedFilters = removeHostFilter(modifiedFilters);\n    setChips(buildChips(modifiedFilters));\n  }, [value]);\n\n  function qsToHostFilter(qs) {\n    const searchParams = toSearchParams(qs);\n    const withoutNamespace = removeNamespacedKeys(QS_CONFIG, searchParams);\n    const withoutDefaultParams = removeDefaultParams(\n      QS_CONFIG,\n      withoutNamespace\n    );\n    return toHostFilter(withoutDefaultParams);\n  }\n\n  const save = () => {\n    const hostFilterString = qsToHostFilter(location.search);\n    onChange(hostFilterString);\n    closeModal();\n    history.replace({\n      pathname: `${location.pathname}`,\n      search: '',\n    });\n  };\n\n  const removeHostFilter = (filter) => {\n    if ('host_filter' in filter) {\n      filter.ansible_facts = filter.host_filter.substring(\n        'ansible_facts__'.length\n      );\n      delete filter.host_filter;\n    }\n\n    return filter;\n  };\n\n  function buildChips(filter = {}) {\n    const inputGroupChips = Object.keys(filter).reduce((obj, param) => {\n      const parsedKey = param.replace('or__', '');\n      const chipsArray = [];\n\n      if (Array.isArray(filter[param])) {\n        filter[param].forEach((val) =>\n          chipsArray.push({\n            key: `${param}:${val}`,\n            node: `${val}`,\n          })\n        );\n      } else {\n        chipsArray.push({\n          key: `${param}:${filter[param]}`,\n          node: `${filter[param]}`,\n        });\n      }\n\n      obj[parsedKey] = {\n        key: parsedKey,\n        label: filter[param],\n        chips: [...chipsArray],\n      };\n\n      return obj;\n    }, {});\n\n    return inputGroupChips;\n  }\n\n  const handleOpenModal = () => {\n    history.replace({\n      pathname: `${location.pathname}`,\n      search: queryString,\n    });\n    fetchHosts(organizationId);\n    toggleModal();\n  };\n\n  const handleClose = () => {\n    closeModal();\n    history.replace({\n      pathname: `${location.pathname}`,\n      search: '',\n    });\n  };\n\n  const renderLookup = () => (\n    <InputGroup onBlur={onBlur}>\n      <Button\n        ouiaId=\"host-filter-search-button\"\n        aria-label={t`Search`}\n        id=\"host-filter\"\n        isDisabled={isDisabled}\n        onClick={handleOpenModal}\n        variant={ButtonVariant.control}\n      >\n        <SearchIcon />\n      </Button>\n      <ChipHolder className=\"pf-c-form-control\">\n        {searchColumns.map(({ name, key }) => (\n          <ChipGroup\n            categoryName={name}\n            key={name}\n            numChips={5}\n            totalChips={chips[key]?.chips?.length || 0}\n            ouiaId=\"host-filter-search-chips\"\n          >\n            {chips[key]?.chips?.map((chip) => (\n              <Chip key={chip.key} isReadOnly>\n                {chip.node}\n              </Chip>\n            ))}\n          </ChipGroup>\n        ))}\n        {/* Parse advanced search chips */}\n        {Object.keys(chips).length > 0 &&\n          Object.keys(chips)\n            .filter((val) => chips[val].chips.length > 0)\n            .filter(\n              (val) => searchColumns.map((val2) => val2.key).indexOf(val) === -1\n            )\n            .map((leftoverKey) => (\n              <ChipGroup\n                categoryName={chips[leftoverKey].key}\n                key={chips[leftoverKey].key}\n                numChips={5}\n                totalChips={chips[leftoverKey]?.chips?.length || 0}\n                ouiaId=\"host-filter-advanced-search-chips\"\n              >\n                {chips[leftoverKey]?.chips?.map((chip) => (\n                  <Chip key={chip.key} isReadOnly>\n                    {chip.node}\n                  </Chip>\n                ))}\n              </ChipGroup>\n            ))}\n      </ChipHolder>\n    </InputGroup>\n  );\n\n  return (\n    <FormGroup\n      fieldId=\"host-filter\"\n      helperTextInvalid={helperTextInvalid}\n      isRequired\n      label={t`Smart host filter`}\n      validated={isValid ? 'default' : 'error'}\n      labelIcon={\n        <Popover\n          content={t`Populate the hosts for this inventory by using a search\n              filter. Example: ansible_facts__ansible_distribution:\"RedHat\".\n              Refer to the documentation for further syntax and\n              examples.  Refer to the Ansible Controller documentation for further syntax and\n              examples.`}\n        />\n      }\n    >\n      {isDisabled ? (\n        <Tooltip\n          content={t`Please select an organization before editing the host filter`}\n        >\n          {renderLookup()}\n        </Tooltip>\n      ) : (\n        renderLookup()\n      )}\n      <Modal\n        aria-label={t`Lookup modal`}\n        isOpen={isModalOpen}\n        onClose={handleClose}\n        title={t`Perform a search to define a host filter`}\n        variant=\"large\"\n        actions={[\n          <Button\n            ouiaId=\"host-filter-modal-select-button\"\n            isDisabled={!location.search}\n            key=\"select\"\n            onClick={save}\n            variant=\"primary\"\n          >\n            {t`Select`}\n          </Button>,\n          <Button\n            ouiaId=\"host-filter-modal-cancel-button\"\n            key=\"cancel\"\n            variant=\"link\"\n            onClick={handleClose}\n          >\n            {t`Cancel`}\n          </Button>,\n        ]}\n      >\n        <ModalList>\n          {isAnsibleFactsSelected && (\n            <Alert\n              variant=\"info\"\n              title={\n                <>\n                  {t`Searching by ansible_facts requires special syntax. Refer to the`}{' '}\n                  <a\n                    href={`${getDocsBaseUrl(\n                      config\n                    )}/html/userguide/inventories.html#smart-host-filter`}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                  >\n                    {t`documentation`}\n                  </a>{' '}\n                  {t`for more info.`}\n                </>\n              }\n            />\n          )}\n          <PaginatedTable\n            contentError={error}\n            hasContentLoading={isLoading}\n            itemCount={count}\n            items={hosts}\n            pluralizedItemName={t`hosts`}\n            qsConfig={QS_CONFIG}\n            headerRow={\n              <HeaderRow qsConfig={QS_CONFIG} isSelectable={false}>\n                <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n                <HeaderCell sortKey=\"description\">{t`Description`}</HeaderCell>\n                <HeaderCell>{t`Inventory`}</HeaderCell>\n              </HeaderRow>\n            }\n            renderRow={(item) => <HostListItem key={item.id} item={item} />}\n            renderToolbar={(props) => (\n              <DataListToolbar\n                {...props}\n                fillWidth\n                enableNegativeFiltering={enableNegativeFiltering}\n                enableRelatedFuzzyFiltering={enableRelatedFuzzyFiltering}\n                handleIsAnsibleFactsSelected={setIsAnsibleFactsSelected}\n              />\n            )}\n            toolbarSearchColumns={searchColumns}\n            toolbarSearchableKeys={searchableKeys}\n            toolbarRelatedSearchableKeys={relatedSearchableKeys}\n          />\n        </ModalList>\n      </Modal>\n      <LookupErrorMessage error={error} />\n    </FormGroup>\n  );\n}\n\nHostFilterLookup.propTypes = {\n  isValid: bool,\n  onBlur: func,\n  onChange: func,\n  organizationId: number,\n  value: string,\n  enableNegativeFiltering: bool,\n  enableRelatedFuzzyFiltering: bool,\n};\nHostFilterLookup.defaultProps = {\n  isValid: true,\n  onBlur: () => {},\n  onChange: () => {},\n  organizationId: null,\n  value: '',\n  enableNegativeFiltering: true,\n  enableRelatedFuzzyFiltering: true,\n};\n\nexport default HostFilterLookup;\n"]},"metadata":{},"sourceType":"module"}