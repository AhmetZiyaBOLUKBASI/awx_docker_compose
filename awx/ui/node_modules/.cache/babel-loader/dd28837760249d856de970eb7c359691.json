{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState}from'react';import{useHistory}from'react-router-dom';import{Card}from'@patternfly/react-core';import{CardBody}from'components/Card';import{ProjectsAPI}from'api';import ProjectForm from'../shared/ProjectForm';import{jsx as _jsx}from\"react/jsx-runtime\";function ProjectEdit(_ref){var project=_ref.project;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),formSubmitError=_useState2[0],setFormSubmitError=_useState2[1];var history=useHistory();var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var _values$default_envir,_yield$ProjectsAPI$up,id;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(values.scm_type==='manual'){values.scm_type='';}if(!values.credential){// Depending on the permissions of the user submitting the form,\n// the API might throw an unexpected error if our creation request\n// has a zero-length string as its credential field. As a work-around,\n// normalize falsey credential fields by deleting them.\ndelete values.credential;}else{values.credential=values.credential.id;}_context.prev=2;_context.next=5;return ProjectsAPI.update(project.id,_objectSpread(_objectSpread({},values),{},{organization:values.organization.id,default_environment:((_values$default_envir=values.default_environment)===null||_values$default_envir===void 0?void 0:_values$default_envir.id)||null}));case 5:_yield$ProjectsAPI$up=_context.sent;id=_yield$ProjectsAPI$up.data.id;history.push(\"/projects/\".concat(id,\"/details\"));_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](2);setFormSubmitError(_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[2,10]]);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push(\"/projects/\".concat(project.id,\"/details\"));};return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(ProjectForm,{project:project,handleCancel:handleCancel,handleSubmit:handleSubmit,submitError:formSubmitError})})});}export default ProjectEdit;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Project/ProjectEdit/ProjectEdit.js"],"names":["React","useState","useHistory","Card","CardBody","ProjectsAPI","ProjectForm","ProjectEdit","project","formSubmitError","setFormSubmitError","history","handleSubmit","values","scm_type","credential","id","update","organization","default_environment","data","push","handleCancel"],"mappings":"8ZAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,IAAT,KAAqB,wBAArB,CACA,OAASC,QAAT,KAAyB,iBAAzB,CACA,OAASC,WAAT,KAA4B,KAA5B,CACA,MAAOC,CAAAA,WAAP,KAAwB,uBAAxB,C,2CAEA,QAASC,CAAAA,WAAT,MAAkC,IAAXC,CAAAA,OAAW,MAAXA,OAAW,CAChC,cAA8CP,QAAQ,CAAC,IAAD,CAAtD,wCAAOQ,eAAP,eAAwBC,kBAAxB,eACA,GAAMC,CAAAA,OAAO,CAAGT,UAAU,EAA1B,CAEA,GAAMU,CAAAA,YAAY,2FAAG,iBAAOC,MAAP,qKACnB,GAAIA,MAAM,CAACC,QAAP,GAAoB,QAAxB,CAAkC,CAChCD,MAAM,CAACC,QAAP,CAAkB,EAAlB,CACD,CACD,GAAI,CAACD,MAAM,CAACE,UAAZ,CAAwB,CACtB;AACA;AACA;AACA;AACA,MAAOF,CAAAA,MAAM,CAACE,UAAd,CACD,CAND,IAMO,CACLF,MAAM,CAACE,UAAP,CAAoBF,MAAM,CAACE,UAAP,CAAkBC,EAAtC,CACD,CAZkB,sCAgBPX,CAAAA,WAAW,CAACY,MAAZ,CAAmBT,OAAO,CAACQ,EAA3B,gCACLH,MADK,MAERK,YAAY,CAAEL,MAAM,CAACK,YAAP,CAAoBF,EAF1B,CAGRG,mBAAmB,CAAE,wBAAAN,MAAM,CAACM,mBAAP,sEAA4BH,EAA5B,GAAkC,IAH/C,GAhBO,4CAePA,EAfO,uBAefI,IAfe,CAePJ,EAfO,CAqBjBL,OAAO,CAACU,IAAR,qBAA0BL,EAA1B,cArBiB,iFAuBjBN,kBAAkB,aAAlB,CAvBiB,qEAAH,kBAAZE,CAAAA,YAAY,6CAAlB,CA2BA,GAAMU,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CACzBX,OAAO,CAACU,IAAR,qBAA0Bb,OAAO,CAACQ,EAAlC,cACD,CAFD,CAIA,mBACE,KAAC,IAAD,wBACE,KAAC,QAAD,wBACE,KAAC,WAAD,EACE,OAAO,CAAER,OADX,CAEE,YAAY,CAAEc,YAFhB,CAGE,YAAY,CAAEV,YAHhB,CAIE,WAAW,CAAEH,eAJf,EADF,EADF,EADF,CAYD,CAED,cAAeF,CAAAA,WAAf","sourcesContent":["import React, { useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Card } from '@patternfly/react-core';\nimport { CardBody } from 'components/Card';\nimport { ProjectsAPI } from 'api';\nimport ProjectForm from '../shared/ProjectForm';\n\nfunction ProjectEdit({ project }) {\n  const [formSubmitError, setFormSubmitError] = useState(null);\n  const history = useHistory();\n\n  const handleSubmit = async (values) => {\n    if (values.scm_type === 'manual') {\n      values.scm_type = '';\n    }\n    if (!values.credential) {\n      // Depending on the permissions of the user submitting the form,\n      // the API might throw an unexpected error if our creation request\n      // has a zero-length string as its credential field. As a work-around,\n      // normalize falsey credential fields by deleting them.\n      delete values.credential;\n    } else {\n      values.credential = values.credential.id;\n    }\n    try {\n      const {\n        data: { id },\n      } = await ProjectsAPI.update(project.id, {\n        ...values,\n        organization: values.organization.id,\n        default_environment: values.default_environment?.id || null,\n      });\n      history.push(`/projects/${id}/details`);\n    } catch (error) {\n      setFormSubmitError(error);\n    }\n  };\n\n  const handleCancel = () => {\n    history.push(`/projects/${project.id}/details`);\n  };\n\n  return (\n    <Card>\n      <CardBody>\n        <ProjectForm\n          project={project}\n          handleCancel={handleCancel}\n          handleSubmit={handleSubmit}\n          submitError={formSubmitError}\n        />\n      </CardBody>\n    </Card>\n  );\n}\n\nexport default ProjectEdit;\n"]},"metadata":{},"sourceType":"module"}