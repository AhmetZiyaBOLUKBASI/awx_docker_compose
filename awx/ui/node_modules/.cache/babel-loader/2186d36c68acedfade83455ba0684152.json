{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{useHistory}from'react-router-dom';import{useField}from'formik';import{Form,FormGroup}from'@patternfly/react-core';import{ExecutionEnvironmentsAPI}from'api';import{parseQueryString,getQSConfig,mergeParams}from'util/qs';import{getSearchableKeys}from'components/PaginatedTable';import useRequest from'hooks/useRequest';import Popover from'../Popover';import ContentError from'../ContentError';import ContentLoading from'../ContentLoading';import OptionsList from'../OptionsList';import{jsx as _jsx}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('execution_environments',{page:1,page_size:5,order_by:'name'});function AdHocExecutionEnvironmentStep(_ref){var organizationId=_ref.organizationId;var history=useHistory();var _useField=useField('execution_environment'),_useField2=_slicedToArray(_useField,3),executionEnvironmentField=_useField2[0],executionEnvironmentHelpers=_useField2[2];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,globallyAvailableParams,organizationIdParams,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,results,count,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,history.location.search);globallyAvailableParams={or__organization__isnull:'True'};organizationIdParams=organizationId?{or__organization__id:organizationId}:{};_context.next=5;return Promise.all([ExecutionEnvironmentsAPI.read(mergeParams(params,_objectSpread(_objectSpread({},globallyAvailableParams),organizationIdParams))),ExecutionEnvironmentsAPI.readOptions()]);case 5:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);_yield$Promise$all2$=_yield$Promise$all2[0].data;results=_yield$Promise$all2$.results;count=_yield$Promise$all2$.count;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{executionEnvironments:results,executionEnvironmentsCount:count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 12:case\"end\":return _context.stop();}}},_callee);})),[history.location.search,organizationId]),{executionEnvironments:[],executionEnvironmentsCount:0,relatedSearchableKeys:[],searchableKeys:[]}),error=_useRequest.error,isLoading=_useRequest.isLoading,fetchExecutionEnvironments=_useRequest.request,_useRequest$result=_useRequest.result,executionEnvironments=_useRequest$result.executionEnvironments,executionEnvironmentsCount=_useRequest$result.executionEnvironmentsCount,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys;useEffect(function(){fetchExecutionEnvironments();},[fetchExecutionEnvironments]);if(error){return/*#__PURE__*/_jsx(ContentError,{error:error});}if(isLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}return/*#__PURE__*/_jsx(Form,{children:/*#__PURE__*/_jsx(FormGroup,{fieldId:\"execution_enviroment\",label:/*i18n*/i18n._(\"Execution Environment\"),\"aria-label\":/*i18n*/i18n._(\"Execution Environment\"),labelIcon:/*#__PURE__*/_jsx(Popover,{content:/*i18n*/i18n._(\"Select the Execution Environment you want this command to run inside.\")}),children:/*#__PURE__*/_jsx(OptionsList,{isLoading:isLoading,value:executionEnvironmentField.value||[],options:executionEnvironments,optionCount:executionEnvironmentsCount,header:/*i18n*/i18n._(\"Execution Environments\"),qsConfig:QS_CONFIG,searchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username'}],sortColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name'}],name:\"execution_environment\",searchableKeys:searchableKeys,relatedSearchableKeys:relatedSearchableKeys,selectItem:function selectItem(value){executionEnvironmentHelpers.setValue([value]);},deselectItem:function deselectItem(){executionEnvironmentHelpers.setValue([]);}})})});}export default AdHocExecutionEnvironmentStep;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/AdHocCommands/AdHocExecutionEnvironmentStep.js"],"names":["React","useEffect","useCallback","useHistory","useField","Form","FormGroup","ExecutionEnvironmentsAPI","parseQueryString","getQSConfig","mergeParams","getSearchableKeys","useRequest","Popover","ContentError","ContentLoading","OptionsList","QS_CONFIG","page","page_size","order_by","AdHocExecutionEnvironmentStep","organizationId","history","executionEnvironmentField","executionEnvironmentHelpers","params","location","search","globallyAvailableParams","or__organization__isnull","organizationIdParams","or__organization__id","Promise","all","read","readOptions","data","results","count","actionsResponse","executionEnvironments","executionEnvironmentsCount","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","error","isLoading","fetchExecutionEnvironments","request","result","value","name","key","isDefault","setValue"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport { useField } from 'formik';\nimport { Form, FormGroup } from '@patternfly/react-core';\nimport { ExecutionEnvironmentsAPI } from 'api';\n\nimport { parseQueryString, getQSConfig, mergeParams } from 'util/qs';\nimport { getSearchableKeys } from 'components/PaginatedTable';\nimport useRequest from 'hooks/useRequest';\nimport Popover from '../Popover';\nimport ContentError from '../ContentError';\nimport ContentLoading from '../ContentLoading';\nimport OptionsList from '../OptionsList';\n\nconst QS_CONFIG = getQSConfig('execution_environments', {\n  page: 1,\n  page_size: 5,\n  order_by: 'name',\n});\nfunction AdHocExecutionEnvironmentStep({ organizationId }) {\n  const history = useHistory();\n  const [executionEnvironmentField, , executionEnvironmentHelpers] = useField(\n    'execution_environment'\n  );\n  const {\n    error,\n    isLoading,\n    request: fetchExecutionEnvironments,\n    result: {\n      executionEnvironments,\n      executionEnvironmentsCount,\n      relatedSearchableKeys,\n      searchableKeys,\n    },\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, history.location.search);\n      const globallyAvailableParams = { or__organization__isnull: 'True' };\n      const organizationIdParams = organizationId\n        ? { or__organization__id: organizationId }\n        : {};\n\n      const [\n        {\n          data: { results, count },\n        },\n        actionsResponse,\n      ] = await Promise.all([\n        ExecutionEnvironmentsAPI.read(\n          mergeParams(params, {\n            ...globallyAvailableParams,\n            ...organizationIdParams,\n          })\n        ),\n        ExecutionEnvironmentsAPI.readOptions(),\n      ]);\n      return {\n        executionEnvironments: results,\n        executionEnvironmentsCount: count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [history.location.search, organizationId]),\n    {\n      executionEnvironments: [],\n      executionEnvironmentsCount: 0,\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchExecutionEnvironments();\n  }, [fetchExecutionEnvironments]);\n\n  if (error) {\n    return <ContentError error={error} />;\n  }\n  if (isLoading) {\n    return <ContentLoading />;\n  }\n\n  return (\n    <Form>\n      <FormGroup\n        fieldId=\"execution_enviroment\"\n        label={t`Execution Environment`}\n        aria-label={t`Execution Environment`}\n        labelIcon={\n          <Popover\n            content={t`Select the Execution Environment you want this command to run inside.`}\n          />\n        }\n      >\n        <OptionsList\n          isLoading={isLoading}\n          value={executionEnvironmentField.value || []}\n          options={executionEnvironments}\n          optionCount={executionEnvironmentsCount}\n          header={t`Execution Environments`}\n          qsConfig={QS_CONFIG}\n          searchColumns={[\n            {\n              name: t`Name`,\n              key: 'name__icontains',\n              isDefault: true,\n            },\n            {\n              name: t`Created By (Username)`,\n              key: 'created_by__username',\n            },\n            {\n              name: t`Modified By (Username)`,\n              key: 'modified_by__username',\n            },\n          ]}\n          sortColumns={[\n            {\n              name: t`Name`,\n              key: 'name',\n            },\n          ]}\n          name=\"execution_environment\"\n          searchableKeys={searchableKeys}\n          relatedSearchableKeys={relatedSearchableKeys}\n          selectItem={(value) => {\n            executionEnvironmentHelpers.setValue([value]);\n          }}\n          deselectItem={() => {\n            executionEnvironmentHelpers.setValue([]);\n          }}\n        />\n      </FormGroup>\n    </Form>\n  );\n}\nexport default AdHocExecutionEnvironmentStep;\n"]},"metadata":{},"sourceType":"module"}