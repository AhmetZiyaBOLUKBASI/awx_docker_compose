{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2;import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect,useReducer}from'react';import{useHistory}from'react-router-dom';import styled from'styled-components';import{WorkflowDispatchContext,WorkflowStateContext}from'contexts/Workflow';import{getAddedAndRemoved}from'util/lists';import{stringIsUUID}from'util/strings';import AlertModal from'components/AlertModal';import ErrorDetail from'components/ErrorDetail';import{layoutGraph}from'components/Workflow/WorkflowUtils';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import workflowReducer from'components/Workflow/workflowReducer';import useRequest,{useDismissableError}from'hooks/useRequest';import{WorkflowApprovalTemplatesAPI,WorkflowJobTemplateNodesAPI,WorkflowJobTemplatesAPI}from'api';import{DeleteAllNodesModal,UnsavedChangesModal}from'./Modals';import{LinkAddModal,LinkDeleteModal,LinkEditModal}from'./Modals/LinkModals';import{NodeAddModal,NodeEditModal,NodeDeleteModal,NodeViewModal}from'./Modals/NodeModals';import VisualizerGraph from'./VisualizerGraph';import VisualizerStartScreen from'./VisualizerStartScreen';import VisualizerToolbar from'./VisualizerToolbar';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CenteredContent=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  align-items: center;\\n  display: flex;\\n  flex-flow: column;\\n  height: 100%;\\n  justify-content: center;\\n\"])));var Wrapper=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-flow: column;\\n  height: 100%;\\n\"])));var replaceIdentifier=function replaceIdentifier(node){if(stringIsUUID(node.originalNodeObject.identifier)||node.identifier){return true;}return false;};var getAggregatedCredentials=function getAggregatedCredentials(){var originalNodeOverride=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var templateDefaultCredentials=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var theArray=[];var isCredentialOverriden=function isCredentialOverriden(templateDefaultCred){var credentialHasOverride=false;originalNodeOverride.forEach(function(overrideCred){if(templateDefaultCred.credential_type===overrideCred.credential_type){var _overrideCred$inputs,_overrideCred$inputs2,_overrideCred$inputs3;if(!templateDefaultCred.vault_id&&!((_overrideCred$inputs=overrideCred.inputs)!==null&&_overrideCred$inputs!==void 0&&_overrideCred$inputs.vault_id)||templateDefaultCred.vault_id&&(_overrideCred$inputs2=overrideCred.inputs)!==null&&_overrideCred$inputs2!==void 0&&_overrideCred$inputs2.vault_id&&templateDefaultCred.vault_id===((_overrideCred$inputs3=overrideCred.inputs)===null||_overrideCred$inputs3===void 0?void 0:_overrideCred$inputs3.vault_id)){credentialHasOverride=true;}}});return credentialHasOverride;};if(templateDefaultCredentials.length>0){templateDefaultCredentials.forEach(function(defaultCred){if(!isCredentialOverriden(defaultCred)){theArray.push(defaultCred);}});}theArray=theArray.concat(originalNodeOverride);return theArray;};var fetchWorkflowNodes=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(templateId){var pageNo,workflowNodes,_yield$WorkflowJobTem,data,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:pageNo=_args.length>1&&_args[1]!==undefined?_args[1]:1;workflowNodes=_args.length>2&&_args[2]!==undefined?_args[2]:[];_context.next=4;return WorkflowJobTemplatesAPI.readNodes(templateId,{page_size:200,page:pageNo});case 4:_yield$WorkflowJobTem=_context.sent;data=_yield$WorkflowJobTem.data;if(!data.next){_context.next=8;break;}return _context.abrupt(\"return\",fetchWorkflowNodes(templateId,pageNo+1,workflowNodes.concat(data.results)));case 8:return _context.abrupt(\"return\",workflowNodes.concat(data.results));case 9:case\"end\":return _context.stop();}}},_callee);}));return function fetchWorkflowNodes(_x){return _ref.apply(this,arguments);};}();function Visualizer(_ref2){var _template$summary_fie,_template$summary_fie2;var template=_ref2.template;var history=useHistory();var _useReducer=useReducer(workflowReducer,{addLinkSourceNode:null,addLinkTargetNode:null,addNodeSource:null,addNodeTarget:null,addingLink:false,contentError:null,isLoading:true,linkToDelete:null,linkToEdit:null,links:[],nextNodeId:0,nodePositions:null,nodeToDelete:null,nodeToEdit:null,nodeToView:null,nodes:[],showDeleteAllNodesModal:false,showLegend:false,showTools:false,showUnsavedChangesModal:false,unsavedChanges:false}),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var addLinkSourceNode=state.addLinkSourceNode,addLinkTargetNode=state.addLinkTargetNode,addNodeSource=state.addNodeSource,contentError=state.contentError,isLoading=state.isLoading,linkToDelete=state.linkToDelete,linkToEdit=state.linkToEdit,links=state.links,nodeToDelete=state.nodeToDelete,nodeToEdit=state.nodeToEdit,nodeToView=state.nodeToView,nodes=state.nodes,showDeleteAllNodesModal=state.showDeleteAllNodesModal,showUnsavedChangesModal=state.showUnsavedChangesModal,unsavedChanges=state.unsavedChanges;var handleVisualizerClose=function handleVisualizerClose(){if(unsavedChanges){dispatch({type:'TOGGLE_UNSAVED_CHANGES_MODAL'});}else{history.push(\"/templates/workflow_job_template/\".concat(template.id,\"/details\"));}};var associateNodes=function associateNodes(newLinks,originalLinkMap){var associateNodeRequests=[];newLinks.forEach(function(link){switch(link.linkType){case'success':associateNodeRequests.push(WorkflowJobTemplateNodesAPI.associateSuccessNode(originalLinkMap[link.source.id].id,originalLinkMap[link.target.id].id));break;case'failure':associateNodeRequests.push(WorkflowJobTemplateNodesAPI.associateFailureNode(originalLinkMap[link.source.id].id,originalLinkMap[link.target.id].id));break;case'always':associateNodeRequests.push(WorkflowJobTemplateNodesAPI.associateAlwaysNode(originalLinkMap[link.source.id].id,originalLinkMap[link.target.id].id));break;default:}});return associateNodeRequests;};var disassociateNodes=function disassociateNodes(originalLinkMap,deletedNodeIds,linkMap){var disassociateNodeRequests=[];Object.keys(originalLinkMap).forEach(function(key){var node=originalLinkMap[key];node.success_nodes.forEach(function(successNodeId){if(!deletedNodeIds.includes(successNodeId)&&(!linkMap[node.id]||!linkMap[node.id][successNodeId]||linkMap[node.id][successNodeId]!=='success')){disassociateNodeRequests.push(WorkflowJobTemplateNodesAPI.disassociateSuccessNode(node.id,successNodeId));}});node.failure_nodes.forEach(function(failureNodeId){if(!deletedNodeIds.includes(failureNodeId)&&(!linkMap[node.id]||!linkMap[node.id][failureNodeId]||linkMap[node.id][failureNodeId]!=='failure')){disassociateNodeRequests.push(WorkflowJobTemplateNodesAPI.disassociateFailuresNode(node.id,failureNodeId));}});node.always_nodes.forEach(function(alwaysNodeId){if(!deletedNodeIds.includes(alwaysNodeId)&&(!linkMap[node.id]||!linkMap[node.id][alwaysNodeId]||linkMap[node.id][alwaysNodeId]!=='always')){disassociateNodeRequests.push(WorkflowJobTemplateNodesAPI.disassociateAlwaysNode(node.id,alwaysNodeId));}});});return disassociateNodeRequests;};useEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var workflowNodes;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetchWorkflowNodes(template.id);case 3:workflowNodes=_context2.sent;dispatch({type:'GENERATE_NODES_AND_LINKS',nodes:workflowNodes});_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);dispatch({type:'SET_CONTENT_ERROR',value:_context2.t0});case 10:_context2.prev=10;dispatch({type:'SET_IS_LOADING',value:false});return _context2.finish(10);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7,10,13]]);}));return _fetchData.apply(this,arguments);}fetchData();},[template.id]);// Update positions of nodes/links\nuseEffect(function(){if(nodes){var newNodePositions={};var nonDeletedNodes=nodes.filter(function(node){return!node.isDeleted;});var g=layoutGraph(nonDeletedNodes,links);g.nodes().forEach(function(node){newNodePositions[node]=g.node(node);});dispatch({type:'SET_NODE_POSITIONS',value:newNodePositions});}},[links,nodes]);var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var nodeRequests,approvalTemplateRequests,originalLinkMap,deletedNodeIds,associateCredentialRequests,disassociateCredentialRequests,generateLinkMapAndNewLinks,_generateLinkMapAndNe,_generateLinkMapAndNe2,linkMap,newLinks;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:nodeRequests=[];approvalTemplateRequests=[];originalLinkMap={};deletedNodeIds=[];associateCredentialRequests=[];disassociateCredentialRequests=[];generateLinkMapAndNewLinks=function generateLinkMapAndNewLinks(){var linkMap={};var newLinks=[];links.forEach(function(link){if(link.source.id!==1){var realLinkSourceId=originalLinkMap[link.source.id].id;var realLinkTargetId=originalLinkMap[link.target.id].id;if(!linkMap[realLinkSourceId]){linkMap[realLinkSourceId]={};}linkMap[realLinkSourceId][realLinkTargetId]=link.linkType;switch(link.linkType){case'success':if(!originalLinkMap[link.source.id].success_nodes.includes(originalLinkMap[link.target.id].id)){newLinks.push(link);}break;case'failure':if(!originalLinkMap[link.source.id].failure_nodes.includes(originalLinkMap[link.target.id].id)){newLinks.push(link);}break;case'always':if(!originalLinkMap[link.source.id].always_nodes.includes(originalLinkMap[link.target.id].id)){newLinks.push(link);}break;default:}}});return[linkMap,newLinks];};nodes.forEach(function(node){// node with id=1 is the artificial start node\nif(node.id===1){return;}if(node.originalNodeObject&&!node.isDeleted){var _node$originalNodeObj=node.originalNodeObject,id=_node$originalNodeObj.id,success_nodes=_node$originalNodeObj.success_nodes,failure_nodes=_node$originalNodeObj.failure_nodes,always_nodes=_node$originalNodeObj.always_nodes;originalLinkMap[node.id]={id:id,success_nodes:success_nodes,failure_nodes:failure_nodes,always_nodes:always_nodes};}if(node.isDeleted&&node.originalNodeObject){deletedNodeIds.push(node.originalNodeObject.id);nodeRequests.push(WorkflowJobTemplateNodesAPI.destroy(node.originalNodeObject.id));}else if(!node.isDeleted&&!node.originalNodeObject){if(node.fullUnifiedJobTemplate.type==='workflow_approval_template'){nodeRequests.push(WorkflowJobTemplatesAPI.createNode(template.id,_objectSpread({all_parents_must_converge:node.all_parents_must_converge},node.identifier&&{identifier:node.identifier})).then(function(_ref4){var data=_ref4.data;node.originalNodeObject=data;originalLinkMap[node.id]={id:data.id,success_nodes:[],failure_nodes:[],always_nodes:[]};approvalTemplateRequests.push(WorkflowJobTemplateNodesAPI.createApprovalTemplate(data.id,{name:node.fullUnifiedJobTemplate.name,description:node.fullUnifiedJobTemplate.description,timeout:node.fullUnifiedJobTemplate.timeout}));}));}else{var _node$promptValues,_node$promptValues$in;nodeRequests.push(WorkflowJobTemplatesAPI.createNode(template.id,_objectSpread(_objectSpread({},node.promptValues),{},{inventory:((_node$promptValues=node.promptValues)===null||_node$promptValues===void 0?void 0:(_node$promptValues$in=_node$promptValues.inventory)===null||_node$promptValues$in===void 0?void 0:_node$promptValues$in.id)||null,unified_job_template:node.fullUnifiedJobTemplate.id,all_parents_must_converge:node.all_parents_must_converge},node.identifier&&{identifier:node.identifier})).then(function(_ref5){var _node$promptValues2,_node$promptValues2$a;var data=_ref5.data;node.originalNodeObject=data;originalLinkMap[node.id]={id:data.id,success_nodes:[],failure_nodes:[],always_nodes:[]};if(((_node$promptValues2=node.promptValues)===null||_node$promptValues2===void 0?void 0:(_node$promptValues2$a=_node$promptValues2.addedCredentials)===null||_node$promptValues2$a===void 0?void 0:_node$promptValues2$a.length)>0){node.promptValues.addedCredentials.forEach(function(cred){associateCredentialRequests.push(WorkflowJobTemplateNodesAPI.associateCredentials(data.id,cred.id));});}}));}}else if(node.isEdited){if(node.fullUnifiedJobTemplate.type==='workflow_approval_template'){var _node$originalNodeObj2;if(((_node$originalNodeObj2=node.originalNodeObject.summary_fields.unified_job_template)===null||_node$originalNodeObj2===void 0?void 0:_node$originalNodeObj2.unified_job_type)==='workflow_approval'){nodeRequests.push(WorkflowJobTemplateNodesAPI.replace(node.originalNodeObject.id,_objectSpread({all_parents_must_converge:node.all_parents_must_converge},replaceIdentifier(node)&&{identifier:node.identifier})).then(function(_ref6){var data=_ref6.data;node.originalNodeObject=data;approvalTemplateRequests.push(WorkflowApprovalTemplatesAPI.update(node.originalNodeObject.summary_fields.unified_job_template.id,{name:node.fullUnifiedJobTemplate.name,description:node.fullUnifiedJobTemplate.description,timeout:node.fullUnifiedJobTemplate.timeout}));}));}else{nodeRequests.push(WorkflowJobTemplateNodesAPI.replace(node.originalNodeObject.id,_objectSpread({all_parents_must_converge:node.all_parents_must_converge},replaceIdentifier(node)&&{identifier:node.identifier})).then(function(_ref7){var data=_ref7.data;node.originalNodeObject=data;approvalTemplateRequests.push(WorkflowJobTemplateNodesAPI.createApprovalTemplate(node.originalNodeObject.id,{name:node.fullUnifiedJobTemplate.name,description:node.fullUnifiedJobTemplate.description,timeout:node.fullUnifiedJobTemplate.timeout}));}));}}else{var _node$promptValues3,_node$promptValues3$i;nodeRequests.push(WorkflowJobTemplateNodesAPI.replace(node.originalNodeObject.id,_objectSpread(_objectSpread({},node.promptValues),{},{inventory:((_node$promptValues3=node.promptValues)===null||_node$promptValues3===void 0?void 0:(_node$promptValues3$i=_node$promptValues3.inventory)===null||_node$promptValues3$i===void 0?void 0:_node$promptValues3$i.id)||null,unified_job_template:node.fullUnifiedJobTemplate.id,all_parents_must_converge:node.all_parents_must_converge},replaceIdentifier(node)&&{identifier:node.identifier})).then(function(){var _node$launchConfig,_node$launchConfig$de,_node$promptValues4;var _getAddedAndRemoved=getAddedAndRemoved(getAggregatedCredentials(node===null||node===void 0?void 0:node.originalNodeCredentials,(_node$launchConfig=node.launchConfig)===null||_node$launchConfig===void 0?void 0:(_node$launchConfig$de=_node$launchConfig.defaults)===null||_node$launchConfig$de===void 0?void 0:_node$launchConfig$de.credentials),(_node$promptValues4=node.promptValues)===null||_node$promptValues4===void 0?void 0:_node$promptValues4.credentials),addedCredentials=_getAddedAndRemoved.added,removedCredentials=_getAddedAndRemoved.removed;if(addedCredentials.length>0){addedCredentials.forEach(function(cred){associateCredentialRequests.push(WorkflowJobTemplateNodesAPI.associateCredentials(node.originalNodeObject.id,cred.id));});}if((removedCredentials===null||removedCredentials===void 0?void 0:removedCredentials.length)>0){removedCredentials.forEach(function(cred){return disassociateCredentialRequests.push(WorkflowJobTemplateNodesAPI.disassociateCredentials(node.originalNodeObject.id,cred.id));});}}));}}});_context3.next=10;return Promise.all(nodeRequests);case 10:_context3.next=12;return Promise.all(approvalTemplateRequests);case 12:_generateLinkMapAndNe=generateLinkMapAndNewLinks(originalLinkMap),_generateLinkMapAndNe2=_slicedToArray(_generateLinkMapAndNe,2),linkMap=_generateLinkMapAndNe2[0],newLinks=_generateLinkMapAndNe2[1];_context3.next=15;return Promise.all(disassociateNodes(originalLinkMap,deletedNodeIds,linkMap));case 15:_context3.next=17;return Promise.all(associateNodes(newLinks,originalLinkMap));case 17:_context3.next=19;return Promise.all(disassociateCredentialRequests);case 19:_context3.next=21;return Promise.all(associateCredentialRequests);case 21:history.push(\"/templates/workflow_job_template/\".concat(template.id,\"/details\"));case 22:case\"end\":return _context3.stop();}}},_callee3);})),[links,nodes,history,template.id]),{}),saveVisualizerError=_useRequest.error,isSavingVisualizer=_useRequest.isLoading,saveVisualizer=_useRequest.request;var _useDismissableError=useDismissableError(saveVisualizerError),nodeRequestError=_useDismissableError.error,dismissNodeRequestError=_useDismissableError.dismissError;if(isLoading||isSavingVisualizer){return/*#__PURE__*/_jsx(CenteredContent,{children:/*#__PURE__*/_jsx(ContentLoading,{})});}if(contentError){return/*#__PURE__*/_jsx(CenteredContent,{children:/*#__PURE__*/_jsx(ContentError,{error:contentError})});}var readOnly=!(template!==null&&template!==void 0&&(_template$summary_fie=template.summary_fields)!==null&&_template$summary_fie!==void 0&&(_template$summary_fie2=_template$summary_fie.user_capabilities)!==null&&_template$summary_fie2!==void 0&&_template$summary_fie2.edit);return/*#__PURE__*/_jsx(WorkflowStateContext.Provider,{value:state,children:/*#__PURE__*/_jsxs(WorkflowDispatchContext.Provider,{value:dispatch,children:[/*#__PURE__*/_jsxs(Wrapper,{children:[/*#__PURE__*/_jsx(VisualizerToolbar,{onClose:handleVisualizerClose,onSave:function onSave(){return saveVisualizer(nodes);},hasUnsavedChanges:unsavedChanges,template:template,readOnly:readOnly}),links.length>0?/*#__PURE__*/_jsx(VisualizerGraph,{readOnly:readOnly}):/*#__PURE__*/_jsx(VisualizerStartScreen,{readOnly:readOnly})]}),nodeToDelete&&/*#__PURE__*/_jsx(NodeDeleteModal,{}),linkToDelete&&/*#__PURE__*/_jsx(LinkDeleteModal,{}),linkToEdit&&/*#__PURE__*/_jsx(LinkEditModal,{}),addLinkSourceNode&&addLinkTargetNode&&/*#__PURE__*/_jsx(LinkAddModal,{}),addNodeSource&&/*#__PURE__*/_jsx(NodeAddModal,{}),nodeToEdit&&/*#__PURE__*/_jsx(NodeEditModal,{}),showUnsavedChangesModal&&/*#__PURE__*/_jsx(UnsavedChangesModal,{onExit:function onExit(){return history.push(\"/templates/workflow_job_template/\".concat(template.id,\"/details\"));},onSaveAndExit:function onSaveAndExit(){return saveVisualizer(nodes);}}),showDeleteAllNodesModal&&/*#__PURE__*/_jsx(DeleteAllNodesModal,{}),nodeToView&&/*#__PURE__*/_jsx(NodeViewModal,{readOnly:readOnly}),nodeRequestError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:true,variant:\"error\",title:/*i18n*/i18n._(\"Error saving the workflow!\"),onClose:dismissNodeRequestError,\"aria-label\":/*i18n*/i18n._(\"Error saving the workflow!\"),children:[/*i18n*/i18n._(\"There was an error saving the workflow.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:nodeRequestError})]})]})});}export default Visualizer;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Template/WorkflowJobTemplateVisualizer/Visualizer.js"],"names":["React","useCallback","useEffect","useReducer","useHistory","styled","WorkflowDispatchContext","WorkflowStateContext","getAddedAndRemoved","stringIsUUID","AlertModal","ErrorDetail","layoutGraph","ContentError","ContentLoading","workflowReducer","useRequest","useDismissableError","WorkflowApprovalTemplatesAPI","WorkflowJobTemplateNodesAPI","WorkflowJobTemplatesAPI","DeleteAllNodesModal","UnsavedChangesModal","LinkAddModal","LinkDeleteModal","LinkEditModal","NodeAddModal","NodeEditModal","NodeDeleteModal","NodeViewModal","VisualizerGraph","VisualizerStartScreen","VisualizerToolbar","CenteredContent","div","Wrapper","replaceIdentifier","node","originalNodeObject","identifier","getAggregatedCredentials","originalNodeOverride","templateDefaultCredentials","theArray","isCredentialOverriden","templateDefaultCred","credentialHasOverride","forEach","overrideCred","credential_type","vault_id","inputs","length","defaultCred","push","concat","fetchWorkflowNodes","templateId","pageNo","workflowNodes","readNodes","page_size","page","data","next","results","Visualizer","template","history","addLinkSourceNode","addLinkTargetNode","addNodeSource","addNodeTarget","addingLink","contentError","isLoading","linkToDelete","linkToEdit","links","nextNodeId","nodePositions","nodeToDelete","nodeToEdit","nodeToView","nodes","showDeleteAllNodesModal","showLegend","showTools","showUnsavedChangesModal","unsavedChanges","state","dispatch","handleVisualizerClose","type","id","associateNodes","newLinks","originalLinkMap","associateNodeRequests","link","linkType","associateSuccessNode","source","target","associateFailureNode","associateAlwaysNode","disassociateNodes","deletedNodeIds","linkMap","disassociateNodeRequests","Object","keys","key","success_nodes","successNodeId","includes","disassociateSuccessNode","failure_nodes","failureNodeId","disassociateFailuresNode","always_nodes","alwaysNodeId","disassociateAlwaysNode","fetchData","value","newNodePositions","nonDeletedNodes","filter","isDeleted","g","nodeRequests","approvalTemplateRequests","associateCredentialRequests","disassociateCredentialRequests","generateLinkMapAndNewLinks","realLinkSourceId","realLinkTargetId","destroy","fullUnifiedJobTemplate","createNode","all_parents_must_converge","then","createApprovalTemplate","name","description","timeout","promptValues","inventory","unified_job_template","addedCredentials","cred","associateCredentials","isEdited","summary_fields","unified_job_type","replace","update","originalNodeCredentials","launchConfig","defaults","credentials","added","removedCredentials","removed","disassociateCredentials","Promise","all","saveVisualizerError","error","isSavingVisualizer","saveVisualizer","request","nodeRequestError","dismissNodeRequestError","dismissError","readOnly","user_capabilities","edit"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useReducer } from 'react';\nimport { useHistory } from 'react-router-dom';\n\nimport styled from 'styled-components';\nimport { shape } from 'prop-types';\nimport { t } from '@lingui/macro';\nimport {\n  WorkflowDispatchContext,\n  WorkflowStateContext,\n} from 'contexts/Workflow';\nimport { getAddedAndRemoved } from 'util/lists';\nimport { stringIsUUID } from 'util/strings';\nimport AlertModal from 'components/AlertModal';\nimport ErrorDetail from 'components/ErrorDetail';\nimport { layoutGraph } from 'components/Workflow/WorkflowUtils';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport workflowReducer from 'components/Workflow/workflowReducer';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport {\n  WorkflowApprovalTemplatesAPI,\n  WorkflowJobTemplateNodesAPI,\n  WorkflowJobTemplatesAPI,\n} from 'api';\nimport { DeleteAllNodesModal, UnsavedChangesModal } from './Modals';\nimport {\n  LinkAddModal,\n  LinkDeleteModal,\n  LinkEditModal,\n} from './Modals/LinkModals';\nimport {\n  NodeAddModal,\n  NodeEditModal,\n  NodeDeleteModal,\n  NodeViewModal,\n} from './Modals/NodeModals';\nimport VisualizerGraph from './VisualizerGraph';\nimport VisualizerStartScreen from './VisualizerStartScreen';\nimport VisualizerToolbar from './VisualizerToolbar';\n\nconst CenteredContent = styled.div`\n  align-items: center;\n  display: flex;\n  flex-flow: column;\n  height: 100%;\n  justify-content: center;\n`;\n\nconst Wrapper = styled.div`\n  display: flex;\n  flex-flow: column;\n  height: 100%;\n`;\n\nconst replaceIdentifier = (node) => {\n  if (stringIsUUID(node.originalNodeObject.identifier) || node.identifier) {\n    return true;\n  }\n\n  return false;\n};\nconst getAggregatedCredentials = (\n  originalNodeOverride = [],\n  templateDefaultCredentials = []\n) => {\n  let theArray = [];\n\n  const isCredentialOverriden = (templateDefaultCred) => {\n    let credentialHasOverride = false;\n    originalNodeOverride.forEach((overrideCred) => {\n      if (\n        templateDefaultCred.credential_type === overrideCred.credential_type\n      ) {\n        if (\n          (!templateDefaultCred.vault_id && !overrideCred.inputs?.vault_id) ||\n          (templateDefaultCred.vault_id &&\n            overrideCred.inputs?.vault_id &&\n            templateDefaultCred.vault_id === overrideCred.inputs?.vault_id)\n        ) {\n          credentialHasOverride = true;\n        }\n      }\n    });\n\n    return credentialHasOverride;\n  };\n\n  if (templateDefaultCredentials.length > 0) {\n    templateDefaultCredentials.forEach((defaultCred) => {\n      if (!isCredentialOverriden(defaultCred)) {\n        theArray.push(defaultCred);\n      }\n    });\n  }\n\n  theArray = theArray.concat(originalNodeOverride);\n\n  return theArray;\n};\n\nconst fetchWorkflowNodes = async (\n  templateId,\n  pageNo = 1,\n  workflowNodes = []\n) => {\n  const { data } = await WorkflowJobTemplatesAPI.readNodes(templateId, {\n    page_size: 200,\n    page: pageNo,\n  });\n  if (data.next) {\n    return fetchWorkflowNodes(\n      templateId,\n      pageNo + 1,\n      workflowNodes.concat(data.results)\n    );\n  }\n  return workflowNodes.concat(data.results);\n};\n\nfunction Visualizer({ template }) {\n  const history = useHistory();\n  const [state, dispatch] = useReducer(workflowReducer, {\n    addLinkSourceNode: null,\n    addLinkTargetNode: null,\n    addNodeSource: null,\n    addNodeTarget: null,\n    addingLink: false,\n    contentError: null,\n    isLoading: true,\n    linkToDelete: null,\n    linkToEdit: null,\n    links: [],\n    nextNodeId: 0,\n    nodePositions: null,\n    nodeToDelete: null,\n    nodeToEdit: null,\n    nodeToView: null,\n    nodes: [],\n    showDeleteAllNodesModal: false,\n    showLegend: false,\n    showTools: false,\n    showUnsavedChangesModal: false,\n    unsavedChanges: false,\n  });\n\n  const {\n    addLinkSourceNode,\n    addLinkTargetNode,\n    addNodeSource,\n    contentError,\n    isLoading,\n    linkToDelete,\n    linkToEdit,\n    links,\n    nodeToDelete,\n    nodeToEdit,\n    nodeToView,\n    nodes,\n    showDeleteAllNodesModal,\n    showUnsavedChangesModal,\n    unsavedChanges,\n  } = state;\n\n  const handleVisualizerClose = () => {\n    if (unsavedChanges) {\n      dispatch({ type: 'TOGGLE_UNSAVED_CHANGES_MODAL' });\n    } else {\n      history.push(`/templates/workflow_job_template/${template.id}/details`);\n    }\n  };\n\n  const associateNodes = (newLinks, originalLinkMap) => {\n    const associateNodeRequests = [];\n    newLinks.forEach((link) => {\n      switch (link.linkType) {\n        case 'success':\n          associateNodeRequests.push(\n            WorkflowJobTemplateNodesAPI.associateSuccessNode(\n              originalLinkMap[link.source.id].id,\n              originalLinkMap[link.target.id].id\n            )\n          );\n          break;\n        case 'failure':\n          associateNodeRequests.push(\n            WorkflowJobTemplateNodesAPI.associateFailureNode(\n              originalLinkMap[link.source.id].id,\n              originalLinkMap[link.target.id].id\n            )\n          );\n          break;\n        case 'always':\n          associateNodeRequests.push(\n            WorkflowJobTemplateNodesAPI.associateAlwaysNode(\n              originalLinkMap[link.source.id].id,\n              originalLinkMap[link.target.id].id\n            )\n          );\n          break;\n        default:\n      }\n    });\n\n    return associateNodeRequests;\n  };\n\n  const disassociateNodes = (originalLinkMap, deletedNodeIds, linkMap) => {\n    const disassociateNodeRequests = [];\n    Object.keys(originalLinkMap).forEach((key) => {\n      const node = originalLinkMap[key];\n      node.success_nodes.forEach((successNodeId) => {\n        if (\n          !deletedNodeIds.includes(successNodeId) &&\n          (!linkMap[node.id] ||\n            !linkMap[node.id][successNodeId] ||\n            linkMap[node.id][successNodeId] !== 'success')\n        ) {\n          disassociateNodeRequests.push(\n            WorkflowJobTemplateNodesAPI.disassociateSuccessNode(\n              node.id,\n              successNodeId\n            )\n          );\n        }\n      });\n      node.failure_nodes.forEach((failureNodeId) => {\n        if (\n          !deletedNodeIds.includes(failureNodeId) &&\n          (!linkMap[node.id] ||\n            !linkMap[node.id][failureNodeId] ||\n            linkMap[node.id][failureNodeId] !== 'failure')\n        ) {\n          disassociateNodeRequests.push(\n            WorkflowJobTemplateNodesAPI.disassociateFailuresNode(\n              node.id,\n              failureNodeId\n            )\n          );\n        }\n      });\n      node.always_nodes.forEach((alwaysNodeId) => {\n        if (\n          !deletedNodeIds.includes(alwaysNodeId) &&\n          (!linkMap[node.id] ||\n            !linkMap[node.id][alwaysNodeId] ||\n            linkMap[node.id][alwaysNodeId] !== 'always')\n        ) {\n          disassociateNodeRequests.push(\n            WorkflowJobTemplateNodesAPI.disassociateAlwaysNode(\n              node.id,\n              alwaysNodeId\n            )\n          );\n        }\n      });\n    });\n\n    return disassociateNodeRequests;\n  };\n\n  useEffect(() => {\n    async function fetchData() {\n      try {\n        const workflowNodes = await fetchWorkflowNodes(template.id);\n        dispatch({\n          type: 'GENERATE_NODES_AND_LINKS',\n          nodes: workflowNodes,\n        });\n      } catch (error) {\n        dispatch({ type: 'SET_CONTENT_ERROR', value: error });\n      } finally {\n        dispatch({ type: 'SET_IS_LOADING', value: false });\n      }\n    }\n    fetchData();\n  }, [template.id]);\n\n  // Update positions of nodes/links\n  useEffect(() => {\n    if (nodes) {\n      const newNodePositions = {};\n      const nonDeletedNodes = nodes.filter((node) => !node.isDeleted);\n      const g = layoutGraph(nonDeletedNodes, links);\n\n      g.nodes().forEach((node) => {\n        newNodePositions[node] = g.node(node);\n      });\n\n      dispatch({ type: 'SET_NODE_POSITIONS', value: newNodePositions });\n    }\n  }, [links, nodes]);\n\n  const {\n    error: saveVisualizerError,\n    isLoading: isSavingVisualizer,\n    request: saveVisualizer,\n  } = useRequest(\n    useCallback(async () => {\n      const nodeRequests = [];\n      const approvalTemplateRequests = [];\n      const originalLinkMap = {};\n      const deletedNodeIds = [];\n      const associateCredentialRequests = [];\n      const disassociateCredentialRequests = [];\n\n      const generateLinkMapAndNewLinks = () => {\n        const linkMap = {};\n        const newLinks = [];\n\n        links.forEach((link) => {\n          if (link.source.id !== 1) {\n            const realLinkSourceId = originalLinkMap[link.source.id].id;\n            const realLinkTargetId = originalLinkMap[link.target.id].id;\n            if (!linkMap[realLinkSourceId]) {\n              linkMap[realLinkSourceId] = {};\n            }\n            linkMap[realLinkSourceId][realLinkTargetId] = link.linkType;\n            switch (link.linkType) {\n              case 'success':\n                if (\n                  !originalLinkMap[link.source.id].success_nodes.includes(\n                    originalLinkMap[link.target.id].id\n                  )\n                ) {\n                  newLinks.push(link);\n                }\n                break;\n              case 'failure':\n                if (\n                  !originalLinkMap[link.source.id].failure_nodes.includes(\n                    originalLinkMap[link.target.id].id\n                  )\n                ) {\n                  newLinks.push(link);\n                }\n                break;\n              case 'always':\n                if (\n                  !originalLinkMap[link.source.id].always_nodes.includes(\n                    originalLinkMap[link.target.id].id\n                  )\n                ) {\n                  newLinks.push(link);\n                }\n                break;\n              default:\n            }\n          }\n        });\n\n        return [linkMap, newLinks];\n      };\n\n      nodes.forEach((node) => {\n        // node with id=1 is the artificial start node\n        if (node.id === 1) {\n          return;\n        }\n        if (node.originalNodeObject && !node.isDeleted) {\n          const { id, success_nodes, failure_nodes, always_nodes } =\n            node.originalNodeObject;\n          originalLinkMap[node.id] = {\n            id,\n            success_nodes,\n            failure_nodes,\n            always_nodes,\n          };\n        }\n        if (node.isDeleted && node.originalNodeObject) {\n          deletedNodeIds.push(node.originalNodeObject.id);\n          nodeRequests.push(\n            WorkflowJobTemplateNodesAPI.destroy(node.originalNodeObject.id)\n          );\n        } else if (!node.isDeleted && !node.originalNodeObject) {\n          if (\n            node.fullUnifiedJobTemplate.type === 'workflow_approval_template'\n          ) {\n            nodeRequests.push(\n              WorkflowJobTemplatesAPI.createNode(template.id, {\n                all_parents_must_converge: node.all_parents_must_converge,\n                ...(node.identifier && { identifier: node.identifier }),\n              }).then(({ data }) => {\n                node.originalNodeObject = data;\n                originalLinkMap[node.id] = {\n                  id: data.id,\n                  success_nodes: [],\n                  failure_nodes: [],\n                  always_nodes: [],\n                };\n                approvalTemplateRequests.push(\n                  WorkflowJobTemplateNodesAPI.createApprovalTemplate(data.id, {\n                    name: node.fullUnifiedJobTemplate.name,\n                    description: node.fullUnifiedJobTemplate.description,\n                    timeout: node.fullUnifiedJobTemplate.timeout,\n                  })\n                );\n              })\n            );\n          } else {\n            nodeRequests.push(\n              WorkflowJobTemplatesAPI.createNode(template.id, {\n                ...node.promptValues,\n                inventory: node.promptValues?.inventory?.id || null,\n                unified_job_template: node.fullUnifiedJobTemplate.id,\n                all_parents_must_converge: node.all_parents_must_converge,\n                ...(node.identifier && { identifier: node.identifier }),\n              }).then(({ data }) => {\n                node.originalNodeObject = data;\n                originalLinkMap[node.id] = {\n                  id: data.id,\n                  success_nodes: [],\n                  failure_nodes: [],\n                  always_nodes: [],\n                };\n\n                if (node.promptValues?.addedCredentials?.length > 0) {\n                  node.promptValues.addedCredentials.forEach((cred) => {\n                    associateCredentialRequests.push(\n                      WorkflowJobTemplateNodesAPI.associateCredentials(\n                        data.id,\n                        cred.id\n                      )\n                    );\n                  });\n                }\n              })\n            );\n          }\n        } else if (node.isEdited) {\n          if (\n            node.fullUnifiedJobTemplate.type === 'workflow_approval_template'\n          ) {\n            if (\n              node.originalNodeObject.summary_fields.unified_job_template\n                ?.unified_job_type === 'workflow_approval'\n            ) {\n              nodeRequests.push(\n                WorkflowJobTemplateNodesAPI.replace(\n                  node.originalNodeObject.id,\n                  {\n                    all_parents_must_converge: node.all_parents_must_converge,\n                    ...(replaceIdentifier(node) && {\n                      identifier: node.identifier,\n                    }),\n                  }\n                ).then(({ data }) => {\n                  node.originalNodeObject = data;\n                  approvalTemplateRequests.push(\n                    WorkflowApprovalTemplatesAPI.update(\n                      node.originalNodeObject.summary_fields\n                        .unified_job_template.id,\n                      {\n                        name: node.fullUnifiedJobTemplate.name,\n                        description: node.fullUnifiedJobTemplate.description,\n                        timeout: node.fullUnifiedJobTemplate.timeout,\n                      }\n                    )\n                  );\n                })\n              );\n            } else {\n              nodeRequests.push(\n                WorkflowJobTemplateNodesAPI.replace(\n                  node.originalNodeObject.id,\n                  {\n                    all_parents_must_converge: node.all_parents_must_converge,\n                    ...(replaceIdentifier(node) && {\n                      identifier: node.identifier,\n                    }),\n                  }\n                ).then(({ data }) => {\n                  node.originalNodeObject = data;\n                  approvalTemplateRequests.push(\n                    WorkflowJobTemplateNodesAPI.createApprovalTemplate(\n                      node.originalNodeObject.id,\n                      {\n                        name: node.fullUnifiedJobTemplate.name,\n                        description: node.fullUnifiedJobTemplate.description,\n                        timeout: node.fullUnifiedJobTemplate.timeout,\n                      }\n                    )\n                  );\n                })\n              );\n            }\n          } else {\n            nodeRequests.push(\n              WorkflowJobTemplateNodesAPI.replace(node.originalNodeObject.id, {\n                ...node.promptValues,\n                inventory: node.promptValues?.inventory?.id || null,\n                unified_job_template: node.fullUnifiedJobTemplate.id,\n                all_parents_must_converge: node.all_parents_must_converge,\n                ...(replaceIdentifier(node) && {\n                  identifier: node.identifier,\n                }),\n              }).then(() => {\n                const { added: addedCredentials, removed: removedCredentials } =\n                  getAddedAndRemoved(\n                    getAggregatedCredentials(\n                      node?.originalNodeCredentials,\n                      node.launchConfig?.defaults?.credentials\n                    ),\n                    node.promptValues?.credentials\n                  );\n\n                if (addedCredentials.length > 0) {\n                  addedCredentials.forEach((cred) => {\n                    associateCredentialRequests.push(\n                      WorkflowJobTemplateNodesAPI.associateCredentials(\n                        node.originalNodeObject.id,\n                        cred.id\n                      )\n                    );\n                  });\n                }\n                if (removedCredentials?.length > 0) {\n                  removedCredentials.forEach((cred) =>\n                    disassociateCredentialRequests.push(\n                      WorkflowJobTemplateNodesAPI.disassociateCredentials(\n                        node.originalNodeObject.id,\n                        cred.id\n                      )\n                    )\n                  );\n                }\n              })\n            );\n          }\n        }\n      });\n\n      await Promise.all(nodeRequests);\n      // Creating approval templates needs to happen after the node has been created\n      // since we reference the node in the approval template request.\n      await Promise.all(approvalTemplateRequests);\n      const [linkMap, newLinks] = generateLinkMapAndNewLinks(originalLinkMap);\n      await Promise.all(\n        disassociateNodes(originalLinkMap, deletedNodeIds, linkMap)\n      );\n      await Promise.all(associateNodes(newLinks, originalLinkMap));\n\n      await Promise.all(disassociateCredentialRequests);\n      await Promise.all(associateCredentialRequests);\n\n      history.push(`/templates/workflow_job_template/${template.id}/details`);\n    }, [links, nodes, history, template.id]),\n    {}\n  );\n\n  const { error: nodeRequestError, dismissError: dismissNodeRequestError } =\n    useDismissableError(saveVisualizerError);\n\n  if (isLoading || isSavingVisualizer) {\n    return (\n      <CenteredContent>\n        <ContentLoading />\n      </CenteredContent>\n    );\n  }\n\n  if (contentError) {\n    return (\n      <CenteredContent>\n        <ContentError error={contentError} />\n      </CenteredContent>\n    );\n  }\n\n  const readOnly = !template?.summary_fields?.user_capabilities?.edit;\n\n  return (\n    <WorkflowStateContext.Provider value={state}>\n      <WorkflowDispatchContext.Provider value={dispatch}>\n        <Wrapper>\n          <VisualizerToolbar\n            onClose={handleVisualizerClose}\n            onSave={() => saveVisualizer(nodes)}\n            hasUnsavedChanges={unsavedChanges}\n            template={template}\n            readOnly={readOnly}\n          />\n          {links.length > 0 ? (\n            <VisualizerGraph readOnly={readOnly} />\n          ) : (\n            <VisualizerStartScreen readOnly={readOnly} />\n          )}\n        </Wrapper>\n        {nodeToDelete && <NodeDeleteModal />}\n        {linkToDelete && <LinkDeleteModal />}\n        {linkToEdit && <LinkEditModal />}\n        {addLinkSourceNode && addLinkTargetNode && <LinkAddModal />}\n        {addNodeSource && <NodeAddModal />}\n        {nodeToEdit && <NodeEditModal />}\n        {showUnsavedChangesModal && (\n          <UnsavedChangesModal\n            onExit={() =>\n              history.push(\n                `/templates/workflow_job_template/${template.id}/details`\n              )\n            }\n            onSaveAndExit={() => saveVisualizer(nodes)}\n          />\n        )}\n        {showDeleteAllNodesModal && <DeleteAllNodesModal />}\n        {nodeToView && <NodeViewModal readOnly={readOnly} />}\n        {nodeRequestError && (\n          <AlertModal\n            isOpen\n            variant=\"error\"\n            title={t`Error saving the workflow!`}\n            onClose={dismissNodeRequestError}\n            aria-label={t`Error saving the workflow!`}\n          >\n            {t`There was an error saving the workflow.`}\n            <ErrorDetail error={nodeRequestError} />\n          </AlertModal>\n        )}\n      </WorkflowDispatchContext.Provider>\n    </WorkflowStateContext.Provider>\n  );\n}\n\nVisualizer.propTypes = {\n  template: shape().isRequired,\n};\n\nexport default Visualizer;\n"]},"metadata":{},"sourceType":"module"}