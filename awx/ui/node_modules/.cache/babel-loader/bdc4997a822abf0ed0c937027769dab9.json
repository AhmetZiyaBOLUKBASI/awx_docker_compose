{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useContext,useEffect,useCallback}from'react';import{Button,Modal}from'@patternfly/react-core';import{WorkflowDispatchContext,WorkflowStateContext}from'contexts/Workflow';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import PromptDetail from'components/PromptDetail';import useRequest from'hooks/useRequest';import{jsonToYaml}from'util/yaml';import{JobTemplatesAPI,WorkflowJobTemplatesAPI}from'api';import getNodeType from'../../shared/WorkflowJobTemplateVisualizerUtils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function NodeViewModal(_ref){var _originalNodeObject$s,_originalNodeObject$s2;var readOnly=_ref.readOnly;var dispatch=useContext(WorkflowDispatchContext);var _useContext=useContext(WorkflowStateContext),nodeToView=_useContext.nodeToView;var fullUnifiedJobTemplate=nodeToView.fullUnifiedJobTemplate,originalNodeCredentials=nodeToView.originalNodeCredentials,originalNodeObject=nodeToView.originalNodeObject,promptValues=nodeToView.promptValues;var _getNodeType=getNodeType(fullUnifiedJobTemplate||(originalNodeObject===null||originalNodeObject===void 0?void 0:(_originalNodeObject$s=originalNodeObject.summary_fields)===null||_originalNodeObject$s===void 0?void 0:_originalNodeObject$s.unified_job_template)),_getNodeType2=_slicedToArray(_getNodeType,2),nodeType=_getNodeType2[0],nodeAPI=_getNodeType2[1];var id=(fullUnifiedJobTemplate===null||fullUnifiedJobTemplate===void 0?void 0:fullUnifiedJobTemplate.id)||(originalNodeObject===null||originalNodeObject===void 0?void 0:(_originalNodeObject$s2=originalNodeObject.summary_fields)===null||_originalNodeObject$s2===void 0?void 0:_originalNodeObject$s2.unified_job_template.id);var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var readLaunch,_yield$readLaunch,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:readLaunch=nodeType==='workflow_job_template'?WorkflowJobTemplatesAPI.readLaunch(id):JobTemplatesAPI.readLaunch(id);_context.next=3;return readLaunch;case 3:_yield$readLaunch=_context.sent;data=_yield$readLaunch.data;return _context.abrupt(\"return\",data);case 6:case\"end\":return _context.stop();}}},_callee);})),[nodeType,id]),{}),launchConfig=_useRequest.result,isLaunchConfigLoading=_useRequest.isLoading,launchConfigError=_useRequest.error,fetchLaunchConfig=_useRequest.request;var _useRequest2=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _fullUnifiedJobTempla;var related,_yield$JobTemplatesAP,_yield$JobTemplatesAP2,results,webhook_key,_yield$nodeAPI$readWe,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:related={};if(!(nodeType==='job_template'&&!fullUnifiedJobTemplate.instance_groups)){_context2.next=8;break;}_context2.next=4;return JobTemplatesAPI.readInstanceGroups(fullUnifiedJobTemplate.id);case 4:_yield$JobTemplatesAP=_context2.sent;_yield$JobTemplatesAP2=_yield$JobTemplatesAP.data.results;results=_yield$JobTemplatesAP2===void 0?[]:_yield$JobTemplatesAP2;related.instance_groups=results;case 8:if(!(fullUnifiedJobTemplate!==null&&fullUnifiedJobTemplate!==void 0&&(_fullUnifiedJobTempla=fullUnifiedJobTemplate.related)!==null&&_fullUnifiedJobTempla!==void 0&&_fullUnifiedJobTempla.webhook_receiver&&!fullUnifiedJobTemplate.webhook_key)){_context2.next=17;break;}webhook_key=null;if(!nodeAPI){_context2.next=16;break;}_context2.next=13;return nodeAPI.readWebhookKey(fullUnifiedJobTemplate.id);case 13:_yield$nodeAPI$readWe=_context2.sent;data=_yield$nodeAPI$readWe.data;webhook_key=data.webhook_key;case 16:related.webhook_key=webhook_key;case 17:return _context2.abrupt(\"return\",related);case 18:case\"end\":return _context2.stop();}}},_callee2);})),[nodeAPI,fullUnifiedJobTemplate,nodeType]),null),relatedData=_useRequest2.result,isRelatedDataLoading=_useRequest2.isLoading,relatedDataError=_useRequest2.error,fetchRelatedData=_useRequest2.request;useEffect(function(){var _fullUnifiedJobTempla2;if(nodeType==='workflow_job_template'||nodeType==='job_template'){fetchLaunchConfig();}if(fullUnifiedJobTemplate&&(nodeType==='job_template'&&!fullUnifiedJobTemplate.instance_groups||fullUnifiedJobTemplate!==null&&fullUnifiedJobTemplate!==void 0&&(_fullUnifiedJobTempla2=fullUnifiedJobTemplate.related)!==null&&_fullUnifiedJobTempla2!==void 0&&_fullUnifiedJobTempla2.webhook_receiver&&!fullUnifiedJobTemplate.webhook_key)){fetchRelatedData();}},[]);// eslint-disable-line react-hooks/exhaustive-deps\nuseEffect(function(){if(relatedData){dispatch({type:'REFRESH_NODE',node:{fullUnifiedJobTemplate:_objectSpread(_objectSpread({},fullUnifiedJobTemplate),relatedData)}});}},[relatedData]);// eslint-disable-line react-hooks/exhaustive-deps\nvar handleEdit=function handleEdit(){dispatch({type:'SET_NODE_TO_VIEW',value:null});dispatch({type:'SET_NODE_TO_EDIT',value:nodeToView});};var Content;if(isLaunchConfigLoading||isRelatedDataLoading){Content=/*#__PURE__*/_jsx(ContentLoading,{});}else if(launchConfigError||relatedDataError){Content=/*#__PURE__*/_jsx(ContentError,{error:launchConfigError||relatedDataError});}else if(!fullUnifiedJobTemplate){Content=/*#__PURE__*/_jsxs(\"p\",{children:[/*i18n*/i18n._(\"The resource associated with this node has been deleted.\"),\"\\xA0\\xA0\",!readOnly?/*i18n*/i18n._(\"Click the Edit button below to reconfigure the node.\"):'']});}else{var _nodeToView$originalN;var overrides={};if(promptValues){overrides=promptValues;if(launchConfig.ask_variables_on_launch||launchConfig.survey_enabled||fullUnifiedJobTemplate.type==='system_job_template'&&promptValues.extra_data){overrides.extra_vars=jsonToYaml(JSON.stringify(promptValues.extra_data));}}else if(fullUnifiedJobTemplate.id===(originalNodeObject===null||originalNodeObject===void 0?void 0:originalNodeObject.unified_job_template)){if(launchConfig.ask_inventory_on_launch){overrides.inventory=originalNodeObject.summary_fields.inventory;}if(launchConfig.ask_scm_branch_on_launch){overrides.scm_branch=originalNodeObject.scm_branch;}if(launchConfig.ask_variables_on_launch||launchConfig.survey_enabled||fullUnifiedJobTemplate.type==='system_job_template'){overrides.extra_vars=jsonToYaml(JSON.stringify(originalNodeObject.extra_data));}if(launchConfig.ask_tags_on_launch){overrides.job_tags=originalNodeObject.job_tags;}if(launchConfig.ask_diff_mode_on_launch){overrides.diff_mode=originalNodeObject.diff_mode;}if(launchConfig.ask_skip_tags_on_launch){overrides.skip_tags=originalNodeObject.skip_tags;}if(launchConfig.ask_job_type_on_launch){overrides.job_type=originalNodeObject.job_type;}if(launchConfig.ask_limit_on_launch){overrides.limit=originalNodeObject.limit;}if(launchConfig.ask_verbosity_on_launch){overrides.verbosity=originalNodeObject.verbosity.toString();}if(launchConfig.ask_credential_on_launch){overrides.credentials=originalNodeCredentials||[];}}var nodeUpdatedConvergence={};if((nodeToView===null||nodeToView===void 0?void 0:nodeToView.all_parents_must_converge)!==undefined&&(nodeToView===null||nodeToView===void 0?void 0:nodeToView.all_parents_must_converge)!==(nodeToView===null||nodeToView===void 0?void 0:(_nodeToView$originalN=nodeToView.originalNodeObject)===null||_nodeToView$originalN===void 0?void 0:_nodeToView$originalN.all_parents_must_converge)){nodeUpdatedConvergence=_objectSpread(_objectSpread({},nodeToView.originalNodeObject),{},{all_parents_must_converge:nodeToView.all_parents_must_converge});}else{nodeUpdatedConvergence=_objectSpread(_objectSpread({},nodeToView.originalNodeObject),{},{all_parents_must_converge:nodeToView===null||nodeToView===void 0?void 0:nodeToView.all_parents_must_converge});}Content=/*#__PURE__*/_jsx(PromptDetail,{launchConfig:launchConfig,resource:fullUnifiedJobTemplate,overrides:overrides,workflowNode:nodeUpdatedConvergence});}return/*#__PURE__*/_jsx(Modal,{variant:\"large\",isOpen:true,title:(fullUnifiedJobTemplate===null||fullUnifiedJobTemplate===void 0?void 0:fullUnifiedJobTemplate.name)||/*i18n*/i18n._(\"Resource deleted\"),\"aria-label\":/*i18n*/i18n._(\"Workflow node view modal\"),onClose:function onClose(){return dispatch({type:'SET_NODE_TO_VIEW',value:null});},actions:readOnly?[]:[/*#__PURE__*/_jsx(Button,{ouiaId:\"node-view-edit-button\",id:\"node-view-edit-button\",\"aria-label\":/*i18n*/i18n._(\"Edit Node\"),onClick:handleEdit,children:/*i18n*/i18n._(\"Edit\")},\"edit\")],children:Content});}export default NodeViewModal;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Template/WorkflowJobTemplateVisualizer/Modals/NodeModals/NodeViewModal.js"],"names":["React","useContext","useEffect","useCallback","Button","Modal","WorkflowDispatchContext","WorkflowStateContext","ContentError","ContentLoading","PromptDetail","useRequest","jsonToYaml","JobTemplatesAPI","WorkflowJobTemplatesAPI","getNodeType","NodeViewModal","readOnly","dispatch","nodeToView","fullUnifiedJobTemplate","originalNodeCredentials","originalNodeObject","promptValues","summary_fields","unified_job_template","nodeType","nodeAPI","id","readLaunch","data","launchConfig","result","isLaunchConfigLoading","isLoading","launchConfigError","error","fetchLaunchConfig","request","related","instance_groups","readInstanceGroups","results","webhook_receiver","webhook_key","readWebhookKey","relatedData","isRelatedDataLoading","relatedDataError","fetchRelatedData","type","node","handleEdit","value","Content","overrides","ask_variables_on_launch","survey_enabled","extra_data","extra_vars","JSON","stringify","ask_inventory_on_launch","inventory","ask_scm_branch_on_launch","scm_branch","ask_tags_on_launch","job_tags","ask_diff_mode_on_launch","diff_mode","ask_skip_tags_on_launch","skip_tags","ask_job_type_on_launch","job_type","ask_limit_on_launch","limit","ask_verbosity_on_launch","verbosity","toString","ask_credential_on_launch","credentials","nodeUpdatedConvergence","all_parents_must_converge","undefined","name"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useCallback } from 'react';\n\nimport { t } from '@lingui/macro';\nimport { Button, Modal } from '@patternfly/react-core';\nimport {\n  WorkflowDispatchContext,\n  WorkflowStateContext,\n} from 'contexts/Workflow';\n\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport PromptDetail from 'components/PromptDetail';\nimport useRequest from 'hooks/useRequest';\nimport { jsonToYaml } from 'util/yaml';\nimport { JobTemplatesAPI, WorkflowJobTemplatesAPI } from 'api';\nimport getNodeType from '../../shared/WorkflowJobTemplateVisualizerUtils';\n\nfunction NodeViewModal({ readOnly }) {\n  const dispatch = useContext(WorkflowDispatchContext);\n  const { nodeToView } = useContext(WorkflowStateContext);\n  const {\n    fullUnifiedJobTemplate,\n    originalNodeCredentials,\n    originalNodeObject,\n    promptValues,\n  } = nodeToView;\n  const [nodeType, nodeAPI] = getNodeType(\n    fullUnifiedJobTemplate ||\n      originalNodeObject?.summary_fields?.unified_job_template\n  );\n\n  const id =\n    fullUnifiedJobTemplate?.id ||\n    originalNodeObject?.summary_fields?.unified_job_template.id;\n\n  const {\n    result: launchConfig,\n    isLoading: isLaunchConfigLoading,\n    error: launchConfigError,\n    request: fetchLaunchConfig,\n  } = useRequest(\n    useCallback(async () => {\n      const readLaunch =\n        nodeType === 'workflow_job_template'\n          ? WorkflowJobTemplatesAPI.readLaunch(id)\n          : JobTemplatesAPI.readLaunch(id);\n      const { data } = await readLaunch;\n      return data;\n    }, [nodeType, id]),\n    {}\n  );\n\n  const {\n    result: relatedData,\n    isLoading: isRelatedDataLoading,\n    error: relatedDataError,\n    request: fetchRelatedData,\n  } = useRequest(\n    useCallback(async () => {\n      const related = {};\n      if (\n        nodeType === 'job_template' &&\n        !fullUnifiedJobTemplate.instance_groups\n      ) {\n        const {\n          data: { results = [] },\n        } = await JobTemplatesAPI.readInstanceGroups(fullUnifiedJobTemplate.id);\n        related.instance_groups = results;\n      }\n\n      if (\n        fullUnifiedJobTemplate?.related?.webhook_receiver &&\n        !fullUnifiedJobTemplate.webhook_key\n      ) {\n        let webhook_key = null;\n        if (nodeAPI) {\n          const { data } = await nodeAPI.readWebhookKey(\n            fullUnifiedJobTemplate.id\n          );\n          webhook_key = data.webhook_key;\n        }\n\n        related.webhook_key = webhook_key;\n      }\n\n      return related;\n    }, [nodeAPI, fullUnifiedJobTemplate, nodeType]),\n    null\n  );\n\n  useEffect(() => {\n    if (nodeType === 'workflow_job_template' || nodeType === 'job_template') {\n      fetchLaunchConfig();\n    }\n\n    if (\n      fullUnifiedJobTemplate &&\n      ((nodeType === 'job_template' &&\n        !fullUnifiedJobTemplate.instance_groups) ||\n        (fullUnifiedJobTemplate?.related?.webhook_receiver &&\n          !fullUnifiedJobTemplate.webhook_key))\n    ) {\n      fetchRelatedData();\n    }\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(() => {\n    if (relatedData) {\n      dispatch({\n        type: 'REFRESH_NODE',\n        node: {\n          fullUnifiedJobTemplate: { ...fullUnifiedJobTemplate, ...relatedData },\n        },\n      });\n    }\n  }, [relatedData]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const handleEdit = () => {\n    dispatch({ type: 'SET_NODE_TO_VIEW', value: null });\n    dispatch({ type: 'SET_NODE_TO_EDIT', value: nodeToView });\n  };\n\n  let Content;\n  if (isLaunchConfigLoading || isRelatedDataLoading) {\n    Content = <ContentLoading />;\n  } else if (launchConfigError || relatedDataError) {\n    Content = <ContentError error={launchConfigError || relatedDataError} />;\n  } else if (!fullUnifiedJobTemplate) {\n    Content = (\n      <p>\n        {t`The resource associated with this node has been deleted.`}\n        &nbsp;&nbsp;\n        {!readOnly\n          ? t`Click the Edit button below to reconfigure the node.`\n          : ''}\n      </p>\n    );\n  } else {\n    let overrides = {};\n\n    if (promptValues) {\n      overrides = promptValues;\n\n      if (\n        launchConfig.ask_variables_on_launch ||\n        launchConfig.survey_enabled ||\n        (fullUnifiedJobTemplate.type === 'system_job_template' &&\n          promptValues.extra_data)\n      ) {\n        overrides.extra_vars = jsonToYaml(\n          JSON.stringify(promptValues.extra_data)\n        );\n      }\n    } else if (\n      fullUnifiedJobTemplate.id === originalNodeObject?.unified_job_template\n    ) {\n      if (launchConfig.ask_inventory_on_launch) {\n        overrides.inventory = originalNodeObject.summary_fields.inventory;\n      }\n      if (launchConfig.ask_scm_branch_on_launch) {\n        overrides.scm_branch = originalNodeObject.scm_branch;\n      }\n      if (\n        launchConfig.ask_variables_on_launch ||\n        launchConfig.survey_enabled ||\n        fullUnifiedJobTemplate.type === 'system_job_template'\n      ) {\n        overrides.extra_vars = jsonToYaml(\n          JSON.stringify(originalNodeObject.extra_data)\n        );\n      }\n      if (launchConfig.ask_tags_on_launch) {\n        overrides.job_tags = originalNodeObject.job_tags;\n      }\n      if (launchConfig.ask_diff_mode_on_launch) {\n        overrides.diff_mode = originalNodeObject.diff_mode;\n      }\n      if (launchConfig.ask_skip_tags_on_launch) {\n        overrides.skip_tags = originalNodeObject.skip_tags;\n      }\n      if (launchConfig.ask_job_type_on_launch) {\n        overrides.job_type = originalNodeObject.job_type;\n      }\n      if (launchConfig.ask_limit_on_launch) {\n        overrides.limit = originalNodeObject.limit;\n      }\n      if (launchConfig.ask_verbosity_on_launch) {\n        overrides.verbosity = originalNodeObject.verbosity.toString();\n      }\n      if (launchConfig.ask_credential_on_launch) {\n        overrides.credentials = originalNodeCredentials || [];\n      }\n    }\n\n    let nodeUpdatedConvergence = {};\n\n    if (\n      nodeToView?.all_parents_must_converge !== undefined &&\n      nodeToView?.all_parents_must_converge !==\n        nodeToView?.originalNodeObject?.all_parents_must_converge\n    ) {\n      nodeUpdatedConvergence = {\n        ...nodeToView.originalNodeObject,\n        all_parents_must_converge: nodeToView.all_parents_must_converge,\n      };\n    } else {\n      nodeUpdatedConvergence = {\n        ...nodeToView.originalNodeObject,\n        all_parents_must_converge: nodeToView?.all_parents_must_converge,\n      };\n    }\n\n    Content = (\n      <PromptDetail\n        launchConfig={launchConfig}\n        resource={fullUnifiedJobTemplate}\n        overrides={overrides}\n        workflowNode={nodeUpdatedConvergence}\n      />\n    );\n  }\n\n  return (\n    <Modal\n      variant=\"large\"\n      isOpen\n      title={fullUnifiedJobTemplate?.name || t`Resource deleted`}\n      aria-label={t`Workflow node view modal`}\n      onClose={() => dispatch({ type: 'SET_NODE_TO_VIEW', value: null })}\n      actions={\n        readOnly\n          ? []\n          : [\n              <Button\n                ouiaId=\"node-view-edit-button\"\n                id=\"node-view-edit-button\"\n                key=\"edit\"\n                aria-label={t`Edit Node`}\n                onClick={handleEdit}\n              >\n                {t`Edit`}\n              </Button>,\n            ]\n      }\n    >\n      {Content}\n    </Modal>\n  );\n}\n\nexport default NodeViewModal;\n"]},"metadata":{},"sourceType":"module"}