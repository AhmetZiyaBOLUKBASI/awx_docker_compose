{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject;import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback}from'react';import{Link,useHistory}from'react-router-dom';import styled from'styled-components';import{Button,ClipboardCopy,TextList,TextListItem,TextListVariants,TextListItemVariants,Tooltip}from'@patternfly/react-core';import{Project}from'types';import{Config,useConfig}from'contexts/Config';import AlertModal from'components/AlertModal';import{CardBody,CardActionsRow}from'components/Card';import DeleteButton from'components/DeleteButton';import{DetailList,Detail,UserDateDetail}from'components/DetailList';import ErrorDetail from'components/ErrorDetail';import JobCancelButton from'components/JobCancelButton';import ExecutionEnvironmentDetail from'components/ExecutionEnvironmentDetail';import CredentialChip from'components/CredentialChip';import{ProjectsAPI}from'api';import{toTitleCase}from'util/strings';import useRequest,{useDismissableError}from'hooks/useRequest';import useBrandName from'hooks/useBrandName';import{relatedResourceDeleteRequests}from'util/getRelatedResourceDeleteDetails';import StatusLabel from'components/StatusLabel';import{formatDateString}from'util/dates';import Popover from'components/Popover';import getDocsBaseUrl from'util/getDocsBaseUrl';import ProjectSyncButton from'../shared/ProjectSyncButton';import projectHelpText from'../shared/Project.helptext';import useWsProject from'./useWsProject';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Label=styled.span(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  color: var(--pf-global--disabled-color--100);\\n\"])));function ProjectDetail(_ref){var _summary_fields$user_,_summary_fields$user_2,_job,_summary_fields$user_3,_job2;var project=_ref.project;var _useWsProject=useWsProject(project),allow_override=_useWsProject.allow_override,created=_useWsProject.created,custom_virtualenv=_useWsProject.custom_virtualenv,description=_useWsProject.description,id=_useWsProject.id,local_path=_useWsProject.local_path,modified=_useWsProject.modified,name=_useWsProject.name,scm_branch=_useWsProject.scm_branch,scm_clean=_useWsProject.scm_clean,scm_delete_on_update=_useWsProject.scm_delete_on_update,scm_track_submodules=_useWsProject.scm_track_submodules,scm_refspec=_useWsProject.scm_refspec,scm_revision=_useWsProject.scm_revision,scm_type=_useWsProject.scm_type,scm_update_on_launch=_useWsProject.scm_update_on_launch,scm_update_cache_timeout=_useWsProject.scm_update_cache_timeout,scm_url=_useWsProject.scm_url,summary_fields=_useWsProject.summary_fields;var docsURL=\"\".concat(getDocsBaseUrl(useConfig()),\"/html/userguide/projects.html#manage-playbooks-using-source-control\");var history=useHistory();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return ProjectsAPI.destroy(id);case 2:history.push(\"/projects\");case 3:case\"end\":return _context.stop();}}},_callee);})),[id,history])),deleteProject=_useRequest.request,isLoading=_useRequest.isLoading,deleteError=_useRequest.error;var brandName=useBrandName();var _useDismissableError=useDismissableError(deleteError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;var deleteDetailsRequests=relatedResourceDeleteRequests.project(project);var optionsList='';if(scm_clean||scm_delete_on_update||scm_track_submodules||scm_update_on_launch||allow_override){optionsList=/*#__PURE__*/_jsxs(TextList,{component:TextListVariants.ul,children:[scm_clean&&/*#__PURE__*/_jsxs(TextListItem,{component:TextListItemVariants.li,children:[/*i18n*/i18n._(\"Discard local changes before syncing\"),/*#__PURE__*/_jsx(Popover,{content:projectHelpText.options.clean})]}),scm_delete_on_update&&/*#__PURE__*/_jsxs(TextListItem,{component:TextListItemVariants.li,children:[/*i18n*/i18n._(\"Delete the project before syncing\"),' ',/*#__PURE__*/_jsx(Popover,{content:projectHelpText.options.delete,id:\"scm-delete-on-update\"})]}),scm_track_submodules&&/*#__PURE__*/_jsxs(TextListItem,{component:TextListItemVariants.li,children:[/*i18n*/i18n._(\"Track submodules latest commit on branch\"),' ',/*#__PURE__*/_jsx(Popover,{content:projectHelpText.options.trackSubModules})]}),scm_update_on_launch&&/*#__PURE__*/_jsxs(TextListItem,{component:TextListItemVariants.li,children:[/*i18n*/i18n._(\"Update revision on job launch\"),' ',/*#__PURE__*/_jsx(Popover,{content:projectHelpText.options.updateOnLaunch})]}),allow_override&&/*#__PURE__*/_jsxs(TextListItem,{component:TextListItemVariants.li,children:[/*i18n*/i18n._(\"Allow branch override\"),' ',/*#__PURE__*/_jsx(Popover,{content:projectHelpText.options.allowBranchOverride})]})]});}var generateLastJobTooltip=function generateLastJobTooltip(job){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{children:/*i18n*/i18n._(\"MOST RECENT SYNC\")}),/*#__PURE__*/_jsxs(\"div\",{children:[/*i18n*/i18n._(\"JOB ID:\"),\" \",job.id]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*i18n*/i18n._(\"STATUS:\"),\" \",job.status.toUpperCase()]}),job.finished&&/*#__PURE__*/_jsxs(\"div\",{children:[/*i18n*/i18n._(\"FINISHED:\"),\" \",formatDateString(job.finished)]})]});};var job=null;if(summary_fields!==null&&summary_fields!==void 0&&summary_fields.current_job){job=summary_fields.current_job;}else if(summary_fields!==null&&summary_fields!==void 0&&summary_fields.last_job){job=summary_fields.last_job;}var getSourceControlUrlHelpText=function getSourceControlUrlHelpText(){return scm_type==='git'?projectHelpText.githubSourceControlUrl:projectHelpText.svnSourceControlUrl;};return/*#__PURE__*/_jsxs(CardBody,{children:[/*#__PURE__*/_jsxs(DetailList,{gutter:\"sm\",children:[/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Last Job Status\"),value:job&&/*#__PURE__*/_jsx(Tooltip,{position:\"top\",content:generateLastJobTooltip(job),children:/*#__PURE__*/_jsx(Link,{to:\"/jobs/project/\".concat(job.id),children:/*#__PURE__*/_jsx(StatusLabel,{status:job.status})})},job.id)}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Name\"),value:name,dataCy:\"project-detail-name\"}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Description\"),value:description}),summary_fields.organization&&/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Organization\"),value:/*#__PURE__*/_jsx(Link,{to:\"/organizations/\".concat(summary_fields.organization.id,\"/details\"),children:summary_fields.organization.name})}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Source Control Type\"),value:scm_type===''?/*i18n*/i18n._(\"Manual\"):toTitleCase(project.scm_type)}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Source Control Revision\"),value:scm_revision?/*#__PURE__*/_jsx(ClipboardCopy,{\"data-cy\":\"project-copy-revision\",variant:\"inline-compact\",clickTip:/*i18n*/i18n._(\"Successfully copied to clipboard!\"),hoverTip:/*i18n*/i18n._(\"Copy full revision to clipboard.\"),onCopy:function onCopy(){return navigator.clipboard.writeText(scm_revision.toString());},children:scm_revision.substring(0,7)}):/*#__PURE__*/_jsx(Label,{\"aria-label\":/*i18n*/i18n._(\"The project must be synced before a revision is available.\"),children:/*i18n*/i18n._(\"Sync for revision\")}),alwaysVisible:true}),/*#__PURE__*/_jsx(Detail,{helpText:scm_type==='git'||scm_type==='svn'?getSourceControlUrlHelpText():'',label:/*i18n*/i18n._(\"Source Control URL\"),value:scm_url}),/*#__PURE__*/_jsx(Detail,{helpText:projectHelpText.branchFormField,label:/*i18n*/i18n._(\"Source Control Branch\"),value:scm_branch}),/*#__PURE__*/_jsx(Detail,{helpText:projectHelpText.sourceControlRefspec(docsURL),label:/*i18n*/i18n._(\"Source Control Refspec\"),value:scm_refspec}),summary_fields.credential&&/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Source Control Credential\"),value:/*#__PURE__*/_jsx(CredentialChip,{credential:summary_fields.credential,isReadOnly:true},summary_fields.credential.id)}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Cache Timeout\"),value:\"\".concat(scm_update_cache_timeout,\" \").concat(/*i18n*/i18n._(\"Seconds\"))}),/*#__PURE__*/_jsx(ExecutionEnvironmentDetail,{helpText:projectHelpText.executionEnvironment,virtualEnvironment:custom_virtualenv,executionEnvironment:summary_fields===null||summary_fields===void 0?void 0:summary_fields.default_environment,isDefaultEnvironment:true}),/*#__PURE__*/_jsx(Config,{children:function children(_ref3){var project_base_dir=_ref3.project_base_dir;return/*#__PURE__*/_jsx(Detail,{helpText:projectHelpText.projectBasePath(brandName),label:/*i18n*/i18n._(\"Project Base Path\"),value:project_base_dir});}}),/*#__PURE__*/_jsx(Detail,{helpText:projectHelpText.projectLocalPath,label:/*i18n*/i18n._(\"Playbook Directory\"),value:local_path}),/*#__PURE__*/_jsx(UserDateDetail,{label:/*i18n*/i18n._(\"Created\"),date:created,user:summary_fields.created_by}),/*#__PURE__*/_jsx(UserDateDetail,{label:/*i18n*/i18n._(\"Last Modified\"),date:modified,user:summary_fields.modified_by}),optionsList&&/*#__PURE__*/_jsx(Detail,{fullWidth:true,label:/*i18n*/i18n._(\"Enabled Options\"),value:optionsList})]}),/*#__PURE__*/_jsxs(CardActionsRow,{children:[((_summary_fields$user_=summary_fields.user_capabilities)===null||_summary_fields$user_===void 0?void 0:_summary_fields$user_.edit)&&/*#__PURE__*/_jsx(Button,{ouiaId:\"project-detail-edit-button\",\"aria-label\":/*i18n*/i18n._(\"edit\"),component:Link,to:\"/projects/\".concat(id,\"/edit\"),children:/*i18n*/i18n._(\"Edit\")}),((_summary_fields$user_2=summary_fields.user_capabilities)===null||_summary_fields$user_2===void 0?void 0:_summary_fields$user_2.start)&&(['running','pending','waiting'].includes((_job=job)===null||_job===void 0?void 0:_job.status)?/*#__PURE__*/_jsx(JobCancelButton,{job:{id:job.id,type:'project_update'},errorTitle:/*i18n*/i18n._(\"Project Sync Error\"),title:/*i18n*/i18n._(\"Cancel Project Sync\"),errorMessage:/*i18n*/i18n._(\"Failed to cancel Project Sync\"),buttonText:/*i18n*/i18n._(\"Cancel Sync\")}):/*#__PURE__*/_jsx(ProjectSyncButton,{projectId:project.id,lastJobStatus:job&&job.status})),((_summary_fields$user_3=summary_fields.user_capabilities)===null||_summary_fields$user_3===void 0?void 0:_summary_fields$user_3.delete)&&/*#__PURE__*/_jsx(DeleteButton,{name:name,modalTitle:/*i18n*/i18n._(\"Delete Project\"),onConfirm:deleteProject,isDisabled:isLoading||((_job2=job)===null||_job2===void 0?void 0:_job2.status)==='running',deleteDetailsRequests:deleteDetailsRequests,deleteMessage:/*i18n*/i18n._(\"This project is currently being used by other resources. Are you sure you want to delete it?\"),children:/*i18n*/i18n._(\"Delete\")})]}),error&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:error,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:dismissError,children:[/*i18n*/i18n._(\"Failed to delete project.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]})]});}export default ProjectDetail;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Project/ProjectDetail/ProjectDetail.js"],"names":["React","useCallback","Link","useHistory","styled","Button","ClipboardCopy","TextList","TextListItem","TextListVariants","TextListItemVariants","Tooltip","Project","Config","useConfig","AlertModal","CardBody","CardActionsRow","DeleteButton","DetailList","Detail","UserDateDetail","ErrorDetail","JobCancelButton","ExecutionEnvironmentDetail","CredentialChip","ProjectsAPI","toTitleCase","useRequest","useDismissableError","useBrandName","relatedResourceDeleteRequests","StatusLabel","formatDateString","Popover","getDocsBaseUrl","ProjectSyncButton","projectHelpText","useWsProject","Label","span","ProjectDetail","project","allow_override","created","custom_virtualenv","description","id","local_path","modified","name","scm_branch","scm_clean","scm_delete_on_update","scm_track_submodules","scm_refspec","scm_revision","scm_type","scm_update_on_launch","scm_update_cache_timeout","scm_url","summary_fields","docsURL","history","destroy","push","deleteProject","request","isLoading","deleteError","error","brandName","dismissError","deleteDetailsRequests","optionsList","ul","li","options","clean","delete","trackSubModules","updateOnLaunch","allowBranchOverride","generateLastJobTooltip","job","status","toUpperCase","finished","current_job","last_job","getSourceControlUrlHelpText","githubSourceControlUrl","svnSourceControlUrl","organization","navigator","clipboard","writeText","toString","substring","branchFormField","sourceControlRefspec","credential","executionEnvironment","default_environment","project_base_dir","projectBasePath","projectLocalPath","created_by","modified_by","user_capabilities","edit","start","includes","type"],"mappings":"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","sourcesContent":["import React, { useCallback } from 'react';\nimport { Link, useHistory } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport styled from 'styled-components';\nimport {\n  Button,\n  ClipboardCopy,\n  TextList,\n  TextListItem,\n  TextListVariants,\n  TextListItemVariants,\n  Tooltip,\n} from '@patternfly/react-core';\nimport { Project } from 'types';\nimport { Config, useConfig } from 'contexts/Config';\nimport AlertModal from 'components/AlertModal';\nimport { CardBody, CardActionsRow } from 'components/Card';\nimport DeleteButton from 'components/DeleteButton';\nimport { DetailList, Detail, UserDateDetail } from 'components/DetailList';\nimport ErrorDetail from 'components/ErrorDetail';\nimport JobCancelButton from 'components/JobCancelButton';\nimport ExecutionEnvironmentDetail from 'components/ExecutionEnvironmentDetail';\nimport CredentialChip from 'components/CredentialChip';\nimport { ProjectsAPI } from 'api';\nimport { toTitleCase } from 'util/strings';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport useBrandName from 'hooks/useBrandName';\nimport { relatedResourceDeleteRequests } from 'util/getRelatedResourceDeleteDetails';\nimport StatusLabel from 'components/StatusLabel';\nimport { formatDateString } from 'util/dates';\nimport Popover from 'components/Popover';\nimport getDocsBaseUrl from 'util/getDocsBaseUrl';\nimport ProjectSyncButton from '../shared/ProjectSyncButton';\nimport projectHelpText from '../shared/Project.helptext';\nimport useWsProject from './useWsProject';\n\nconst Label = styled.span`\n  color: var(--pf-global--disabled-color--100);\n`;\n\nfunction ProjectDetail({ project }) {\n  const {\n    allow_override,\n    created,\n    custom_virtualenv,\n    description,\n    id,\n    local_path,\n    modified,\n    name,\n    scm_branch,\n    scm_clean,\n    scm_delete_on_update,\n    scm_track_submodules,\n    scm_refspec,\n    scm_revision,\n    scm_type,\n    scm_update_on_launch,\n    scm_update_cache_timeout,\n    scm_url,\n    summary_fields,\n  } = useWsProject(project);\n  const docsURL = `${getDocsBaseUrl(\n    useConfig()\n  )}/html/userguide/projects.html#manage-playbooks-using-source-control`;\n  const history = useHistory();\n  const {\n    request: deleteProject,\n    isLoading,\n    error: deleteError,\n  } = useRequest(\n    useCallback(async () => {\n      await ProjectsAPI.destroy(id);\n      history.push(`/projects`);\n    }, [id, history])\n  );\n  const brandName = useBrandName();\n\n  const { error, dismissError } = useDismissableError(deleteError);\n  const deleteDetailsRequests = relatedResourceDeleteRequests.project(project);\n  let optionsList = '';\n  if (\n    scm_clean ||\n    scm_delete_on_update ||\n    scm_track_submodules ||\n    scm_update_on_launch ||\n    allow_override\n  ) {\n    optionsList = (\n      <TextList component={TextListVariants.ul}>\n        {scm_clean && (\n          <TextListItem component={TextListItemVariants.li}>\n            {t`Discard local changes before syncing`}\n            <Popover content={projectHelpText.options.clean} />\n          </TextListItem>\n        )}\n        {scm_delete_on_update && (\n          <TextListItem component={TextListItemVariants.li}>\n            {t`Delete the project before syncing`}{' '}\n            <Popover\n              content={projectHelpText.options.delete}\n              id=\"scm-delete-on-update\"\n            />\n          </TextListItem>\n        )}\n        {scm_track_submodules && (\n          <TextListItem component={TextListItemVariants.li}>\n            {t`Track submodules latest commit on branch`}{' '}\n            <Popover content={projectHelpText.options.trackSubModules} />\n          </TextListItem>\n        )}\n        {scm_update_on_launch && (\n          <TextListItem component={TextListItemVariants.li}>\n            {t`Update revision on job launch`}{' '}\n            <Popover content={projectHelpText.options.updateOnLaunch} />\n          </TextListItem>\n        )}\n        {allow_override && (\n          <TextListItem component={TextListItemVariants.li}>\n            {t`Allow branch override`}{' '}\n            <Popover content={projectHelpText.options.allowBranchOverride} />\n          </TextListItem>\n        )}\n      </TextList>\n    );\n  }\n\n  const generateLastJobTooltip = (job) => (\n    <>\n      <div>{t`MOST RECENT SYNC`}</div>\n      <div>\n        {t`JOB ID:`} {job.id}\n      </div>\n      <div>\n        {t`STATUS:`} {job.status.toUpperCase()}\n      </div>\n      {job.finished && (\n        <div>\n          {t`FINISHED:`} {formatDateString(job.finished)}\n        </div>\n      )}\n    </>\n  );\n\n  let job = null;\n\n  if (summary_fields?.current_job) {\n    job = summary_fields.current_job;\n  } else if (summary_fields?.last_job) {\n    job = summary_fields.last_job;\n  }\n  const getSourceControlUrlHelpText = () =>\n    scm_type === 'git'\n      ? projectHelpText.githubSourceControlUrl\n      : projectHelpText.svnSourceControlUrl;\n  return (\n    <CardBody>\n      <DetailList gutter=\"sm\">\n        <Detail\n          label={t`Last Job Status`}\n          value={\n            job && (\n              <Tooltip\n                position=\"top\"\n                content={generateLastJobTooltip(job)}\n                key={job.id}\n              >\n                <Link to={`/jobs/project/${job.id}`}>\n                  <StatusLabel status={job.status} />\n                </Link>\n              </Tooltip>\n            )\n          }\n        />\n        <Detail label={t`Name`} value={name} dataCy=\"project-detail-name\" />\n        <Detail label={t`Description`} value={description} />\n        {summary_fields.organization && (\n          <Detail\n            label={t`Organization`}\n            value={\n              <Link\n                to={`/organizations/${summary_fields.organization.id}/details`}\n              >\n                {summary_fields.organization.name}\n              </Link>\n            }\n          />\n        )}\n        <Detail\n          label={t`Source Control Type`}\n          value={scm_type === '' ? t`Manual` : toTitleCase(project.scm_type)}\n        />\n        <Detail\n          label={t`Source Control Revision`}\n          value={\n            scm_revision ? (\n              <ClipboardCopy\n                data-cy=\"project-copy-revision\"\n                variant=\"inline-compact\"\n                clickTip={t`Successfully copied to clipboard!`}\n                hoverTip={t`Copy full revision to clipboard.`}\n                onCopy={() =>\n                  navigator.clipboard.writeText(scm_revision.toString())\n                }\n              >\n                {scm_revision.substring(0, 7)}\n              </ClipboardCopy>\n            ) : (\n              <Label\n                aria-label={t`The project must be synced before a revision is available.`}\n              >\n                {t`Sync for revision`}\n              </Label>\n            )\n          }\n          alwaysVisible\n        />\n        <Detail\n          helpText={\n            scm_type === 'git' || scm_type === 'svn'\n              ? getSourceControlUrlHelpText()\n              : ''\n          }\n          label={t`Source Control URL`}\n          value={scm_url}\n        />\n        <Detail\n          helpText={projectHelpText.branchFormField}\n          label={t`Source Control Branch`}\n          value={scm_branch}\n        />\n        <Detail\n          helpText={projectHelpText.sourceControlRefspec(docsURL)}\n          label={t`Source Control Refspec`}\n          value={scm_refspec}\n        />\n        {summary_fields.credential && (\n          <Detail\n            label={t`Source Control Credential`}\n            value={\n              <CredentialChip\n                key={summary_fields.credential.id}\n                credential={summary_fields.credential}\n                isReadOnly\n              />\n            }\n          />\n        )}\n        <Detail\n          label={t`Cache Timeout`}\n          value={`${scm_update_cache_timeout} ${t`Seconds`}`}\n        />\n        <ExecutionEnvironmentDetail\n          helpText={projectHelpText.executionEnvironment}\n          virtualEnvironment={custom_virtualenv}\n          executionEnvironment={summary_fields?.default_environment}\n          isDefaultEnvironment\n        />\n        <Config>\n          {({ project_base_dir }) => (\n            <Detail\n              helpText={projectHelpText.projectBasePath(brandName)}\n              label={t`Project Base Path`}\n              value={project_base_dir}\n            />\n          )}\n        </Config>\n        <Detail\n          helpText={projectHelpText.projectLocalPath}\n          label={t`Playbook Directory`}\n          value={local_path}\n        />\n        <UserDateDetail\n          label={t`Created`}\n          date={created}\n          user={summary_fields.created_by}\n        />\n        <UserDateDetail\n          label={t`Last Modified`}\n          date={modified}\n          user={summary_fields.modified_by}\n        />\n        {optionsList && (\n          <Detail fullWidth label={t`Enabled Options`} value={optionsList} />\n        )}\n      </DetailList>\n      <CardActionsRow>\n        {summary_fields.user_capabilities?.edit && (\n          <Button\n            ouiaId=\"project-detail-edit-button\"\n            aria-label={t`edit`}\n            component={Link}\n            to={`/projects/${id}/edit`}\n          >\n            {t`Edit`}\n          </Button>\n        )}\n        {summary_fields.user_capabilities?.start &&\n          (['running', 'pending', 'waiting'].includes(job?.status) ? (\n            <JobCancelButton\n              job={{ id: job.id, type: 'project_update' }}\n              errorTitle={t`Project Sync Error`}\n              title={t`Cancel Project Sync`}\n              errorMessage={t`Failed to cancel Project Sync`}\n              buttonText={t`Cancel Sync`}\n            />\n          ) : (\n            <ProjectSyncButton\n              projectId={project.id}\n              lastJobStatus={job && job.status}\n            />\n          ))}\n        {summary_fields.user_capabilities?.delete && (\n          <DeleteButton\n            name={name}\n            modalTitle={t`Delete Project`}\n            onConfirm={deleteProject}\n            isDisabled={isLoading || job?.status === 'running'}\n            deleteDetailsRequests={deleteDetailsRequests}\n            deleteMessage={t`This project is currently being used by other resources. Are you sure you want to delete it?`}\n          >\n            {t`Delete`}\n          </DeleteButton>\n        )}\n      </CardActionsRow>\n      {error && (\n        <AlertModal\n          isOpen={error}\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={dismissError}\n        >\n          {t`Failed to delete project.`}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </CardBody>\n  );\n}\n\nProjectDetail.propTypes = {\n  project: Project.isRequired,\n};\n\nexport default ProjectDetail;\n"]},"metadata":{},"sourceType":"module"}