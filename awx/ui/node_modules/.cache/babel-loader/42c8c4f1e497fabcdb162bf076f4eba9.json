{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{useHistory,useLocation,useRouteMatch}from'react-router-dom';import{Card,PageSection}from'@patternfly/react-core';import{HostsAPI}from'api';import AlertModal from'components/AlertModal';import DataListToolbar from'components/DataListToolbar';import ErrorDetail from'components/ErrorDetail';import PaginatedTable,{HeaderRow,HeaderCell,ToolbarAddButton,ToolbarDeleteButton,getSearchableKeys}from'components/PaginatedTable';import useRequest,{useDeleteItems}from'hooks/useRequest';import useSelected from'hooks/useSelected';import useExpanded from'hooks/useExpanded';import{encodeQueryString,getQSConfig,parseQueryString}from'util/qs';import HostListItem from'./HostListItem';import SmartInventoryButton from'./SmartInventoryButton';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('host',{page:1,page_size:20,order_by:'name'});function HostList(){var history=useHistory();var location=useLocation();var match=useRouteMatch();var parsedQueryStrings=parseQueryString(QS_CONFIG,location.search);var nonDefaultSearchParams={};Object.keys(parsedQueryStrings).forEach(function(key){if(!QS_CONFIG.defaultParams[key]){nonDefaultSearchParams[key]=parsedQueryStrings[key];}});var hasAnsibleFactsKeys=function hasAnsibleFactsKeys(){var nonDefaultSearchValues=Object.values(nonDefaultSearchParams);return nonDefaultSearchValues.filter(function(value){return value.includes('ansible_facts');}).length>0;};var hasInvalidHostFilterKeys=function hasInvalidHostFilterKeys(){var nonDefaultSearchKeys=Object.keys(nonDefaultSearchParams);return nonDefaultSearchKeys.filter(function(searchKey){return searchKey.startsWith('not__');}).length>0||nonDefaultSearchKeys.filter(function(searchKey){return searchKey.endsWith('__search');}).length>0;};var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _results$,_results$$data,_results$1$data$actio;var params,results;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,location.search);_context.next=3;return Promise.all([HostsAPI.read(params),HostsAPI.readOptions()]);case 3:results=_context.sent;return _context.abrupt(\"return\",{hosts:results[0].data.results,count:results[0].data.count,actions:results[1].data.actions,relatedSearchableKeys:(((_results$=results[1])===null||_results$===void 0?void 0:(_results$$data=_results$.data)===null||_results$$data===void 0?void 0:_results$$data.related_search_fields)||[]).map(function(val){return val.endsWith('search')?val.slice(0,-8):val;}),searchableKeys:getSearchableKeys((_results$1$data$actio=results[1].data.actions)===null||_results$1$data$actio===void 0?void 0:_results$1$data$actio.GET)});case 5:case\"end\":return _context.stop();}}},_callee);})),[location]),{hosts:[],count:0,actions:{},relatedSearchableKeys:[],searchableKeys:[]}),_useRequest$result=_useRequest.result,hosts=_useRequest$result.hosts,count=_useRequest$result.count,actions=_useRequest$result.actions,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,contentError=_useRequest.error,isLoading=_useRequest.isLoading,fetchHosts=_useRequest.request;useEffect(function(){fetchHosts();},[fetchHosts]);var _useSelected=useSelected(hosts),selected=_useSelected.selected,isAllSelected=_useSelected.isAllSelected,handleSelect=_useSelected.handleSelect,selectAll=_useSelected.selectAll,clearSelected=_useSelected.clearSelected;var _useExpanded=useExpanded(hosts),expanded=_useExpanded.expanded,isAllExpanded=_useExpanded.isAllExpanded,handleExpand=_useExpanded.handleExpand,expandAll=_useExpanded.expandAll;var _useDeleteItems=useDeleteItems(useCallback(function(){return Promise.all(selected.map(function(host){return HostsAPI.destroy(host.id);}));},[selected]),{qsConfig:QS_CONFIG,allItemsSelected:isAllSelected,fetchItems:fetchHosts}),isDeleteLoading=_useDeleteItems.isLoading,deleteHosts=_useDeleteItems.deleteItems,deletionError=_useDeleteItems.deletionError,clearDeletionError=_useDeleteItems.clearDeletionError;var handleHostDelete=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return deleteHosts();case 2:clearSelected();case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleHostDelete(){return _ref2.apply(this,arguments);};}();var handleSmartInventoryClick=function handleSmartInventoryClick(){history.push(\"/inventories/smart_inventory/add?host_filter=\".concat(encodeURIComponent(encodeQueryString(nonDefaultSearchParams))));};var canAdd=actions&&Object.prototype.hasOwnProperty.call(actions,'POST');return/*#__PURE__*/_jsxs(PageSection,{children:[/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(PaginatedTable,{contentError:contentError,hasContentLoading:isLoading||isDeleteLoading,items:hosts,itemCount:count,pluralizedItemName:/*i18n*/i18n._(\"Hosts\"),qsConfig:QS_CONFIG,clearSelected:clearSelected,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Description\"),key:'description__icontains'},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username__icontains'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username__icontains'}],toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,isExpandable:true,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"description\",children:/*i18n*/i18n._(\"Description\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Inventory\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Actions\")})]}),renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{isAllSelected:isAllSelected,onSelectAll:selectAll,isAllExpanded:isAllExpanded,onExpandAll:expandAll,qsConfig:QS_CONFIG,additionalControls:[].concat(_toConsumableArray(canAdd?[/*#__PURE__*/_jsx(ToolbarAddButton,{linkTo:\"\".concat(match.url,\"/add\")},\"add\")]:[]),[/*#__PURE__*/_jsx(ToolbarDeleteButton,{onDelete:handleHostDelete,itemsToDelete:selected,pluralizedItemName:/*i18n*/i18n._(\"Hosts\")},\"delete\")],_toConsumableArray(canAdd?[/*#__PURE__*/_jsx(SmartInventoryButton,{hasInvalidKeys:hasInvalidHostFilterKeys(),hasAnsibleFactsKeys:hasAnsibleFactsKeys(),isDisabled:Object.keys(nonDefaultSearchParams).length===0||hasInvalidHostFilterKeys()||hasAnsibleFactsKeys(),onClick:function onClick(){return handleSmartInventoryClick();}})]:[]))}));},renderRow:function renderRow(host,index){return/*#__PURE__*/_jsx(HostListItem,{host:host,isExpanded:expanded.some(function(row){return row.id===host.id;}),onExpand:function onExpand(){return handleExpand(host);},detailUrl:\"\".concat(match.url,\"/\").concat(host.id,\"/details\"),isSelected:selected.some(function(row){return row.id===host.id;}),onSelect:function onSelect(){return handleSelect(host);},rowIndex:index},host.id);},emptyStateControls:canAdd?/*#__PURE__*/_jsx(ToolbarAddButton,{linkTo:\"\".concat(match.url,\"/add\")},\"add\"):null})}),deletionError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:deletionError,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:clearDeletionError,children:[/*i18n*/i18n._(\"Failed to delete one or more hosts.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:deletionError})]})]});}export default HostList;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Host/HostList/HostList.js"],"names":["React","useEffect","useCallback","useHistory","useLocation","useRouteMatch","Card","PageSection","HostsAPI","AlertModal","DataListToolbar","ErrorDetail","PaginatedTable","HeaderRow","HeaderCell","ToolbarAddButton","ToolbarDeleteButton","getSearchableKeys","useRequest","useDeleteItems","useSelected","useExpanded","encodeQueryString","getQSConfig","parseQueryString","HostListItem","SmartInventoryButton","QS_CONFIG","page","page_size","order_by","HostList","history","location","match","parsedQueryStrings","search","nonDefaultSearchParams","Object","keys","forEach","key","defaultParams","hasAnsibleFactsKeys","nonDefaultSearchValues","values","filter","value","includes","length","hasInvalidHostFilterKeys","nonDefaultSearchKeys","searchKey","startsWith","endsWith","params","Promise","all","read","readOptions","results","hosts","data","count","actions","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","GET","result","contentError","error","isLoading","fetchHosts","request","selected","isAllSelected","handleSelect","selectAll","clearSelected","expanded","isAllExpanded","handleExpand","expandAll","host","destroy","id","qsConfig","allItemsSelected","fetchItems","isDeleteLoading","deleteHosts","deleteItems","deletionError","clearDeletionError","handleHostDelete","handleSmartInventoryClick","push","encodeURIComponent","canAdd","prototype","hasOwnProperty","call","name","isDefault","props","url","index","some","row"],"mappings":"qcAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,WAA3B,KAA8C,OAA9C,CACA,OAASC,UAAT,CAAqBC,WAArB,CAAkCC,aAAlC,KAAuD,kBAAvD,CAEA,OAASC,IAAT,CAAeC,WAAf,KAAkC,wBAAlC,CACA,OAASC,QAAT,KAAyB,KAAzB,CACA,MAAOC,CAAAA,UAAP,KAAuB,uBAAvB,CACA,MAAOC,CAAAA,eAAP,KAA4B,4BAA5B,CACA,MAAOC,CAAAA,WAAP,KAAwB,wBAAxB,CACA,MAAOC,CAAAA,cAAP,EACEC,SADF,CAEEC,UAFF,CAGEC,gBAHF,CAIEC,mBAJF,CAKEC,iBALF,KAMO,2BANP,CAOA,MAAOC,CAAAA,UAAP,EAAqBC,cAArB,KAA2C,kBAA3C,CACA,MAAOC,CAAAA,WAAP,KAAwB,mBAAxB,CACA,MAAOC,CAAAA,WAAP,KAAwB,mBAAxB,CACA,OAASC,iBAAT,CAA4BC,WAA5B,CAAyCC,gBAAzC,KAAiE,SAAjE,CAEA,MAAOC,CAAAA,YAAP,KAAyB,gBAAzB,CACA,MAAOC,CAAAA,oBAAP,KAAiC,wBAAjC,C,wFAEA,GAAMC,CAAAA,SAAS,CAAGJ,WAAW,CAAC,MAAD,CAAS,CACpCK,IAAI,CAAE,CAD8B,CAEpCC,SAAS,CAAE,EAFyB,CAGpCC,QAAQ,CAAE,MAH0B,CAAT,CAA7B,CAMA,QAASC,CAAAA,QAAT,EAAoB,CAClB,GAAMC,CAAAA,OAAO,CAAG7B,UAAU,EAA1B,CACA,GAAM8B,CAAAA,QAAQ,CAAG7B,WAAW,EAA5B,CACA,GAAM8B,CAAAA,KAAK,CAAG7B,aAAa,EAA3B,CACA,GAAM8B,CAAAA,kBAAkB,CAAGX,gBAAgB,CAACG,SAAD,CAAYM,QAAQ,CAACG,MAArB,CAA3C,CACA,GAAMC,CAAAA,sBAAsB,CAAG,EAA/B,CAEAC,MAAM,CAACC,IAAP,CAAYJ,kBAAZ,EAAgCK,OAAhC,CAAwC,SAACC,GAAD,CAAS,CAC/C,GAAI,CAACd,SAAS,CAACe,aAAV,CAAwBD,GAAxB,CAAL,CAAmC,CACjCJ,sBAAsB,CAACI,GAAD,CAAtB,CAA8BN,kBAAkB,CAACM,GAAD,CAAhD,CACD,CACF,CAJD,EAMA,GAAME,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,EAAM,CAChC,GAAMC,CAAAA,sBAAsB,CAAGN,MAAM,CAACO,MAAP,CAAcR,sBAAd,CAA/B,CACA,MACEO,CAAAA,sBAAsB,CAACE,MAAvB,CAA8B,SAACC,KAAD,QAAWA,CAAAA,KAAK,CAACC,QAAN,CAAe,eAAf,CAAX,EAA9B,EACGC,MADH,CACY,CAFd,CAID,CAND,CAQA,GAAMC,CAAAA,wBAAwB,CAAG,QAA3BA,CAAAA,wBAA2B,EAAM,CACrC,GAAMC,CAAAA,oBAAoB,CAAGb,MAAM,CAACC,IAAP,CAAYF,sBAAZ,CAA7B,CACA,MACEc,CAAAA,oBAAoB,CAACL,MAArB,CAA4B,SAACM,SAAD,QAAeA,CAAAA,SAAS,CAACC,UAAV,CAAqB,OAArB,CAAf,EAA5B,EACGJ,MADH,CACY,CADZ,EAEAE,oBAAoB,CAACL,MAArB,CAA4B,SAACM,SAAD,QAAeA,CAAAA,SAAS,CAACE,QAAV,CAAmB,UAAnB,CAAf,EAA5B,EACGL,MADH,CACY,CAJd,CAMD,CARD,CAUA,gBAKI/B,UAAU,CACZhB,WAAW,sEAAC,yMACJqD,MADI,CACK/B,gBAAgB,CAACG,SAAD,CAAYM,QAAQ,CAACG,MAArB,CADrB,uBAEYoB,CAAAA,OAAO,CAACC,GAAR,CAAY,CAChCjD,QAAQ,CAACkD,IAAT,CAAcH,MAAd,CADgC,CAEhC/C,QAAQ,CAACmD,WAAT,EAFgC,CAAZ,CAFZ,QAEJC,OAFI,+CAMH,CACLC,KAAK,CAAED,OAAO,CAAC,CAAD,CAAP,CAAWE,IAAX,CAAgBF,OADlB,CAELG,KAAK,CAAEH,OAAO,CAAC,CAAD,CAAP,CAAWE,IAAX,CAAgBC,KAFlB,CAGLC,OAAO,CAAEJ,OAAO,CAAC,CAAD,CAAP,CAAWE,IAAX,CAAgBE,OAHpB,CAILC,qBAAqB,CAAE,CACrB,YAAAL,OAAO,CAAC,CAAD,CAAP,8DAAYE,IAAZ,wDAAkBI,qBAAlB,GAA2C,EADtB,EAErBC,GAFqB,CAEjB,SAACC,GAAD,QAAUA,CAAAA,GAAG,CAACd,QAAJ,CAAa,QAAb,EAAyBc,GAAG,CAACC,KAAJ,CAAU,CAAV,CAAa,CAAC,CAAd,CAAzB,CAA4CD,GAAtD,EAFiB,CAJlB,CAOLE,cAAc,CAAErD,iBAAiB,wBAAC2C,OAAO,CAAC,CAAD,CAAP,CAAWE,IAAX,CAAgBE,OAAjB,gDAAC,sBAAyBO,GAA1B,CAP5B,CANG,wDAAD,GAeR,CAACtC,QAAD,CAfQ,CADC,CAiBZ,CACE4B,KAAK,CAAE,EADT,CAEEE,KAAK,CAAE,CAFT,CAGEC,OAAO,CAAE,EAHX,CAIEC,qBAAqB,CAAE,EAJzB,CAKEK,cAAc,CAAE,EALlB,CAjBY,CALd,gCACEE,MADF,CACYX,KADZ,oBACYA,KADZ,CACmBE,KADnB,oBACmBA,KADnB,CAC0BC,OAD1B,oBAC0BA,OAD1B,CACmCC,qBADnC,oBACmCA,qBADnC,CAC0DK,cAD1D,oBAC0DA,cAD1D,CAESG,YAFT,aAEEC,KAFF,CAGEC,SAHF,aAGEA,SAHF,CAIWC,UAJX,aAIEC,OAJF,CA+BA5E,SAAS,CAAC,UAAM,CACd2E,UAAU,GACX,CAFQ,CAEN,CAACA,UAAD,CAFM,CAAT,CAIA,iBACExD,WAAW,CAACyC,KAAD,CADb,CAAQiB,QAAR,cAAQA,QAAR,CAAkBC,aAAlB,cAAkBA,aAAlB,CAAiCC,YAAjC,cAAiCA,YAAjC,CAA+CC,SAA/C,cAA+CA,SAA/C,CAA0DC,aAA1D,cAA0DA,aAA1D,CAGA,iBACE7D,WAAW,CAACwC,KAAD,CADb,CAAQsB,QAAR,cAAQA,QAAR,CAAkBC,aAAlB,cAAkBA,aAAlB,CAAiCC,YAAjC,cAAiCA,YAAjC,CAA+CC,SAA/C,cAA+CA,SAA/C,CAGA,oBAKInE,cAAc,CAChBjB,WAAW,CACT,iBAAMsD,CAAAA,OAAO,CAACC,GAAR,CAAYqB,QAAQ,CAACX,GAAT,CAAa,SAACoB,IAAD,QAAU/E,CAAAA,QAAQ,CAACgF,OAAT,CAAiBD,IAAI,CAACE,EAAtB,CAAV,EAAb,CAAZ,CAAN,EADS,CAET,CAACX,QAAD,CAFS,CADK,CAKhB,CACEY,QAAQ,CAAE/D,SADZ,CAEEgE,gBAAgB,CAAEZ,aAFpB,CAGEa,UAAU,CAAEhB,UAHd,CALgB,CALlB,CACaiB,eADb,iBACElB,SADF,CAEemB,WAFf,iBAEEC,WAFF,CAGEC,aAHF,iBAGEA,aAHF,CAIEC,kBAJF,iBAIEA,kBAJF,CAiBA,GAAMC,CAAAA,gBAAgB,2FAAG,+JACjBJ,CAAAA,WAAW,EADM,QAEvBZ,aAAa,GAFU,wDAAH,kBAAhBgB,CAAAA,gBAAgB,2CAAtB,CAKA,GAAMC,CAAAA,yBAAyB,CAAG,QAA5BA,CAAAA,yBAA4B,EAAM,CACtCnE,OAAO,CAACoE,IAAR,wDACkDC,kBAAkB,CAChE/E,iBAAiB,CAACe,sBAAD,CAD+C,CADpE,GAKD,CAND,CAQA,GAAMiE,CAAAA,MAAM,CACVtC,OAAO,EAAI1B,MAAM,CAACiE,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCzC,OAArC,CAA8C,MAA9C,CADb,CAGA,mBACE,MAAC,WAAD,yBACE,KAAC,IAAD,wBACE,KAAC,cAAD,EACE,YAAY,CAAES,YADhB,CAEE,iBAAiB,CAAEE,SAAS,EAAIkB,eAFlC,CAGE,KAAK,CAAEhC,KAHT,CAIE,SAAS,CAAEE,KAJb,CAKE,kBAAkB,SAAE,eALtB,CAME,QAAQ,CAAEpC,SANZ,CAOE,aAAa,CAAEuD,aAPjB,CAQE,oBAAoB,CAAE,CACpB,CACEwB,IAAI,SAAE,cADR,CAEEjE,GAAG,CAAE,iBAFP,CAGEkE,SAAS,CAAE,IAHb,CADoB,CAMpB,CACED,IAAI,SAAE,qBADR,CAEEjE,GAAG,CAAE,wBAFP,CANoB,CAUpB,CACEiE,IAAI,SAAE,+BADR,CAEEjE,GAAG,CAAE,iCAFP,CAVoB,CAcpB,CACEiE,IAAI,SAAE,gCADR,CAEEjE,GAAG,CAAE,kCAFP,CAdoB,CARxB,CA2BE,qBAAqB,CAAE6B,cA3BzB,CA4BE,4BAA4B,CAAEL,qBA5BhC,CA6BE,SAAS,cACP,MAAC,SAAD,EAAW,QAAQ,CAAEtC,SAArB,CAAgC,YAAY,KAA5C,wBACE,KAAC,UAAD,EAAY,OAAO,CAAC,MAApB,kBAA4B,cAA5B,EADF,cAEE,KAAC,UAAD,EAAY,OAAO,CAAC,aAApB,kBAAmC,qBAAnC,EAFF,cAGE,KAAC,UAAD,mBAAa,mBAAb,EAHF,cAIE,KAAC,UAAD,mBAAa,iBAAb,EAJF,GA9BJ,CAqCE,aAAa,CAAE,uBAACiF,KAAD,qBACb,KAAC,eAAD,gCACMA,KADN,MAEE,aAAa,CAAE7B,aAFjB,CAGE,WAAW,CAAEE,SAHf,CAIE,aAAa,CAAEG,aAJjB,CAKE,WAAW,CAAEE,SALf,CAME,QAAQ,CAAE3D,SANZ,CAOE,kBAAkB,8BACZ2E,MAAM,CACN,cAAC,KAAC,gBAAD,EAA4B,MAAM,WAAKpE,KAAK,CAAC2E,GAAX,QAAlC,EAAsB,KAAtB,CAAD,CADM,CAEN,EAHY,gBAIhB,KAAC,mBAAD,EAEE,QAAQ,CAAEX,gBAFZ,CAGE,aAAa,CAAEpB,QAHjB,CAIE,kBAAkB,SAAE,eAJtB,EACM,QADN,CAJgB,qBAUZwB,MAAM,CACN,cACE,KAAC,oBAAD,EACE,cAAc,CAAEpD,wBAAwB,EAD1C,CAEE,mBAAmB,CAAEP,mBAAmB,EAF1C,CAGE,UAAU,CACRL,MAAM,CAACC,IAAP,CAAYF,sBAAZ,EAAoCY,MAApC,GAA+C,CAA/C,EACAC,wBAAwB,EADxB,EAEAP,mBAAmB,EANvB,CAQE,OAAO,CAAE,yBAAMwD,CAAAA,yBAAyB,EAA/B,EARX,EADF,CADM,CAaN,EAvBY,EAPpB,GADa,EArCjB,CAwEE,SAAS,CAAE,mBAACZ,IAAD,CAAOuB,KAAP,qBACT,KAAC,YAAD,EAEE,IAAI,CAAEvB,IAFR,CAGE,UAAU,CAAEJ,QAAQ,CAAC4B,IAAT,CAAc,SAACC,GAAD,QAASA,CAAAA,GAAG,CAACvB,EAAJ,GAAWF,IAAI,CAACE,EAAzB,EAAd,CAHd,CAIE,QAAQ,CAAE,0BAAMJ,CAAAA,YAAY,CAACE,IAAD,CAAlB,EAJZ,CAKE,SAAS,WAAKrD,KAAK,CAAC2E,GAAX,aAAkBtB,IAAI,CAACE,EAAvB,YALX,CAME,UAAU,CAAEX,QAAQ,CAACiC,IAAT,CAAc,SAACC,GAAD,QAASA,CAAAA,GAAG,CAACvB,EAAJ,GAAWF,IAAI,CAACE,EAAzB,EAAd,CANd,CAOE,QAAQ,CAAE,0BAAMT,CAAAA,YAAY,CAACO,IAAD,CAAlB,EAPZ,CAQE,QAAQ,CAAEuB,KARZ,EACOvB,IAAI,CAACE,EADZ,CADS,EAxEb,CAoFE,kBAAkB,CAChBa,MAAM,cACJ,KAAC,gBAAD,EAA4B,MAAM,WAAKpE,KAAK,CAAC2E,GAAX,QAAlC,EAAsB,KAAtB,CADI,CAEF,IAvFR,EADF,EADF,CA6FGb,aAAa,eACZ,MAAC,UAAD,EACE,MAAM,CAAEA,aADV,CAEE,OAAO,CAAC,OAFV,CAGE,KAAK,SAAE,gBAHT,CAIE,OAAO,CAAEC,kBAJX,mBAMG,6CANH,cAOE,KAAC,WAAD,EAAa,KAAK,CAAED,aAApB,EAPF,GA9FJ,GADF,CA2GD,CAED,cAAejE,CAAAA,QAAf","sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { useHistory, useLocation, useRouteMatch } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport { Card, PageSection } from '@patternfly/react-core';\nimport { HostsAPI } from 'api';\nimport AlertModal from 'components/AlertModal';\nimport DataListToolbar from 'components/DataListToolbar';\nimport ErrorDetail from 'components/ErrorDetail';\nimport PaginatedTable, {\n  HeaderRow,\n  HeaderCell,\n  ToolbarAddButton,\n  ToolbarDeleteButton,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\nimport useRequest, { useDeleteItems } from 'hooks/useRequest';\nimport useSelected from 'hooks/useSelected';\nimport useExpanded from 'hooks/useExpanded';\nimport { encodeQueryString, getQSConfig, parseQueryString } from 'util/qs';\n\nimport HostListItem from './HostListItem';\nimport SmartInventoryButton from './SmartInventoryButton';\n\nconst QS_CONFIG = getQSConfig('host', {\n  page: 1,\n  page_size: 20,\n  order_by: 'name',\n});\n\nfunction HostList() {\n  const history = useHistory();\n  const location = useLocation();\n  const match = useRouteMatch();\n  const parsedQueryStrings = parseQueryString(QS_CONFIG, location.search);\n  const nonDefaultSearchParams = {};\n\n  Object.keys(parsedQueryStrings).forEach((key) => {\n    if (!QS_CONFIG.defaultParams[key]) {\n      nonDefaultSearchParams[key] = parsedQueryStrings[key];\n    }\n  });\n\n  const hasAnsibleFactsKeys = () => {\n    const nonDefaultSearchValues = Object.values(nonDefaultSearchParams);\n    return (\n      nonDefaultSearchValues.filter((value) => value.includes('ansible_facts'))\n        .length > 0\n    );\n  };\n\n  const hasInvalidHostFilterKeys = () => {\n    const nonDefaultSearchKeys = Object.keys(nonDefaultSearchParams);\n    return (\n      nonDefaultSearchKeys.filter((searchKey) => searchKey.startsWith('not__'))\n        .length > 0 ||\n      nonDefaultSearchKeys.filter((searchKey) => searchKey.endsWith('__search'))\n        .length > 0\n    );\n  };\n\n  const {\n    result: { hosts, count, actions, relatedSearchableKeys, searchableKeys },\n    error: contentError,\n    isLoading,\n    request: fetchHosts,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, location.search);\n      const results = await Promise.all([\n        HostsAPI.read(params),\n        HostsAPI.readOptions(),\n      ]);\n      return {\n        hosts: results[0].data.results,\n        count: results[0].data.count,\n        actions: results[1].data.actions,\n        relatedSearchableKeys: (\n          results[1]?.data?.related_search_fields || []\n        ).map((val) => (val.endsWith('search') ? val.slice(0, -8) : val)),\n        searchableKeys: getSearchableKeys(results[1].data.actions?.GET),\n      };\n    }, [location]),\n    {\n      hosts: [],\n      count: 0,\n      actions: {},\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchHosts();\n  }, [fetchHosts]);\n\n  const { selected, isAllSelected, handleSelect, selectAll, clearSelected } =\n    useSelected(hosts);\n\n  const { expanded, isAllExpanded, handleExpand, expandAll } =\n    useExpanded(hosts);\n\n  const {\n    isLoading: isDeleteLoading,\n    deleteItems: deleteHosts,\n    deletionError,\n    clearDeletionError,\n  } = useDeleteItems(\n    useCallback(\n      () => Promise.all(selected.map((host) => HostsAPI.destroy(host.id))),\n      [selected]\n    ),\n    {\n      qsConfig: QS_CONFIG,\n      allItemsSelected: isAllSelected,\n      fetchItems: fetchHosts,\n    }\n  );\n\n  const handleHostDelete = async () => {\n    await deleteHosts();\n    clearSelected();\n  };\n\n  const handleSmartInventoryClick = () => {\n    history.push(\n      `/inventories/smart_inventory/add?host_filter=${encodeURIComponent(\n        encodeQueryString(nonDefaultSearchParams)\n      )}`\n    );\n  };\n\n  const canAdd =\n    actions && Object.prototype.hasOwnProperty.call(actions, 'POST');\n\n  return (\n    <PageSection>\n      <Card>\n        <PaginatedTable\n          contentError={contentError}\n          hasContentLoading={isLoading || isDeleteLoading}\n          items={hosts}\n          itemCount={count}\n          pluralizedItemName={t`Hosts`}\n          qsConfig={QS_CONFIG}\n          clearSelected={clearSelected}\n          toolbarSearchColumns={[\n            {\n              name: t`Name`,\n              key: 'name__icontains',\n              isDefault: true,\n            },\n            {\n              name: t`Description`,\n              key: 'description__icontains',\n            },\n            {\n              name: t`Created By (Username)`,\n              key: 'created_by__username__icontains',\n            },\n            {\n              name: t`Modified By (Username)`,\n              key: 'modified_by__username__icontains',\n            },\n          ]}\n          toolbarSearchableKeys={searchableKeys}\n          toolbarRelatedSearchableKeys={relatedSearchableKeys}\n          headerRow={\n            <HeaderRow qsConfig={QS_CONFIG} isExpandable>\n              <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n              <HeaderCell sortKey=\"description\">{t`Description`}</HeaderCell>\n              <HeaderCell>{t`Inventory`}</HeaderCell>\n              <HeaderCell>{t`Actions`}</HeaderCell>\n            </HeaderRow>\n          }\n          renderToolbar={(props) => (\n            <DataListToolbar\n              {...props}\n              isAllSelected={isAllSelected}\n              onSelectAll={selectAll}\n              isAllExpanded={isAllExpanded}\n              onExpandAll={expandAll}\n              qsConfig={QS_CONFIG}\n              additionalControls={[\n                ...(canAdd\n                  ? [<ToolbarAddButton key=\"add\" linkTo={`${match.url}/add`} />]\n                  : []),\n                <ToolbarDeleteButton\n                  key=\"delete\"\n                  onDelete={handleHostDelete}\n                  itemsToDelete={selected}\n                  pluralizedItemName={t`Hosts`}\n                />,\n                ...(canAdd\n                  ? [\n                      <SmartInventoryButton\n                        hasInvalidKeys={hasInvalidHostFilterKeys()}\n                        hasAnsibleFactsKeys={hasAnsibleFactsKeys()}\n                        isDisabled={\n                          Object.keys(nonDefaultSearchParams).length === 0 ||\n                          hasInvalidHostFilterKeys() ||\n                          hasAnsibleFactsKeys()\n                        }\n                        onClick={() => handleSmartInventoryClick()}\n                      />,\n                    ]\n                  : []),\n              ]}\n            />\n          )}\n          renderRow={(host, index) => (\n            <HostListItem\n              key={host.id}\n              host={host}\n              isExpanded={expanded.some((row) => row.id === host.id)}\n              onExpand={() => handleExpand(host)}\n              detailUrl={`${match.url}/${host.id}/details`}\n              isSelected={selected.some((row) => row.id === host.id)}\n              onSelect={() => handleSelect(host)}\n              rowIndex={index}\n            />\n          )}\n          emptyStateControls={\n            canAdd ? (\n              <ToolbarAddButton key=\"add\" linkTo={`${match.url}/add`} />\n            ) : null\n          }\n        />\n      </Card>\n      {deletionError && (\n        <AlertModal\n          isOpen={deletionError}\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={clearDeletionError}\n        >\n          {t`Failed to delete one or more hosts.`}\n          <ErrorDetail error={deletionError} />\n        </AlertModal>\n      )}\n    </PageSection>\n  );\n}\n\nexport default HostList;\n"]},"metadata":{},"sourceType":"module"}