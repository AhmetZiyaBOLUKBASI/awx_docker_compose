{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{Link,useHistory}from'react-router-dom';import{Button}from'@patternfly/react-core';import{VariablesDetail}from'components/CodeEditor';import AlertModal from'components/AlertModal';import{CardBody,CardActionsRow}from'components/Card';import DeleteButton from'components/DeleteButton';import{Detail,DetailList,UserDateDetail}from'components/DetailList';import useRequest,{useDismissableError}from'hooks/useRequest';import{CredentialTypesAPI}from'api';import{jsonToYaml}from'util/yaml';import{relatedResourceDeleteRequests,getRelatedResourceDeleteCounts}from'util/getRelatedResourceDeleteDetails';import ErrorDetail from'components/ErrorDetail';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CredentialTypeDetails(_ref){var credentialType=_ref.credentialType;var id=credentialType.id,name=credentialType.name,description=credentialType.description,injectors=credentialType.injectors,inputs=credentialType.inputs;var history=useHistory();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return CredentialTypesAPI.destroy(id);case 2:history.push(\"/credential_types\");case 3:case\"end\":return _context.stop();}}},_callee);})),[id,history])),deleteCredentialType=_useRequest.request,isLoading=_useRequest.isLoading,deleteError=_useRequest.error;var _useRequest2=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$getRelatedReso,deleteDetails,error;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getRelatedResourceDeleteCounts(relatedResourceDeleteRequests.credentialType(credentialType));case 2:_yield$getRelatedReso=_context2.sent;deleteDetails=_yield$getRelatedReso.results;error=_yield$getRelatedReso.error;if(!error){_context2.next=7;break;}throw new Error(error);case 7:if(!deleteDetails){_context2.next=9;break;}return _context2.abrupt(\"return\",{isDeleteDisabled:true});case 9:return _context2.abrupt(\"return\",{isDeleteDisabled:false});case 10:case\"end\":return _context2.stop();}}},_callee2);})),[credentialType]),{isDeleteDisabled:false}),isDeleteDisabled=_useRequest2.result.isDeleteDisabled,deleteDetailsError=_useRequest2.error,fetchDeleteDetails=_useRequest2.request;useEffect(function(){fetchDeleteDetails();},[fetchDeleteDetails]);var _useDismissableError=useDismissableError(deleteError||deleteDetailsError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;return/*#__PURE__*/_jsxs(CardBody,{children:[/*#__PURE__*/_jsxs(DetailList,{children:[/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Name\"),value:name,dataCy:\"credential-type-detail-name\"}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Description\"),value:description}),/*#__PURE__*/_jsx(VariablesDetail,{label:/*i18n*/i18n._(\"Input configuration\"),value:jsonToYaml(JSON.stringify(inputs)),rows:6,name:\"input\",dataCy:\"credential-type-detail-input\",helpText:/*i18n*/i18n._(\"Input schema which defines a set of ordered fields for that type.\")}),/*#__PURE__*/_jsx(VariablesDetail,{label:/*i18n*/i18n._(\"Injector configuration\"),value:jsonToYaml(JSON.stringify(injectors)),rows:6,name:\"injector\",dataCy:\"credential-type-detail-injector\",helpText:/*i18n*/i18n._(\"Environment variables or extra variables that specify the values a credential type can inject.\")}),/*#__PURE__*/_jsx(UserDateDetail,{label:/*i18n*/i18n._(\"Created\"),date:credentialType.created,user:credentialType.summary_fields.created_by}),/*#__PURE__*/_jsx(UserDateDetail,{label:/*i18n*/i18n._(\"Last Modified\"),date:credentialType.modified,user:credentialType.summary_fields.modified_by})]}),/*#__PURE__*/_jsxs(CardActionsRow,{children:[credentialType.summary_fields.user_capabilities&&credentialType.summary_fields.user_capabilities.edit&&/*#__PURE__*/_jsx(Button,{ouiaId:\"credential-type-detail-edit-button\",\"aria-label\":/*i18n*/i18n._(\"edit\"),component:Link,to:\"/credential_types/\".concat(id,\"/edit\"),children:/*i18n*/i18n._(\"Edit\")}),credentialType.summary_fields.user_capabilities&&credentialType.summary_fields.user_capabilities.delete&&/*#__PURE__*/_jsx(DeleteButton,{name:name,modalTitle:/*i18n*/i18n._(\"Delete credential type\"),onConfirm:deleteCredentialType,isDisabled:isLoading||isDeleteDisabled,disabledTooltip:isDeleteDisabled&&/*i18n*/i18n._(\"This credential type is currently being used by some credentials and cannot be deleted\"),children:/*i18n*/i18n._(\"Delete\")})]}),error&&/*#__PURE__*/_jsx(AlertModal,{isOpen:error,onClose:dismissError,title:/*i18n*/i18n._(\"Error\"),variant:\"error\",children:/*#__PURE__*/_jsx(ErrorDetail,{error:error})})]});}export default CredentialTypeDetails;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/CredentialType/CredentialTypeDetails/CredentialTypeDetails.js"],"names":["React","useCallback","useEffect","Link","useHistory","Button","VariablesDetail","AlertModal","CardBody","CardActionsRow","DeleteButton","Detail","DetailList","UserDateDetail","useRequest","useDismissableError","CredentialTypesAPI","jsonToYaml","relatedResourceDeleteRequests","getRelatedResourceDeleteCounts","ErrorDetail","CredentialTypeDetails","credentialType","id","name","description","injectors","inputs","history","destroy","push","deleteCredentialType","request","isLoading","deleteError","error","deleteDetails","results","Error","isDeleteDisabled","result","deleteDetailsError","fetchDeleteDetails","dismissError","JSON","stringify","created","summary_fields","created_by","modified","modified_by","user_capabilities","edit","delete"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from 'react';\n\nimport { t } from '@lingui/macro';\nimport { Link, useHistory } from 'react-router-dom';\nimport { Button } from '@patternfly/react-core';\n\nimport { VariablesDetail } from 'components/CodeEditor';\nimport AlertModal from 'components/AlertModal';\nimport { CardBody, CardActionsRow } from 'components/Card';\nimport DeleteButton from 'components/DeleteButton';\nimport { Detail, DetailList, UserDateDetail } from 'components/DetailList';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport { CredentialTypesAPI } from 'api';\nimport { jsonToYaml } from 'util/yaml';\nimport {\n  relatedResourceDeleteRequests,\n  getRelatedResourceDeleteCounts,\n} from 'util/getRelatedResourceDeleteDetails';\nimport ErrorDetail from 'components/ErrorDetail';\n\nfunction CredentialTypeDetails({ credentialType }) {\n  const { id, name, description, injectors, inputs } = credentialType;\n  const history = useHistory();\n\n  const {\n    request: deleteCredentialType,\n    isLoading,\n    error: deleteError,\n  } = useRequest(\n    useCallback(async () => {\n      await CredentialTypesAPI.destroy(id);\n      history.push(`/credential_types`);\n    }, [id, history])\n  );\n\n  const {\n    result: { isDeleteDisabled },\n    error: deleteDetailsError,\n    request: fetchDeleteDetails,\n  } = useRequest(\n    useCallback(async () => {\n      const { results: deleteDetails, error } =\n        await getRelatedResourceDeleteCounts(\n          relatedResourceDeleteRequests.credentialType(credentialType)\n        );\n      if (error) {\n        throw new Error(error);\n      }\n      if (deleteDetails) {\n        return { isDeleteDisabled: true };\n      }\n      return { isDeleteDisabled: false };\n    }, [credentialType]),\n    { isDeleteDisabled: false }\n  );\n\n  useEffect(() => {\n    fetchDeleteDetails();\n  }, [fetchDeleteDetails]);\n  const { error, dismissError } = useDismissableError(\n    deleteError || deleteDetailsError\n  );\n\n  return (\n    <CardBody>\n      <DetailList>\n        <Detail\n          label={t`Name`}\n          value={name}\n          dataCy=\"credential-type-detail-name\"\n        />\n        <Detail label={t`Description`} value={description} />\n        <VariablesDetail\n          label={t`Input configuration`}\n          value={jsonToYaml(JSON.stringify(inputs))}\n          rows={6}\n          name=\"input\"\n          dataCy=\"credential-type-detail-input\"\n          helpText={t`Input schema which defines a set of ordered fields for that type.`}\n        />\n        <VariablesDetail\n          label={t`Injector configuration`}\n          value={jsonToYaml(JSON.stringify(injectors))}\n          rows={6}\n          name=\"injector\"\n          dataCy=\"credential-type-detail-injector\"\n          helpText={t`Environment variables or extra variables that specify the values a credential type can inject.`}\n        />\n        <UserDateDetail\n          label={t`Created`}\n          date={credentialType.created}\n          user={credentialType.summary_fields.created_by}\n        />\n        <UserDateDetail\n          label={t`Last Modified`}\n          date={credentialType.modified}\n          user={credentialType.summary_fields.modified_by}\n        />\n      </DetailList>\n      <CardActionsRow>\n        {credentialType.summary_fields.user_capabilities &&\n          credentialType.summary_fields.user_capabilities.edit && (\n            <Button\n              ouiaId=\"credential-type-detail-edit-button\"\n              aria-label={t`edit`}\n              component={Link}\n              to={`/credential_types/${id}/edit`}\n            >\n              {t`Edit`}\n            </Button>\n          )}\n        {credentialType.summary_fields.user_capabilities &&\n          credentialType.summary_fields.user_capabilities.delete && (\n            <DeleteButton\n              name={name}\n              modalTitle={t`Delete credential type`}\n              onConfirm={deleteCredentialType}\n              isDisabled={isLoading || isDeleteDisabled}\n              disabledTooltip={\n                isDeleteDisabled &&\n                t`This credential type is currently being used by some credentials and cannot be deleted`\n              }\n            >\n              {t`Delete`}\n            </DeleteButton>\n          )}\n      </CardActionsRow>\n\n      {error && (\n        <AlertModal\n          isOpen={error}\n          onClose={dismissError}\n          title={t`Error`}\n          variant=\"error\"\n        >\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </CardBody>\n  );\n}\n\nexport default CredentialTypeDetails;\n"]},"metadata":{},"sourceType":"module"}