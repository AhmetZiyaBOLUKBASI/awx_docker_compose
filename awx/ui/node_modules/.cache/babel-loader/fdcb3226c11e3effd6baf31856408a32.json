{"ast":null,"code":"import _createForOfIteratorHelper from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState}from'react';import{useHistory}from'react-router-dom';import{CardBody}from'components/Card';import{OrganizationsAPI}from'api';import OrganizationForm from'../shared/OrganizationForm';import{jsx as _jsx}from\"react/jsx-runtime\";var isEqual=function isEqual(array1,array2){return array1.length===array2.length&&array1.every(function(element,index){return element.id===array2[index].id;});};function OrganizationEdit(_ref){var organization=_ref.organization;var detailsUrl=\"/organizations/\".concat(organization.id,\"/details\");var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),formError=_useState2[0],setFormError=_useState2[1];var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values,groupsToAssociate,groupsToDisassociate){var _values$default_envir,_iterator,_step,credential,_iterator2,_step2,_credential;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return OrganizationsAPI.update(organization.id,_objectSpread(_objectSpread({},values),{},{default_environment:((_values$default_envir=values.default_environment)===null||_values$default_envir===void 0?void 0:_values$default_envir.id)||null}));case 3:_context.next=5;return OrganizationsAPI.orderInstanceGroups(organization.id,groupsToAssociate,groupsToDisassociate);case 5:if(isEqual(organization.galaxy_credentials,values.galaxy_credentials)){_context.next=40;break;}_iterator=_createForOfIteratorHelper(organization.galaxy_credentials);_context.prev=7;_iterator.s();case 9:if((_step=_iterator.n()).done){_context.next=15;break;}credential=_step.value;_context.next=13;return OrganizationsAPI.disassociateGalaxyCredential(organization.id,credential.id);case 13:_context.next=9;break;case 15:_context.next=20;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](7);_iterator.e(_context.t0);case 20:_context.prev=20;_iterator.f();return _context.finish(20);case 23:_iterator2=_createForOfIteratorHelper(values.galaxy_credentials);_context.prev=24;_iterator2.s();case 26:if((_step2=_iterator2.n()).done){_context.next=32;break;}_credential=_step2.value;_context.next=30;return OrganizationsAPI.associateGalaxyCredential(organization.id,_credential.id);case 30:_context.next=26;break;case 32:_context.next=37;break;case 34:_context.prev=34;_context.t1=_context[\"catch\"](24);_iterator2.e(_context.t1);case 37:_context.prev=37;_iterator2.f();return _context.finish(37);case 40:/* eslint-enable no-await-in-loop, no-restricted-syntax */history.push(detailsUrl);_context.next=46;break;case 43:_context.prev=43;_context.t2=_context[\"catch\"](0);setFormError(_context.t2);case 46:case\"end\":return _context.stop();}}},_callee,null,[[0,43],[7,17,20,23],[24,34,37,40]]);}));return function handleSubmit(_x,_x2,_x3){return _ref2.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push(detailsUrl);};return/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(OrganizationForm,{organization:organization,onSubmit:handleSubmit,onCancel:handleCancel,submitError:formError})});}export{OrganizationEdit as _OrganizationEdit};export default OrganizationEdit;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Organization/OrganizationEdit/OrganizationEdit.js"],"names":["React","useState","useHistory","CardBody","OrganizationsAPI","OrganizationForm","isEqual","array1","array2","length","every","element","index","id","OrganizationEdit","organization","detailsUrl","history","formError","setFormError","handleSubmit","values","groupsToAssociate","groupsToDisassociate","update","default_environment","orderInstanceGroups","galaxy_credentials","credential","disassociateGalaxyCredential","associateGalaxyCredential","push","handleCancel","_OrganizationEdit"],"mappings":"6hBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CAEA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,QAAT,KAAyB,iBAAzB,CACA,OAASC,gBAAT,KAAiC,KAAjC,CACA,MAAOC,CAAAA,gBAAP,KAA6B,4BAA7B,C,2CAEA,GAAMC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,CAACC,MAAD,CAASC,MAAT,QACdD,CAAAA,MAAM,CAACE,MAAP,GAAkBD,MAAM,CAACC,MAAzB,EACAF,MAAM,CAACG,KAAP,CAAa,SAACC,OAAD,CAAUC,KAAV,QAAoBD,CAAAA,OAAO,CAACE,EAAR,GAAeL,MAAM,CAACI,KAAD,CAAN,CAAcC,EAAjD,EAAb,CAFc,EAAhB,CAIA,QAASC,CAAAA,gBAAT,MAA4C,IAAhBC,CAAAA,YAAgB,MAAhBA,YAAgB,CAC1C,GAAMC,CAAAA,UAAU,0BAAqBD,YAAY,CAACF,EAAlC,YAAhB,CACA,GAAMI,CAAAA,OAAO,CAAGf,UAAU,EAA1B,CACA,cAAkCD,QAAQ,CAAC,IAAD,CAA1C,wCAAOiB,SAAP,eAAkBC,YAAlB,eAEA,GAAMC,CAAAA,YAAY,2FAAG,iBACnBC,MADmB,CAEnBC,iBAFmB,CAGnBC,oBAHmB,2OAMXnB,CAAAA,gBAAgB,CAACoB,MAAjB,CAAwBT,YAAY,CAACF,EAArC,gCACDQ,MADC,MAEJI,mBAAmB,CAAE,wBAAAJ,MAAM,CAACI,mBAAP,sEAA4BZ,EAA5B,GAAkC,IAFnD,GANW,8BAUXT,CAAAA,gBAAgB,CAACsB,mBAAjB,CACJX,YAAY,CAACF,EADT,CAEJS,iBAFI,CAGJC,oBAHI,CAVW,WAmBdjB,OAAO,CAACS,YAAY,CAACY,kBAAd,CAAkCN,MAAM,CAACM,kBAAzC,CAnBO,+DAqBUZ,YAAY,CAACY,kBArBvB,8FAqBJC,UArBI,oCAsBPxB,CAAAA,gBAAgB,CAACyB,4BAAjB,CACJd,YAAY,CAACF,EADT,CAEJe,UAAU,CAACf,EAFP,CAtBO,iQA2BUQ,MAAM,CAACM,kBA3BjB,mGA2BJC,WA3BI,qCA4BPxB,CAAAA,gBAAgB,CAAC0B,yBAAjB,CACJf,YAAY,CAACF,EADT,CAEJe,WAAU,CAACf,EAFP,CA5BO,+NAkCjB,0DACAI,OAAO,CAACc,IAAR,CAAaf,UAAb,EAnCiB,iFAqCjBG,YAAY,aAAZ,CArCiB,gGAAH,kBAAZC,CAAAA,YAAY,qDAAlB,CAyCA,GAAMY,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CACzBf,OAAO,CAACc,IAAR,CAAaf,UAAb,EACD,CAFD,CAIA,mBACE,KAAC,QAAD,wBACE,KAAC,gBAAD,EACE,YAAY,CAAED,YADhB,CAEE,QAAQ,CAAEK,YAFZ,CAGE,QAAQ,CAAEY,YAHZ,CAIE,WAAW,CAAEd,SAJf,EADF,EADF,CAUD,CAMD,OAASJ,gBAAgB,GAAImB,CAAAA,iBAA7B,EACA,cAAenB,CAAAA,gBAAf","sourcesContent":["import React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { useHistory } from 'react-router-dom';\nimport { CardBody } from 'components/Card';\nimport { OrganizationsAPI } from 'api';\nimport OrganizationForm from '../shared/OrganizationForm';\n\nconst isEqual = (array1, array2) =>\n  array1.length === array2.length &&\n  array1.every((element, index) => element.id === array2[index].id);\n\nfunction OrganizationEdit({ organization }) {\n  const detailsUrl = `/organizations/${organization.id}/details`;\n  const history = useHistory();\n  const [formError, setFormError] = useState(null);\n\n  const handleSubmit = async (\n    values,\n    groupsToAssociate,\n    groupsToDisassociate\n  ) => {\n    try {\n      await OrganizationsAPI.update(organization.id, {\n        ...values,\n        default_environment: values.default_environment?.id || null,\n      });\n      await OrganizationsAPI.orderInstanceGroups(\n        organization.id,\n        groupsToAssociate,\n        groupsToDisassociate\n      );\n\n      /* eslint-disable no-await-in-loop, no-restricted-syntax */\n      // Resolve Promises sequentially to avoid race condition\n      if (\n        !isEqual(organization.galaxy_credentials, values.galaxy_credentials)\n      ) {\n        for (const credential of organization.galaxy_credentials) {\n          await OrganizationsAPI.disassociateGalaxyCredential(\n            organization.id,\n            credential.id\n          );\n        }\n        for (const credential of values.galaxy_credentials) {\n          await OrganizationsAPI.associateGalaxyCredential(\n            organization.id,\n            credential.id\n          );\n        }\n      }\n      /* eslint-enable no-await-in-loop, no-restricted-syntax */\n      history.push(detailsUrl);\n    } catch (error) {\n      setFormError(error);\n    }\n  };\n\n  const handleCancel = () => {\n    history.push(detailsUrl);\n  };\n\n  return (\n    <CardBody>\n      <OrganizationForm\n        organization={organization}\n        onSubmit={handleSubmit}\n        onCancel={handleCancel}\n        submitError={formError}\n      />\n    </CardBody>\n  );\n}\n\nOrganizationEdit.propTypes = {\n  organization: PropTypes.shape().isRequired,\n};\n\nexport { OrganizationEdit as _OrganizationEdit };\nexport default OrganizationEdit;\n"]},"metadata":{},"sourceType":"module"}