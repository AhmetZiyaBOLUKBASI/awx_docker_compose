{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _excluded=[\"EVENT_STDOUT_MAX_BYTES_DISPLAY\",\"STDOUT_MAX_BYTES_DISPLAY\"];import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{Formik}from'formik';import{Form}from'@patternfly/react-core';import{CardBody}from'components/Card';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import{FormSubmitError}from'components/FormField';import{FormColumnLayout}from'components/FormLayout';import{useSettings}from'contexts/Settings';import useModal from'hooks/useModal';import useRequest from'hooks/useRequest';import{SettingsAPI}from'api';import{formatJson}from'../../shared/settingUtils';import{BooleanField,InputField,ObjectField,RevertAllAlert,RevertFormActionGroup,ChoiceField}from'../../shared';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function JobsEdit(){var _jobs$ALLOW_JINJA_IN_,_jobs$ALLOW_JINJA_IN_2,_jobs$ALLOW_JINJA_IN_3;var history=useHistory();var _useModal=useModal(),isModalOpen=_useModal.isModalOpen,toggleModal=_useModal.toggleModal,closeModal=_useModal.closeModal;var _useSettings=useSettings(),options=_useSettings.PUT;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$SettingsAPI$re,data,EVENT_STDOUT_MAX_BYTES_DISPLAY,STDOUT_MAX_BYTES_DISPLAY,jobsData,mergedData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return SettingsAPI.readCategory('jobs');case 2:_yield$SettingsAPI$re=_context.sent;data=_yield$SettingsAPI$re.data;EVENT_STDOUT_MAX_BYTES_DISPLAY=data.EVENT_STDOUT_MAX_BYTES_DISPLAY,STDOUT_MAX_BYTES_DISPLAY=data.STDOUT_MAX_BYTES_DISPLAY,jobsData=_objectWithoutProperties(data,_excluded);mergedData={};Object.keys(jobsData).forEach(function(key){if(!options[key]){return;}mergedData[key]=options[key];mergedData[key].value=jobsData[key];});return _context.abrupt(\"return\",mergedData);case 8:case\"end\":return _context.stop();}}},_callee);})),[options]),null),isLoading=_useRequest.isLoading,error=_useRequest.error,fetchJobs=_useRequest.request,jobs=_useRequest.result;useEffect(function(){fetchJobs();},[fetchJobs]);var _useRequest2=useRequest(useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return SettingsAPI.updateAll(values);case 2:history.push('/settings/jobs/details');case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}(),[history]),null),submitError=_useRequest2.error,submitForm=_useRequest2.request;var _useRequest3=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return SettingsAPI.revertCategory('jobs');case 2:case\"end\":return _context3.stop();}}},_callee3);})),[]),null),revertError=_useRequest3.error,revertAll=_useRequest3.request;var handleSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(form){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return submitForm(_objectSpread(_objectSpread({},form),{},{AD_HOC_COMMANDS:formatJson(form.AD_HOC_COMMANDS),AWX_ISOLATION_SHOW_PATHS:formatJson(form.AWX_ISOLATION_SHOW_PATHS),AWX_ANSIBLE_CALLBACK_PLUGINS:formatJson(form.AWX_ANSIBLE_CALLBACK_PLUGINS),AWX_TASK_ENV:formatJson(form.AWX_TASK_ENV),GALAXY_TASK_ENV:formatJson(form.GALAXY_TASK_ENV)}));case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function handleSubmit(_x2){return _ref4.apply(this,arguments);};}();var handleRevertAll=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return revertAll();case 2:closeModal();history.push('/settings/jobs/details');case 4:case\"end\":return _context5.stop();}}},_callee5);}));return function handleRevertAll(){return _ref5.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push('/settings/jobs/details');};var initialValues=function initialValues(fields){return Object.keys(fields).reduce(function(acc,key){if(fields[key].type==='list'||fields[key].type==='nested object'){acc[key]=fields[key].value?JSON.stringify(fields[key].value,null,2):null;}else{var _fields$key$value;acc[key]=(_fields$key$value=fields[key].value)!==null&&_fields$key$value!==void 0?_fields$key$value:'';}return acc;},{});};// We have to rebuild the ALLOW_JINJA_IN_EXTRA_VARS object because the default value\n// is 'template' but its label that comes from the api is 'Only On Job Template\n// Definitions'.  The problem is that this label does not match whats in the help\n// text, or what is rendered on the screen in the details, 'template' is what is\n// rendered in those locations. For consistency sake I have changed that label\n// value below.\nvar jinja={default:'template',help_text:jobs===null||jobs===void 0?void 0:(_jobs$ALLOW_JINJA_IN_=jobs.ALLOW_JINJA_IN_EXTRA_VARS)===null||_jobs$ALLOW_JINJA_IN_===void 0?void 0:_jobs$ALLOW_JINJA_IN_.help_text,label:jobs===null||jobs===void 0?void 0:(_jobs$ALLOW_JINJA_IN_2=jobs.ALLOW_JINJA_IN_EXTRA_VARS)===null||_jobs$ALLOW_JINJA_IN_2===void 0?void 0:_jobs$ALLOW_JINJA_IN_2.label};jinja.choices=jobs===null||jobs===void 0?void 0:(_jobs$ALLOW_JINJA_IN_3=jobs.ALLOW_JINJA_IN_EXTRA_VARS)===null||_jobs$ALLOW_JINJA_IN_3===void 0?void 0:_jobs$ALLOW_JINJA_IN_3.choices.map(function(_ref6){var _ref7=_slicedToArray(_ref6,2),value=_ref7[0],label=_ref7[1];return value==='template'?[value,/*i18n*/i18n._(\"Template\")]:[value,label];});return/*#__PURE__*/_jsxs(CardBody,{children:[isLoading&&/*#__PURE__*/_jsx(ContentLoading,{}),!isLoading&&error&&/*#__PURE__*/_jsx(ContentError,{error:error}),!isLoading&&jobs&&/*#__PURE__*/_jsx(Formik,{initialValues:initialValues(jobs),onSubmit:handleSubmit,children:function children(formik){return/*#__PURE__*/_jsxs(Form,{autoComplete:\"off\",onSubmit:formik.handleSubmit,children:[/*#__PURE__*/_jsxs(FormColumnLayout,{children:[/*#__PURE__*/_jsx(InputField,{name:\"AWX_ISOLATION_BASE_PATH\",config:jobs.AWX_ISOLATION_BASE_PATH,isRequired:true}),/*#__PURE__*/_jsx(InputField,{name:\"SCHEDULE_MAX_JOBS\",config:jobs.SCHEDULE_MAX_JOBS,type:\"number\",isRequired:true}),/*#__PURE__*/_jsx(InputField,{name:\"DEFAULT_JOB_TIMEOUT\",config:jobs.DEFAULT_JOB_TIMEOUT,type:\"number\"}),/*#__PURE__*/_jsx(InputField,{name:\"DEFAULT_JOB_IDLE_TIMEOUT\",config:jobs.DEFAULT_JOB_IDLE_TIMEOUT,type:\"number\"}),/*#__PURE__*/_jsx(InputField,{name:\"DEFAULT_INVENTORY_UPDATE_TIMEOUT\",config:jobs.DEFAULT_INVENTORY_UPDATE_TIMEOUT,type:\"number\"}),/*#__PURE__*/_jsx(InputField,{name:\"DEFAULT_PROJECT_UPDATE_TIMEOUT\",config:jobs.DEFAULT_PROJECT_UPDATE_TIMEOUT,type:\"number\"}),/*#__PURE__*/_jsx(InputField,{name:\"ANSIBLE_FACT_CACHE_TIMEOUT\",config:jobs.ANSIBLE_FACT_CACHE_TIMEOUT,type:\"number\"}),/*#__PURE__*/_jsx(InputField,{name:\"MAX_FORKS\",config:jobs.MAX_FORKS,type:\"number\"}),/*#__PURE__*/_jsx(ChoiceField,{name:\"ALLOW_JINJA_IN_EXTRA_VARS\",config:jinja}),/*#__PURE__*/_jsx(BooleanField,{name:\"PROJECT_UPDATE_VVV\",config:jobs.PROJECT_UPDATE_VVV}),/*#__PURE__*/_jsx(BooleanField,{name:\"GALAXY_IGNORE_CERTS\",config:jobs.GALAXY_IGNORE_CERTS}),/*#__PURE__*/_jsx(BooleanField,{name:\"AWX_ROLES_ENABLED\",config:jobs.AWX_ROLES_ENABLED}),/*#__PURE__*/_jsx(BooleanField,{name:\"AWX_COLLECTIONS_ENABLED\",config:jobs.AWX_COLLECTIONS_ENABLED}),/*#__PURE__*/_jsx(BooleanField,{name:\"AWX_SHOW_PLAYBOOK_LINKS\",config:jobs.AWX_SHOW_PLAYBOOK_LINKS}),/*#__PURE__*/_jsx(BooleanField,{name:\"AWX_MOUNT_ISOLATED_PATHS_ON_K8S\",config:jobs.AWX_MOUNT_ISOLATED_PATHS_ON_K8S}),/*#__PURE__*/_jsx(ObjectField,{name:\"AD_HOC_COMMANDS\",config:jobs.AD_HOC_COMMANDS}),/*#__PURE__*/_jsx(ObjectField,{name:\"AWX_ANSIBLE_CALLBACK_PLUGINS\",config:jobs.AWX_ANSIBLE_CALLBACK_PLUGINS}),/*#__PURE__*/_jsx(ObjectField,{name:\"AWX_ISOLATION_SHOW_PATHS\",config:jobs.AWX_ISOLATION_SHOW_PATHS}),/*#__PURE__*/_jsx(ObjectField,{name:\"AWX_TASK_ENV\",config:jobs.AWX_TASK_ENV}),/*#__PURE__*/_jsx(ObjectField,{name:\"GALAXY_TASK_ENV\",config:jobs.GALAXY_TASK_ENV}),submitError&&/*#__PURE__*/_jsx(FormSubmitError,{error:submitError}),revertError&&/*#__PURE__*/_jsx(FormSubmitError,{error:revertError})]}),/*#__PURE__*/_jsx(RevertFormActionGroup,{onCancel:handleCancel,onSubmit:formik.handleSubmit,onRevert:toggleModal}),isModalOpen&&/*#__PURE__*/_jsx(RevertAllAlert,{onClose:closeModal,onRevertAll:handleRevertAll})]});}})]});}export default JobsEdit;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Setting/Jobs/JobsEdit/JobsEdit.js"],"names":["React","useCallback","useEffect","useHistory","Formik","Form","CardBody","ContentError","ContentLoading","FormSubmitError","FormColumnLayout","useSettings","useModal","useRequest","SettingsAPI","formatJson","BooleanField","InputField","ObjectField","RevertAllAlert","RevertFormActionGroup","ChoiceField","JobsEdit","history","isModalOpen","toggleModal","closeModal","options","PUT","readCategory","data","EVENT_STDOUT_MAX_BYTES_DISPLAY","STDOUT_MAX_BYTES_DISPLAY","jobsData","mergedData","Object","keys","forEach","key","value","isLoading","error","fetchJobs","request","jobs","result","values","updateAll","push","submitError","submitForm","revertCategory","revertError","revertAll","handleSubmit","form","AD_HOC_COMMANDS","AWX_ISOLATION_SHOW_PATHS","AWX_ANSIBLE_CALLBACK_PLUGINS","AWX_TASK_ENV","GALAXY_TASK_ENV","handleRevertAll","handleCancel","initialValues","fields","reduce","acc","type","JSON","stringify","jinja","default","help_text","ALLOW_JINJA_IN_EXTRA_VARS","label","choices","map","formik","AWX_ISOLATION_BASE_PATH","SCHEDULE_MAX_JOBS","DEFAULT_JOB_TIMEOUT","DEFAULT_JOB_IDLE_TIMEOUT","DEFAULT_INVENTORY_UPDATE_TIMEOUT","DEFAULT_PROJECT_UPDATE_TIMEOUT","ANSIBLE_FACT_CACHE_TIMEOUT","MAX_FORKS","PROJECT_UPDATE_VVV","GALAXY_IGNORE_CERTS","AWX_ROLES_ENABLED","AWX_COLLECTIONS_ENABLED","AWX_SHOW_PLAYBOOK_LINKS","AWX_MOUNT_ISOLATED_PATHS_ON_K8S"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { t } from '@lingui/macro';\nimport { useHistory } from 'react-router-dom';\nimport { Formik } from 'formik';\nimport { Form } from '@patternfly/react-core';\nimport { CardBody } from 'components/Card';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport { FormSubmitError } from 'components/FormField';\nimport { FormColumnLayout } from 'components/FormLayout';\nimport { useSettings } from 'contexts/Settings';\nimport useModal from 'hooks/useModal';\nimport useRequest from 'hooks/useRequest';\nimport { SettingsAPI } from 'api';\nimport { formatJson } from '../../shared/settingUtils';\nimport {\n  BooleanField,\n  InputField,\n  ObjectField,\n  RevertAllAlert,\n  RevertFormActionGroup,\n  ChoiceField,\n} from '../../shared';\n\nfunction JobsEdit() {\n  const history = useHistory();\n  const { isModalOpen, toggleModal, closeModal } = useModal();\n  const { PUT: options } = useSettings();\n\n  const {\n    isLoading,\n    error,\n    request: fetchJobs,\n    result: jobs,\n  } = useRequest(\n    useCallback(async () => {\n      const { data } = await SettingsAPI.readCategory('jobs');\n      const {\n        EVENT_STDOUT_MAX_BYTES_DISPLAY,\n        STDOUT_MAX_BYTES_DISPLAY,\n        ...jobsData\n      } = data;\n      const mergedData = {};\n      Object.keys(jobsData).forEach((key) => {\n        if (!options[key]) {\n          return;\n        }\n        mergedData[key] = options[key];\n        mergedData[key].value = jobsData[key];\n      });\n\n      return mergedData;\n    }, [options]),\n    null\n  );\n\n  useEffect(() => {\n    fetchJobs();\n  }, [fetchJobs]);\n\n  const { error: submitError, request: submitForm } = useRequest(\n    useCallback(\n      async (values) => {\n        await SettingsAPI.updateAll(values);\n        history.push('/settings/jobs/details');\n      },\n      [history]\n    ),\n    null\n  );\n\n  const { error: revertError, request: revertAll } = useRequest(\n    useCallback(async () => {\n      await SettingsAPI.revertCategory('jobs');\n    }, []),\n    null\n  );\n\n  const handleSubmit = async (form) => {\n    await submitForm({\n      ...form,\n      AD_HOC_COMMANDS: formatJson(form.AD_HOC_COMMANDS),\n      AWX_ISOLATION_SHOW_PATHS: formatJson(form.AWX_ISOLATION_SHOW_PATHS),\n      AWX_ANSIBLE_CALLBACK_PLUGINS: formatJson(\n        form.AWX_ANSIBLE_CALLBACK_PLUGINS\n      ),\n      AWX_TASK_ENV: formatJson(form.AWX_TASK_ENV),\n      GALAXY_TASK_ENV: formatJson(form.GALAXY_TASK_ENV),\n    });\n  };\n\n  const handleRevertAll = async () => {\n    await revertAll();\n\n    closeModal();\n\n    history.push('/settings/jobs/details');\n  };\n\n  const handleCancel = () => {\n    history.push('/settings/jobs/details');\n  };\n\n  const initialValues = (fields) =>\n    Object.keys(fields).reduce((acc, key) => {\n      if (fields[key].type === 'list' || fields[key].type === 'nested object') {\n        acc[key] = fields[key].value\n          ? JSON.stringify(fields[key].value, null, 2)\n          : null;\n      } else {\n        acc[key] = fields[key].value ?? '';\n      }\n      return acc;\n    }, {});\n\n  // We have to rebuild the ALLOW_JINJA_IN_EXTRA_VARS object because the default value\n  // is 'template' but its label that comes from the api is 'Only On Job Template\n  // Definitions'.  The problem is that this label does not match whats in the help\n  // text, or what is rendered on the screen in the details, 'template' is what is\n  // rendered in those locations. For consistency sake I have changed that label\n  // value below.\n\n  const jinja = {\n    default: 'template',\n    help_text: jobs?.ALLOW_JINJA_IN_EXTRA_VARS?.help_text,\n    label: jobs?.ALLOW_JINJA_IN_EXTRA_VARS?.label,\n  };\n  jinja.choices = jobs?.ALLOW_JINJA_IN_EXTRA_VARS?.choices.map(\n    ([value, label]) =>\n      value === 'template' ? [value, t`Template`] : [value, label]\n  );\n\n  return (\n    <CardBody>\n      {isLoading && <ContentLoading />}\n      {!isLoading && error && <ContentError error={error} />}\n      {!isLoading && jobs && (\n        <Formik initialValues={initialValues(jobs)} onSubmit={handleSubmit}>\n          {(formik) => (\n            <Form autoComplete=\"off\" onSubmit={formik.handleSubmit}>\n              <FormColumnLayout>\n                <InputField\n                  name=\"AWX_ISOLATION_BASE_PATH\"\n                  config={jobs.AWX_ISOLATION_BASE_PATH}\n                  isRequired\n                />\n                <InputField\n                  name=\"SCHEDULE_MAX_JOBS\"\n                  config={jobs.SCHEDULE_MAX_JOBS}\n                  type=\"number\"\n                  isRequired\n                />\n                <InputField\n                  name=\"DEFAULT_JOB_TIMEOUT\"\n                  config={jobs.DEFAULT_JOB_TIMEOUT}\n                  type=\"number\"\n                />\n                <InputField\n                  name=\"DEFAULT_JOB_IDLE_TIMEOUT\"\n                  config={jobs.DEFAULT_JOB_IDLE_TIMEOUT}\n                  type=\"number\"\n                />\n                <InputField\n                  name=\"DEFAULT_INVENTORY_UPDATE_TIMEOUT\"\n                  config={jobs.DEFAULT_INVENTORY_UPDATE_TIMEOUT}\n                  type=\"number\"\n                />\n                <InputField\n                  name=\"DEFAULT_PROJECT_UPDATE_TIMEOUT\"\n                  config={jobs.DEFAULT_PROJECT_UPDATE_TIMEOUT}\n                  type=\"number\"\n                />\n                <InputField\n                  name=\"ANSIBLE_FACT_CACHE_TIMEOUT\"\n                  config={jobs.ANSIBLE_FACT_CACHE_TIMEOUT}\n                  type=\"number\"\n                />\n                <InputField\n                  name=\"MAX_FORKS\"\n                  config={jobs.MAX_FORKS}\n                  type=\"number\"\n                />\n                <ChoiceField name=\"ALLOW_JINJA_IN_EXTRA_VARS\" config={jinja} />\n                <BooleanField\n                  name=\"PROJECT_UPDATE_VVV\"\n                  config={jobs.PROJECT_UPDATE_VVV}\n                />\n                <BooleanField\n                  name=\"GALAXY_IGNORE_CERTS\"\n                  config={jobs.GALAXY_IGNORE_CERTS}\n                />\n                <BooleanField\n                  name=\"AWX_ROLES_ENABLED\"\n                  config={jobs.AWX_ROLES_ENABLED}\n                />\n                <BooleanField\n                  name=\"AWX_COLLECTIONS_ENABLED\"\n                  config={jobs.AWX_COLLECTIONS_ENABLED}\n                />\n                <BooleanField\n                  name=\"AWX_SHOW_PLAYBOOK_LINKS\"\n                  config={jobs.AWX_SHOW_PLAYBOOK_LINKS}\n                />\n                <BooleanField\n                  name=\"AWX_MOUNT_ISOLATED_PATHS_ON_K8S\"\n                  config={jobs.AWX_MOUNT_ISOLATED_PATHS_ON_K8S}\n                />\n                <ObjectField\n                  name=\"AD_HOC_COMMANDS\"\n                  config={jobs.AD_HOC_COMMANDS}\n                />\n                <ObjectField\n                  name=\"AWX_ANSIBLE_CALLBACK_PLUGINS\"\n                  config={jobs.AWX_ANSIBLE_CALLBACK_PLUGINS}\n                />\n                <ObjectField\n                  name=\"AWX_ISOLATION_SHOW_PATHS\"\n                  config={jobs.AWX_ISOLATION_SHOW_PATHS}\n                />\n                <ObjectField name=\"AWX_TASK_ENV\" config={jobs.AWX_TASK_ENV} />\n                <ObjectField\n                  name=\"GALAXY_TASK_ENV\"\n                  config={jobs.GALAXY_TASK_ENV}\n                />\n                {submitError && <FormSubmitError error={submitError} />}\n                {revertError && <FormSubmitError error={revertError} />}\n              </FormColumnLayout>\n              <RevertFormActionGroup\n                onCancel={handleCancel}\n                onSubmit={formik.handleSubmit}\n                onRevert={toggleModal}\n              />\n              {isModalOpen && (\n                <RevertAllAlert\n                  onClose={closeModal}\n                  onRevertAll={handleRevertAll}\n                />\n              )}\n            </Form>\n          )}\n        </Formik>\n      )}\n    </CardBody>\n  );\n}\n\nexport default JobsEdit;\n"]},"metadata":{},"sourceType":"module"}