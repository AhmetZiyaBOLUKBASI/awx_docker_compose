{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectWithoutProperties from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _excluded=[\"executionEnvironment\",\"onSubmit\",\"onCancel\",\"submitError\",\"me\",\"isOrgLookupDisabled\"];import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect,useRef}from'react';import{Formik,useField,useFormikContext}from'formik';import{Form,FormGroup,Tooltip}from'@patternfly/react-core';import{ExecutionEnvironmentsAPI}from'api';import CredentialLookup from'components/Lookup/CredentialLookup';import FormActionGroup from'components/FormActionGroup';import FormField,{FormSubmitError}from'components/FormField';import AnsibleSelect from'components/AnsibleSelect';import{FormColumnLayout}from'components/FormLayout';import{OrganizationLookup}from'components/Lookup';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import{required}from'util/validators';import useRequest from'hooks/useRequest';import helpText from'./ExecutionEnvironment.helptext';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ExecutionEnvironmentFormFields(_ref){var _options$actions,_options$actions$POST,_options$actions$POST2;var me=_ref.me,options=_ref.options,executionEnvironment=_ref.executionEnvironment,isOrgLookupDisabled=_ref.isOrgLookupDisabled;var _useField=useField('credential'),_useField2=_slicedToArray(_useField,3),credentialField=_useField2[0],credentialMeta=_useField2[1],credentialHelpers=_useField2[2];var _useField3=useField('organization'),_useField4=_slicedToArray(_useField3,3),organizationField=_useField4[0],organizationMeta=_useField4[1],organizationHelpers=_useField4[2];var isGloballyAvailable=useRef(!organizationField.value);var _useFormikContext=useFormikContext(),setFieldValue=_useFormikContext.setFieldValue,setFieldTouched=_useFormikContext.setFieldTouched;var onCredentialChange=useCallback(function(value){setFieldValue('credential',value);},[setFieldValue]);var handleOrganizationUpdate=useCallback(function(value){setFieldValue('organization',value);setFieldTouched('organization',true,false);},[setFieldValue,setFieldTouched]);var _useField5=useField('pull'),_useField6=_slicedToArray(_useField5,3),containerOptionsField=_useField6[0],containerOptionsMeta=_useField6[1],containerOptionsHelpers=_useField6[2];var containerPullChoices=options===null||options===void 0?void 0:(_options$actions=options.actions)===null||_options$actions===void 0?void 0:(_options$actions$POST=_options$actions.POST)===null||_options$actions$POST===void 0?void 0:(_options$actions$POST2=_options$actions$POST.pull)===null||_options$actions$POST2===void 0?void 0:_options$actions$POST2.choices.map(function(_ref2){var _ref3=_slicedToArray(_ref2,2),value=_ref3[0],label=_ref3[1];return{value:value,label:label,key:value};});var renderOrganizationLookup=function renderOrganizationLookup(){return/*#__PURE__*/_jsx(OrganizationLookup,{helperTextInvalid:organizationMeta.error,isValid:!organizationMeta.touched||!organizationMeta.error,onBlur:function onBlur(){return organizationHelpers.setTouched();},onChange:handleOrganizationUpdate,value:organizationField.value,required:!me.is_superuser,helperText:me!==null&&me!==void 0&&me.is_superuser&&(!isOrgLookupDisabled&&isGloballyAvailable||organizationField.value===null)?/*i18n*/i18n._(\"Leave this field blank to make the execution environment globally available.\"):null,autoPopulate:!(me!==null&&me!==void 0&&me.is_superuser)?!(executionEnvironment!==null&&executionEnvironment!==void 0&&executionEnvironment.id):null,isDisabled:!!isOrgLookupDisabled&&isGloballyAvailable.current||(executionEnvironment===null||executionEnvironment===void 0?void 0:executionEnvironment.managed),validate:!(me!==null&&me!==void 0&&me.is_superuser)?required(/*i18n*/i18n._(\"Select a value for this field\")):undefined});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FormField,{id:\"execution-environment-name\",label:/*i18n*/i18n._(\"Name\"),name:\"name\",type:\"text\",validate:required(null),isRequired:true,isDisabled:(executionEnvironment===null||executionEnvironment===void 0?void 0:executionEnvironment.managed)||false}),/*#__PURE__*/_jsx(FormField,{id:\"execution-environment-image\",label:/*i18n*/i18n._(\"Image\"),name:\"image\",type:\"text\",validate:required(null),isRequired:true,isDisabled:(executionEnvironment===null||executionEnvironment===void 0?void 0:executionEnvironment.managed)||false,tooltip:helpText.image}),/*#__PURE__*/_jsx(FormGroup,{fieldId:\"execution-environment-container-options\",helperTextInvalid:containerOptionsMeta.error,validated:!containerOptionsMeta.touched||!containerOptionsMeta.error?'default':'error',label:/*i18n*/i18n._(\"Pull\"),children:/*#__PURE__*/_jsx(AnsibleSelect,_objectSpread(_objectSpread({},containerOptionsField),{},{id:\"container-pull-options\",data:containerPullChoices,onChange:function onChange(event,value){containerOptionsHelpers.setValue(value);}}))}),/*#__PURE__*/_jsx(FormField,{id:\"execution-environment-description\",label:/*i18n*/i18n._(\"Description\"),name:\"description\",type:\"text\",isDisabled:(executionEnvironment===null||executionEnvironment===void 0?void 0:executionEnvironment.managed)||false}),isOrgLookupDisabled&&isGloballyAvailable.current?/*#__PURE__*/_jsx(Tooltip,{content:/*i18n*/i18n._(\"Globally available execution environment can not be reassigned to a specific Organization\"),children:renderOrganizationLookup()}):renderOrganizationLookup(),/*#__PURE__*/_jsx(CredentialLookup,{label:/*i18n*/i18n._(\"Registry credential\"),credentialTypeKind:\"registry\",helperTextInvalid:credentialMeta.error,isValid:!credentialMeta.touched||!credentialMeta.error,onBlur:function onBlur(){return credentialHelpers.setTouched();},onChange:onCredentialChange,value:credentialField.value,tooltip:helpText.registryCredential,isDisabled:(executionEnvironment===null||executionEnvironment===void 0?void 0:executionEnvironment.managed)||false})]});}function ExecutionEnvironmentForm(_ref4){var _executionEnvironment,_executionEnvironment2;var _ref4$executionEnviro=_ref4.executionEnvironment,executionEnvironment=_ref4$executionEnviro===void 0?{}:_ref4$executionEnviro,_onSubmit=_ref4.onSubmit,onCancel=_ref4.onCancel,submitError=_ref4.submitError,me=_ref4.me,isOrgLookupDisabled=_ref4.isOrgLookupDisabled,rest=_objectWithoutProperties(_ref4,_excluded);var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return ExecutionEnvironmentsAPI.readOptions();case 2:res=_context.sent;data=res.data;return _context.abrupt(\"return\",data);case 5:case\"end\":return _context.stop();}}},_callee);})),[]),null),isLoading=_useRequest.isLoading,error=_useRequest.error,fetchOptions=_useRequest.request,options=_useRequest.result;useEffect(function(){fetchOptions();},[fetchOptions]);if(isLoading||!options){return/*#__PURE__*/_jsx(ContentLoading,{});}if(error){return/*#__PURE__*/_jsx(ContentError,{error:error});}var initialValues={name:executionEnvironment.name||'',image:executionEnvironment.image||'',pull:(executionEnvironment===null||executionEnvironment===void 0?void 0:executionEnvironment.pull)||'',description:executionEnvironment.description||'',credential:((_executionEnvironment=executionEnvironment.summary_fields)===null||_executionEnvironment===void 0?void 0:_executionEnvironment.credential)||null,organization:((_executionEnvironment2=executionEnvironment.summary_fields)===null||_executionEnvironment2===void 0?void 0:_executionEnvironment2.organization)||null};return/*#__PURE__*/_jsx(Formik,{enableReinitialize:true,initialValues:initialValues,onSubmit:function onSubmit(values){return _onSubmit(values);},children:function children(formik){return/*#__PURE__*/_jsx(Form,{autoComplete:\"off\",onSubmit:formik.handleSubmit,children:/*#__PURE__*/_jsxs(FormColumnLayout,{children:[/*#__PURE__*/_jsx(ExecutionEnvironmentFormFields,_objectSpread({me:me,options:options,executionEnvironment:executionEnvironment,isOrgLookupDisabled:isOrgLookupDisabled},rest)),submitError&&/*#__PURE__*/_jsx(FormSubmitError,{error:submitError}),/*#__PURE__*/_jsx(FormActionGroup,{onCancel:onCancel,onSubmit:formik.handleSubmit})]})});}});}ExecutionEnvironmentForm.defaultProps={executionEnvironment:{},submitError:null,isOrgLookupDisabled:false};export default ExecutionEnvironmentForm;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/ExecutionEnvironment/shared/ExecutionEnvironmentForm.js"],"names":["React","useCallback","useEffect","useRef","Formik","useField","useFormikContext","Form","FormGroup","Tooltip","ExecutionEnvironmentsAPI","CredentialLookup","FormActionGroup","FormField","FormSubmitError","AnsibleSelect","FormColumnLayout","OrganizationLookup","ContentError","ContentLoading","required","useRequest","helpText","ExecutionEnvironmentFormFields","me","options","executionEnvironment","isOrgLookupDisabled","credentialField","credentialMeta","credentialHelpers","organizationField","organizationMeta","organizationHelpers","isGloballyAvailable","value","setFieldValue","setFieldTouched","onCredentialChange","handleOrganizationUpdate","containerOptionsField","containerOptionsMeta","containerOptionsHelpers","containerPullChoices","actions","POST","pull","choices","map","label","key","renderOrganizationLookup","error","touched","setTouched","is_superuser","id","current","managed","undefined","image","event","setValue","registryCredential","ExecutionEnvironmentForm","onSubmit","onCancel","submitError","rest","readOptions","res","data","isLoading","fetchOptions","request","result","initialValues","name","description","credential","summary_fields","organization","values","formik","handleSubmit","defaultProps"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useRef } from 'react';\nimport { func, shape, bool } from 'prop-types';\nimport { Formik, useField, useFormikContext } from 'formik';\nimport { t } from '@lingui/macro';\nimport { Form, FormGroup, Tooltip } from '@patternfly/react-core';\nimport { ExecutionEnvironmentsAPI } from 'api';\nimport CredentialLookup from 'components/Lookup/CredentialLookup';\nimport FormActionGroup from 'components/FormActionGroup';\nimport FormField, { FormSubmitError } from 'components/FormField';\nimport AnsibleSelect from 'components/AnsibleSelect';\nimport { FormColumnLayout } from 'components/FormLayout';\nimport { OrganizationLookup } from 'components/Lookup';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport { required } from 'util/validators';\nimport useRequest from 'hooks/useRequest';\nimport helpText from './ExecutionEnvironment.helptext';\n\nfunction ExecutionEnvironmentFormFields({\n  me,\n  options,\n  executionEnvironment,\n  isOrgLookupDisabled,\n}) {\n  const [credentialField, credentialMeta, credentialHelpers] =\n    useField('credential');\n  const [organizationField, organizationMeta, organizationHelpers] =\n    useField('organization');\n\n  const isGloballyAvailable = useRef(!organizationField.value);\n\n  const { setFieldValue, setFieldTouched } = useFormikContext();\n\n  const onCredentialChange = useCallback(\n    (value) => {\n      setFieldValue('credential', value);\n    },\n    [setFieldValue]\n  );\n\n  const handleOrganizationUpdate = useCallback(\n    (value) => {\n      setFieldValue('organization', value);\n      setFieldTouched('organization', true, false);\n    },\n    [setFieldValue, setFieldTouched]\n  );\n\n  const [containerOptionsField, containerOptionsMeta, containerOptionsHelpers] =\n    useField('pull');\n\n  const containerPullChoices = options?.actions?.POST?.pull?.choices.map(\n    ([value, label]) => ({ value, label, key: value })\n  );\n\n  const renderOrganizationLookup = () => (\n    <OrganizationLookup\n      helperTextInvalid={organizationMeta.error}\n      isValid={!organizationMeta.touched || !organizationMeta.error}\n      onBlur={() => organizationHelpers.setTouched()}\n      onChange={handleOrganizationUpdate}\n      value={organizationField.value}\n      required={!me.is_superuser}\n      helperText={\n        me?.is_superuser &&\n        ((!isOrgLookupDisabled && isGloballyAvailable) ||\n          organizationField.value === null)\n          ? t`Leave this field blank to make the execution environment globally available.`\n          : null\n      }\n      autoPopulate={!me?.is_superuser ? !executionEnvironment?.id : null}\n      isDisabled={\n        (!!isOrgLookupDisabled && isGloballyAvailable.current) ||\n        executionEnvironment?.managed\n      }\n      validate={\n        !me?.is_superuser\n          ? required(t`Select a value for this field`)\n          : undefined\n      }\n    />\n  );\n\n  return (\n    <>\n      <FormField\n        id=\"execution-environment-name\"\n        label={t`Name`}\n        name=\"name\"\n        type=\"text\"\n        validate={required(null)}\n        isRequired\n        isDisabled={executionEnvironment?.managed || false}\n      />\n      <FormField\n        id=\"execution-environment-image\"\n        label={t`Image`}\n        name=\"image\"\n        type=\"text\"\n        validate={required(null)}\n        isRequired\n        isDisabled={executionEnvironment?.managed || false}\n        tooltip={helpText.image}\n      />\n      <FormGroup\n        fieldId=\"execution-environment-container-options\"\n        helperTextInvalid={containerOptionsMeta.error}\n        validated={\n          !containerOptionsMeta.touched || !containerOptionsMeta.error\n            ? 'default'\n            : 'error'\n        }\n        label={t`Pull`}\n      >\n        <AnsibleSelect\n          {...containerOptionsField}\n          id=\"container-pull-options\"\n          data={containerPullChoices}\n          onChange={(event, value) => {\n            containerOptionsHelpers.setValue(value);\n          }}\n        />\n      </FormGroup>\n      <FormField\n        id=\"execution-environment-description\"\n        label={t`Description`}\n        name=\"description\"\n        type=\"text\"\n        isDisabled={executionEnvironment?.managed || false}\n      />\n      {isOrgLookupDisabled && isGloballyAvailable.current ? (\n        <Tooltip\n          content={t`Globally available execution environment can not be reassigned to a specific Organization`}\n        >\n          {renderOrganizationLookup()}\n        </Tooltip>\n      ) : (\n        renderOrganizationLookup()\n      )}\n\n      <CredentialLookup\n        label={t`Registry credential`}\n        credentialTypeKind=\"registry\"\n        helperTextInvalid={credentialMeta.error}\n        isValid={!credentialMeta.touched || !credentialMeta.error}\n        onBlur={() => credentialHelpers.setTouched()}\n        onChange={onCredentialChange}\n        value={credentialField.value}\n        tooltip={helpText.registryCredential}\n        isDisabled={executionEnvironment?.managed || false}\n      />\n    </>\n  );\n}\n\nfunction ExecutionEnvironmentForm({\n  executionEnvironment = {},\n  onSubmit,\n  onCancel,\n  submitError,\n  me,\n  isOrgLookupDisabled,\n  ...rest\n}) {\n  const {\n    isLoading,\n    error,\n    request: fetchOptions,\n    result: options,\n  } = useRequest(\n    useCallback(async () => {\n      const res = await ExecutionEnvironmentsAPI.readOptions();\n      const { data } = res;\n      return data;\n    }, []),\n    null\n  );\n\n  useEffect(() => {\n    fetchOptions();\n  }, [fetchOptions]);\n\n  if (isLoading || !options) {\n    return <ContentLoading />;\n  }\n\n  if (error) {\n    return <ContentError error={error} />;\n  }\n\n  const initialValues = {\n    name: executionEnvironment.name || '',\n    image: executionEnvironment.image || '',\n    pull: executionEnvironment?.pull || '',\n    description: executionEnvironment.description || '',\n    credential: executionEnvironment.summary_fields?.credential || null,\n    organization: executionEnvironment.summary_fields?.organization || null,\n  };\n  return (\n    <Formik\n      enableReinitialize\n      initialValues={initialValues}\n      onSubmit={(values) => onSubmit(values)}\n    >\n      {(formik) => (\n        <Form autoComplete=\"off\" onSubmit={formik.handleSubmit}>\n          <FormColumnLayout>\n            <ExecutionEnvironmentFormFields\n              me={me}\n              options={options}\n              executionEnvironment={executionEnvironment}\n              isOrgLookupDisabled={isOrgLookupDisabled}\n              {...rest}\n            />\n            {submitError && <FormSubmitError error={submitError} />}\n            <FormActionGroup\n              onCancel={onCancel}\n              onSubmit={formik.handleSubmit}\n            />\n          </FormColumnLayout>\n        </Form>\n      )}\n    </Formik>\n  );\n}\n\nExecutionEnvironmentForm.propTypes = {\n  executionEnvironment: shape({}),\n  onCancel: func.isRequired,\n  onSubmit: func.isRequired,\n  submitError: shape({}),\n  isOrgLookupDisabled: bool,\n};\n\nExecutionEnvironmentForm.defaultProps = {\n  executionEnvironment: {},\n  submitError: null,\n  isOrgLookupDisabled: false,\n};\n\nexport default ExecutionEnvironmentForm;\n"]},"metadata":{},"sourceType":"module"}