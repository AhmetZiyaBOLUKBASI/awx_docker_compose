{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import useWebsocket from'./useWebsocket';export default function useWsTemplates(initialTemplates){var _useState=useState(initialTemplates),_useState2=_slicedToArray(_useState,2),templates=_useState2[0],setTemplates=_useState2[1];var lastMessage=useWebsocket({jobs:['status_changed'],control:['limit_reached_1']});useEffect(function(){setTemplates(initialTemplates);},[initialTemplates]);useEffect(function(){if(!(lastMessage!==null&&lastMessage!==void 0&&lastMessage.unified_job_id)){return;}var index=templates.findIndex(function(t){return t.id===lastMessage.unified_job_template_id;});if(index===-1){return;}var template=templates[index];var updated=_toConsumableArray(templates);updated[index]=updateTemplate(template,lastMessage);setTemplates(updated);},[lastMessage]// eslint-disable-line react-hooks/exhaustive-deps\n);return templates;}function updateTemplate(template,message){var recentJobs=_toConsumableArray(template.summary_fields.recent_jobs||[]);var job={id:message.unified_job_id,status:message.status,finished:message.finished||null,type:message.type};var index=recentJobs.findIndex(function(j){return j.id===job.id;});if(index>-1){recentJobs[index]=_objectSpread(_objectSpread({},recentJobs[index]),job);}else{recentJobs.unshift(job);}return _objectSpread(_objectSpread({},template),{},{summary_fields:_objectSpread(_objectSpread({},template.summary_fields),{},{recent_jobs:recentJobs.slice(0,10)})});}","map":{"version":3,"sources":["/awx_devel/awx/ui/src/hooks/useWsTemplates.js"],"names":["useState","useEffect","useWebsocket","useWsTemplates","initialTemplates","templates","setTemplates","lastMessage","jobs","control","unified_job_id","index","findIndex","t","id","unified_job_template_id","template","updated","updateTemplate","message","recentJobs","summary_fields","recent_jobs","job","status","finished","type","j","unshift","slice"],"mappings":"4TAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,MAAOC,CAAAA,YAAP,KAAyB,gBAAzB,CAEA,cAAe,SAASC,CAAAA,cAAT,CAAwBC,gBAAxB,CAA0C,CACvD,cAAkCJ,QAAQ,CAACI,gBAAD,CAA1C,wCAAOC,SAAP,eAAkBC,YAAlB,eACA,GAAMC,CAAAA,WAAW,CAAGL,YAAY,CAAC,CAC/BM,IAAI,CAAE,CAAC,gBAAD,CADyB,CAE/BC,OAAO,CAAE,CAAC,iBAAD,CAFsB,CAAD,CAAhC,CAKAR,SAAS,CAAC,UAAM,CACdK,YAAY,CAACF,gBAAD,CAAZ,CACD,CAFQ,CAEN,CAACA,gBAAD,CAFM,CAAT,CAIAH,SAAS,CACP,UAAM,CACJ,GAAI,EAACM,WAAD,SAACA,WAAD,WAACA,WAAW,CAAEG,cAAd,CAAJ,CAAkC,CAChC,OACD,CACD,GAAMC,CAAAA,KAAK,CAAGN,SAAS,CAACO,SAAV,CACZ,SAACC,CAAD,QAAOA,CAAAA,CAAC,CAACC,EAAF,GAASP,WAAW,CAACQ,uBAA5B,EADY,CAAd,CAGA,GAAIJ,KAAK,GAAK,CAAC,CAAf,CAAkB,CAChB,OACD,CAED,GAAMK,CAAAA,QAAQ,CAAGX,SAAS,CAACM,KAAD,CAA1B,CACA,GAAMM,CAAAA,OAAO,oBAAOZ,SAAP,CAAb,CACAY,OAAO,CAACN,KAAD,CAAP,CAAiBO,cAAc,CAACF,QAAD,CAAWT,WAAX,CAA/B,CACAD,YAAY,CAACW,OAAD,CAAZ,CACD,CAhBM,CAiBP,CAACV,WAAD,CAAc;AAjBP,CAAT,CAoBA,MAAOF,CAAAA,SAAP,CACD,CAED,QAASa,CAAAA,cAAT,CAAwBF,QAAxB,CAAkCG,OAAlC,CAA2C,CACzC,GAAMC,CAAAA,UAAU,oBAAQJ,QAAQ,CAACK,cAAT,CAAwBC,WAAxB,EAAuC,EAA/C,CAAhB,CACA,GAAMC,CAAAA,GAAG,CAAG,CACVT,EAAE,CAAEK,OAAO,CAACT,cADF,CAEVc,MAAM,CAAEL,OAAO,CAACK,MAFN,CAGVC,QAAQ,CAAEN,OAAO,CAACM,QAAR,EAAoB,IAHpB,CAIVC,IAAI,CAAEP,OAAO,CAACO,IAJJ,CAAZ,CAMA,GAAMf,CAAAA,KAAK,CAAGS,UAAU,CAACR,SAAX,CAAqB,SAACe,CAAD,QAAOA,CAAAA,CAAC,CAACb,EAAF,GAASS,GAAG,CAACT,EAApB,EAArB,CAAd,CACA,GAAIH,KAAK,CAAG,CAAC,CAAb,CAAgB,CACdS,UAAU,CAACT,KAAD,CAAV,gCACKS,UAAU,CAACT,KAAD,CADf,EAEKY,GAFL,EAID,CALD,IAKO,CACLH,UAAU,CAACQ,OAAX,CAAmBL,GAAnB,EACD,CAED,sCACKP,QADL,MAEEK,cAAc,gCACTL,QAAQ,CAACK,cADA,MAEZC,WAAW,CAAEF,UAAU,CAACS,KAAX,CAAiB,CAAjB,CAAoB,EAApB,CAFD,EAFhB,GAOD","sourcesContent":["import { useState, useEffect } from 'react';\nimport useWebsocket from './useWebsocket';\n\nexport default function useWsTemplates(initialTemplates) {\n  const [templates, setTemplates] = useState(initialTemplates);\n  const lastMessage = useWebsocket({\n    jobs: ['status_changed'],\n    control: ['limit_reached_1'],\n  });\n\n  useEffect(() => {\n    setTemplates(initialTemplates);\n  }, [initialTemplates]);\n\n  useEffect(\n    () => {\n      if (!lastMessage?.unified_job_id) {\n        return;\n      }\n      const index = templates.findIndex(\n        (t) => t.id === lastMessage.unified_job_template_id\n      );\n      if (index === -1) {\n        return;\n      }\n\n      const template = templates[index];\n      const updated = [...templates];\n      updated[index] = updateTemplate(template, lastMessage);\n      setTemplates(updated);\n    },\n    [lastMessage] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n\n  return templates;\n}\n\nfunction updateTemplate(template, message) {\n  const recentJobs = [...(template.summary_fields.recent_jobs || [])];\n  const job = {\n    id: message.unified_job_id,\n    status: message.status,\n    finished: message.finished || null,\n    type: message.type,\n  };\n  const index = recentJobs.findIndex((j) => j.id === job.id);\n  if (index > -1) {\n    recentJobs[index] = {\n      ...recentJobs[index],\n      ...job,\n    };\n  } else {\n    recentJobs.unshift(job);\n  }\n\n  return {\n    ...template,\n    summary_fields: {\n      ...template.summary_fields,\n      recent_jobs: recentJobs.slice(0, 10),\n    },\n  };\n}\n"]},"metadata":{},"sourceType":"module"}