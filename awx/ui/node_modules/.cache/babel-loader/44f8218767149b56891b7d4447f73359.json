{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{Formik}from'formik';import{Form}from'@patternfly/react-core';import{CardBody}from'components/Card';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import{FormSubmitError}from'components/FormField';import{FormColumnLayout}from'components/FormLayout';import{useSettings}from'contexts/Settings';import{useConfig}from'contexts/Config';import useModal from'hooks/useModal';import useRequest from'hooks/useRequest';import{SettingsAPI}from'api';import{ChoiceField,FileUploadField,TextAreaField}from'../../shared/SharedFields';import{RevertAllAlert,RevertFormActionGroup}from'../../shared';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function UIEdit(){var _uiData$PENDO_TRACKIN2,_uiData$PENDO_TRACKIN3,_uiData$CUSTOM_LOGIN_,_uiData$CUSTOM_LOGIN_2,_uiData$CUSTOM_LOGO$v,_uiData$CUSTOM_LOGO;var history=useHistory();var _useModal=useModal(),isModalOpen=_useModal.isModalOpen,toggleModal=_useModal.toggleModal,closeModal=_useModal.closeModal;var _useSettings=useSettings(),options=_useSettings.PUT;var _useConfig=useConfig(),license_info=_useConfig.license_info;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$SettingsAPI$re,data,mergedData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return SettingsAPI.readCategory('ui');case 2:_yield$SettingsAPI$re=_context.sent;data=_yield$SettingsAPI$re.data;mergedData={};Object.keys(data).forEach(function(key){if(!options[key]){return;}mergedData[key]=options[key];mergedData[key].value=data[key];});return _context.abrupt(\"return\",mergedData);case 7:case\"end\":return _context.stop();}}},_callee);})),[options]),null),isLoading=_useRequest.isLoading,error=_useRequest.error,fetchUI=_useRequest.request,uiData=_useRequest.result;useEffect(function(){fetchUI();},[fetchUI]);var _useRequest2=useRequest(useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values){var _uiData$PENDO_TRACKIN;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return SettingsAPI.updateAll(values);case 2:if((values===null||values===void 0?void 0:values.PENDO_TRACKING_STATE)!==(uiData===null||uiData===void 0?void 0:(_uiData$PENDO_TRACKIN=uiData.PENDO_TRACKING_STATE)===null||_uiData$PENDO_TRACKIN===void 0?void 0:_uiData$PENDO_TRACKIN.value)){history.push({pathname:'/settings/ui/details',hardReload:true});}else{history.push('/settings/ui/details');}case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}(),[history,uiData]),null),submitError=_useRequest2.error,submitForm=_useRequest2.request;var _useRequest3=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return SettingsAPI.revertCategory('ui');case 2:case\"end\":return _context3.stop();}}},_callee3);})),[]),null),revertError=_useRequest3.error,revertAll=_useRequest3.request;var handleSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(form){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return submitForm(form);case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function handleSubmit(_x2){return _ref4.apply(this,arguments);};}();var handleRevertAll=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return revertAll();case 2:closeModal();history.push({pathname:'/settings/ui/details',hardReload:true});case 4:case\"end\":return _context5.stop();}}},_callee5);}));return function handleRevertAll(){return _ref5.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push('/settings/ui/details');};return/*#__PURE__*/_jsxs(CardBody,{children:[isLoading&&/*#__PURE__*/_jsx(ContentLoading,{}),!isLoading&&error&&/*#__PURE__*/_jsx(ContentError,{error:error}),!isLoading&&uiData&&/*#__PURE__*/_jsx(Formik,{initialValues:{PENDO_TRACKING_STATE:(_uiData$PENDO_TRACKIN2=uiData===null||uiData===void 0?void 0:(_uiData$PENDO_TRACKIN3=uiData.PENDO_TRACKING_STATE)===null||_uiData$PENDO_TRACKIN3===void 0?void 0:_uiData$PENDO_TRACKIN3.value)!==null&&_uiData$PENDO_TRACKIN2!==void 0?_uiData$PENDO_TRACKIN2:'off',CUSTOM_LOGIN_INFO:(_uiData$CUSTOM_LOGIN_=uiData===null||uiData===void 0?void 0:(_uiData$CUSTOM_LOGIN_2=uiData.CUSTOM_LOGIN_INFO)===null||_uiData$CUSTOM_LOGIN_2===void 0?void 0:_uiData$CUSTOM_LOGIN_2.value)!==null&&_uiData$CUSTOM_LOGIN_!==void 0?_uiData$CUSTOM_LOGIN_:'',CUSTOM_LOGO:(_uiData$CUSTOM_LOGO$v=uiData===null||uiData===void 0?void 0:(_uiData$CUSTOM_LOGO=uiData.CUSTOM_LOGO)===null||_uiData$CUSTOM_LOGO===void 0?void 0:_uiData$CUSTOM_LOGO.value)!==null&&_uiData$CUSTOM_LOGO$v!==void 0?_uiData$CUSTOM_LOGO$v:''},onSubmit:handleSubmit,children:function children(formik){return/*#__PURE__*/_jsxs(Form,{autoComplete:\"off\",onSubmit:formik.handleSubmit,children:[/*#__PURE__*/_jsxs(FormColumnLayout,{children:[/*#__PURE__*/_jsx(ChoiceField,{name:\"PENDO_TRACKING_STATE\",config:uiData.PENDO_TRACKING_STATE,isDisabled:(license_info===null||license_info===void 0?void 0:license_info.license_type)==='open',isRequired:true}),/*#__PURE__*/_jsx(TextAreaField,{name:\"CUSTOM_LOGIN_INFO\",config:uiData.CUSTOM_LOGIN_INFO}),/*#__PURE__*/_jsx(FileUploadField,{name:\"CUSTOM_LOGO\",config:uiData.CUSTOM_LOGO,type:\"dataURL\"}),submitError&&/*#__PURE__*/_jsx(FormSubmitError,{error:submitError}),revertError&&/*#__PURE__*/_jsx(FormSubmitError,{error:revertError})]}),/*#__PURE__*/_jsx(RevertFormActionGroup,{onCancel:handleCancel,onSubmit:formik.handleSubmit,onRevert:toggleModal}),isModalOpen&&/*#__PURE__*/_jsx(RevertAllAlert,{onClose:closeModal,onRevertAll:handleRevertAll})]});}})]});}export default UIEdit;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Setting/UI/UIEdit/UIEdit.js"],"names":["React","useCallback","useEffect","useHistory","Formik","Form","CardBody","ContentError","ContentLoading","FormSubmitError","FormColumnLayout","useSettings","useConfig","useModal","useRequest","SettingsAPI","ChoiceField","FileUploadField","TextAreaField","RevertAllAlert","RevertFormActionGroup","UIEdit","history","isModalOpen","toggleModal","closeModal","options","PUT","license_info","readCategory","data","mergedData","Object","keys","forEach","key","value","isLoading","error","fetchUI","request","uiData","result","values","updateAll","PENDO_TRACKING_STATE","push","pathname","hardReload","submitError","submitForm","revertCategory","revertError","revertAll","handleSubmit","form","handleRevertAll","handleCancel","CUSTOM_LOGIN_INFO","CUSTOM_LOGO","formik","license_type"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Formik } from 'formik';\nimport { Form } from '@patternfly/react-core';\nimport { CardBody } from 'components/Card';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport { FormSubmitError } from 'components/FormField';\nimport { FormColumnLayout } from 'components/FormLayout';\nimport { useSettings } from 'contexts/Settings';\nimport { useConfig } from 'contexts/Config';\nimport useModal from 'hooks/useModal';\nimport useRequest from 'hooks/useRequest';\nimport { SettingsAPI } from 'api';\nimport {\n  ChoiceField,\n  FileUploadField,\n  TextAreaField,\n} from '../../shared/SharedFields';\nimport { RevertAllAlert, RevertFormActionGroup } from '../../shared';\n\nfunction UIEdit() {\n  const history = useHistory();\n  const { isModalOpen, toggleModal, closeModal } = useModal();\n  const { PUT: options } = useSettings();\n  const { license_info } = useConfig();\n\n  const {\n    isLoading,\n    error,\n    request: fetchUI,\n    result: uiData,\n  } = useRequest(\n    useCallback(async () => {\n      const { data } = await SettingsAPI.readCategory('ui');\n      const mergedData = {};\n      Object.keys(data).forEach((key) => {\n        if (!options[key]) {\n          return;\n        }\n        mergedData[key] = options[key];\n        mergedData[key].value = data[key];\n      });\n      return mergedData;\n    }, [options]),\n    null\n  );\n\n  useEffect(() => {\n    fetchUI();\n  }, [fetchUI]);\n\n  const { error: submitError, request: submitForm } = useRequest(\n    useCallback(\n      async (values) => {\n        await SettingsAPI.updateAll(values);\n        if (\n          values?.PENDO_TRACKING_STATE !== uiData?.PENDO_TRACKING_STATE?.value\n        ) {\n          history.push({\n            pathname: '/settings/ui/details',\n            hardReload: true,\n          });\n        } else {\n          history.push('/settings/ui/details');\n        }\n      },\n      [history, uiData]\n    ),\n    null\n  );\n\n  const { error: revertError, request: revertAll } = useRequest(\n    useCallback(async () => {\n      await SettingsAPI.revertCategory('ui');\n    }, []),\n    null\n  );\n\n  const handleSubmit = async (form) => {\n    await submitForm(form);\n  };\n\n  const handleRevertAll = async () => {\n    await revertAll();\n\n    closeModal();\n\n    history.push({\n      pathname: '/settings/ui/details',\n      hardReload: true,\n    });\n  };\n\n  const handleCancel = () => {\n    history.push('/settings/ui/details');\n  };\n\n  return (\n    <CardBody>\n      {isLoading && <ContentLoading />}\n      {!isLoading && error && <ContentError error={error} />}\n      {!isLoading && uiData && (\n        <Formik\n          initialValues={{\n            PENDO_TRACKING_STATE: uiData?.PENDO_TRACKING_STATE?.value ?? 'off',\n            CUSTOM_LOGIN_INFO: uiData?.CUSTOM_LOGIN_INFO?.value ?? '',\n            CUSTOM_LOGO: uiData?.CUSTOM_LOGO?.value ?? '',\n          }}\n          onSubmit={handleSubmit}\n        >\n          {(formik) => (\n            <Form autoComplete=\"off\" onSubmit={formik.handleSubmit}>\n              <FormColumnLayout>\n                <ChoiceField\n                  name=\"PENDO_TRACKING_STATE\"\n                  config={uiData.PENDO_TRACKING_STATE}\n                  isDisabled={license_info?.license_type === 'open'}\n                  isRequired\n                />\n                <TextAreaField\n                  name=\"CUSTOM_LOGIN_INFO\"\n                  config={uiData.CUSTOM_LOGIN_INFO}\n                />\n                <FileUploadField\n                  name=\"CUSTOM_LOGO\"\n                  config={uiData.CUSTOM_LOGO}\n                  type=\"dataURL\"\n                />\n                {submitError && <FormSubmitError error={submitError} />}\n                {revertError && <FormSubmitError error={revertError} />}\n              </FormColumnLayout>\n              <RevertFormActionGroup\n                onCancel={handleCancel}\n                onSubmit={formik.handleSubmit}\n                onRevert={toggleModal}\n              />\n              {isModalOpen && (\n                <RevertAllAlert\n                  onClose={closeModal}\n                  onRevertAll={handleRevertAll}\n                />\n              )}\n            </Form>\n          )}\n        </Formik>\n      )}\n    </CardBody>\n  );\n}\n\nexport default UIEdit;\n"]},"metadata":{},"sourceType":"module"}