{"ast":null,"code":"import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{useLocation,Link}from'react-router-dom';import{Card,DropdownItem}from'@patternfly/react-core';import{JobTemplatesAPI,UnifiedJobTemplatesAPI,WorkflowJobTemplatesAPI}from'api';import useRequest,{useDeleteItems}from'hooks/useRequest';import useSelected from'hooks/useSelected';import useExpanded from'hooks/useExpanded';import{getQSConfig,parseQueryString}from'util/qs';import useWsTemplates from'hooks/useWsTemplates';import useToast,{AlertVariant}from'hooks/useToast';import{relatedResourceDeleteRequests}from'util/getRelatedResourceDeleteDetails';import AlertModal from'../AlertModal';import DatalistToolbar from'../DataListToolbar';import ErrorDetail from'../ErrorDetail';import PaginatedTable,{HeaderRow,HeaderCell,ToolbarDeleteButton,getSearchableKeys}from'../PaginatedTable';import AddDropDownButton from'../AddDropDownButton';import TemplateListItem from'./TemplateListItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function TemplateList(_ref){var defaultParams=_ref.defaultParams;// The type value in const qsConfig below does not have a space between job_template and\n// workflow_job_template so the params sent to the API match what the api expects.\nvar qsConfig=getQSConfig('template',_objectSpread({page:1,page_size:20,order_by:'name',type:'job_template,workflow_job_template'},defaultParams),['id','page','page_size']);var location=useLocation();var _useToast=useToast(),addToast=_useToast.addToast,Toast=_useToast.Toast,toastProps=_useToast.toastProps;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _responses$,_responses$$data,_responses$3$data$act;var params,responses;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(qsConfig,location.search);_context.next=3;return Promise.all([UnifiedJobTemplatesAPI.read(params),JobTemplatesAPI.readOptions(),WorkflowJobTemplatesAPI.readOptions(),UnifiedJobTemplatesAPI.readOptions()]);case 3:responses=_context.sent;return _context.abrupt(\"return\",{results:responses[0].data.results,count:responses[0].data.count,jtActions:responses[1].data.actions,wfjtActions:responses[2].data.actions,relatedSearchableKeys:(((_responses$=responses[3])===null||_responses$===void 0?void 0:(_responses$$data=_responses$.data)===null||_responses$$data===void 0?void 0:_responses$$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_responses$3$data$act=responses[3].data.actions)===null||_responses$3$data$act===void 0?void 0:_responses$3$data$act.GET)});case 5:case\"end\":return _context.stop();}}},_callee);})),[location]),// eslint-disable-line react-hooks/exhaustive-deps\n{results:[],count:0,jtActions:{},wfjtActions:{},relatedSearchableKeys:[],searchableKeys:[]}),_useRequest$result=_useRequest.result,results=_useRequest$result.results,count=_useRequest$result.count,jtActions=_useRequest$result.jtActions,wfjtActions=_useRequest$result.wfjtActions,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,contentError=_useRequest.error,isLoading=_useRequest.isLoading,fetchTemplates=_useRequest.request;useEffect(function(){fetchTemplates();},[fetchTemplates]);var templates=useWsTemplates(results);var _useSelected=useSelected(templates),selected=_useSelected.selected,isAllSelected=_useSelected.isAllSelected,handleSelect=_useSelected.handleSelect,selectAll=_useSelected.selectAll,clearSelected=_useSelected.clearSelected;var _useExpanded=useExpanded(templates),expanded=_useExpanded.expanded,isAllExpanded=_useExpanded.isAllExpanded,handleExpand=_useExpanded.handleExpand,expandAll=_useExpanded.expandAll;var _useDeleteItems=useDeleteItems(useCallback(function(){return Promise.all(selected.map(function(_ref3){var type=_ref3.type,id=_ref3.id;if(type==='job_template'){return JobTemplatesAPI.destroy(id);}if(type==='workflow_job_template'){return WorkflowJobTemplatesAPI.destroy(id);}return false;}));},[selected]),{qsConfig:qsConfig,allItemsSelected:isAllSelected,fetchItems:fetchTemplates}),isDeleteLoading=_useDeleteItems.isLoading,deleteTemplates=_useDeleteItems.deleteItems,deletionError=_useDeleteItems.deletionError,clearDeletionError=_useDeleteItems.clearDeletionError;var handleCopy=useCallback(function(newTemplateId){addToast({id:newTemplateId,title:/*i18n*/i18n._(\"Template copied successfully\"),variant:AlertVariant.success,hasTimeout:true});},[addToast]);var handleTemplateDelete=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return deleteTemplates();case 2:clearSelected();case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleTemplateDelete(){return _ref4.apply(this,arguments);};}();var canAddJT=jtActions&&Object.prototype.hasOwnProperty.call(jtActions,'POST');var canAddWFJT=wfjtActions&&Object.prototype.hasOwnProperty.call(wfjtActions,'POST');var addTemplate=/*i18n*/i18n._(\"Add job template\");var addWFTemplate=/*i18n*/i18n._(\"Add workflow template\");var addDropDownButton=[];if(canAddJT){addDropDownButton.push(/*#__PURE__*/_jsx(DropdownItem,{ouiaId:\"add-job-template-item\",component:Link,to:\"/templates/job_template/add/\",\"aria-label\":addTemplate,children:addTemplate},addTemplate));}if(canAddWFJT){addDropDownButton.push(/*#__PURE__*/_jsx(DropdownItem,{ouiaId:\"add-workflow-job-template-item\",component:Link,to:\"/templates/workflow_job_template/add/\",\"aria-label\":addWFTemplate,children:addWFTemplate},addWFTemplate));}var addButton=/*#__PURE__*/_jsx(AddDropDownButton,{ouiaId:\"add-template-button\",dropdownItems:addDropDownButton},\"add\");var deleteDetailsRequests=relatedResourceDeleteRequests.template(selected[0]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(PaginatedTable,{contentError:contentError,hasContentLoading:isLoading||isDeleteLoading,items:templates,itemCount:count,pluralizedItemName:/*i18n*/i18n._(\"Templates\"),qsConfig:qsConfig,clearSelected:clearSelected,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Description\"),key:'description__icontains'},{name:/*i18n*/i18n._(\"Type\"),key:'or__type',options:[[\"job_template\",/*i18n*/i18n._(\"Job Template\")],[\"workflow_job_template\",/*i18n*/i18n._(\"Workflow Template\")]]},{name:/*i18n*/i18n._(\"Playbook name\"),key:'job_template__playbook__icontains'},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username__icontains'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username__icontains'},{name:/*i18n*/i18n._(\"Label\"),key:'labels__name__icontains'}],toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:qsConfig,isExpandable:true,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"type\",children:/*i18n*/i18n._(\"Type\")}),/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"organization\",children:/*i18n*/i18n._(\"Organization\")}),/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"last_job_run\",children:/*i18n*/i18n._(\"Last Ran\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Actions\")})]}),renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DatalistToolbar,_objectSpread(_objectSpread({},props),{},{isAllSelected:isAllSelected,onSelectAll:selectAll,isAllExpanded:isAllExpanded,onExpandAll:expandAll,qsConfig:qsConfig,additionalControls:[].concat(_toConsumableArray(canAddJT||canAddWFJT?[addButton]:[]),[/*#__PURE__*/_jsx(ToolbarDeleteButton,{onDelete:handleTemplateDelete,itemsToDelete:selected,pluralizedItemName:/*i18n*/i18n._(\"Templates\"),deleteDetailsRequests:deleteDetailsRequests,deleteMessage:/*#__PURE__*/_jsx(Trans,{id:\"{0, plural, one {This template is currently being used by some workflow nodes. Are you sure you want to delete it?} other {Deleting these templates could impact some workflow nodes that rely on them. Are you sure you want to delete anyway?}}\",values:{0:selected.length}})},\"delete\")])}));},renderRow:function renderRow(template,index){return/*#__PURE__*/_jsx(TemplateListItem,{value:template.name,template:template,detailUrl:\"/templates/\".concat(template.type,\"/\").concat(template.id),onSelect:function onSelect(){return handleSelect(template);},isExpanded:expanded.some(function(row){return row.id===template.id;}),onExpand:function onExpand(){return handleExpand(template);},onCopy:handleCopy,isSelected:selected.some(function(row){return row.id===template.id;}),fetchTemplates:fetchTemplates,rowIndex:index},template.id);},emptyStateControls:(canAddJT||canAddWFJT)&&addButton})}),/*#__PURE__*/_jsx(Toast,_objectSpread({},toastProps)),/*#__PURE__*/_jsxs(AlertModal,{\"aria-label\":/*i18n*/i18n._(\"Deletion Error\"),isOpen:deletionError,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:clearDeletionError,children:[/*i18n*/i18n._(\"Failed to delete one or more templates.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:deletionError})]})]});}export default TemplateList;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/TemplateList/TemplateList.js"],"names":["React","useEffect","useCallback","useLocation","Link","Card","DropdownItem","JobTemplatesAPI","UnifiedJobTemplatesAPI","WorkflowJobTemplatesAPI","useRequest","useDeleteItems","useSelected","useExpanded","getQSConfig","parseQueryString","useWsTemplates","useToast","AlertVariant","relatedResourceDeleteRequests","AlertModal","DatalistToolbar","ErrorDetail","PaginatedTable","HeaderRow","HeaderCell","ToolbarDeleteButton","getSearchableKeys","AddDropDownButton","TemplateListItem","TemplateList","defaultParams","qsConfig","page","page_size","order_by","type","location","addToast","Toast","toastProps","params","search","Promise","all","read","readOptions","responses","results","data","count","jtActions","actions","wfjtActions","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","GET","result","contentError","error","isLoading","fetchTemplates","request","templates","selected","isAllSelected","handleSelect","selectAll","clearSelected","expanded","isAllExpanded","handleExpand","expandAll","id","destroy","allItemsSelected","fetchItems","isDeleteLoading","deleteTemplates","deleteItems","deletionError","clearDeletionError","handleCopy","newTemplateId","title","variant","success","hasTimeout","handleTemplateDelete","canAddJT","Object","prototype","hasOwnProperty","call","canAddWFJT","addTemplate","addWFTemplate","addDropDownButton","push","addButton","deleteDetailsRequests","template","name","key","isDefault","options","props","length","index","some","row"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { useLocation, Link } from 'react-router-dom';\nimport { t, Plural } from '@lingui/macro';\nimport { Card, DropdownItem } from '@patternfly/react-core';\nimport {\n  JobTemplatesAPI,\n  UnifiedJobTemplatesAPI,\n  WorkflowJobTemplatesAPI,\n} from 'api';\nimport useRequest, { useDeleteItems } from 'hooks/useRequest';\nimport useSelected from 'hooks/useSelected';\nimport useExpanded from 'hooks/useExpanded';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport useWsTemplates from 'hooks/useWsTemplates';\nimport useToast, { AlertVariant } from 'hooks/useToast';\nimport { relatedResourceDeleteRequests } from 'util/getRelatedResourceDeleteDetails';\nimport AlertModal from '../AlertModal';\nimport DatalistToolbar from '../DataListToolbar';\nimport ErrorDetail from '../ErrorDetail';\nimport PaginatedTable, {\n  HeaderRow,\n  HeaderCell,\n  ToolbarDeleteButton,\n  getSearchableKeys,\n} from '../PaginatedTable';\nimport AddDropDownButton from '../AddDropDownButton';\nimport TemplateListItem from './TemplateListItem';\n\nfunction TemplateList({ defaultParams }) {\n  // The type value in const qsConfig below does not have a space between job_template and\n  // workflow_job_template so the params sent to the API match what the api expects.\n  const qsConfig = getQSConfig(\n    'template',\n    {\n      page: 1,\n      page_size: 20,\n      order_by: 'name',\n      type: 'job_template,workflow_job_template',\n      ...defaultParams,\n    },\n    ['id', 'page', 'page_size']\n  );\n\n  const location = useLocation();\n  const { addToast, Toast, toastProps } = useToast();\n\n  const {\n    result: {\n      results,\n      count,\n      jtActions,\n      wfjtActions,\n      relatedSearchableKeys,\n      searchableKeys,\n    },\n    error: contentError,\n    isLoading,\n    request: fetchTemplates,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(qsConfig, location.search);\n      const responses = await Promise.all([\n        UnifiedJobTemplatesAPI.read(params),\n        JobTemplatesAPI.readOptions(),\n        WorkflowJobTemplatesAPI.readOptions(),\n        UnifiedJobTemplatesAPI.readOptions(),\n      ]);\n      return {\n        results: responses[0].data.results,\n        count: responses[0].data.count,\n        jtActions: responses[1].data.actions,\n        wfjtActions: responses[2].data.actions,\n        relatedSearchableKeys: (\n          responses[3]?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(responses[3].data.actions?.GET),\n      };\n    }, [location]), // eslint-disable-line react-hooks/exhaustive-deps\n    {\n      results: [],\n      count: 0,\n      jtActions: {},\n      wfjtActions: {},\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchTemplates();\n  }, [fetchTemplates]);\n\n  const templates = useWsTemplates(results);\n\n  const { selected, isAllSelected, handleSelect, selectAll, clearSelected } =\n    useSelected(templates);\n\n  const { expanded, isAllExpanded, handleExpand, expandAll } =\n    useExpanded(templates);\n\n  const {\n    isLoading: isDeleteLoading,\n    deleteItems: deleteTemplates,\n    deletionError,\n    clearDeletionError,\n  } = useDeleteItems(\n    useCallback(\n      () =>\n        Promise.all(\n          selected.map(({ type, id }) => {\n            if (type === 'job_template') {\n              return JobTemplatesAPI.destroy(id);\n            }\n            if (type === 'workflow_job_template') {\n              return WorkflowJobTemplatesAPI.destroy(id);\n            }\n            return false;\n          })\n        ),\n      [selected]\n    ),\n    {\n      qsConfig,\n      allItemsSelected: isAllSelected,\n      fetchItems: fetchTemplates,\n    }\n  );\n\n  const handleCopy = useCallback(\n    (newTemplateId) => {\n      addToast({\n        id: newTemplateId,\n        title: t`Template copied successfully`,\n        variant: AlertVariant.success,\n        hasTimeout: true,\n      });\n    },\n    [addToast]\n  );\n\n  const handleTemplateDelete = async () => {\n    await deleteTemplates();\n    clearSelected();\n  };\n\n  const canAddJT =\n    jtActions && Object.prototype.hasOwnProperty.call(jtActions, 'POST');\n  const canAddWFJT =\n    wfjtActions && Object.prototype.hasOwnProperty.call(wfjtActions, 'POST');\n\n  const addTemplate = t`Add job template`;\n  const addWFTemplate = t`Add workflow template`;\n  const addDropDownButton = [];\n  if (canAddJT) {\n    addDropDownButton.push(\n      <DropdownItem\n        ouiaId=\"add-job-template-item\"\n        key={addTemplate}\n        component={Link}\n        to=\"/templates/job_template/add/\"\n        aria-label={addTemplate}\n      >\n        {addTemplate}\n      </DropdownItem>\n    );\n  }\n  if (canAddWFJT) {\n    addDropDownButton.push(\n      <DropdownItem\n        ouiaId=\"add-workflow-job-template-item\"\n        component={Link}\n        to=\"/templates/workflow_job_template/add/\"\n        key={addWFTemplate}\n        aria-label={addWFTemplate}\n      >\n        {addWFTemplate}\n      </DropdownItem>\n    );\n  }\n  const addButton = (\n    <AddDropDownButton\n      ouiaId=\"add-template-button\"\n      key=\"add\"\n      dropdownItems={addDropDownButton}\n    />\n  );\n\n  const deleteDetailsRequests = relatedResourceDeleteRequests.template(\n    selected[0]\n  );\n\n  return (\n    <>\n      <Card>\n        <PaginatedTable\n          contentError={contentError}\n          hasContentLoading={isLoading || isDeleteLoading}\n          items={templates}\n          itemCount={count}\n          pluralizedItemName={t`Templates`}\n          qsConfig={qsConfig}\n          clearSelected={clearSelected}\n          toolbarSearchColumns={[\n            {\n              name: t`Name`,\n              key: 'name__icontains',\n              isDefault: true,\n            },\n            {\n              name: t`Description`,\n              key: 'description__icontains',\n            },\n            {\n              name: t`Type`,\n              key: 'or__type',\n              options: [\n                [`job_template`, t`Job Template`],\n                [`workflow_job_template`, t`Workflow Template`],\n              ],\n            },\n            {\n              name: t`Playbook name`,\n              key: 'job_template__playbook__icontains',\n            },\n            {\n              name: t`Created By (Username)`,\n              key: 'created_by__username__icontains',\n            },\n            {\n              name: t`Modified By (Username)`,\n              key: 'modified_by__username__icontains',\n            },\n            {\n              name: t`Label`,\n              key: 'labels__name__icontains',\n            },\n          ]}\n          toolbarSearchableKeys={searchableKeys}\n          toolbarRelatedSearchableKeys={relatedSearchableKeys}\n          headerRow={\n            <HeaderRow qsConfig={qsConfig} isExpandable>\n              <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n              <HeaderCell sortKey=\"type\">{t`Type`}</HeaderCell>\n              <HeaderCell sortKey=\"organization\">{t`Organization`}</HeaderCell>\n              <HeaderCell sortKey=\"last_job_run\">{t`Last Ran`}</HeaderCell>\n              <HeaderCell>{t`Actions`}</HeaderCell>\n            </HeaderRow>\n          }\n          renderToolbar={(props) => (\n            <DatalistToolbar\n              {...props}\n              isAllSelected={isAllSelected}\n              onSelectAll={selectAll}\n              isAllExpanded={isAllExpanded}\n              onExpandAll={expandAll}\n              qsConfig={qsConfig}\n              additionalControls={[\n                ...(canAddJT || canAddWFJT ? [addButton] : []),\n                <ToolbarDeleteButton\n                  key=\"delete\"\n                  onDelete={handleTemplateDelete}\n                  itemsToDelete={selected}\n                  pluralizedItemName={t`Templates`}\n                  deleteDetailsRequests={deleteDetailsRequests}\n                  deleteMessage={\n                    <Plural\n                      value={selected.length}\n                      one=\"This template is currently being used by some workflow nodes. Are you sure you want to delete it?\"\n                      other=\"Deleting these templates could impact some workflow nodes that rely on them. Are you sure you want to delete anyway?\"\n                    />\n                  }\n                />,\n              ]}\n            />\n          )}\n          renderRow={(template, index) => (\n            <TemplateListItem\n              key={template.id}\n              value={template.name}\n              template={template}\n              detailUrl={`/templates/${template.type}/${template.id}`}\n              onSelect={() => handleSelect(template)}\n              isExpanded={expanded.some((row) => row.id === template.id)}\n              onExpand={() => handleExpand(template)}\n              onCopy={handleCopy}\n              isSelected={selected.some((row) => row.id === template.id)}\n              fetchTemplates={fetchTemplates}\n              rowIndex={index}\n            />\n          )}\n          emptyStateControls={(canAddJT || canAddWFJT) && addButton}\n        />\n      </Card>\n      <Toast {...toastProps} />\n      <AlertModal\n        aria-label={t`Deletion Error`}\n        isOpen={deletionError}\n        variant=\"error\"\n        title={t`Error!`}\n        onClose={clearDeletionError}\n      >\n        {t`Failed to delete one or more templates.`}\n        <ErrorDetail error={deletionError} />\n      </AlertModal>\n    </>\n  );\n}\n\nexport default TemplateList;\n"]},"metadata":{},"sourceType":"module"}