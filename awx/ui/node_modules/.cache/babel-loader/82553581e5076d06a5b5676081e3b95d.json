{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{useLocation,useRouteMatch}from'react-router-dom';import{Card,PageSection}from'@patternfly/react-core';import{ProjectsAPI}from'api';import useRequest,{useDeleteItems,useDismissableError}from'hooks/useRequest';import AlertModal from'components/AlertModal';import DataListToolbar from'components/DataListToolbar';import ErrorDetail from'components/ErrorDetail';import PaginatedTable,{HeaderRow,HeaderCell,ToolbarAddButton,ToolbarDeleteButton,getSearchableKeys}from'components/PaginatedTable';import useSelected from'hooks/useSelected';import useExpanded from'hooks/useExpanded';import useToast,{AlertVariant}from'hooks/useToast';import{relatedResourceDeleteRequests}from'util/getRelatedResourceDeleteDetails';import{getQSConfig,parseQueryString}from'util/qs';import useWsProjects from'./useWsProjects';import ProjectListItem from'./ProjectListItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('project',{page:1,page_size:20,order_by:'name'});function ProjectList(){var location=useLocation();var match=useRouteMatch();var _useToast=useToast(),addToast=_useToast.addToast,Toast=_useToast.Toast,toastProps=_useToast.toastProps;var _useRequest=useRequest(useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(projectId){var _yield$ProjectsAPI$re,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(projectId){_context.next=2;break;}return _context.abrupt(\"return\",{});case 2:_context.next=4;return ProjectsAPI.readDetail(projectId);case 4:_yield$ProjectsAPI$re=_context.sent;data=_yield$ProjectsAPI$re.data;return _context.abrupt(\"return\",data);case 7:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}(),[]),null),fetchUpdatedProject=_useRequest.request,fetchUpdatedProjectError=_useRequest.error,updatedProject=_useRequest.result;var _useRequest2=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,response,actionsResponse;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:params=parseQueryString(QS_CONFIG,location.search);_context2.next=3;return Promise.all([ProjectsAPI.read(params),ProjectsAPI.readOptions()]);case 3:_yield$Promise$all=_context2.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);response=_yield$Promise$all2[0];actionsResponse=_yield$Promise$all2[1];return _context2.abrupt(\"return\",{results:response.data.results,itemCount:response.data.count,actions:actionsResponse.data.actions,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 8:case\"end\":return _context2.stop();}}},_callee2);})),[location]),{results:[],itemCount:0,actions:{},relatedSearchableKeys:[],searchableKeys:[]}),_useRequest2$result=_useRequest2.result,results=_useRequest2$result.results,itemCount=_useRequest2$result.itemCount,actions=_useRequest2$result.actions,relatedSearchableKeys=_useRequest2$result.relatedSearchableKeys,searchableKeys=_useRequest2$result.searchableKeys,contentError=_useRequest2.error,isLoading=_useRequest2.isLoading,fetchProjects=_useRequest2.request,setProjects=_useRequest2.setValue;useEffect(function(){fetchProjects();},[fetchProjects]);var projects=useWsProjects(results);var _useSelected=useSelected(projects),selected=_useSelected.selected,isAllSelected=_useSelected.isAllSelected,handleSelect=_useSelected.handleSelect,setSelected=_useSelected.setSelected,selectAll=_useSelected.selectAll,clearSelected=_useSelected.clearSelected;var _useExpanded=useExpanded(projects),expanded=_useExpanded.expanded,isAllExpanded=_useExpanded.isAllExpanded,handleExpand=_useExpanded.handleExpand,expandAll=_useExpanded.expandAll;var _useDeleteItems=useDeleteItems(useCallback(function(){return Promise.all(selected.map(function(_ref3){var id=_ref3.id;return ProjectsAPI.destroy(id);}));},[selected]),{qsConfig:QS_CONFIG,allItemsSelected:isAllSelected,fetchItems:fetchProjects}),isDeleteLoading=_useDeleteItems.isLoading,deleteProjects=_useDeleteItems.deleteItems,deletionError=_useDeleteItems.deletionError,clearDeletionError=_useDeleteItems.clearDeletionError;var handleCopy=useCallback(function(newId){addToast({id:newId,title:/*i18n*/i18n._(\"Project copied successfully\"),variant:AlertVariant.success,hasTimeout:true});},[addToast]);var handleProjectDelete=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return deleteProjects();case 2:setSelected([]);case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function handleProjectDelete(){return _ref4.apply(this,arguments);};}();var hasContentLoading=isDeleteLoading||isLoading;var canAdd=actions&&actions.POST;var deleteDetailsRequests=relatedResourceDeleteRequests.project(selected[0]);useEffect(function(){if(updatedProject){var updatedProjects=projects.map(function(project){return project.id===updatedProject.id?updatedProject:project;});setProjects({results:updatedProjects,itemCount:itemCount,actions:actions,relatedSearchableKeys:relatedSearchableKeys,searchableKeys:searchableKeys});}/* eslint-disable-next-line react-hooks/exhaustive-deps */},[updatedProject]);var _useDismissableError=useDismissableError(fetchUpdatedProjectError),projectError=_useDismissableError.error,dismissProjectError=_useDismissableError.dismissError;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(PaginatedTable,{contentError:contentError,hasContentLoading:hasContentLoading,items:projects,itemCount:itemCount,pluralizedItemName:/*i18n*/i18n._(\"Projects\"),qsConfig:QS_CONFIG,clearSelected:clearSelected,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Description\"),key:'description__icontains'},{name:/*i18n*/i18n._(\"Type\"),key:'or__scm_type',options:[[\"\",/*i18n*/i18n._(\"Manual\")],[\"git\",/*i18n*/i18n._(\"Git\")],[\"svn\",/*i18n*/i18n._(\"Subversion\")],[\"archive\",/*i18n*/i18n._(\"Remote Archive\")],[\"insights\",/*i18n*/i18n._(\"Red Hat Insights\")]]},{name:/*i18n*/i18n._(\"Source Control URL\"),key:'scm_url__icontains'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username__icontains'},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username__icontains'}],toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,isExpandable:true,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Status\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Type\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Revision\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Actions\")})]}),renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{isAllExpanded:isAllExpanded,onExpandAll:expandAll,isAllSelected:isAllSelected,onSelectAll:selectAll,qsConfig:QS_CONFIG,additionalControls:[].concat(_toConsumableArray(canAdd?[/*#__PURE__*/_jsx(ToolbarAddButton,{linkTo:\"\".concat(match.url,\"/add\")},\"add\")]:[]),[/*#__PURE__*/_jsx(ToolbarDeleteButton,{onDelete:handleProjectDelete,itemsToDelete:selected,pluralizedItemName:/*i18n*/i18n._(\"Projects\"),deleteDetailsRequests:deleteDetailsRequests,deleteMessage:/*#__PURE__*/_jsx(Trans,{id:\"{0, plural, one {This project is currently being used by other resources. Are you sure you want to delete it?} other {Deleting these projects could impact other resources that rely on them. Are you sure you want to delete anyway?}}\",values:{0:selected.length}})},\"delete\")])}));},renderRow:function renderRow(project,index){return/*#__PURE__*/_jsx(ProjectListItem,{isExpanded:expanded.some(function(row){return row.id===project.id;}),onExpand:function onExpand(){return handleExpand(project);},fetchProjects:fetchProjects,project:project,detailUrl:\"\".concat(match.url,\"/\").concat(project.id),isSelected:selected.some(function(row){return row.id===project.id;}),onSelect:function onSelect(){return handleSelect(project);},onCopy:handleCopy,rowIndex:index,onRefreshRow:function onRefreshRow(projectId){return fetchUpdatedProject(projectId);}},project.id);},emptyStateControls:canAdd?/*#__PURE__*/_jsx(ToolbarAddButton,{linkTo:\"\".concat(match.url,\"/add\")},\"add\"):null})})}),/*#__PURE__*/_jsx(Toast,_objectSpread({},toastProps)),deletionError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:deletionError,variant:\"error\",\"aria-label\":/*i18n*/i18n._(\"Deletion Error\"),title:/*i18n*/i18n._(\"Error!\"),onClose:clearDeletionError,children:[/*i18n*/i18n._(\"Failed to delete one or more projects.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:deletionError})]}),projectError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:projectError,variant:\"error\",\"aria-label\":/*i18n*/i18n._(\"Error fetching updated project\"),title:/*i18n*/i18n._(\"Error!\"),onClose:dismissProjectError,children:[/*i18n*/i18n._(\"Failed to fetch the updated project data.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:projectError})]})]});}export default ProjectList;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Project/ProjectList/ProjectList.js"],"names":["React","useEffect","useCallback","useLocation","useRouteMatch","Card","PageSection","ProjectsAPI","useRequest","useDeleteItems","useDismissableError","AlertModal","DataListToolbar","ErrorDetail","PaginatedTable","HeaderRow","HeaderCell","ToolbarAddButton","ToolbarDeleteButton","getSearchableKeys","useSelected","useExpanded","useToast","AlertVariant","relatedResourceDeleteRequests","getQSConfig","parseQueryString","useWsProjects","ProjectListItem","QS_CONFIG","page","page_size","order_by","ProjectList","location","match","addToast","Toast","toastProps","projectId","readDetail","data","fetchUpdatedProject","request","fetchUpdatedProjectError","error","updatedProject","result","params","search","Promise","all","read","readOptions","response","actionsResponse","results","itemCount","count","actions","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","GET","contentError","isLoading","fetchProjects","setProjects","setValue","projects","selected","isAllSelected","handleSelect","setSelected","selectAll","clearSelected","expanded","isAllExpanded","handleExpand","expandAll","id","destroy","qsConfig","allItemsSelected","fetchItems","isDeleteLoading","deleteProjects","deleteItems","deletionError","clearDeletionError","handleCopy","newId","title","variant","success","hasTimeout","handleProjectDelete","hasContentLoading","canAdd","POST","deleteDetailsRequests","project","updatedProjects","projectError","dismissProjectError","dismissError","name","key","isDefault","options","props","url","length","index","some","row"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { useLocation, useRouteMatch } from 'react-router-dom';\nimport { t, Plural } from '@lingui/macro';\nimport { Card, PageSection } from '@patternfly/react-core';\nimport { ProjectsAPI } from 'api';\nimport useRequest, {\n  useDeleteItems,\n  useDismissableError,\n} from 'hooks/useRequest';\nimport AlertModal from 'components/AlertModal';\nimport DataListToolbar from 'components/DataListToolbar';\nimport ErrorDetail from 'components/ErrorDetail';\nimport PaginatedTable, {\n  HeaderRow,\n  HeaderCell,\n  ToolbarAddButton,\n  ToolbarDeleteButton,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\nimport useSelected from 'hooks/useSelected';\nimport useExpanded from 'hooks/useExpanded';\nimport useToast, { AlertVariant } from 'hooks/useToast';\nimport { relatedResourceDeleteRequests } from 'util/getRelatedResourceDeleteDetails';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport useWsProjects from './useWsProjects';\n\nimport ProjectListItem from './ProjectListItem';\n\nconst QS_CONFIG = getQSConfig('project', {\n  page: 1,\n  page_size: 20,\n  order_by: 'name',\n});\n\nfunction ProjectList() {\n  const location = useLocation();\n  const match = useRouteMatch();\n  const { addToast, Toast, toastProps } = useToast();\n\n  const {\n    request: fetchUpdatedProject,\n    error: fetchUpdatedProjectError,\n    result: updatedProject,\n  } = useRequest(\n    useCallback(async (projectId) => {\n      if (!projectId) {\n        return {};\n      }\n      const { data } = await ProjectsAPI.readDetail(projectId);\n      return data;\n    }, []),\n    null\n  );\n\n  const {\n    result: {\n      results,\n      itemCount,\n      actions,\n      relatedSearchableKeys,\n      searchableKeys,\n    },\n    error: contentError,\n    isLoading,\n    request: fetchProjects,\n    setValue: setProjects,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, location.search);\n      const [response, actionsResponse] = await Promise.all([\n        ProjectsAPI.read(params),\n        ProjectsAPI.readOptions(),\n      ]);\n      return {\n        results: response.data.results,\n        itemCount: response.data.count,\n        actions: actionsResponse.data.actions,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [location]),\n    {\n      results: [],\n      itemCount: 0,\n      actions: {},\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchProjects();\n  }, [fetchProjects]);\n\n  const projects = useWsProjects(results);\n\n  const {\n    selected,\n    isAllSelected,\n    handleSelect,\n    setSelected,\n    selectAll,\n    clearSelected,\n  } = useSelected(projects);\n\n  const { expanded, isAllExpanded, handleExpand, expandAll } =\n    useExpanded(projects);\n\n  const {\n    isLoading: isDeleteLoading,\n    deleteItems: deleteProjects,\n    deletionError,\n    clearDeletionError,\n  } = useDeleteItems(\n    useCallback(\n      () => Promise.all(selected.map(({ id }) => ProjectsAPI.destroy(id))),\n      [selected]\n    ),\n    {\n      qsConfig: QS_CONFIG,\n      allItemsSelected: isAllSelected,\n      fetchItems: fetchProjects,\n    }\n  );\n\n  const handleCopy = useCallback(\n    (newId) => {\n      addToast({\n        id: newId,\n        title: t`Project copied successfully`,\n        variant: AlertVariant.success,\n        hasTimeout: true,\n      });\n    },\n    [addToast]\n  );\n\n  const handleProjectDelete = async () => {\n    await deleteProjects();\n    setSelected([]);\n  };\n\n  const hasContentLoading = isDeleteLoading || isLoading;\n  const canAdd = actions && actions.POST;\n\n  const deleteDetailsRequests = relatedResourceDeleteRequests.project(\n    selected[0]\n  );\n\n  useEffect(() => {\n    if (updatedProject) {\n      const updatedProjects = projects.map((project) =>\n        project.id === updatedProject.id ? updatedProject : project\n      );\n      setProjects({\n        results: updatedProjects,\n        itemCount,\n        actions,\n        relatedSearchableKeys,\n        searchableKeys,\n      });\n    }\n    /* eslint-disable-next-line react-hooks/exhaustive-deps */\n  }, [updatedProject]);\n\n  const { error: projectError, dismissError: dismissProjectError } =\n    useDismissableError(fetchUpdatedProjectError);\n\n  return (\n    <>\n      <PageSection>\n        <Card>\n          <PaginatedTable\n            contentError={contentError}\n            hasContentLoading={hasContentLoading}\n            items={projects}\n            itemCount={itemCount}\n            pluralizedItemName={t`Projects`}\n            qsConfig={QS_CONFIG}\n            clearSelected={clearSelected}\n            toolbarSearchColumns={[\n              {\n                name: t`Name`,\n                key: 'name__icontains',\n                isDefault: true,\n              },\n              {\n                name: t`Description`,\n                key: 'description__icontains',\n              },\n              {\n                name: t`Type`,\n                key: 'or__scm_type',\n                options: [\n                  [``, t`Manual`],\n                  [`git`, t`Git`],\n                  [`svn`, t`Subversion`],\n                  [`archive`, t`Remote Archive`],\n                  [`insights`, t`Red Hat Insights`],\n                ],\n              },\n              {\n                name: t`Source Control URL`,\n                key: 'scm_url__icontains',\n              },\n              {\n                name: t`Modified By (Username)`,\n                key: 'modified_by__username__icontains',\n              },\n              {\n                name: t`Created By (Username)`,\n                key: 'created_by__username__icontains',\n              },\n            ]}\n            toolbarSearchableKeys={searchableKeys}\n            toolbarRelatedSearchableKeys={relatedSearchableKeys}\n            headerRow={\n              <HeaderRow qsConfig={QS_CONFIG} isExpandable>\n                <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n                <HeaderCell>{t`Status`}</HeaderCell>\n                <HeaderCell>{t`Type`}</HeaderCell>\n                <HeaderCell>{t`Revision`}</HeaderCell>\n                <HeaderCell>{t`Actions`}</HeaderCell>\n              </HeaderRow>\n            }\n            renderToolbar={(props) => (\n              <DataListToolbar\n                {...props}\n                isAllExpanded={isAllExpanded}\n                onExpandAll={expandAll}\n                isAllSelected={isAllSelected}\n                onSelectAll={selectAll}\n                qsConfig={QS_CONFIG}\n                additionalControls={[\n                  ...(canAdd\n                    ? [\n                        <ToolbarAddButton\n                          key=\"add\"\n                          linkTo={`${match.url}/add`}\n                        />,\n                      ]\n                    : []),\n                  <ToolbarDeleteButton\n                    key=\"delete\"\n                    onDelete={handleProjectDelete}\n                    itemsToDelete={selected}\n                    pluralizedItemName={t`Projects`}\n                    deleteDetailsRequests={deleteDetailsRequests}\n                    deleteMessage={\n                      <Plural\n                        value={selected.length}\n                        one=\"This project is currently being used by other resources. Are you sure you want to delete it?\"\n                        other=\"Deleting these projects could impact other resources that rely on them. Are you sure you want to delete anyway?\"\n                      />\n                    }\n                  />,\n                ]}\n              />\n            )}\n            renderRow={(project, index) => (\n              <ProjectListItem\n                isExpanded={expanded.some((row) => row.id === project.id)}\n                onExpand={() => handleExpand(project)}\n                fetchProjects={fetchProjects}\n                key={project.id}\n                project={project}\n                detailUrl={`${match.url}/${project.id}`}\n                isSelected={selected.some((row) => row.id === project.id)}\n                onSelect={() => handleSelect(project)}\n                onCopy={handleCopy}\n                rowIndex={index}\n                onRefreshRow={(projectId) => fetchUpdatedProject(projectId)}\n              />\n            )}\n            emptyStateControls={\n              canAdd ? (\n                <ToolbarAddButton key=\"add\" linkTo={`${match.url}/add`} />\n              ) : null\n            }\n          />\n        </Card>\n      </PageSection>\n      <Toast {...toastProps} />\n      {deletionError && (\n        <AlertModal\n          isOpen={deletionError}\n          variant=\"error\"\n          aria-label={t`Deletion Error`}\n          title={t`Error!`}\n          onClose={clearDeletionError}\n        >\n          {t`Failed to delete one or more projects.`}\n          <ErrorDetail error={deletionError} />\n        </AlertModal>\n      )}\n      {projectError && (\n        <AlertModal\n          isOpen={projectError}\n          variant=\"error\"\n          aria-label={t`Error fetching updated project`}\n          title={t`Error!`}\n          onClose={dismissProjectError}\n        >\n          {t`Failed to fetch the updated project data.`}\n          <ErrorDetail error={projectError} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nexport default ProjectList;\n"]},"metadata":{},"sourceType":"module"}