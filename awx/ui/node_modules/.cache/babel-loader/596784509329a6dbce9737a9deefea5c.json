{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{i18n}from\"@lingui/core\";export function initReducer(){return{addLinkSourceNode:null,addLinkTargetNode:null,addNodeSource:null,addNodeTarget:null,addingLink:false,contentError:null,isLoading:true,linkToDelete:null,linkToEdit:null,links:[],nextNodeId:0,nodePositions:null,nodes:[],nodeToDelete:null,nodeToEdit:null,nodeToView:null,showDeleteAllNodesModal:false,showLegend:false,showTools:false,showUnsavedChangesModal:false,unsavedChanges:false};}export default function visualizerReducer(state,action){switch(action.type){case'CREATE_LINK':return createLink(state,action.linkType);case'CREATE_NODE':return createNode(state,action.node);case'CANCEL_LINK':case'CANCEL_LINK_MODAL':return cancelLink(state);case'CANCEL_NODE_MODAL':return _objectSpread(_objectSpread({},state),{},{addNodeSource:null,addNodeTarget:null,nodeToEdit:null});case'DELETE_ALL_NODES':return deleteAllNodes(state);case'DELETE_LINK':return deleteLink(state);case'DELETE_NODE':return deleteNode(state);case'GENERATE_NODES_AND_LINKS':return generateNodesAndLinks(state,action.nodes);case'RESET':return initReducer();case'SELECT_SOURCE_FOR_LINKING':return selectSourceForLinking(state,action.node);case'SET_ADD_LINK_TARGET_NODE':return _objectSpread(_objectSpread({},state),{},{addLinkTargetNode:action.value});case'SET_CONTENT_ERROR':return _objectSpread(_objectSpread({},state),{},{contentError:action.value});case'SET_IS_LOADING':return _objectSpread(_objectSpread({},state),{},{isLoading:action.value});case'SET_LINK_TO_DELETE':return _objectSpread(_objectSpread({},state),{},{linkToDelete:action.value});case'SET_LINK_TO_EDIT':return _objectSpread(_objectSpread({},state),{},{linkToEdit:action.value});case'SET_NODES':return _objectSpread(_objectSpread({},state),{},{nodes:action.value});case'SET_NODE_POSITIONS':return _objectSpread(_objectSpread({},state),{},{nodePositions:action.value});case'SET_NODE_TO_DELETE':return _objectSpread(_objectSpread({},state),{},{nodeToDelete:action.value});case'SET_NODE_TO_EDIT':return _objectSpread(_objectSpread({},state),{},{nodeToEdit:action.value});case'SET_NODE_TO_VIEW':return _objectSpread(_objectSpread({},state),{},{nodeToView:action.value});case'SET_SHOW_DELETE_ALL_NODES_MODAL':return _objectSpread(_objectSpread({},state),{},{showDeleteAllNodesModal:action.value});case'START_ADD_NODE':return _objectSpread(_objectSpread({},state),{},{addNodeSource:action.sourceNodeId,addNodeTarget:action.targetNodeId||null});case'START_DELETE_LINK':return startDeleteLink(state,action.link);case'TOGGLE_DELETE_ALL_NODES_MODAL':return toggleDeleteAllNodesModal(state);case'TOGGLE_LEGEND':return toggleLegend(state);case'TOGGLE_TOOLS':return toggleTools(state);case'TOGGLE_UNSAVED_CHANGES_MODAL':return toggleUnsavedChangesModal(state);case'UPDATE_LINK':return updateLink(state,action.linkType);case'UPDATE_NODE':return updateNode(state,action.node);case'REFRESH_NODE':return refreshNode(state,action.node);default:throw new Error(\"Unrecognized action type: \".concat(action.type));}}function createLink(state,linkType){var addLinkSourceNode=state.addLinkSourceNode,addLinkTargetNode=state.addLinkTargetNode,links=state.links,nodes=state.nodes;var newLinks=_toConsumableArray(links);var newNodes=_toConsumableArray(nodes);newNodes.forEach(function(node){node.isInvalidLinkTarget=false;});newLinks.push({source:{id:addLinkSourceNode.id},target:{id:addLinkTargetNode.id},linkType:linkType});newLinks.forEach(function(link,index){if(link.source.id===1&&link.target.id===addLinkTargetNode.id){newLinks.splice(index,1);}});return _objectSpread(_objectSpread({},state),{},{addLinkSourceNode:null,addLinkTargetNode:null,addingLink:false,linkToEdit:null,links:newLinks,nodes:newNodes,unsavedChanges:true});}function createNode(state,node){var addNodeSource=state.addNodeSource,addNodeTarget=state.addNodeTarget,links=state.links,nodes=state.nodes,nextNodeId=state.nextNodeId;var newNodes=_toConsumableArray(nodes);var newLinks=_toConsumableArray(links);newNodes.push({id:nextNodeId,fullUnifiedJobTemplate:node.nodeResource,isInvalidLinkTarget:false,promptValues:node.promptValues,all_parents_must_converge:node.all_parents_must_converge,identifier:node.identifier});// Ensures that root nodes appear to always run\n// after \"START\"\nif(addNodeSource===1){node.linkType='always';}newLinks.push({source:{id:addNodeSource},target:{id:nextNodeId},linkType:node.linkType});if(addNodeTarget){newLinks.forEach(function(linkToCompare){if(linkToCompare.source.id===addNodeSource&&linkToCompare.target.id===addNodeTarget){linkToCompare.source={id:nextNodeId};}});}return _objectSpread(_objectSpread({},state),{},{addNodeSource:null,addNodeTarget:null,links:newLinks,nextNodeId:nextNodeId+1,nodes:newNodes,unsavedChanges:true});}function cancelLink(state){var nodes=state.nodes;var newNodes=_toConsumableArray(nodes);newNodes.forEach(function(node){node.isInvalidLinkTarget=false;});return _objectSpread(_objectSpread({},state),{},{addLinkSourceNode:null,addLinkTargetNode:null,addingLink:false,linkToEdit:null,nodes:newNodes});}function deleteAllNodes(state){var nodes=state.nodes;return _objectSpread(_objectSpread({},state),{},{addLinkSourceNode:null,addLinkTargetNode:null,addingLink:false,links:[],nodes:nodes.map(function(node){if(node.id!==1){node.isDeleted=true;}return node;}),showDeleteAllNodesModal:false,unsavedChanges:true});}function deleteLink(state){var links=state.links,linkToDelete=state.linkToDelete;var newLinks=_toConsumableArray(links);for(var i=newLinks.length;i--;){var link=newLinks[i];if(link.source.id===linkToDelete.source.id&&link.target.id===linkToDelete.target.id){newLinks.splice(i,1);}}if(!linkToDelete.isConvergenceLink){// Add a new link from the start node to the orphaned node\nnewLinks.push({source:{id:1},target:{id:linkToDelete.target.id},linkType:'always'});}return _objectSpread(_objectSpread({},state),{},{links:newLinks,linkToDelete:null,unsavedChanges:true});}function addLinksFromParentsToChildren(parents,children,newLinks,linkParentMapping){parents.forEach(function(parentId){children.forEach(function(child){if(parentId===1){// We only want to create a link from the start node to this node if it\n// doesn't have any other parents\nif(linkParentMapping[child.id].length===1){newLinks.push({source:{id:parentId},target:{id:child.id},linkType:'always'});}}else if(!linkParentMapping[child.id].includes(parentId)){newLinks.push({source:{id:parentId},target:{id:child.id},linkType:child.linkType});}});});}function removeLinksFromDeletedNode(nodeId,newLinks,linkParentMapping,children,parents){for(var i=newLinks.length;i--;){var link=newLinks[i];if(!linkParentMapping[link.target.id]){linkParentMapping[link.target.id]=[];}linkParentMapping[link.target.id].push(link.source.id);if(link.source.id===nodeId||link.target.id===nodeId){if(link.source.id===nodeId){children.push({id:link.target.id,linkType:link.linkType});}else if(link.target.id===nodeId){parents.push(link.source.id);}newLinks.splice(i,1);}}}function deleteNode(state){var links=state.links,nodes=state.nodes,nodeToDelete=state.nodeToDelete;var nodeId=nodeToDelete.id;var newNodes=_toConsumableArray(nodes);var newLinks=_toConsumableArray(links);newNodes.find(function(node){return node.id===nodeToDelete.id;}).isDeleted=true;// Update the links\nvar parents=[];var children=[];var linkParentMapping={};removeLinksFromDeletedNode(nodeId,newLinks,linkParentMapping,children,parents);addLinksFromParentsToChildren(parents,children,newLinks,linkParentMapping);return _objectSpread(_objectSpread({},state),{},{links:newLinks,nodeToDelete:null,nodes:newNodes,unsavedChanges:true});}function generateNodes(workflowNodes){var allNodeIds=[];var chartNodeIdToIndexMapping={};var nodeIdToChartNodeIdMapping={};var nodeIdCounter=2;var arrayOfNodesForChart=[{id:1,fullUnifiedJobTemplate:{name:/*i18n*/i18n._(\"START\")}}];workflowNodes.forEach(function(node){var _node$summary_fields,_node$summary_fields$;node.workflowMakerNodeId=nodeIdCounter;var nodeObj={id:nodeIdCounter,originalNodeObject:node};if(((_node$summary_fields=node.summary_fields)===null||_node$summary_fields===void 0?void 0:(_node$summary_fields$=_node$summary_fields.unified_job_template)===null||_node$summary_fields$===void 0?void 0:_node$summary_fields$.unified_job_type)==='workflow_approval'){nodeObj.fullUnifiedJobTemplate=_objectSpread(_objectSpread({},node.summary_fields.unified_job_template),{},{type:'workflow_approval_template'});}arrayOfNodesForChart.push(nodeObj);allNodeIds.push(node.id);nodeIdToChartNodeIdMapping[node.id]=node.workflowMakerNodeId;chartNodeIdToIndexMapping[nodeIdCounter]=nodeIdCounter-1;nodeIdCounter++;});return[arrayOfNodesForChart,allNodeIds,nodeIdToChartNodeIdMapping,chartNodeIdToIndexMapping,nodeIdCounter];}function generateLinks(workflowNodes,chartNodeIdToIndexMapping,nodeIdToChartNodeIdMapping,arrayOfNodesForChart){var arrayOfLinksForChart=[];var nonRootNodeIds=[];workflowNodes.forEach(function(node){var sourceIndex=chartNodeIdToIndexMapping[node.workflowMakerNodeId];node.success_nodes.forEach(function(nodeId){var targetIndex=chartNodeIdToIndexMapping[nodeIdToChartNodeIdMapping[nodeId]];arrayOfLinksForChart.push({source:arrayOfNodesForChart[sourceIndex],target:arrayOfNodesForChart[targetIndex],linkType:'success'});nonRootNodeIds.push(nodeId);});node.failure_nodes.forEach(function(nodeId){var targetIndex=chartNodeIdToIndexMapping[nodeIdToChartNodeIdMapping[nodeId]];arrayOfLinksForChart.push({source:arrayOfNodesForChart[sourceIndex],target:arrayOfNodesForChart[targetIndex],linkType:'failure'});nonRootNodeIds.push(nodeId);});node.always_nodes.forEach(function(nodeId){var targetIndex=chartNodeIdToIndexMapping[nodeIdToChartNodeIdMapping[nodeId]];arrayOfLinksForChart.push({source:arrayOfNodesForChart[sourceIndex],target:arrayOfNodesForChart[targetIndex],linkType:'always'});nonRootNodeIds.push(nodeId);});});return[arrayOfLinksForChart,nonRootNodeIds];}function generateNodesAndLinks(state,workflowNodes){var _generateNodes=generateNodes(workflowNodes),_generateNodes2=_slicedToArray(_generateNodes,5),arrayOfNodesForChart=_generateNodes2[0],allNodeIds=_generateNodes2[1],nodeIdToChartNodeIdMapping=_generateNodes2[2],chartNodeIdToIndexMapping=_generateNodes2[3],nodeIdCounter=_generateNodes2[4];var _generateLinks=generateLinks(workflowNodes,chartNodeIdToIndexMapping,nodeIdToChartNodeIdMapping,arrayOfNodesForChart),_generateLinks2=_slicedToArray(_generateLinks,2),arrayOfLinksForChart=_generateLinks2[0],nonRootNodeIds=_generateLinks2[1];var uniqueNonRootNodeIds=Array.from(new Set(nonRootNodeIds));var rootNodes=allNodeIds.filter(function(nodeId){return!uniqueNonRootNodeIds.includes(nodeId);});rootNodes.forEach(function(rootNodeId){var targetIndex=chartNodeIdToIndexMapping[nodeIdToChartNodeIdMapping[rootNodeId]];arrayOfLinksForChart.push({source:arrayOfNodesForChart[0],target:arrayOfNodesForChart[targetIndex],linkType:'always'});});return _objectSpread(_objectSpread({},state),{},{links:arrayOfLinksForChart,nodes:arrayOfNodesForChart,nextNodeId:nodeIdCounter});}function selectSourceForLinking(state,sourceNode){var links=state.links,nodes=state.nodes;var newNodes=_toConsumableArray(nodes);var parentMap={};var invalidLinkTargetIds=[];// Find and mark any ancestors as disabled to prevent cycles\nlinks.forEach(function(link){// id=1 is our artificial root node so we don't care about that\nif(link.source.id===1){return;}if(link.source.id===sourceNode.id){// Disables direct children from the add link process\ninvalidLinkTargetIds.push(link.target.id);}if(!parentMap[link.target.id]){parentMap[link.target.id]={parents:[],traversed:false};}parentMap[link.target.id].parents.push(link.source.id);});var getAncestors=function getAncestors(id){if(parentMap[id]&&!parentMap[id].traversed){parentMap[id].parents.forEach(function(parentId){invalidLinkTargetIds.push(parentId);getAncestors(parentId);});parentMap[id].traversed=true;}};getAncestors(sourceNode.id);// Filter out the duplicates\ninvalidLinkTargetIds.filter(function(element,index,array){return index===array.indexOf(element);}).forEach(function(ancestorId){newNodes.forEach(function(node){if(node.id===ancestorId){node.isInvalidLinkTarget=true;}});});return _objectSpread(_objectSpread({},state),{},{addLinkSourceNode:sourceNode,addingLink:true,nodes:newNodes});}function startDeleteLink(state,link){var links=state.links;var parentMap={};links.forEach(function(existingLink){if(!parentMap[existingLink.target.id]){parentMap[existingLink.target.id]=[];}parentMap[existingLink.target.id].push(existingLink.source.id);});link.isConvergenceLink=parentMap[link.target.id].length>1;return _objectSpread(_objectSpread({},state),{},{linkToDelete:link});}function toggleDeleteAllNodesModal(state){var showDeleteAllNodesModal=state.showDeleteAllNodesModal;return _objectSpread(_objectSpread({},state),{},{showDeleteAllNodesModal:!showDeleteAllNodesModal});}function toggleLegend(state){var showLegend=state.showLegend;return _objectSpread(_objectSpread({},state),{},{showLegend:!showLegend});}function toggleTools(state){var showTools=state.showTools;return _objectSpread(_objectSpread({},state),{},{showTools:!showTools});}function toggleUnsavedChangesModal(state){var showUnsavedChangesModal=state.showUnsavedChangesModal;return _objectSpread(_objectSpread({},state),{},{showUnsavedChangesModal:!showUnsavedChangesModal});}function updateLink(state,linkType){var linkToEdit=state.linkToEdit,links=state.links;var newLinks=_toConsumableArray(links);newLinks.forEach(function(link){if(link.source.id===linkToEdit.source.id&&link.target.id===linkToEdit.target.id){link.linkType=linkType;}});return _objectSpread(_objectSpread({},state),{},{linkToEdit:null,links:newLinks,unsavedChanges:true});}function updateNode(state,editedNode){var nodeToEdit=state.nodeToEdit,nodes=state.nodes;var nodeResource=editedNode.nodeResource,launchConfig=editedNode.launchConfig,promptValues=editedNode.promptValues,all_parents_must_converge=editedNode.all_parents_must_converge,identifier=editedNode.identifier;var newNodes=_toConsumableArray(nodes);var matchingNode=newNodes.find(function(node){return node.id===nodeToEdit.id;});matchingNode.all_parents_must_converge=all_parents_must_converge;matchingNode.fullUnifiedJobTemplate=nodeResource;matchingNode.isEdited=true;matchingNode.launchConfig=launchConfig;matchingNode.identifier=identifier;if(promptValues){matchingNode.promptValues=promptValues;}else{delete matchingNode.promptValues;}return _objectSpread(_objectSpread({},state),{},{nodeToEdit:null,nodes:newNodes,unsavedChanges:true});}function refreshNode(state,refreshedNode){var nodeToView=state.nodeToView,nodes=state.nodes;var newNodes=_toConsumableArray(nodes);var matchingNode=newNodes.find(function(node){return node.id===nodeToView.id;});if(refreshedNode.fullUnifiedJobTemplate){matchingNode.fullUnifiedJobTemplate=refreshedNode.fullUnifiedJobTemplate;}if(refreshedNode.originalNodeCredentials){matchingNode.originalNodeCredentials=refreshedNode.originalNodeCredentials;}return _objectSpread(_objectSpread({},state),{},{nodes:newNodes,nodeToView:matchingNode});}","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/Workflow/workflowReducer.js"],"names":["initReducer","addLinkSourceNode","addLinkTargetNode","addNodeSource","addNodeTarget","addingLink","contentError","isLoading","linkToDelete","linkToEdit","links","nextNodeId","nodePositions","nodes","nodeToDelete","nodeToEdit","nodeToView","showDeleteAllNodesModal","showLegend","showTools","showUnsavedChangesModal","unsavedChanges","visualizerReducer","state","action","type","createLink","linkType","createNode","node","cancelLink","deleteAllNodes","deleteLink","deleteNode","generateNodesAndLinks","selectSourceForLinking","value","sourceNodeId","targetNodeId","startDeleteLink","link","toggleDeleteAllNodesModal","toggleLegend","toggleTools","toggleUnsavedChangesModal","updateLink","updateNode","refreshNode","Error","newLinks","newNodes","forEach","isInvalidLinkTarget","push","source","id","target","index","splice","fullUnifiedJobTemplate","nodeResource","promptValues","all_parents_must_converge","identifier","linkToCompare","map","isDeleted","i","length","isConvergenceLink","addLinksFromParentsToChildren","parents","children","linkParentMapping","parentId","child","includes","removeLinksFromDeletedNode","nodeId","find","generateNodes","workflowNodes","allNodeIds","chartNodeIdToIndexMapping","nodeIdToChartNodeIdMapping","nodeIdCounter","arrayOfNodesForChart","name","workflowMakerNodeId","nodeObj","originalNodeObject","summary_fields","unified_job_template","unified_job_type","generateLinks","arrayOfLinksForChart","nonRootNodeIds","sourceIndex","success_nodes","targetIndex","failure_nodes","always_nodes","uniqueNonRootNodeIds","Array","from","Set","rootNodes","filter","rootNodeId","sourceNode","parentMap","invalidLinkTargetIds","traversed","getAncestors","element","array","indexOf","ancestorId","existingLink","editedNode","launchConfig","matchingNode","isEdited","refreshedNode","originalNodeCredentials"],"mappings":"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","sourcesContent":["import { t } from '@lingui/macro';\n\nexport function initReducer() {\n  return {\n    addLinkSourceNode: null,\n    addLinkTargetNode: null,\n    addNodeSource: null,\n    addNodeTarget: null,\n    addingLink: false,\n    contentError: null,\n    isLoading: true,\n    linkToDelete: null,\n    linkToEdit: null,\n    links: [],\n    nextNodeId: 0,\n    nodePositions: null,\n    nodes: [],\n    nodeToDelete: null,\n    nodeToEdit: null,\n    nodeToView: null,\n    showDeleteAllNodesModal: false,\n    showLegend: false,\n    showTools: false,\n    showUnsavedChangesModal: false,\n    unsavedChanges: false,\n  };\n}\n\nexport default function visualizerReducer(state, action) {\n  switch (action.type) {\n    case 'CREATE_LINK':\n      return createLink(state, action.linkType);\n    case 'CREATE_NODE':\n      return createNode(state, action.node);\n    case 'CANCEL_LINK':\n    case 'CANCEL_LINK_MODAL':\n      return cancelLink(state);\n    case 'CANCEL_NODE_MODAL':\n      return {\n        ...state,\n        addNodeSource: null,\n        addNodeTarget: null,\n        nodeToEdit: null,\n      };\n    case 'DELETE_ALL_NODES':\n      return deleteAllNodes(state);\n    case 'DELETE_LINK':\n      return deleteLink(state);\n    case 'DELETE_NODE':\n      return deleteNode(state);\n    case 'GENERATE_NODES_AND_LINKS':\n      return generateNodesAndLinks(state, action.nodes);\n    case 'RESET':\n      return initReducer();\n    case 'SELECT_SOURCE_FOR_LINKING':\n      return selectSourceForLinking(state, action.node);\n    case 'SET_ADD_LINK_TARGET_NODE':\n      return {\n        ...state,\n        addLinkTargetNode: action.value,\n      };\n    case 'SET_CONTENT_ERROR':\n      return {\n        ...state,\n        contentError: action.value,\n      };\n    case 'SET_IS_LOADING':\n      return {\n        ...state,\n        isLoading: action.value,\n      };\n    case 'SET_LINK_TO_DELETE':\n      return {\n        ...state,\n        linkToDelete: action.value,\n      };\n    case 'SET_LINK_TO_EDIT':\n      return {\n        ...state,\n        linkToEdit: action.value,\n      };\n    case 'SET_NODES':\n      return {\n        ...state,\n        nodes: action.value,\n      };\n    case 'SET_NODE_POSITIONS':\n      return {\n        ...state,\n        nodePositions: action.value,\n      };\n    case 'SET_NODE_TO_DELETE':\n      return {\n        ...state,\n        nodeToDelete: action.value,\n      };\n    case 'SET_NODE_TO_EDIT':\n      return {\n        ...state,\n        nodeToEdit: action.value,\n      };\n    case 'SET_NODE_TO_VIEW':\n      return {\n        ...state,\n        nodeToView: action.value,\n      };\n    case 'SET_SHOW_DELETE_ALL_NODES_MODAL':\n      return {\n        ...state,\n        showDeleteAllNodesModal: action.value,\n      };\n    case 'START_ADD_NODE':\n      return {\n        ...state,\n        addNodeSource: action.sourceNodeId,\n        addNodeTarget: action.targetNodeId || null,\n      };\n    case 'START_DELETE_LINK':\n      return startDeleteLink(state, action.link);\n    case 'TOGGLE_DELETE_ALL_NODES_MODAL':\n      return toggleDeleteAllNodesModal(state);\n    case 'TOGGLE_LEGEND':\n      return toggleLegend(state);\n    case 'TOGGLE_TOOLS':\n      return toggleTools(state);\n    case 'TOGGLE_UNSAVED_CHANGES_MODAL':\n      return toggleUnsavedChangesModal(state);\n    case 'UPDATE_LINK':\n      return updateLink(state, action.linkType);\n    case 'UPDATE_NODE':\n      return updateNode(state, action.node);\n    case 'REFRESH_NODE':\n      return refreshNode(state, action.node);\n    default:\n      throw new Error(`Unrecognized action type: ${action.type}`);\n  }\n}\n\nfunction createLink(state, linkType) {\n  const { addLinkSourceNode, addLinkTargetNode, links, nodes } = state;\n  const newLinks = [...links];\n  const newNodes = [...nodes];\n\n  newNodes.forEach((node) => {\n    node.isInvalidLinkTarget = false;\n  });\n\n  newLinks.push({\n    source: {\n      id: addLinkSourceNode.id,\n    },\n    target: {\n      id: addLinkTargetNode.id,\n    },\n    linkType,\n  });\n\n  newLinks.forEach((link, index) => {\n    if (link.source.id === 1 && link.target.id === addLinkTargetNode.id) {\n      newLinks.splice(index, 1);\n    }\n  });\n\n  return {\n    ...state,\n    addLinkSourceNode: null,\n    addLinkTargetNode: null,\n    addingLink: false,\n    linkToEdit: null,\n    links: newLinks,\n    nodes: newNodes,\n    unsavedChanges: true,\n  };\n}\n\nfunction createNode(state, node) {\n  const { addNodeSource, addNodeTarget, links, nodes, nextNodeId } = state;\n  const newNodes = [...nodes];\n  const newLinks = [...links];\n\n  newNodes.push({\n    id: nextNodeId,\n    fullUnifiedJobTemplate: node.nodeResource,\n    isInvalidLinkTarget: false,\n    promptValues: node.promptValues,\n    all_parents_must_converge: node.all_parents_must_converge,\n    identifier: node.identifier,\n  });\n\n  // Ensures that root nodes appear to always run\n  // after \"START\"\n  if (addNodeSource === 1) {\n    node.linkType = 'always';\n  }\n\n  newLinks.push({\n    source: {\n      id: addNodeSource,\n    },\n    target: {\n      id: nextNodeId,\n    },\n    linkType: node.linkType,\n  });\n\n  if (addNodeTarget) {\n    newLinks.forEach((linkToCompare) => {\n      if (\n        linkToCompare.source.id === addNodeSource &&\n        linkToCompare.target.id === addNodeTarget\n      ) {\n        linkToCompare.source = {\n          id: nextNodeId,\n        };\n      }\n    });\n  }\n\n  return {\n    ...state,\n    addNodeSource: null,\n    addNodeTarget: null,\n    links: newLinks,\n    nextNodeId: nextNodeId + 1,\n    nodes: newNodes,\n    unsavedChanges: true,\n  };\n}\n\nfunction cancelLink(state) {\n  const { nodes } = state;\n  const newNodes = [...nodes];\n\n  newNodes.forEach((node) => {\n    node.isInvalidLinkTarget = false;\n  });\n\n  return {\n    ...state,\n    addLinkSourceNode: null,\n    addLinkTargetNode: null,\n    addingLink: false,\n    linkToEdit: null,\n    nodes: newNodes,\n  };\n}\n\nfunction deleteAllNodes(state) {\n  const { nodes } = state;\n  return {\n    ...state,\n    addLinkSourceNode: null,\n    addLinkTargetNode: null,\n    addingLink: false,\n    links: [],\n    nodes: nodes.map((node) => {\n      if (node.id !== 1) {\n        node.isDeleted = true;\n      }\n\n      return node;\n    }),\n    showDeleteAllNodesModal: false,\n    unsavedChanges: true,\n  };\n}\n\nfunction deleteLink(state) {\n  const { links, linkToDelete } = state;\n  const newLinks = [...links];\n\n  for (let i = newLinks.length; i--; ) {\n    const link = newLinks[i];\n\n    if (\n      link.source.id === linkToDelete.source.id &&\n      link.target.id === linkToDelete.target.id\n    ) {\n      newLinks.splice(i, 1);\n    }\n  }\n\n  if (!linkToDelete.isConvergenceLink) {\n    // Add a new link from the start node to the orphaned node\n    newLinks.push({\n      source: {\n        id: 1,\n      },\n      target: {\n        id: linkToDelete.target.id,\n      },\n      linkType: 'always',\n    });\n  }\n\n  return {\n    ...state,\n    links: newLinks,\n    linkToDelete: null,\n    unsavedChanges: true,\n  };\n}\n\nfunction addLinksFromParentsToChildren(\n  parents,\n  children,\n  newLinks,\n  linkParentMapping\n) {\n  parents.forEach((parentId) => {\n    children.forEach((child) => {\n      if (parentId === 1) {\n        // We only want to create a link from the start node to this node if it\n        // doesn't have any other parents\n        if (linkParentMapping[child.id].length === 1) {\n          newLinks.push({\n            source: {\n              id: parentId,\n            },\n            target: {\n              id: child.id,\n            },\n            linkType: 'always',\n          });\n        }\n      } else if (!linkParentMapping[child.id].includes(parentId)) {\n        newLinks.push({\n          source: {\n            id: parentId,\n          },\n          target: {\n            id: child.id,\n          },\n          linkType: child.linkType,\n        });\n      }\n    });\n  });\n}\n\nfunction removeLinksFromDeletedNode(\n  nodeId,\n  newLinks,\n  linkParentMapping,\n  children,\n  parents\n) {\n  for (let i = newLinks.length; i--; ) {\n    const link = newLinks[i];\n\n    if (!linkParentMapping[link.target.id]) {\n      linkParentMapping[link.target.id] = [];\n    }\n\n    linkParentMapping[link.target.id].push(link.source.id);\n\n    if (link.source.id === nodeId || link.target.id === nodeId) {\n      if (link.source.id === nodeId) {\n        children.push({\n          id: link.target.id,\n          linkType: link.linkType,\n        });\n      } else if (link.target.id === nodeId) {\n        parents.push(link.source.id);\n      }\n      newLinks.splice(i, 1);\n    }\n  }\n}\n\nfunction deleteNode(state) {\n  const { links, nodes, nodeToDelete } = state;\n\n  const nodeId = nodeToDelete.id;\n  const newNodes = [...nodes];\n  const newLinks = [...links];\n\n  newNodes.find((node) => node.id === nodeToDelete.id).isDeleted = true;\n\n  // Update the links\n  const parents = [];\n  const children = [];\n  const linkParentMapping = {};\n\n  removeLinksFromDeletedNode(\n    nodeId,\n    newLinks,\n    linkParentMapping,\n    children,\n    parents\n  );\n\n  addLinksFromParentsToChildren(parents, children, newLinks, linkParentMapping);\n\n  return {\n    ...state,\n    links: newLinks,\n    nodeToDelete: null,\n    nodes: newNodes,\n    unsavedChanges: true,\n  };\n}\n\nfunction generateNodes(workflowNodes) {\n  const allNodeIds = [];\n  const chartNodeIdToIndexMapping = {};\n  const nodeIdToChartNodeIdMapping = {};\n  let nodeIdCounter = 2;\n  const arrayOfNodesForChart = [\n    {\n      id: 1,\n      fullUnifiedJobTemplate: {\n        name: t`START`,\n      },\n    },\n  ];\n  workflowNodes.forEach((node) => {\n    node.workflowMakerNodeId = nodeIdCounter;\n\n    const nodeObj = {\n      id: nodeIdCounter,\n      originalNodeObject: node,\n    };\n\n    if (\n      node.summary_fields?.unified_job_template?.unified_job_type ===\n      'workflow_approval'\n    ) {\n      nodeObj.fullUnifiedJobTemplate = {\n        ...node.summary_fields.unified_job_template,\n        type: 'workflow_approval_template',\n      };\n    }\n\n    arrayOfNodesForChart.push(nodeObj);\n    allNodeIds.push(node.id);\n    nodeIdToChartNodeIdMapping[node.id] = node.workflowMakerNodeId;\n    chartNodeIdToIndexMapping[nodeIdCounter] = nodeIdCounter - 1;\n    nodeIdCounter++;\n  });\n\n  return [\n    arrayOfNodesForChart,\n    allNodeIds,\n    nodeIdToChartNodeIdMapping,\n    chartNodeIdToIndexMapping,\n    nodeIdCounter,\n  ];\n}\n\nfunction generateLinks(\n  workflowNodes,\n  chartNodeIdToIndexMapping,\n  nodeIdToChartNodeIdMapping,\n  arrayOfNodesForChart\n) {\n  const arrayOfLinksForChart = [];\n  const nonRootNodeIds = [];\n  workflowNodes.forEach((node) => {\n    const sourceIndex = chartNodeIdToIndexMapping[node.workflowMakerNodeId];\n    node.success_nodes.forEach((nodeId) => {\n      const targetIndex =\n        chartNodeIdToIndexMapping[nodeIdToChartNodeIdMapping[nodeId]];\n      arrayOfLinksForChart.push({\n        source: arrayOfNodesForChart[sourceIndex],\n        target: arrayOfNodesForChart[targetIndex],\n        linkType: 'success',\n      });\n      nonRootNodeIds.push(nodeId);\n    });\n    node.failure_nodes.forEach((nodeId) => {\n      const targetIndex =\n        chartNodeIdToIndexMapping[nodeIdToChartNodeIdMapping[nodeId]];\n      arrayOfLinksForChart.push({\n        source: arrayOfNodesForChart[sourceIndex],\n        target: arrayOfNodesForChart[targetIndex],\n        linkType: 'failure',\n      });\n      nonRootNodeIds.push(nodeId);\n    });\n    node.always_nodes.forEach((nodeId) => {\n      const targetIndex =\n        chartNodeIdToIndexMapping[nodeIdToChartNodeIdMapping[nodeId]];\n      arrayOfLinksForChart.push({\n        source: arrayOfNodesForChart[sourceIndex],\n        target: arrayOfNodesForChart[targetIndex],\n        linkType: 'always',\n      });\n      nonRootNodeIds.push(nodeId);\n    });\n  });\n\n  return [arrayOfLinksForChart, nonRootNodeIds];\n}\n\nfunction generateNodesAndLinks(state, workflowNodes) {\n  const [\n    arrayOfNodesForChart,\n    allNodeIds,\n    nodeIdToChartNodeIdMapping,\n    chartNodeIdToIndexMapping,\n    nodeIdCounter,\n  ] = generateNodes(workflowNodes);\n  const [arrayOfLinksForChart, nonRootNodeIds] = generateLinks(\n    workflowNodes,\n    chartNodeIdToIndexMapping,\n    nodeIdToChartNodeIdMapping,\n    arrayOfNodesForChart\n  );\n\n  const uniqueNonRootNodeIds = Array.from(new Set(nonRootNodeIds));\n\n  const rootNodes = allNodeIds.filter(\n    (nodeId) => !uniqueNonRootNodeIds.includes(nodeId)\n  );\n\n  rootNodes.forEach((rootNodeId) => {\n    const targetIndex =\n      chartNodeIdToIndexMapping[nodeIdToChartNodeIdMapping[rootNodeId]];\n    arrayOfLinksForChart.push({\n      source: arrayOfNodesForChart[0],\n      target: arrayOfNodesForChart[targetIndex],\n      linkType: 'always',\n    });\n  });\n\n  return {\n    ...state,\n    links: arrayOfLinksForChart,\n    nodes: arrayOfNodesForChart,\n    nextNodeId: nodeIdCounter,\n  };\n}\n\nfunction selectSourceForLinking(state, sourceNode) {\n  const { links, nodes } = state;\n  const newNodes = [...nodes];\n  const parentMap = {};\n  const invalidLinkTargetIds = [];\n  // Find and mark any ancestors as disabled to prevent cycles\n  links.forEach((link) => {\n    // id=1 is our artificial root node so we don't care about that\n    if (link.source.id === 1) {\n      return;\n    }\n    if (link.source.id === sourceNode.id) {\n      // Disables direct children from the add link process\n      invalidLinkTargetIds.push(link.target.id);\n    }\n    if (!parentMap[link.target.id]) {\n      parentMap[link.target.id] = {\n        parents: [],\n        traversed: false,\n      };\n    }\n    parentMap[link.target.id].parents.push(link.source.id);\n  });\n\n  const getAncestors = (id) => {\n    if (parentMap[id] && !parentMap[id].traversed) {\n      parentMap[id].parents.forEach((parentId) => {\n        invalidLinkTargetIds.push(parentId);\n        getAncestors(parentId);\n      });\n      parentMap[id].traversed = true;\n    }\n  };\n\n  getAncestors(sourceNode.id);\n\n  // Filter out the duplicates\n  invalidLinkTargetIds\n    .filter((element, index, array) => index === array.indexOf(element))\n    .forEach((ancestorId) => {\n      newNodes.forEach((node) => {\n        if (node.id === ancestorId) {\n          node.isInvalidLinkTarget = true;\n        }\n      });\n    });\n\n  return {\n    ...state,\n    addLinkSourceNode: sourceNode,\n    addingLink: true,\n    nodes: newNodes,\n  };\n}\n\nfunction startDeleteLink(state, link) {\n  const { links } = state;\n  const parentMap = {};\n  links.forEach((existingLink) => {\n    if (!parentMap[existingLink.target.id]) {\n      parentMap[existingLink.target.id] = [];\n    }\n    parentMap[existingLink.target.id].push(existingLink.source.id);\n  });\n\n  link.isConvergenceLink = parentMap[link.target.id].length > 1;\n\n  return {\n    ...state,\n    linkToDelete: link,\n  };\n}\n\nfunction toggleDeleteAllNodesModal(state) {\n  const { showDeleteAllNodesModal } = state;\n  return {\n    ...state,\n    showDeleteAllNodesModal: !showDeleteAllNodesModal,\n  };\n}\n\nfunction toggleLegend(state) {\n  const { showLegend } = state;\n  return {\n    ...state,\n    showLegend: !showLegend,\n  };\n}\n\nfunction toggleTools(state) {\n  const { showTools } = state;\n  return {\n    ...state,\n    showTools: !showTools,\n  };\n}\n\nfunction toggleUnsavedChangesModal(state) {\n  const { showUnsavedChangesModal } = state;\n  return {\n    ...state,\n    showUnsavedChangesModal: !showUnsavedChangesModal,\n  };\n}\n\nfunction updateLink(state, linkType) {\n  const { linkToEdit, links } = state;\n  const newLinks = [...links];\n\n  newLinks.forEach((link) => {\n    if (\n      link.source.id === linkToEdit.source.id &&\n      link.target.id === linkToEdit.target.id\n    ) {\n      link.linkType = linkType;\n    }\n  });\n\n  return {\n    ...state,\n    linkToEdit: null,\n    links: newLinks,\n    unsavedChanges: true,\n  };\n}\n\nfunction updateNode(state, editedNode) {\n  const { nodeToEdit, nodes } = state;\n  const {\n    nodeResource,\n    launchConfig,\n    promptValues,\n    all_parents_must_converge,\n    identifier,\n  } = editedNode;\n  const newNodes = [...nodes];\n\n  const matchingNode = newNodes.find((node) => node.id === nodeToEdit.id);\n  matchingNode.all_parents_must_converge = all_parents_must_converge;\n  matchingNode.fullUnifiedJobTemplate = nodeResource;\n  matchingNode.isEdited = true;\n  matchingNode.launchConfig = launchConfig;\n  matchingNode.identifier = identifier;\n\n  if (promptValues) {\n    matchingNode.promptValues = promptValues;\n  } else {\n    delete matchingNode.promptValues;\n  }\n\n  return {\n    ...state,\n    nodeToEdit: null,\n    nodes: newNodes,\n    unsavedChanges: true,\n  };\n}\n\nfunction refreshNode(state, refreshedNode) {\n  const { nodeToView, nodes } = state;\n  const newNodes = [...nodes];\n\n  const matchingNode = newNodes.find((node) => node.id === nodeToView.id);\n\n  if (refreshedNode.fullUnifiedJobTemplate) {\n    matchingNode.fullUnifiedJobTemplate = refreshedNode.fullUnifiedJobTemplate;\n  }\n\n  if (refreshedNode.originalNodeCredentials) {\n    matchingNode.originalNodeCredentials =\n      refreshedNode.originalNodeCredentials;\n  }\n\n  return {\n    ...state,\n    nodes: newNodes,\n    nodeToView: matchingNode,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}