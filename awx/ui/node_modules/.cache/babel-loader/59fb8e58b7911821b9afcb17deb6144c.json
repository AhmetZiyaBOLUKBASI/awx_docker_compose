{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{CaretLeftIcon}from'@patternfly/react-icons';import{Card,PageSection}from'@patternfly/react-core';import{Switch,Route,Redirect,Link,useLocation,useParams,useRouteMatch}from'react-router-dom';import RoutedTabs from'components/RoutedTabs';import{useConfig}from'contexts/Config';import useRequest from'hooks/useRequest';import AppendBody from'components/AppendBody';import ContentError from'components/ContentError';import FullPage from'components/FullPage';import JobList from'components/JobList';import NotificationList from'components/NotificationList';import{Schedules}from'components/Schedule';import{ResourceAccessList}from'components/ResourceAccessList';import{WorkflowJobTemplatesAPI,OrganizationsAPI}from'api';import ContentLoading from'components/ContentLoading';import WorkflowJobTemplateDetail from'./WorkflowJobTemplateDetail';import WorkflowJobTemplateEdit from'./WorkflowJobTemplateEdit';import TemplateSurvey from'./TemplateSurvey';import{Visualizer}from'./WorkflowJobTemplateVisualizer';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function WorkflowJobTemplate(_ref){var _template$summary_fie,_template$summary_fie2;var setBreadcrumb=_ref.setBreadcrumb;var location=useLocation();var match=useRouteMatch();var _useParams=useParams(),templateId=_useParams.id;var _useConfig=useConfig(),_useConfig$me=_useConfig.me,me=_useConfig$me===void 0?{}:_useConfig$me;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$Promise$all,_yield$Promise$all2,data,actions,notifAdminRes,launchConfiguration,surveyConfiguration,_yield$WorkflowJobTem,survey,_data$related,_yield$WorkflowJobTem2,webhook_key;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Promise.all([WorkflowJobTemplatesAPI.readDetail(templateId),WorkflowJobTemplatesAPI.readWorkflowJobTemplateOptions(templateId),OrganizationsAPI.read({page_size:1,role_level:'notification_admin_role'}),WorkflowJobTemplatesAPI.readLaunch(templateId)]);case 2:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,4);data=_yield$Promise$all2[0].data;actions=_yield$Promise$all2[1];notifAdminRes=_yield$Promise$all2[2];launchConfiguration=_yield$Promise$all2[3].data;surveyConfiguration=null;if(!data.survey_enabled){_context.next=15;break;}_context.next=12;return WorkflowJobTemplatesAPI.readSurvey(templateId);case 12:_yield$WorkflowJobTem=_context.sent;survey=_yield$WorkflowJobTem.data;surveyConfiguration=survey;case 15:if(!actions.data.actions.PUT){_context.next=22;break;}if(!(data.webhook_service&&data!==null&&data!==void 0&&(_data$related=data.related)!==null&&_data$related!==void 0&&_data$related.webhook_key)){_context.next=22;break;}_context.next=19;return WorkflowJobTemplatesAPI.readWebhookKey(templateId);case 19:_yield$WorkflowJobTem2=_context.sent;webhook_key=_yield$WorkflowJobTem2.data.webhook_key;data.webhook_key=webhook_key;case 22:setBreadcrumb(data);return _context.abrupt(\"return\",{template:data,isNotifAdmin:notifAdminRes.data.results.length>0,launchConfig:launchConfiguration,surveyConfig:surveyConfiguration});case 24:case\"end\":return _context.stop();}}},_callee);})),[setBreadcrumb,templateId]),{isNotifAdmin:false,template:null}),_useRequest$result=_useRequest.result,isNotifAdmin=_useRequest$result.isNotifAdmin,template=_useRequest$result.template,surveyConfig=_useRequest$result.surveyConfig,launchConfig=_useRequest$result.launchConfig,hasRolesandTemplateLoading=_useRequest.isLoading,rolesAndTemplateError=_useRequest.error,loadTemplateAndRoles=_useRequest.request;useEffect(function(){loadTemplateAndRoles();},[loadTemplateAndRoles,location.pathname]);var loadScheduleOptions=useCallback(function(){return WorkflowJobTemplatesAPI.readScheduleOptions(templateId);},[templateId]);var loadSchedules=useCallback(function(params){return WorkflowJobTemplatesAPI.readSchedules(templateId,params);},[templateId]);var canSeeNotificationsTab=me.is_system_auditor||isNotifAdmin;var canAddAndEditSurvey=(template===null||template===void 0?void 0:(_template$summary_fie=template.summary_fields)===null||_template$summary_fie===void 0?void 0:_template$summary_fie.user_capabilities.edit)||(template===null||template===void 0?void 0:(_template$summary_fie2=template.summary_fields)===null||_template$summary_fie2===void 0?void 0:_template$summary_fie2.user_capabilities.delete);var tabsArray=[{name:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CaretLeftIcon,{}),/*i18n*/i18n._(\"Back to Templates\")]}),link:\"/templates\",isBackButton:true,id:99},{name:/*i18n*/i18n._(\"Details\"),link:\"\".concat(match.url,\"/details\")},{name:/*i18n*/i18n._(\"Access\"),link:\"\".concat(match.url,\"/access\")}];if(canSeeNotificationsTab){tabsArray.push({name:/*i18n*/i18n._(\"Notifications\"),link:\"\".concat(match.url,\"/notifications\")});}if(template){tabsArray.push({name:/*i18n*/i18n._(\"Schedules\"),link:\"\".concat(match.url,\"/schedules\")});}tabsArray.push({name:/*i18n*/i18n._(\"Visualizer\"),link:\"\".concat(match.url,\"/visualizer\")},{name:/*i18n*/i18n._(\"Jobs\"),link:\"\".concat(match.url,\"/jobs\")},{name:canAddAndEditSurvey?/*i18n*/i18n._(\"Survey\"):/*i18n*/i18n._(\"View Survey\"),link:\"\".concat(match.url,\"/survey\")});tabsArray.forEach(function(tab,n){tab.id=n;});var showCardHeader=true;if(location.pathname.endsWith('edit')||location.pathname.includes('schedules/')){showCardHeader=false;}var contentError=rolesAndTemplateError;if(hasRolesandTemplateLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}if(!hasRolesandTemplateLoading&&contentError){return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(ContentError,{error:contentError,children:contentError.response.status===404&&/*#__PURE__*/_jsxs(\"span\",{children:[/*i18n*/i18n._(\"Template not found.\"),' ',/*#__PURE__*/_jsx(Link,{to:\"/templates\",children:/*i18n*/i18n._(\"View all Templates.\")})]})})})});}return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsxs(Card,{children:[showCardHeader&&/*#__PURE__*/_jsx(RoutedTabs,{tabsArray:tabsArray}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Redirect,{from:\"/templates/:templateType/:id\",to:\"/templates/:templateType/:id/details\",exact:true}),template&&/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/details\",children:/*#__PURE__*/_jsx(WorkflowJobTemplateDetail,{template:template})},\"details\"),template&&/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/edit\",children:/*#__PURE__*/_jsx(WorkflowJobTemplateEdit,{template:template})},\"edit\"),template&&/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/access\",children:/*#__PURE__*/_jsx(ResourceAccessList,{resource:template,apiModel:WorkflowJobTemplatesAPI})},\"access\"),template&&/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/schedules\",children:/*#__PURE__*/_jsx(Schedules,{apiModel:WorkflowJobTemplatesAPI,setBreadcrumb:setBreadcrumb,resource:template,loadSchedules:loadSchedules,loadScheduleOptions:loadScheduleOptions,surveyConfig:surveyConfig,launchConfig:launchConfig})},\"schedules\"),canSeeNotificationsTab&&/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/notifications\",children:/*#__PURE__*/_jsx(NotificationList,{id:Number(templateId),canToggleNotifications:isNotifAdmin,apiModel:WorkflowJobTemplatesAPI,showApprovalsToggle:true})}),template&&/*#__PURE__*/_jsx(Route,{path:\"/templates/workflow_job_template/:id/visualizer\",children:/*#__PURE__*/_jsx(AppendBody,{children:/*#__PURE__*/_jsx(FullPage,{children:/*#__PURE__*/_jsx(Visualizer,{template:template})})})},\"wfjt-visualizer\"),(template===null||template===void 0?void 0:template.id)&&/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/jobs\",children:/*#__PURE__*/_jsx(JobList,{defaultParams:{workflow_job__workflow_job_template:template.id}})}),template&&/*#__PURE__*/_jsx(Route,{path:\"/templates/:templateType/:id/survey\",children:/*#__PURE__*/_jsx(TemplateSurvey,{template:template,canEdit:canAddAndEditSurvey})}),!hasRolesandTemplateLoading&&/*#__PURE__*/_jsx(Route,{path:\"*\",children:/*#__PURE__*/_jsx(ContentError,{isNotFound:true,children:match.params.id&&/*#__PURE__*/_jsx(Link,{to:\"/templates/\".concat(match.params.templateType,\"/\").concat(match.params.id,\"/details\"),children:/*i18n*/i18n._(\"View Template Details\")})})},\"not-found\")]})]})});}export{WorkflowJobTemplate as _WorkflowJobTemplate};export default WorkflowJobTemplate;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Template/WorkflowJobTemplate.js"],"names":["React","useEffect","useCallback","CaretLeftIcon","Card","PageSection","Switch","Route","Redirect","Link","useLocation","useParams","useRouteMatch","RoutedTabs","useConfig","useRequest","AppendBody","ContentError","FullPage","JobList","NotificationList","Schedules","ResourceAccessList","WorkflowJobTemplatesAPI","OrganizationsAPI","ContentLoading","WorkflowJobTemplateDetail","WorkflowJobTemplateEdit","TemplateSurvey","Visualizer","WorkflowJobTemplate","setBreadcrumb","location","match","templateId","id","me","Promise","all","readDetail","readWorkflowJobTemplateOptions","read","page_size","role_level","readLaunch","data","actions","notifAdminRes","launchConfiguration","surveyConfiguration","survey_enabled","readSurvey","survey","PUT","webhook_service","related","webhook_key","readWebhookKey","template","isNotifAdmin","results","length","launchConfig","surveyConfig","result","hasRolesandTemplateLoading","isLoading","rolesAndTemplateError","error","loadTemplateAndRoles","request","pathname","loadScheduleOptions","readScheduleOptions","loadSchedules","params","readSchedules","canSeeNotificationsTab","is_system_auditor","canAddAndEditSurvey","summary_fields","user_capabilities","edit","delete","tabsArray","name","link","isBackButton","url","push","forEach","tab","n","showCardHeader","endsWith","includes","contentError","response","status","Number","workflow_job__workflow_job_template","templateType","_WorkflowJobTemplate"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { t } from '@lingui/macro';\n\nimport { CaretLeftIcon } from '@patternfly/react-icons';\nimport { Card, PageSection } from '@patternfly/react-core';\nimport {\n  Switch,\n  Route,\n  Redirect,\n  Link,\n  useLocation,\n  useParams,\n  useRouteMatch,\n} from 'react-router-dom';\nimport RoutedTabs from 'components/RoutedTabs';\nimport { useConfig } from 'contexts/Config';\nimport useRequest from 'hooks/useRequest';\nimport AppendBody from 'components/AppendBody';\nimport ContentError from 'components/ContentError';\nimport FullPage from 'components/FullPage';\nimport JobList from 'components/JobList';\nimport NotificationList from 'components/NotificationList';\nimport { Schedules } from 'components/Schedule';\nimport { ResourceAccessList } from 'components/ResourceAccessList';\nimport { WorkflowJobTemplatesAPI, OrganizationsAPI } from 'api';\nimport ContentLoading from 'components/ContentLoading';\nimport WorkflowJobTemplateDetail from './WorkflowJobTemplateDetail';\nimport WorkflowJobTemplateEdit from './WorkflowJobTemplateEdit';\nimport TemplateSurvey from './TemplateSurvey';\nimport { Visualizer } from './WorkflowJobTemplateVisualizer';\n\nfunction WorkflowJobTemplate({ setBreadcrumb }) {\n  const location = useLocation();\n  const match = useRouteMatch();\n  const { id: templateId } = useParams();\n  const { me = {} } = useConfig();\n\n  const {\n    result: { isNotifAdmin, template, surveyConfig, launchConfig },\n    isLoading: hasRolesandTemplateLoading,\n    error: rolesAndTemplateError,\n    request: loadTemplateAndRoles,\n  } = useRequest(\n    useCallback(async () => {\n      const [{ data }, actions, notifAdminRes, { data: launchConfiguration }] =\n        await Promise.all([\n          WorkflowJobTemplatesAPI.readDetail(templateId),\n          WorkflowJobTemplatesAPI.readWorkflowJobTemplateOptions(templateId),\n          OrganizationsAPI.read({\n            page_size: 1,\n            role_level: 'notification_admin_role',\n          }),\n          WorkflowJobTemplatesAPI.readLaunch(templateId),\n        ]);\n\n      let surveyConfiguration = null;\n\n      if (data.survey_enabled) {\n        const { data: survey } = await WorkflowJobTemplatesAPI.readSurvey(\n          templateId\n        );\n\n        surveyConfiguration = survey;\n      }\n\n      if (actions.data.actions.PUT) {\n        if (data.webhook_service && data?.related?.webhook_key) {\n          const {\n            data: { webhook_key },\n          } = await WorkflowJobTemplatesAPI.readWebhookKey(templateId);\n\n          data.webhook_key = webhook_key;\n        }\n      }\n      setBreadcrumb(data);\n\n      return {\n        template: data,\n        isNotifAdmin: notifAdminRes.data.results.length > 0,\n        launchConfig: launchConfiguration,\n        surveyConfig: surveyConfiguration,\n      };\n    }, [setBreadcrumb, templateId]),\n    { isNotifAdmin: false, template: null }\n  );\n  useEffect(() => {\n    loadTemplateAndRoles();\n  }, [loadTemplateAndRoles, location.pathname]);\n\n  const loadScheduleOptions = useCallback(\n    () => WorkflowJobTemplatesAPI.readScheduleOptions(templateId),\n    [templateId]\n  );\n\n  const loadSchedules = useCallback(\n    (params) => WorkflowJobTemplatesAPI.readSchedules(templateId, params),\n    [templateId]\n  );\n\n  const canSeeNotificationsTab = me.is_system_auditor || isNotifAdmin;\n  const canAddAndEditSurvey =\n    template?.summary_fields?.user_capabilities.edit ||\n    template?.summary_fields?.user_capabilities.delete;\n\n  const tabsArray = [\n    {\n      name: (\n        <>\n          <CaretLeftIcon />\n          {t`Back to Templates`}\n        </>\n      ),\n      link: `/templates`,\n      isBackButton: true,\n      id: 99,\n    },\n    { name: t`Details`, link: `${match.url}/details` },\n    { name: t`Access`, link: `${match.url}/access` },\n  ];\n\n  if (canSeeNotificationsTab) {\n    tabsArray.push({\n      name: t`Notifications`,\n      link: `${match.url}/notifications`,\n    });\n  }\n\n  if (template) {\n    tabsArray.push({\n      name: t`Schedules`,\n      link: `${match.url}/schedules`,\n    });\n  }\n\n  tabsArray.push(\n    {\n      name: t`Visualizer`,\n      link: `${match.url}/visualizer`,\n    },\n    {\n      name: t`Jobs`,\n      link: `${match.url}/jobs`,\n    },\n    {\n      name: canAddAndEditSurvey ? t`Survey` : t`View Survey`,\n      link: `${match.url}/survey`,\n    }\n  );\n\n  tabsArray.forEach((tab, n) => {\n    tab.id = n;\n  });\n\n  let showCardHeader = true;\n\n  if (\n    location.pathname.endsWith('edit') ||\n    location.pathname.includes('schedules/')\n  ) {\n    showCardHeader = false;\n  }\n\n  const contentError = rolesAndTemplateError;\n\n  if (hasRolesandTemplateLoading) {\n    return <ContentLoading />;\n  }\n  if (!hasRolesandTemplateLoading && contentError) {\n    return (\n      <PageSection>\n        <Card>\n          <ContentError error={contentError}>\n            {contentError.response.status === 404 && (\n              <span>\n                {t`Template not found.`}{' '}\n                <Link to=\"/templates\">{t`View all Templates.`}</Link>\n              </span>\n            )}\n          </ContentError>\n        </Card>\n      </PageSection>\n    );\n  }\n\n  return (\n    <PageSection>\n      <Card>\n        {showCardHeader && <RoutedTabs tabsArray={tabsArray} />}\n        <Switch>\n          <Redirect\n            from=\"/templates/:templateType/:id\"\n            to=\"/templates/:templateType/:id/details\"\n            exact\n          />\n          {template && (\n            <Route key=\"details\" path=\"/templates/:templateType/:id/details\">\n              <WorkflowJobTemplateDetail template={template} />\n            </Route>\n          )}\n          {template && (\n            <Route key=\"edit\" path=\"/templates/:templateType/:id/edit\">\n              <WorkflowJobTemplateEdit template={template} />\n            </Route>\n          )}\n          {template && (\n            <Route key=\"access\" path=\"/templates/:templateType/:id/access\">\n              <ResourceAccessList\n                resource={template}\n                apiModel={WorkflowJobTemplatesAPI}\n              />\n            </Route>\n          )}\n          {template && (\n            <Route\n              key=\"schedules\"\n              path=\"/templates/:templateType/:id/schedules\"\n            >\n              <Schedules\n                apiModel={WorkflowJobTemplatesAPI}\n                setBreadcrumb={setBreadcrumb}\n                resource={template}\n                loadSchedules={loadSchedules}\n                loadScheduleOptions={loadScheduleOptions}\n                surveyConfig={surveyConfig}\n                launchConfig={launchConfig}\n              />\n            </Route>\n          )}\n          {canSeeNotificationsTab && (\n            <Route path=\"/templates/:templateType/:id/notifications\">\n              <NotificationList\n                id={Number(templateId)}\n                canToggleNotifications={isNotifAdmin}\n                apiModel={WorkflowJobTemplatesAPI}\n                showApprovalsToggle\n              />\n            </Route>\n          )}\n          {template && (\n            <Route\n              key=\"wfjt-visualizer\"\n              path=\"/templates/workflow_job_template/:id/visualizer\"\n            >\n              <AppendBody>\n                <FullPage>\n                  <Visualizer template={template} />\n                </FullPage>\n              </AppendBody>\n            </Route>\n          )}\n          {template?.id && (\n            <Route path=\"/templates/:templateType/:id/jobs\">\n              <JobList\n                defaultParams={{\n                  workflow_job__workflow_job_template: template.id,\n                }}\n              />\n            </Route>\n          )}\n          {template && (\n            <Route path=\"/templates/:templateType/:id/survey\">\n              <TemplateSurvey\n                template={template}\n                canEdit={canAddAndEditSurvey}\n              />\n            </Route>\n          )}\n          {!hasRolesandTemplateLoading && (\n            <Route key=\"not-found\" path=\"*\">\n              <ContentError isNotFound>\n                {match.params.id && (\n                  <Link\n                    to={`/templates/${match.params.templateType}/${match.params.id}/details`}\n                  >\n                    {t`View Template Details`}\n                  </Link>\n                )}\n              </ContentError>\n            </Route>\n          )}\n        </Switch>\n      </Card>\n    </PageSection>\n  );\n}\n\nexport { WorkflowJobTemplate as _WorkflowJobTemplate };\nexport default WorkflowJobTemplate;\n"]},"metadata":{},"sourceType":"module"}