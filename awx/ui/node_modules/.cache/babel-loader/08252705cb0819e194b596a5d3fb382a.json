{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useContext,useEffect,useMemo}from'react';import{useRouteMatch}from'react-router-dom';import{ConfigAPI,MeAPI,UsersAPI,OrganizationsAPI}from'api';import useRequest,{useDismissableError}from'hooks/useRequest';import AlertModal from'components/AlertModal';import ErrorDetail from'components/ErrorDetail';import{useSession}from'./Session';// eslint-disable-next-line import/prefer-default-export\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var ConfigContext=/*#__PURE__*/React.createContext({});ConfigContext.displayName='ConfigContext';export var Config=ConfigContext.Consumer;export var useConfig=function useConfig(){var context=useContext(ConfigContext);if(context===undefined){throw new Error('useConfig must be used within a ConfigProvider');}return context;};export var ConfigProvider=function ConfigProvider(_ref){var children=_ref.children;var _useSession=useSession(),logout=_useSession.logout;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$Promise$all,_yield$Promise$all2,data,_yield$Promise$all2$,me,_yield$Promise$all3,_yield$Promise$all4,adminOrgCount,notifAdminCount,execEnvAdminCount;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Promise.all([ConfigAPI.read(),MeAPI.read()]);case 2:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);data=_yield$Promise$all2[0].data;_yield$Promise$all2$=_slicedToArray(_yield$Promise$all2[1].data.results,1);me=_yield$Promise$all2$[0];_context.next=9;return Promise.all([UsersAPI.readAdminOfOrganizations(me===null||me===void 0?void 0:me.id),OrganizationsAPI.read({page_size:1,role_level:'notification_admin_role'}),OrganizationsAPI.read({page_size:1,role_level:'execution_environment_admin_role'})]);case 9:_yield$Promise$all3=_context.sent;_yield$Promise$all4=_slicedToArray(_yield$Promise$all3,3);adminOrgCount=_yield$Promise$all4[0].data.count;notifAdminCount=_yield$Promise$all4[1].data.count;execEnvAdminCount=_yield$Promise$all4[2].data.count;return _context.abrupt(\"return\",_objectSpread(_objectSpread({},data),{},{me:me,adminOrgCount:adminOrgCount,notifAdminCount:notifAdminCount,execEnvAdminCount:execEnvAdminCount}));case 15:case\"end\":return _context.stop();}}},_callee);})),[]),{adminOrgCount:0,notifAdminCount:0,execEnvAdminCount:0}),configError=_useRequest.error,isLoading=_useRequest.isLoading,request=_useRequest.request,config=_useRequest.result;var _useDismissableError=useDismissableError(configError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;useEffect(function(){request();},[request]);useEffect(function(){var _error$response;if((error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){logout();}},[error,logout]);var value=useMemo(function(){return _objectSpread(_objectSpread({},config),{},{request:request,isLoading:isLoading});},[config,request,isLoading]);return/*#__PURE__*/_jsxs(ConfigContext.Provider,{value:value,children:[error&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:error,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:dismissError,ouiaId:\"config-error-modal\",children:[/*i18n*/i18n._(\"Failed to retrieve configuration.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]}),children]});};export var useUserProfile=function useUserProfile(){var _config$me,_config$me2;var config=useConfig();return{isSuperUser:!!((_config$me=config.me)!==null&&_config$me!==void 0&&_config$me.is_superuser),isSystemAuditor:!!((_config$me2=config.me)!==null&&_config$me2!==void 0&&_config$me2.is_system_auditor),isOrgAdmin:config.adminOrgCount,isNotificationAdmin:config.notifAdminCount,isExecEnvAdmin:config.execEnvAdminCount};};export var useAuthorizedPath=function useAuthorizedPath(){var _config$license_info;var config=useConfig();var subscriptionMgmtRoute=useRouteMatch({path:'/subscription_management'});return!!((_config$license_info=config.license_info)!==null&&_config$license_info!==void 0&&_config$license_info.valid_key)&&!subscriptionMgmtRoute;};","map":{"version":3,"sources":["/awx_devel/awx/ui/src/contexts/Config.js"],"names":["React","useCallback","useContext","useEffect","useMemo","useRouteMatch","ConfigAPI","MeAPI","UsersAPI","OrganizationsAPI","useRequest","useDismissableError","AlertModal","ErrorDetail","useSession","ConfigContext","createContext","displayName","Config","Consumer","useConfig","context","undefined","Error","ConfigProvider","children","logout","Promise","all","read","data","results","me","readAdminOfOrganizations","id","page_size","role_level","adminOrgCount","count","notifAdminCount","execEnvAdminCount","configError","error","isLoading","request","config","result","dismissError","response","status","value","useUserProfile","isSuperUser","is_superuser","isSystemAuditor","is_system_auditor","isOrgAdmin","isNotificationAdmin","isExecEnvAdmin","useAuthorizedPath","subscriptionMgmtRoute","path","license_info","valid_key"],"mappings":"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","sourcesContent":["import React, { useCallback, useContext, useEffect, useMemo } from 'react';\nimport { useRouteMatch } from 'react-router-dom';\n\nimport { t } from '@lingui/macro';\n\nimport { ConfigAPI, MeAPI, UsersAPI, OrganizationsAPI } from 'api';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport AlertModal from 'components/AlertModal';\nimport ErrorDetail from 'components/ErrorDetail';\nimport { useSession } from './Session';\n\n// eslint-disable-next-line import/prefer-default-export\nexport const ConfigContext = React.createContext({});\nConfigContext.displayName = 'ConfigContext';\n\nexport const Config = ConfigContext.Consumer;\nexport const useConfig = () => {\n  const context = useContext(ConfigContext);\n  if (context === undefined) {\n    throw new Error('useConfig must be used within a ConfigProvider');\n  }\n  return context;\n};\n\nexport const ConfigProvider = ({ children }) => {\n  const { logout } = useSession();\n\n  const {\n    error: configError,\n    isLoading,\n    request,\n    result: config,\n  } = useRequest(\n    useCallback(async () => {\n      const [\n        { data },\n        {\n          data: {\n            results: [me],\n          },\n        },\n      ] = await Promise.all([ConfigAPI.read(), MeAPI.read()]);\n\n      const [\n        {\n          data: { count: adminOrgCount },\n        },\n        {\n          data: { count: notifAdminCount },\n        },\n        {\n          data: { count: execEnvAdminCount },\n        },\n      ] = await Promise.all([\n        UsersAPI.readAdminOfOrganizations(me?.id),\n        OrganizationsAPI.read({\n          page_size: 1,\n          role_level: 'notification_admin_role',\n        }),\n        OrganizationsAPI.read({\n          page_size: 1,\n          role_level: 'execution_environment_admin_role',\n        }),\n      ]);\n\n      return { ...data, me, adminOrgCount, notifAdminCount, execEnvAdminCount };\n    }, []),\n    { adminOrgCount: 0, notifAdminCount: 0, execEnvAdminCount: 0 }\n  );\n\n  const { error, dismissError } = useDismissableError(configError);\n\n  useEffect(() => {\n    request();\n  }, [request]);\n\n  useEffect(() => {\n    if (error?.response?.status === 401) {\n      logout();\n    }\n  }, [error, logout]);\n\n  const value = useMemo(\n    () => ({ ...config, request, isLoading }),\n    [config, request, isLoading]\n  );\n\n  return (\n    <ConfigContext.Provider value={value}>\n      {error && (\n        <AlertModal\n          isOpen={error}\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={dismissError}\n          ouiaId=\"config-error-modal\"\n        >\n          {t`Failed to retrieve configuration.`}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n      {children}\n    </ConfigContext.Provider>\n  );\n};\n\nexport const useUserProfile = () => {\n  const config = useConfig();\n  return {\n    isSuperUser: !!config.me?.is_superuser,\n    isSystemAuditor: !!config.me?.is_system_auditor,\n    isOrgAdmin: config.adminOrgCount,\n    isNotificationAdmin: config.notifAdminCount,\n    isExecEnvAdmin: config.execEnvAdminCount,\n  };\n};\n\nexport const useAuthorizedPath = () => {\n  const config = useConfig();\n  const subscriptionMgmtRoute = useRouteMatch({\n    path: '/subscription_management',\n  });\n  return !!config.license_info?.valid_key && !subscriptionMgmtRoute;\n};\n"]},"metadata":{},"sourceType":"module"}