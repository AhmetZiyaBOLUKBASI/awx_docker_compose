{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{Formik,useField,useFormikContext}from'formik';import{Form,FormGroup,Title}from'@patternfly/react-core';import{InventorySourcesAPI}from'api';import useRequest from'hooks/useRequest';import{required}from'util/validators';import AnsibleSelect from'components/AnsibleSelect';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import FormActionGroup from'components/FormActionGroup/FormActionGroup';import FormField,{FormSubmitError}from'components/FormField';import{FormColumnLayout,SubFormLayout}from'components/FormLayout';import{ExecutionEnvironmentLookup}from'components/Lookup';import{AzureSubForm,EC2SubForm,GCESubForm,InsightsSubForm,OpenStackSubForm,SCMSubForm,SatelliteSubForm,ControllerSubForm,VMwareSubForm,VirtualizationSubForm}from'./InventorySourceSubForms';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var buildSourceChoiceOptions=function buildSourceChoiceOptions(options){var sourceChoices=options.actions.GET.source.choices.map(function(_ref){var _ref2=_slicedToArray(_ref,2),choice=_ref2[0],label=_ref2[1];return{label:label,key:choice,value:choice};});return sourceChoices.filter(function(_ref3){var key=_ref3.key;return key!=='file';});};var InventorySourceFormFields=function InventorySourceFormFields(_ref4){var source=_ref4.source,sourceOptions=_ref4.sourceOptions,organizationId=_ref4.organizationId;var _useFormikContext=useFormikContext(),values=_useFormikContext.values,initialValues=_useFormikContext.initialValues,resetForm=_useFormikContext.resetForm,setFieldTouched=_useFormikContext.setFieldTouched,setFieldValue=_useFormikContext.setFieldValue;var _useField=useField({name:'source',validate:required(/*i18n*/i18n._(\"Set a value for this field\"))}),_useField2=_slicedToArray(_useField,2),sourceField=_useField2[0],sourceMeta=_useField2[1];var _useField3=useField('execution_environment'),_useField4=_slicedToArray(_useField3,3),executionEnvironmentField=_useField4[0],executionEnvironmentMeta=_useField4[1],executionEnvironmentHelpers=_useField4[2];var resetSubFormFields=function resetSubFormFields(sourceType){if(sourceType===initialValues.source){resetForm({values:_objectSpread(_objectSpread({},initialValues),{},{name:values.name,description:values.description,source:sourceType})});}else{var defaults={credential:null,overwrite:false,overwrite_vars:false,source:sourceType,source_path:'',source_project:null,source_script:null,source_vars:'---\\n',update_cache_timeout:0,update_on_launch:false,verbosity:1,enabled_var:'',enabled_value:'',host_filter:''};Object.keys(defaults).forEach(function(label){setFieldValue(label,defaults[label]);setFieldTouched(label,false);});}};var handleExecutionEnvironmentUpdate=useCallback(function(value){setFieldValue('execution_environment',value);setFieldTouched('execution_environment',true,false);},[setFieldValue,setFieldTouched]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FormField,{id:\"name\",label:/*i18n*/i18n._(\"Name\"),name:\"name\",type:\"text\",validate:required(null),isRequired:true}),/*#__PURE__*/_jsx(FormField,{id:\"description\",label:/*i18n*/i18n._(\"Description\"),name:\"description\",type:\"text\"}),/*#__PURE__*/_jsx(ExecutionEnvironmentLookup,{helperTextInvalid:executionEnvironmentMeta.error,isValid:!executionEnvironmentMeta.touched||!executionEnvironmentMeta.error,onBlur:function onBlur(){return executionEnvironmentHelpers.setTouched();},value:executionEnvironmentField.value,onChange:handleExecutionEnvironmentUpdate,globallyAvailable:true,organizationId:organizationId}),/*#__PURE__*/_jsx(FormGroup,{fieldId:\"source\",helperTextInvalid:sourceMeta.error,isRequired:true,validated:!sourceMeta.touched||!sourceMeta.error?'default':'error',label:/*i18n*/i18n._(\"Source\"),children:/*#__PURE__*/_jsx(AnsibleSelect,_objectSpread(_objectSpread({},sourceField),{},{id:\"source\",data:[{value:'',key:'',label:/*i18n*/i18n._(\"Choose a source\"),isDisabled:true}].concat(_toConsumableArray(buildSourceChoiceOptions(sourceOptions))),onChange:function onChange(event,value){resetSubFormFields(value);}}))}),!['','custom'].includes(sourceField.value)&&/*#__PURE__*/_jsxs(SubFormLayout,{children:[/*#__PURE__*/_jsx(Title,{size:\"md\",headingLevel:\"h4\",children:/*i18n*/i18n._(\"Source details\")}),/*#__PURE__*/_jsx(FormColumnLayout,{children:{azure_rm:/*#__PURE__*/_jsx(AzureSubForm,{autoPopulateCredential:!(source!==null&&source!==void 0&&source.id)||(source===null||source===void 0?void 0:source.source)!=='azure_rm',sourceOptions:sourceOptions}),ec2:/*#__PURE__*/_jsx(EC2SubForm,{sourceOptions:sourceOptions}),gce:/*#__PURE__*/_jsx(GCESubForm,{autoPopulateCredential:!(source!==null&&source!==void 0&&source.id)||(source===null||source===void 0?void 0:source.source)!=='gce',sourceOptions:sourceOptions}),insights:/*#__PURE__*/_jsx(InsightsSubForm,{autoPopulateCredential:!(source!==null&&source!==void 0&&source.id)||(source===null||source===void 0?void 0:source.source)!=='insights'}),openstack:/*#__PURE__*/_jsx(OpenStackSubForm,{autoPopulateCredential:!(source!==null&&source!==void 0&&source.id)||(source===null||source===void 0?void 0:source.source)!=='openstack'}),rhv:/*#__PURE__*/_jsx(VirtualizationSubForm,{autoPopulateCredential:!(source!==null&&source!==void 0&&source.id)||(source===null||source===void 0?void 0:source.source)!=='rhv'}),satellite6:/*#__PURE__*/_jsx(SatelliteSubForm,{autoPopulateCredential:!(source!==null&&source!==void 0&&source.id)||(source===null||source===void 0?void 0:source.source)!=='satellite6'}),scm:/*#__PURE__*/_jsx(SCMSubForm,{autoPopulateProject:!(source!==null&&source!==void 0&&source.id)||(source===null||source===void 0?void 0:source.source)!=='scm'}),controller:/*#__PURE__*/_jsx(ControllerSubForm,{autoPopulateCredential:!(source!==null&&source!==void 0&&source.id)||(source===null||source===void 0?void 0:source.source)!=='controller'}),vmware:/*#__PURE__*/_jsx(VMwareSubForm,{autoPopulateCredential:!(source!==null&&source!==void 0&&source.id)||(source===null||source===void 0?void 0:source.source)!=='vmware',sourceOptions:sourceOptions})}[sourceField.value]})]})]});};var InventorySourceForm=function InventorySourceForm(_ref5){var _source$summary_field,_source$summary_field2,_source$summary_field3,_source$summary_field4;var onCancel=_ref5.onCancel,_onSubmit=_ref5.onSubmit,source=_ref5.source,_ref5$submitError=_ref5.submitError,submitError=_ref5$submitError===void 0?null:_ref5$submitError,organizationId=_ref5.organizationId;var initialValues={credential:(source===null||source===void 0?void 0:(_source$summary_field=source.summary_fields)===null||_source$summary_field===void 0?void 0:_source$summary_field.credential)||null,description:(source===null||source===void 0?void 0:source.description)||'',name:(source===null||source===void 0?void 0:source.name)||'',overwrite:(source===null||source===void 0?void 0:source.overwrite)||false,overwrite_vars:(source===null||source===void 0?void 0:source.overwrite_vars)||false,source:(source===null||source===void 0?void 0:source.source)||'',source_path:(source===null||source===void 0?void 0:source.source_path)||'',source_project:(source===null||source===void 0?void 0:(_source$summary_field2=source.summary_fields)===null||_source$summary_field2===void 0?void 0:_source$summary_field2.source_project)||null,source_script:(source===null||source===void 0?void 0:(_source$summary_field3=source.summary_fields)===null||_source$summary_field3===void 0?void 0:_source$summary_field3.source_script)||null,source_vars:(source===null||source===void 0?void 0:source.source_vars)||'---\\n',update_cache_timeout:(source===null||source===void 0?void 0:source.update_cache_timeout)||0,update_on_launch:(source===null||source===void 0?void 0:source.update_on_launch)||false,verbosity:(source===null||source===void 0?void 0:source.verbosity)||1,enabled_var:(source===null||source===void 0?void 0:source.enabled_var)||'',enabled_value:(source===null||source===void 0?void 0:source.enabled_value)||'',host_filter:(source===null||source===void 0?void 0:source.host_filter)||'',execution_environment:(source===null||source===void 0?void 0:(_source$summary_field4=source.summary_fields)===null||_source$summary_field4===void 0?void 0:_source$summary_field4.execution_environment)||null};var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$InventorySourc,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return InventorySourcesAPI.readOptions();case 2:_yield$InventorySourc=_context.sent;data=_yield$InventorySourc.data;return _context.abrupt(\"return\",data);case 5:case\"end\":return _context.stop();}}},_callee);})),[]),null),isSourceOptionsLoading=_useRequest.isLoading,sourceOptionsError=_useRequest.error,fetchSourceOptions=_useRequest.request,sourceOptions=_useRequest.result;useEffect(function(){fetchSourceOptions();},[fetchSourceOptions]);if(sourceOptionsError){return/*#__PURE__*/_jsx(ContentError,{error:sourceOptionsError});}if(!sourceOptions||isSourceOptionsLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}return/*#__PURE__*/_jsx(Formik,{initialValues:initialValues,onSubmit:function onSubmit(values){_onSubmit(values);},children:function children(formik){return/*#__PURE__*/_jsx(Form,{autoComplete:\"off\",onSubmit:formik.handleSubmit,children:/*#__PURE__*/_jsxs(FormColumnLayout,{children:[/*#__PURE__*/_jsx(InventorySourceFormFields,{formik:formik,source:source,sourceOptions:sourceOptions,organizationId:organizationId}),submitError&&/*#__PURE__*/_jsx(FormSubmitError,{error:submitError}),/*#__PURE__*/_jsx(FormActionGroup,{onCancel:onCancel,onSubmit:formik.handleSubmit})]})});}});};InventorySourceForm.defaultProps={submitError:null};export default InventorySourceForm;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Inventory/shared/InventorySourceForm.js"],"names":["React","useEffect","useCallback","Formik","useField","useFormikContext","Form","FormGroup","Title","InventorySourcesAPI","useRequest","required","AnsibleSelect","ContentError","ContentLoading","FormActionGroup","FormField","FormSubmitError","FormColumnLayout","SubFormLayout","ExecutionEnvironmentLookup","AzureSubForm","EC2SubForm","GCESubForm","InsightsSubForm","OpenStackSubForm","SCMSubForm","SatelliteSubForm","ControllerSubForm","VMwareSubForm","VirtualizationSubForm","buildSourceChoiceOptions","options","sourceChoices","actions","GET","source","choices","map","choice","label","key","value","filter","InventorySourceFormFields","sourceOptions","organizationId","values","initialValues","resetForm","setFieldTouched","setFieldValue","name","validate","sourceField","sourceMeta","executionEnvironmentField","executionEnvironmentMeta","executionEnvironmentHelpers","resetSubFormFields","sourceType","description","defaults","credential","overwrite","overwrite_vars","source_path","source_project","source_script","source_vars","update_cache_timeout","update_on_launch","verbosity","enabled_var","enabled_value","host_filter","Object","keys","forEach","handleExecutionEnvironmentUpdate","error","touched","setTouched","isDisabled","event","includes","azure_rm","id","ec2","gce","insights","openstack","rhv","satellite6","scm","controller","vmware","InventorySourceForm","onCancel","onSubmit","submitError","summary_fields","execution_environment","readOptions","data","isSourceOptionsLoading","isLoading","sourceOptionsError","fetchSourceOptions","request","result","formik","handleSubmit","defaultProps"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { Formik, useField, useFormikContext } from 'formik';\nimport { func, shape } from 'prop-types';\nimport { t } from '@lingui/macro';\nimport { Form, FormGroup, Title } from '@patternfly/react-core';\nimport { InventorySourcesAPI } from 'api';\nimport useRequest from 'hooks/useRequest';\nimport { required } from 'util/validators';\nimport AnsibleSelect from 'components/AnsibleSelect';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport FormActionGroup from 'components/FormActionGroup/FormActionGroup';\nimport FormField, { FormSubmitError } from 'components/FormField';\nimport { FormColumnLayout, SubFormLayout } from 'components/FormLayout';\n\nimport { ExecutionEnvironmentLookup } from 'components/Lookup';\nimport {\n  AzureSubForm,\n  EC2SubForm,\n  GCESubForm,\n  InsightsSubForm,\n  OpenStackSubForm,\n  SCMSubForm,\n  SatelliteSubForm,\n  ControllerSubForm,\n  VMwareSubForm,\n  VirtualizationSubForm,\n} from './InventorySourceSubForms';\n\nconst buildSourceChoiceOptions = (options) => {\n  const sourceChoices = options.actions.GET.source.choices.map(\n    ([choice, label]) => ({ label, key: choice, value: choice })\n  );\n  return sourceChoices.filter(({ key }) => key !== 'file');\n};\n\nconst InventorySourceFormFields = ({\n  source,\n  sourceOptions,\n  organizationId,\n}) => {\n  const { values, initialValues, resetForm, setFieldTouched, setFieldValue } =\n    useFormikContext();\n  const [sourceField, sourceMeta] = useField({\n    name: 'source',\n    validate: required(t`Set a value for this field`),\n  });\n  const [\n    executionEnvironmentField,\n    executionEnvironmentMeta,\n    executionEnvironmentHelpers,\n  ] = useField('execution_environment');\n\n  const resetSubFormFields = (sourceType) => {\n    if (sourceType === initialValues.source) {\n      resetForm({\n        values: {\n          ...initialValues,\n          name: values.name,\n          description: values.description,\n          source: sourceType,\n        },\n      });\n    } else {\n      const defaults = {\n        credential: null,\n        overwrite: false,\n        overwrite_vars: false,\n        source: sourceType,\n        source_path: '',\n        source_project: null,\n        source_script: null,\n        source_vars: '---\\n',\n        update_cache_timeout: 0,\n        update_on_launch: false,\n        verbosity: 1,\n        enabled_var: '',\n        enabled_value: '',\n        host_filter: '',\n      };\n      Object.keys(defaults).forEach((label) => {\n        setFieldValue(label, defaults[label]);\n        setFieldTouched(label, false);\n      });\n    }\n  };\n\n  const handleExecutionEnvironmentUpdate = useCallback(\n    (value) => {\n      setFieldValue('execution_environment', value);\n      setFieldTouched('execution_environment', true, false);\n    },\n    [setFieldValue, setFieldTouched]\n  );\n\n  return (\n    <>\n      <FormField\n        id=\"name\"\n        label={t`Name`}\n        name=\"name\"\n        type=\"text\"\n        validate={required(null)}\n        isRequired\n      />\n      <FormField\n        id=\"description\"\n        label={t`Description`}\n        name=\"description\"\n        type=\"text\"\n      />\n      <ExecutionEnvironmentLookup\n        helperTextInvalid={executionEnvironmentMeta.error}\n        isValid={\n          !executionEnvironmentMeta.touched || !executionEnvironmentMeta.error\n        }\n        onBlur={() => executionEnvironmentHelpers.setTouched()}\n        value={executionEnvironmentField.value}\n        onChange={handleExecutionEnvironmentUpdate}\n        globallyAvailable\n        organizationId={organizationId}\n      />\n      <FormGroup\n        fieldId=\"source\"\n        helperTextInvalid={sourceMeta.error}\n        isRequired\n        validated={\n          !sourceMeta.touched || !sourceMeta.error ? 'default' : 'error'\n        }\n        label={t`Source`}\n      >\n        <AnsibleSelect\n          {...sourceField}\n          id=\"source\"\n          data={[\n            {\n              value: '',\n              key: '',\n              label: t`Choose a source`,\n              isDisabled: true,\n            },\n            ...buildSourceChoiceOptions(sourceOptions),\n          ]}\n          onChange={(event, value) => {\n            resetSubFormFields(value);\n          }}\n        />\n      </FormGroup>\n      {!['', 'custom'].includes(sourceField.value) && (\n        <SubFormLayout>\n          <Title size=\"md\" headingLevel=\"h4\">\n            {t`Source details`}\n          </Title>\n          <FormColumnLayout>\n            {\n              {\n                azure_rm: (\n                  <AzureSubForm\n                    autoPopulateCredential={\n                      !source?.id || source?.source !== 'azure_rm'\n                    }\n                    sourceOptions={sourceOptions}\n                  />\n                ),\n                ec2: <EC2SubForm sourceOptions={sourceOptions} />,\n                gce: (\n                  <GCESubForm\n                    autoPopulateCredential={\n                      !source?.id || source?.source !== 'gce'\n                    }\n                    sourceOptions={sourceOptions}\n                  />\n                ),\n                insights: (\n                  <InsightsSubForm\n                    autoPopulateCredential={\n                      !source?.id || source?.source !== 'insights'\n                    }\n                  />\n                ),\n                openstack: (\n                  <OpenStackSubForm\n                    autoPopulateCredential={\n                      !source?.id || source?.source !== 'openstack'\n                    }\n                  />\n                ),\n                rhv: (\n                  <VirtualizationSubForm\n                    autoPopulateCredential={\n                      !source?.id || source?.source !== 'rhv'\n                    }\n                  />\n                ),\n                satellite6: (\n                  <SatelliteSubForm\n                    autoPopulateCredential={\n                      !source?.id || source?.source !== 'satellite6'\n                    }\n                  />\n                ),\n                scm: (\n                  <SCMSubForm\n                    autoPopulateProject={\n                      !source?.id || source?.source !== 'scm'\n                    }\n                  />\n                ),\n                controller: (\n                  <ControllerSubForm\n                    autoPopulateCredential={\n                      !source?.id || source?.source !== 'controller'\n                    }\n                  />\n                ),\n                vmware: (\n                  <VMwareSubForm\n                    autoPopulateCredential={\n                      !source?.id || source?.source !== 'vmware'\n                    }\n                    sourceOptions={sourceOptions}\n                  />\n                ),\n              }[sourceField.value]\n            }\n          </FormColumnLayout>\n        </SubFormLayout>\n      )}\n    </>\n  );\n};\n\nconst InventorySourceForm = ({\n  onCancel,\n  onSubmit,\n  source,\n  submitError = null,\n  organizationId,\n}) => {\n  const initialValues = {\n    credential: source?.summary_fields?.credential || null,\n    description: source?.description || '',\n    name: source?.name || '',\n    overwrite: source?.overwrite || false,\n    overwrite_vars: source?.overwrite_vars || false,\n    source: source?.source || '',\n    source_path: source?.source_path || '',\n    source_project: source?.summary_fields?.source_project || null,\n    source_script: source?.summary_fields?.source_script || null,\n    source_vars: source?.source_vars || '---\\n',\n    update_cache_timeout: source?.update_cache_timeout || 0,\n    update_on_launch: source?.update_on_launch || false,\n    verbosity: source?.verbosity || 1,\n    enabled_var: source?.enabled_var || '',\n    enabled_value: source?.enabled_value || '',\n    host_filter: source?.host_filter || '',\n    execution_environment:\n      source?.summary_fields?.execution_environment || null,\n  };\n\n  const {\n    isLoading: isSourceOptionsLoading,\n    error: sourceOptionsError,\n    request: fetchSourceOptions,\n    result: sourceOptions,\n  } = useRequest(\n    useCallback(async () => {\n      const { data } = await InventorySourcesAPI.readOptions();\n      return data;\n    }, []),\n    null\n  );\n\n  useEffect(() => {\n    fetchSourceOptions();\n  }, [fetchSourceOptions]);\n\n  if (sourceOptionsError) {\n    return <ContentError error={sourceOptionsError} />;\n  }\n\n  if (!sourceOptions || isSourceOptionsLoading) {\n    return <ContentLoading />;\n  }\n\n  return (\n    <Formik\n      initialValues={initialValues}\n      onSubmit={(values) => {\n        onSubmit(values);\n      }}\n    >\n      {(formik) => (\n        <Form autoComplete=\"off\" onSubmit={formik.handleSubmit}>\n          <FormColumnLayout>\n            <InventorySourceFormFields\n              formik={formik}\n              source={source}\n              sourceOptions={sourceOptions}\n              organizationId={organizationId}\n            />\n            {submitError && <FormSubmitError error={submitError} />}\n            <FormActionGroup\n              onCancel={onCancel}\n              onSubmit={formik.handleSubmit}\n            />\n          </FormColumnLayout>\n        </Form>\n      )}\n    </Formik>\n  );\n};\n\nInventorySourceForm.propTypes = {\n  onCancel: func.isRequired,\n  onSubmit: func.isRequired,\n  submitError: shape({}),\n};\n\nInventorySourceForm.defaultProps = {\n  submitError: null,\n};\n\nexport default InventorySourceForm;\n"]},"metadata":{},"sourceType":"module"}