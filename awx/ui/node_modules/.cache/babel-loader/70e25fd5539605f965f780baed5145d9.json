{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState,useEffect}from'react';import{useHistory}from'react-router-dom';import{TeamsAPI,UsersAPI}from'api';import useSelected from'hooks/useSelected';import SelectableCard from'../SelectableCard';import Wizard from'../Wizard';import SelectResourceStep from'./SelectResourceStep';import SelectRoleStep from'./SelectRoleStep';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var readUsers=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(queryParams){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",UsersAPI.read(Object.assign(queryParams,{is_superuser:false})));case 1:case\"end\":return _context.stop();}}},_callee);}));return function readUsers(_x){return _ref.apply(this,arguments);};}();var readUsersOptions=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",UsersAPI.readOptions());case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function readUsersOptions(){return _ref2.apply(this,arguments);};}();var readTeams=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(queryParams){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",TeamsAPI.read(queryParams));case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function readTeams(_x2){return _ref3.apply(this,arguments);};}();var readTeamsOptions=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",TeamsAPI.readOptions());case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function readTeamsOptions(){return _ref4.apply(this,arguments);};}();var userSearchColumns=[{name:/*i18n*/i18n._(\"Username\"),key:'username__icontains',isDefault:true},{name:/*i18n*/i18n._(\"First Name\"),key:'first_name__icontains'},{name:/*i18n*/i18n._(\"Last Name\"),key:'last_name__icontains'}];var userSortColumns=[{name:/*i18n*/i18n._(\"Username\"),key:'username'},{name:/*i18n*/i18n._(\"First Name\"),key:'first_name'},{name:/*i18n*/i18n._(\"Last Name\"),key:'last_name'}];var teamSearchColumns=[{name:/*i18n*/i18n._(\"Name\"),key:'name',isDefault:true},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username'}];var teamSortColumns=[{name:/*i18n*/i18n._(\"Name\"),key:'name'}];function AddResourceRole(_ref5){var onSave=_ref5.onSave,onClose=_ref5.onClose,roles=_ref5.roles,resource=_ref5.resource,onError=_ref5.onError;var history=useHistory();var _useSelected=useSelected([]),resourcesSelected=_useSelected.selected,handleResourceSelect=_useSelected.handleSelect,clearResources=_useSelected.clearSelected;var _useSelected2=useSelected([]),rolesSelected=_useSelected2.selected,handleRoleSelect=_useSelected2.handleSelect,clearRoles=_useSelected2.clearSelected;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),resourceType=_useState2[0],setResourceType=_useState2[1];var _useState3=useState(1),_useState4=_slicedToArray(_useState3,2),currentStepId=_useState4[0],setCurrentStepId=_useState4[1];var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),maxEnabledStep=_useState6[0],setMaxEnabledStep=_useState6[1];useEffect(function(){if(currentStepId===1&&maxEnabledStep>1){history.push(history.location.pathname);}},[currentStepId,history,maxEnabledStep]);var handleResourceTypeSelect=function handleResourceTypeSelect(type){setResourceType(type);clearResources();clearRoles();};var handleWizardNext=function handleWizardNext(step){setCurrentStepId(step.id);setMaxEnabledStep(step.id);};var handleWizardGoToStep=function handleWizardGoToStep(step){setCurrentStepId(step.id);};var handleWizardSave=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var roleRequests,i,j;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;roleRequests=[];for(i=0;i<resourcesSelected.length;i++){for(j=0;j<rolesSelected.length;j++){if(resourceType==='users'){roleRequests.push(UsersAPI.associateRole(resourcesSelected[i].id,rolesSelected[j].id));}else if(resourceType==='teams'){roleRequests.push(TeamsAPI.associateRole(resourcesSelected[i].id,rolesSelected[j].id));}}}_context5.next=5;return Promise.all(roleRequests);case 5:onSave();_context5.next=12;break;case 8:_context5.prev=8;_context5.t0=_context5[\"catch\"](0);onError(_context5.t0);onClose();case 12:case\"end\":return _context5.stop();}}},_callee5,null,[[0,8]]);}));return function handleWizardSave(){return _ref6.apply(this,arguments);};}();// Object roles can be user only, so we remove them when\n// showing role choices for team access\nvar selectableRoles=_objectSpread({},roles);if(resourceType==='teams'){Object.keys(roles).forEach(function(key){if(selectableRoles[key].user_only){delete selectableRoles[key];}});}var wizardTitle='';switch(resourceType){case'users':wizardTitle=/*i18n*/i18n._(\"Add User Roles\");break;case'teams':wizardTitle=/*i18n*/i18n._(\"Add Team Roles\");break;default:wizardTitle=/*i18n*/i18n._(\"Add Roles\");}var steps=[{id:1,name:/*i18n*/i18n._(\"Select a Resource Type\"),component:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexWrap:'wrap'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',marginBottom:'10px'},children:/*i18n*/i18n._(\"Choose the type of resource that will be receiving new roles.  For example, if you'd like to add new roles to a set of users please choose Users and click Next.  You'll be able to select the specific resources in the next step.\")}),/*#__PURE__*/_jsx(SelectableCard,{isSelected:resourceType==='users',label:/*i18n*/i18n._(\"Users\"),ariaLabel:/*i18n*/i18n._(\"Users\"),dataCy:\"add-role-users\",onClick:function onClick(){return handleResourceTypeSelect('users');}}),(resource===null||resource===void 0?void 0:resource.type)==='team'||(resource===null||resource===void 0?void 0:resource.type)==='credential'&&!(resource!==null&&resource!==void 0&&resource.organization)?null:/*#__PURE__*/_jsx(SelectableCard,{isSelected:resourceType==='teams',label:/*i18n*/i18n._(\"Teams\"),ariaLabel:/*i18n*/i18n._(\"Teams\"),dataCy:\"add-role-teams\",onClick:function onClick(){return handleResourceTypeSelect('teams');}})]}),nextButtonText:/*i18n*/i18n._(\"Next\"),enableNext:resourceType!==null},{id:2,name:/*i18n*/i18n._(\"Select Items from List\"),component:/*#__PURE__*/_jsxs(_Fragment,{children:[resourceType==='users'&&/*#__PURE__*/_jsx(SelectResourceStep,{searchColumns:userSearchColumns,sortColumns:userSortColumns,displayKey:\"username\",onRowClick:handleResourceSelect,fetchItems:readUsers,fetchOptions:readUsersOptions,selectedLabel:/*i18n*/i18n._(\"Selected\"),selectedResourceRows:resourcesSelected,sortedColumnKey:\"username\"}),resourceType==='teams'&&/*#__PURE__*/_jsx(SelectResourceStep,{searchColumns:teamSearchColumns,sortColumns:teamSortColumns,onRowClick:handleResourceSelect,fetchItems:readTeams,fetchOptions:readTeamsOptions,selectedLabel:/*i18n*/i18n._(\"Selected\"),selectedResourceRows:resourcesSelected})]}),enableNext:resourcesSelected.length>0,nextButtonText:/*i18n*/i18n._(\"Next\"),canJumpTo:maxEnabledStep>=2},{id:3,name:/*i18n*/i18n._(\"Select Roles to Apply\"),component:/*#__PURE__*/_jsx(SelectRoleStep,{onRolesClick:handleRoleSelect,roles:selectableRoles,selectedListKey:resourceType==='users'?'username':'name',selectedListLabel:/*i18n*/i18n._(\"Selected\"),selectedResourceRows:resourcesSelected,selectedRoleRows:rolesSelected}),nextButtonText:/*i18n*/i18n._(\"Save\"),enableNext:rolesSelected.length>0,canJumpTo:maxEnabledStep>=3}];var currentStep=steps.find(function(step){return step.id===currentStepId;});return/*#__PURE__*/_jsx(Wizard,{style:{overflow:'scroll'},isOpen:true,onNext:handleWizardNext,onBack:function onBack(step){return setCurrentStepId(step.id);},onClose:onClose,onSave:handleWizardSave,onGoToStep:function onGoToStep(step){return handleWizardGoToStep(step);},steps:steps,title:wizardTitle,nextButtonText:currentStep.nextButtonText||undefined,backButtonText:/*i18n*/i18n._(\"Back\"),cancelButtonText:/*i18n*/i18n._(\"Cancel\")});}AddResourceRole.defaultProps={roles:{},resource:{}};export{AddResourceRole as _AddResourceRole};export default AddResourceRole;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/AddRole/AddResourceRole.js"],"names":["React","useState","useEffect","useHistory","TeamsAPI","UsersAPI","useSelected","SelectableCard","Wizard","SelectResourceStep","SelectRoleStep","readUsers","queryParams","read","Object","assign","is_superuser","readUsersOptions","readOptions","readTeams","readTeamsOptions","userSearchColumns","name","key","isDefault","userSortColumns","teamSearchColumns","teamSortColumns","AddResourceRole","onSave","onClose","roles","resource","onError","history","resourcesSelected","selected","handleResourceSelect","handleSelect","clearResources","clearSelected","rolesSelected","handleRoleSelect","clearRoles","resourceType","setResourceType","currentStepId","setCurrentStepId","maxEnabledStep","setMaxEnabledStep","push","location","pathname","handleResourceTypeSelect","type","handleWizardNext","step","id","handleWizardGoToStep","handleWizardSave","roleRequests","i","length","j","associateRole","Promise","all","selectableRoles","keys","forEach","user_only","wizardTitle","steps","component","display","flexWrap","width","marginBottom","organization","nextButtonText","enableNext","canJumpTo","currentStep","find","overflow","undefined","defaultProps","_AddResourceRole"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { useHistory } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport { TeamsAPI, UsersAPI } from 'api';\nimport useSelected from 'hooks/useSelected';\nimport SelectableCard from '../SelectableCard';\nimport Wizard from '../Wizard';\nimport SelectResourceStep from './SelectResourceStep';\nimport SelectRoleStep from './SelectRoleStep';\n\nconst readUsers = async (queryParams) =>\n  UsersAPI.read(Object.assign(queryParams, { is_superuser: false }));\n\nconst readUsersOptions = async () => UsersAPI.readOptions();\n\nconst readTeams = async (queryParams) => TeamsAPI.read(queryParams);\n\nconst readTeamsOptions = async () => TeamsAPI.readOptions();\n\nconst userSearchColumns = [\n  {\n    name: t`Username`,\n    key: 'username__icontains',\n    isDefault: true,\n  },\n  {\n    name: t`First Name`,\n    key: 'first_name__icontains',\n  },\n  {\n    name: t`Last Name`,\n    key: 'last_name__icontains',\n  },\n];\nconst userSortColumns = [\n  {\n    name: t`Username`,\n    key: 'username',\n  },\n  {\n    name: t`First Name`,\n    key: 'first_name',\n  },\n  {\n    name: t`Last Name`,\n    key: 'last_name',\n  },\n];\nconst teamSearchColumns = [\n  {\n    name: t`Name`,\n    key: 'name',\n    isDefault: true,\n  },\n  {\n    name: t`Created By (Username)`,\n    key: 'created_by__username',\n  },\n  {\n    name: t`Modified By (Username)`,\n    key: 'modified_by__username',\n  },\n];\n\nconst teamSortColumns = [\n  {\n    name: t`Name`,\n    key: 'name',\n  },\n];\nfunction AddResourceRole({ onSave, onClose, roles, resource, onError }) {\n  const history = useHistory();\n\n  const {\n    selected: resourcesSelected,\n    handleSelect: handleResourceSelect,\n    clearSelected: clearResources,\n  } = useSelected([]);\n  const {\n    selected: rolesSelected,\n    handleSelect: handleRoleSelect,\n    clearSelected: clearRoles,\n  } = useSelected([]);\n\n  const [resourceType, setResourceType] = useState(null);\n  const [currentStepId, setCurrentStepId] = useState(1);\n  const [maxEnabledStep, setMaxEnabledStep] = useState(1);\n\n  useEffect(() => {\n    if (currentStepId === 1 && maxEnabledStep > 1) {\n      history.push(history.location.pathname);\n    }\n  }, [currentStepId, history, maxEnabledStep]);\n\n  const handleResourceTypeSelect = (type) => {\n    setResourceType(type);\n    clearResources();\n    clearRoles();\n  };\n\n  const handleWizardNext = (step) => {\n    setCurrentStepId(step.id);\n    setMaxEnabledStep(step.id);\n  };\n\n  const handleWizardGoToStep = (step) => {\n    setCurrentStepId(step.id);\n  };\n\n  const handleWizardSave = async () => {\n    try {\n      const roleRequests = [];\n\n      for (let i = 0; i < resourcesSelected.length; i++) {\n        for (let j = 0; j < rolesSelected.length; j++) {\n          if (resourceType === 'users') {\n            roleRequests.push(\n              UsersAPI.associateRole(\n                resourcesSelected[i].id,\n                rolesSelected[j].id\n              )\n            );\n          } else if (resourceType === 'teams') {\n            roleRequests.push(\n              TeamsAPI.associateRole(\n                resourcesSelected[i].id,\n                rolesSelected[j].id\n              )\n            );\n          }\n        }\n      }\n\n      await Promise.all(roleRequests);\n      onSave();\n    } catch (err) {\n      onError(err);\n      onClose();\n    }\n  };\n\n  // Object roles can be user only, so we remove them when\n  // showing role choices for team access\n  const selectableRoles = { ...roles };\n  if (resourceType === 'teams') {\n    Object.keys(roles).forEach((key) => {\n      if (selectableRoles[key].user_only) {\n        delete selectableRoles[key];\n      }\n    });\n  }\n\n  let wizardTitle = '';\n\n  switch (resourceType) {\n    case 'users':\n      wizardTitle = t`Add User Roles`;\n      break;\n    case 'teams':\n      wizardTitle = t`Add Team Roles`;\n      break;\n    default:\n      wizardTitle = t`Add Roles`;\n  }\n\n  const steps = [\n    {\n      id: 1,\n      name: t`Select a Resource Type`,\n      component: (\n        <div style={{ display: 'flex', flexWrap: 'wrap' }}>\n          <div style={{ width: '100%', marginBottom: '10px' }}>\n            {t`Choose the type of resource that will be receiving new roles.  For example, if you'd like to add new roles to a set of users please choose Users and click Next.  You'll be able to select the specific resources in the next step.`}\n          </div>\n          <SelectableCard\n            isSelected={resourceType === 'users'}\n            label={t`Users`}\n            ariaLabel={t`Users`}\n            dataCy=\"add-role-users\"\n            onClick={() => handleResourceTypeSelect('users')}\n          />\n          {resource?.type === 'team' ||\n          (resource?.type === 'credential' &&\n            !resource?.organization) ? null : (\n            <SelectableCard\n              isSelected={resourceType === 'teams'}\n              label={t`Teams`}\n              ariaLabel={t`Teams`}\n              dataCy=\"add-role-teams\"\n              onClick={() => handleResourceTypeSelect('teams')}\n            />\n          )}\n        </div>\n      ),\n      nextButtonText: t`Next`,\n      enableNext: resourceType !== null,\n    },\n    {\n      id: 2,\n      name: t`Select Items from List`,\n      component: (\n        <>\n          {resourceType === 'users' && (\n            <SelectResourceStep\n              searchColumns={userSearchColumns}\n              sortColumns={userSortColumns}\n              displayKey=\"username\"\n              onRowClick={handleResourceSelect}\n              fetchItems={readUsers}\n              fetchOptions={readUsersOptions}\n              selectedLabel={t`Selected`}\n              selectedResourceRows={resourcesSelected}\n              sortedColumnKey=\"username\"\n            />\n          )}\n          {resourceType === 'teams' && (\n            <SelectResourceStep\n              searchColumns={teamSearchColumns}\n              sortColumns={teamSortColumns}\n              onRowClick={handleResourceSelect}\n              fetchItems={readTeams}\n              fetchOptions={readTeamsOptions}\n              selectedLabel={t`Selected`}\n              selectedResourceRows={resourcesSelected}\n            />\n          )}\n        </>\n      ),\n      enableNext: resourcesSelected.length > 0,\n      nextButtonText: t`Next`,\n      canJumpTo: maxEnabledStep >= 2,\n    },\n    {\n      id: 3,\n      name: t`Select Roles to Apply`,\n      component: (\n        <SelectRoleStep\n          onRolesClick={handleRoleSelect}\n          roles={selectableRoles}\n          selectedListKey={resourceType === 'users' ? 'username' : 'name'}\n          selectedListLabel={t`Selected`}\n          selectedResourceRows={resourcesSelected}\n          selectedRoleRows={rolesSelected}\n        />\n      ),\n      nextButtonText: t`Save`,\n      enableNext: rolesSelected.length > 0,\n      canJumpTo: maxEnabledStep >= 3,\n    },\n  ];\n\n  const currentStep = steps.find((step) => step.id === currentStepId);\n\n  return (\n    <Wizard\n      style={{ overflow: 'scroll' }}\n      isOpen\n      onNext={handleWizardNext}\n      onBack={(step) => setCurrentStepId(step.id)}\n      onClose={onClose}\n      onSave={handleWizardSave}\n      onGoToStep={(step) => handleWizardGoToStep(step)}\n      steps={steps}\n      title={wizardTitle}\n      nextButtonText={currentStep.nextButtonText || undefined}\n      backButtonText={t`Back`}\n      cancelButtonText={t`Cancel`}\n    />\n  );\n}\n\nAddResourceRole.propTypes = {\n  onClose: PropTypes.func.isRequired,\n  onSave: PropTypes.func.isRequired,\n  roles: PropTypes.shape(),\n  resource: PropTypes.shape(),\n};\n\nAddResourceRole.defaultProps = {\n  roles: {},\n  resource: {},\n};\n\nexport { AddResourceRole as _AddResourceRole };\nexport default AddResourceRole;\n"]},"metadata":{},"sourceType":"module"}