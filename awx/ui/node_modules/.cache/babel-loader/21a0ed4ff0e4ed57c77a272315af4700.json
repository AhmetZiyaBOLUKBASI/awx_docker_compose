{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback,useState}from'react';import{useLocation}from'react-router-dom';import DataListToolbar from'components/DataListToolbar';import PaginatedTable,{HeaderRow,HeaderCell}from'components/PaginatedTable';import useRequest from'hooks/useRequest';import useSelected from'hooks/useSelected';import{getQSConfig,parseQueryString}from'util/qs';import{InventoriesAPI}from'api';import{Inventory}from'types';import AdHocCommands from'components/AdHocCommands/AdHocCommands';import SmartInventoryHostListItem from'./SmartInventoryHostListItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('host',{page:1,page_size:20,order_by:'name'});function SmartInventoryHostList(_ref){var inventory=_ref.inventory;var location=useLocation();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isAdHocLaunchLoading=_useState2[0],setIsAdHocLaunchLoading=_useState2[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var params,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,results,hostCount,adHocOptions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,location.search);_context.next=3;return Promise.all([InventoriesAPI.readHosts(inventory.id,params),InventoriesAPI.readAdHocOptions(inventory.id)]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);_yield$Promise$all2$=_yield$Promise$all2[0].data;results=_yield$Promise$all2$.results;hostCount=_yield$Promise$all2$.count;adHocOptions=_yield$Promise$all2[1];return _context.abrupt(\"return\",{hosts:results,count:hostCount,moduleOptions:adHocOptions.data.actions.GET.module_name.choices});case 10:case\"end\":return _context.stop();}}},_callee);})),[location.search,inventory.id]),{hosts:[],count:0,moduleOptions:[]}),_useRequest$result=_useRequest.result,hosts=_useRequest$result.hosts,count=_useRequest$result.count,moduleOptions=_useRequest$result.moduleOptions,contentError=_useRequest.error,isLoading=_useRequest.isLoading,fetchHosts=_useRequest.request;var _useSelected=useSelected(hosts),selected=_useSelected.selected,isAllSelected=_useSelected.isAllSelected,handleSelect=_useSelected.handleSelect,clearSelected=_useSelected.clearSelected,selectAll=_useSelected.selectAll;useEffect(function(){fetchHosts();},[fetchHosts]);return/*#__PURE__*/_jsx(PaginatedTable,{contentError:contentError,hasContentLoading:isLoading||isAdHocLaunchLoading,items:hosts,itemCount:count,pluralizedItemName:/*i18n*/i18n._(\"Hosts\"),qsConfig:QS_CONFIG,clearSelected:clearSelected,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Created by (username)\"),key:'created_by__username'},{name:/*i18n*/i18n._(\"Modified by (username)\"),key:'modified_by__username'}],renderToolbar:function renderToolbar(props){var _inventory$summary_fi,_inventory$summary_fi2;return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{isAllSelected:isAllSelected,onSelectAll:selectAll,qsConfig:QS_CONFIG,additionalControls:inventory!==null&&inventory!==void 0&&(_inventory$summary_fi=inventory.summary_fields)!==null&&_inventory$summary_fi!==void 0&&(_inventory$summary_fi2=_inventory$summary_fi.user_capabilities)!==null&&_inventory$summary_fi2!==void 0&&_inventory$summary_fi2.adhoc?[/*#__PURE__*/_jsx(AdHocCommands,{adHocItems:selected,hasListItems:count>0,onLaunchLoading:setIsAdHocLaunchLoading,moduleOptions:moduleOptions})]:[]}));},headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Recent jobs\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Inventory\")})]}),renderRow:function renderRow(host,index){return/*#__PURE__*/_jsx(SmartInventoryHostListItem,{host:host,detailUrl:\"/inventories/smart_inventory/\".concat(inventory.id,\"/hosts/\").concat(host.id,\"/details\"),isSelected:selected.some(function(row){return row.id===host.id;}),onSelect:function onSelect(){return handleSelect(host);},rowIndex:index},host.id);}});}export default SmartInventoryHostList;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Inventory/SmartInventoryHosts/SmartInventoryHostList.js"],"names":["React","useEffect","useCallback","useState","useLocation","DataListToolbar","PaginatedTable","HeaderRow","HeaderCell","useRequest","useSelected","getQSConfig","parseQueryString","InventoriesAPI","Inventory","AdHocCommands","SmartInventoryHostListItem","QS_CONFIG","page","page_size","order_by","SmartInventoryHostList","inventory","location","isAdHocLaunchLoading","setIsAdHocLaunchLoading","params","search","Promise","all","readHosts","id","readAdHocOptions","data","results","hostCount","count","adHocOptions","hosts","moduleOptions","actions","GET","module_name","choices","result","contentError","error","isLoading","fetchHosts","request","selected","isAllSelected","handleSelect","clearSelected","selectAll","name","key","isDefault","props","summary_fields","user_capabilities","adhoc","host","index","some","row"],"mappings":"6bAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,WAA3B,CAAwCC,QAAxC,KAAwD,OAAxD,CACA,OAASC,WAAT,KAA4B,kBAA5B,CAGA,MAAOC,CAAAA,eAAP,KAA4B,4BAA5B,CACA,MAAOC,CAAAA,cAAP,EACEC,SADF,CAEEC,UAFF,KAGO,2BAHP,CAIA,MAAOC,CAAAA,UAAP,KAAuB,kBAAvB,CACA,MAAOC,CAAAA,WAAP,KAAwB,mBAAxB,CACA,OAASC,WAAT,CAAsBC,gBAAtB,KAA8C,SAA9C,CACA,OAASC,cAAT,KAA+B,KAA/B,CACA,OAASC,SAAT,KAA0B,OAA1B,CACA,MAAOC,CAAAA,aAAP,KAA0B,wCAA1B,CACA,MAAOC,CAAAA,0BAAP,KAAuC,8BAAvC,C,wFAEA,GAAMC,CAAAA,SAAS,CAAGN,WAAW,CAAC,MAAD,CAAS,CACpCO,IAAI,CAAE,CAD8B,CAEpCC,SAAS,CAAE,EAFyB,CAGpCC,QAAQ,CAAE,MAH0B,CAAT,CAA7B,CAMA,QAASC,CAAAA,sBAAT,MAA+C,IAAbC,CAAAA,SAAa,MAAbA,SAAa,CAC7C,GAAMC,CAAAA,QAAQ,CAAGnB,WAAW,EAA5B,CACA,cAAwDD,QAAQ,CAAC,KAAD,CAAhE,wCAAOqB,oBAAP,eAA6BC,uBAA7B,eACA,gBAKIhB,UAAU,CACZP,WAAW,sEAAC,yOACJwB,MADI,CACKd,gBAAgB,CAACK,SAAD,CAAYM,QAAQ,CAACI,MAArB,CADrB,uBAOAC,CAAAA,OAAO,CAACC,GAAR,CAAY,CACpBhB,cAAc,CAACiB,SAAf,CAAyBR,SAAS,CAACS,EAAnC,CAAuCL,MAAvC,CADoB,CAEpBb,cAAc,CAACmB,gBAAf,CAAgCV,SAAS,CAACS,EAA1C,CAFoB,CAAZ,CAPA,8IAINE,IAJM,CAIEC,OAJF,sBAIEA,OAJF,CAIkBC,SAJlB,sBAIWC,KAJX,CAMRC,YANQ,wDAYH,CACLC,KAAK,CAAEJ,OADF,CAELE,KAAK,CAAED,SAFF,CAGLI,aAAa,CAAEF,YAAY,CAACJ,IAAb,CAAkBO,OAAlB,CAA0BC,GAA1B,CAA8BC,WAA9B,CAA0CC,OAHpD,CAZG,yDAAD,GAiBR,CAACpB,QAAQ,CAACI,MAAV,CAAkBL,SAAS,CAACS,EAA5B,CAjBQ,CADC,CAmBZ,CACEO,KAAK,CAAE,EADT,CAEEF,KAAK,CAAE,CAFT,CAGEG,aAAa,CAAE,EAHjB,CAnBY,CALd,gCACEK,MADF,CACYN,KADZ,oBACYA,KADZ,CACmBF,KADnB,oBACmBA,KADnB,CAC0BG,aAD1B,oBAC0BA,aAD1B,CAESM,YAFT,aAEEC,KAFF,CAGEC,SAHF,aAGEA,SAHF,CAIWC,UAJX,aAIEC,OAJF,CA+BA,iBACEvC,WAAW,CAAC4B,KAAD,CADb,CAAQY,QAAR,cAAQA,QAAR,CAAkBC,aAAlB,cAAkBA,aAAlB,CAAiCC,YAAjC,cAAiCA,YAAjC,CAA+CC,aAA/C,cAA+CA,aAA/C,CAA8DC,SAA9D,cAA8DA,SAA9D,CAGArD,SAAS,CAAC,UAAM,CACd+C,UAAU,GACX,CAFQ,CAEN,CAACA,UAAD,CAFM,CAAT,CAIA,mBACE,KAAC,cAAD,EACE,YAAY,CAAEH,YADhB,CAEE,iBAAiB,CAAEE,SAAS,EAAIvB,oBAFlC,CAGE,KAAK,CAAEc,KAHT,CAIE,SAAS,CAAEF,KAJb,CAKE,kBAAkB,SAAE,eALtB,CAME,QAAQ,CAAEnB,SANZ,CAOE,aAAa,CAAEoC,aAPjB,CAQE,oBAAoB,CAAE,CACpB,CACEE,IAAI,SAAE,cADR,CAEEC,GAAG,CAAE,iBAFP,CAGEC,SAAS,CAAE,IAHb,CADoB,CAMpB,CACEF,IAAI,SAAE,+BADR,CAEEC,GAAG,CAAE,sBAFP,CANoB,CAUpB,CACED,IAAI,SAAE,gCADR,CAEEC,GAAG,CAAE,uBAFP,CAVoB,CARxB,CAuBE,aAAa,CAAE,uBAACE,KAAD,sEACb,KAAC,eAAD,gCACMA,KADN,MAEE,aAAa,CAAEP,aAFjB,CAGE,WAAW,CAAEG,SAHf,CAIE,QAAQ,CAAErC,SAJZ,CAKE,kBAAkB,CAChBK,SAAS,OAAT,EAAAA,SAAS,SAAT,yBAAAA,SAAS,CAAEqC,cAAX,wFAA2BC,iBAA3B,kEAA8CC,KAA9C,CACI,cACE,KAAC,aAAD,EACE,UAAU,CAAEX,QADd,CAEE,YAAY,CAAEd,KAAK,CAAG,CAFxB,CAGE,eAAe,CAAEX,uBAHnB,CAIE,aAAa,CAAEc,aAJjB,EADF,CADJ,CASI,EAfR,GADa,EAvBjB,CA2CE,SAAS,cACP,MAAC,SAAD,EAAW,QAAQ,CAAEtB,SAArB,wBACE,KAAC,UAAD,EAAY,OAAO,CAAC,MAApB,kBAA4B,cAA5B,EADF,cAEE,KAAC,UAAD,mBAAa,qBAAb,EAFF,cAGE,KAAC,UAAD,mBAAa,mBAAb,EAHF,GA5CJ,CAkDE,SAAS,CAAE,mBAAC6C,IAAD,CAAOC,KAAP,qBACT,KAAC,0BAAD,EAEE,IAAI,CAAED,IAFR,CAGE,SAAS,wCAAkCxC,SAAS,CAACS,EAA5C,mBAAwD+B,IAAI,CAAC/B,EAA7D,YAHX,CAIE,UAAU,CAAEmB,QAAQ,CAACc,IAAT,CAAc,SAACC,GAAD,QAASA,CAAAA,GAAG,CAAClC,EAAJ,GAAW+B,IAAI,CAAC/B,EAAzB,EAAd,CAJd,CAKE,QAAQ,CAAE,0BAAMqB,CAAAA,YAAY,CAACU,IAAD,CAAlB,EALZ,CAME,QAAQ,CAAEC,KANZ,EACOD,IAAI,CAAC/B,EADZ,CADS,EAlDb,EADF,CA+DD,CAMD,cAAeV,CAAAA,sBAAf","sourcesContent":["import React, { useEffect, useCallback, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\n\nimport { t } from '@lingui/macro';\nimport DataListToolbar from 'components/DataListToolbar';\nimport PaginatedTable, {\n  HeaderRow,\n  HeaderCell,\n} from 'components/PaginatedTable';\nimport useRequest from 'hooks/useRequest';\nimport useSelected from 'hooks/useSelected';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport { InventoriesAPI } from 'api';\nimport { Inventory } from 'types';\nimport AdHocCommands from 'components/AdHocCommands/AdHocCommands';\nimport SmartInventoryHostListItem from './SmartInventoryHostListItem';\n\nconst QS_CONFIG = getQSConfig('host', {\n  page: 1,\n  page_size: 20,\n  order_by: 'name',\n});\n\nfunction SmartInventoryHostList({ inventory }) {\n  const location = useLocation();\n  const [isAdHocLaunchLoading, setIsAdHocLaunchLoading] = useState(false);\n  const {\n    result: { hosts, count, moduleOptions },\n    error: contentError,\n    isLoading,\n    request: fetchHosts,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, location.search);\n      const [\n        {\n          data: { results, count: hostCount },\n        },\n        adHocOptions,\n      ] = await Promise.all([\n        InventoriesAPI.readHosts(inventory.id, params),\n        InventoriesAPI.readAdHocOptions(inventory.id),\n      ]);\n\n      return {\n        hosts: results,\n        count: hostCount,\n        moduleOptions: adHocOptions.data.actions.GET.module_name.choices,\n      };\n    }, [location.search, inventory.id]),\n    {\n      hosts: [],\n      count: 0,\n      moduleOptions: [],\n    }\n  );\n\n  const { selected, isAllSelected, handleSelect, clearSelected, selectAll } =\n    useSelected(hosts);\n\n  useEffect(() => {\n    fetchHosts();\n  }, [fetchHosts]);\n\n  return (\n    <PaginatedTable\n      contentError={contentError}\n      hasContentLoading={isLoading || isAdHocLaunchLoading}\n      items={hosts}\n      itemCount={count}\n      pluralizedItemName={t`Hosts`}\n      qsConfig={QS_CONFIG}\n      clearSelected={clearSelected}\n      toolbarSearchColumns={[\n        {\n          name: t`Name`,\n          key: 'name__icontains',\n          isDefault: true,\n        },\n        {\n          name: t`Created by (username)`,\n          key: 'created_by__username',\n        },\n        {\n          name: t`Modified by (username)`,\n          key: 'modified_by__username',\n        },\n      ]}\n      renderToolbar={(props) => (\n        <DataListToolbar\n          {...props}\n          isAllSelected={isAllSelected}\n          onSelectAll={selectAll}\n          qsConfig={QS_CONFIG}\n          additionalControls={\n            inventory?.summary_fields?.user_capabilities?.adhoc\n              ? [\n                  <AdHocCommands\n                    adHocItems={selected}\n                    hasListItems={count > 0}\n                    onLaunchLoading={setIsAdHocLaunchLoading}\n                    moduleOptions={moduleOptions}\n                  />,\n                ]\n              : []\n          }\n        />\n      )}\n      headerRow={\n        <HeaderRow qsConfig={QS_CONFIG}>\n          <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n          <HeaderCell>{t`Recent jobs`}</HeaderCell>\n          <HeaderCell>{t`Inventory`}</HeaderCell>\n        </HeaderRow>\n      }\n      renderRow={(host, index) => (\n        <SmartInventoryHostListItem\n          key={host.id}\n          host={host}\n          detailUrl={`/inventories/smart_inventory/${inventory.id}/hosts/${host.id}/details`}\n          isSelected={selected.some((row) => row.id === host.id)}\n          onSelect={() => handleSelect(host)}\n          rowIndex={index}\n        />\n      )}\n    />\n  );\n}\n\nSmartInventoryHostList.propTypes = {\n  inventory: Inventory.isRequired,\n};\n\nexport default SmartInventoryHostList;\n"]},"metadata":{},"sourceType":"module"}