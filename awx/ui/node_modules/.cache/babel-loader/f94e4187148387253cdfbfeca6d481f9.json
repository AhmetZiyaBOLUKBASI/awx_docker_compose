{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{Link,useHistory}from'react-router-dom';import{Button,Chip,Label}from'@patternfly/react-core';import{Inventory}from'types';import{InventoriesAPI,UnifiedJobsAPI}from'api';import useRequest,{useDismissableError}from'hooks/useRequest';import AlertModal from'components/AlertModal';import{CardBody,CardActionsRow}from'components/Card';import ChipGroup from'components/ChipGroup';import{VariablesDetail}from'components/CodeEditor';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import DeleteButton from'components/DeleteButton';import{DetailList,Detail,UserDateDetail}from'components/DetailList';import ErrorDetail from'components/ErrorDetail';import Sparkline from'components/Sparkline';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function SmartInventoryDetail(_ref){var inventory=_ref.inventory;var history=useHistory();var created=inventory.created,description=inventory.description,host_filter=inventory.host_filter,id=inventory.id,modified=inventory.modified,name=inventory.name,total_hosts=inventory.total_hosts,variables=inventory.variables,_inventory$summary_fi=inventory.summary_fields,created_by=_inventory$summary_fi.created_by,modified_by=_inventory$summary_fi.modified_by,organization=_inventory$summary_fi.organization,user_capabilities=_inventory$summary_fi.user_capabilities;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var params,_yield$Promise$all,_yield$Promise$all2,jobData,igData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params={or__job__inventory:id,or__workflowjob__inventory:id,order_by:'-finished',page_size:10};_context.next=3;return Promise.all([UnifiedJobsAPI.read(params),InventoriesAPI.readInstanceGroups(id)]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);jobData=_yield$Promise$all2[0].data;igData=_yield$Promise$all2[1].data;return _context.abrupt(\"return\",{recentJobs:jobData.results,instanceGroups:igData.results});case 8:case\"end\":return _context.stop();}}},_callee);})),[id]),{recentJobs:[],instanceGroups:[]}),contentError=_useRequest.error,hasContentLoading=_useRequest.isLoading,fetchData=_useRequest.request,_useRequest$result=_useRequest.result,recentJobs=_useRequest$result.recentJobs,instanceGroups=_useRequest$result.instanceGroups;useEffect(function(){fetchData();},[fetchData]);var _useRequest2=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return InventoriesAPI.destroy(id);case 2:history.push(\"/inventories\");case 3:case\"end\":return _context2.stop();}}},_callee2);})),[id,history])),deleteError=_useRequest2.error,isLoading=_useRequest2.isLoading,handleDelete=_useRequest2.request;var _useDismissableError=useDismissableError(deleteError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;if(hasContentLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}if(contentError){return/*#__PURE__*/_jsx(ContentError,{error:contentError});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(CardBody,{children:[/*#__PURE__*/_jsxs(DetailList,{children:[/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Name\"),value:name}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Activity\"),value:/*#__PURE__*/_jsx(Sparkline,{jobs:recentJobs}),isEmpty:recentJobs.length===0}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Description\"),value:description}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Type\"),value:/*i18n*/i18n._(\"Smart inventory\")}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Organization\"),value:/*#__PURE__*/_jsx(Link,{to:\"/organizations/\".concat(organization.id,\"/details\"),children:organization.name})}),/*#__PURE__*/_jsx(Detail,{fullWidth:true,label:/*i18n*/i18n._(\"Smart host filter\"),value:/*#__PURE__*/_jsx(Label,{variant:\"outline\",children:host_filter})}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Total hosts\"),value:total_hosts}),/*#__PURE__*/_jsx(Detail,{fullWidth:true,label:/*i18n*/i18n._(\"Instance groups\"),value:/*#__PURE__*/_jsx(ChipGroup,{numChips:5,totalChips:instanceGroups.length,ouiaId:\"instance-group-chips\",children:instanceGroups.map(function(ig){return/*#__PURE__*/_jsx(Chip,{isReadOnly:true,ouiaId:\"instance-group-\".concat(ig.id,\"-chip\"),children:ig.name},ig.id);})}),isEmpty:instanceGroups.length===0}),/*#__PURE__*/_jsx(VariablesDetail,{label:/*i18n*/i18n._(\"Variables\"),value:variables,rows:4,name:\"variables\",dataCy:\"smart-inventory-detail-variables\"}),/*#__PURE__*/_jsx(UserDateDetail,{label:/*i18n*/i18n._(\"Created\"),date:created,user:created_by}),/*#__PURE__*/_jsx(UserDateDetail,{label:/*i18n*/i18n._(\"Last modified\"),date:modified,user:modified_by})]}),/*#__PURE__*/_jsxs(CardActionsRow,{children:[(user_capabilities===null||user_capabilities===void 0?void 0:user_capabilities.edit)&&/*#__PURE__*/_jsx(Button,{ouiaId:\"smart-inventory-detail-edit-button\",component:Link,\"aria-label\":/*i18n*/i18n._(\"edit\"),to:\"/inventories/smart_inventory/\".concat(id,\"/edit\"),children:/*i18n*/i18n._(\"Edit\")}),(user_capabilities===null||user_capabilities===void 0?void 0:user_capabilities.delete)&&/*#__PURE__*/_jsx(DeleteButton,{name:name,modalTitle:/*i18n*/i18n._(\"Delete smart inventory\"),onConfirm:handleDelete,isDisabled:isLoading,children:/*i18n*/i18n._(\"Delete\")})]})]}),error&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:error,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:dismissError,children:[/*i18n*/i18n._(\"Failed to delete smart inventory.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]})]});}export default SmartInventoryDetail;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Inventory/SmartInventoryDetail/SmartInventoryDetail.js"],"names":["React","useCallback","useEffect","Link","useHistory","Button","Chip","Label","Inventory","InventoriesAPI","UnifiedJobsAPI","useRequest","useDismissableError","AlertModal","CardBody","CardActionsRow","ChipGroup","VariablesDetail","ContentError","ContentLoading","DeleteButton","DetailList","Detail","UserDateDetail","ErrorDetail","Sparkline","SmartInventoryDetail","inventory","history","created","description","host_filter","id","modified","name","total_hosts","variables","summary_fields","created_by","modified_by","organization","user_capabilities","params","or__job__inventory","or__workflowjob__inventory","order_by","page_size","Promise","all","read","readInstanceGroups","jobData","data","igData","recentJobs","results","instanceGroups","contentError","error","hasContentLoading","isLoading","fetchData","request","result","destroy","push","deleteError","handleDelete","dismissError","length","map","ig","edit","delete"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { Link, useHistory } from 'react-router-dom';\n\nimport { t } from '@lingui/macro';\nimport { Button, Chip, Label } from '@patternfly/react-core';\n\nimport { Inventory } from 'types';\nimport { InventoriesAPI, UnifiedJobsAPI } from 'api';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\n\nimport AlertModal from 'components/AlertModal';\nimport { CardBody, CardActionsRow } from 'components/Card';\nimport ChipGroup from 'components/ChipGroup';\nimport { VariablesDetail } from 'components/CodeEditor';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport DeleteButton from 'components/DeleteButton';\nimport { DetailList, Detail, UserDateDetail } from 'components/DetailList';\nimport ErrorDetail from 'components/ErrorDetail';\nimport Sparkline from 'components/Sparkline';\n\nfunction SmartInventoryDetail({ inventory }) {\n  const history = useHistory();\n  const {\n    created,\n    description,\n    host_filter,\n    id,\n    modified,\n    name,\n    total_hosts,\n    variables,\n    summary_fields: {\n      created_by,\n      modified_by,\n      organization,\n      user_capabilities,\n    },\n  } = inventory;\n\n  const {\n    error: contentError,\n    isLoading: hasContentLoading,\n    request: fetchData,\n    result: { recentJobs, instanceGroups },\n  } = useRequest(\n    useCallback(async () => {\n      const params = {\n        or__job__inventory: id,\n        or__workflowjob__inventory: id,\n        order_by: '-finished',\n        page_size: 10,\n      };\n      const [{ data: jobData }, { data: igData }] = await Promise.all([\n        UnifiedJobsAPI.read(params),\n        InventoriesAPI.readInstanceGroups(id),\n      ]);\n      return {\n        recentJobs: jobData.results,\n        instanceGroups: igData.results,\n      };\n    }, [id]),\n    {\n      recentJobs: [],\n      instanceGroups: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchData();\n  }, [fetchData]);\n\n  const {\n    error: deleteError,\n    isLoading,\n    request: handleDelete,\n  } = useRequest(\n    useCallback(async () => {\n      await InventoriesAPI.destroy(id);\n      history.push(`/inventories`);\n    }, [id, history])\n  );\n\n  const { error, dismissError } = useDismissableError(deleteError);\n\n  if (hasContentLoading) {\n    return <ContentLoading />;\n  }\n\n  if (contentError) {\n    return <ContentError error={contentError} />;\n  }\n\n  return (\n    <>\n      <CardBody>\n        <DetailList>\n          <Detail label={t`Name`} value={name} />\n          <Detail\n            label={t`Activity`}\n            value={<Sparkline jobs={recentJobs} />}\n            isEmpty={recentJobs.length === 0}\n          />\n          <Detail label={t`Description`} value={description} />\n          <Detail label={t`Type`} value={t`Smart inventory`} />\n          <Detail\n            label={t`Organization`}\n            value={\n              <Link to={`/organizations/${organization.id}/details`}>\n                {organization.name}\n              </Link>\n            }\n          />\n          <Detail\n            fullWidth\n            label={t`Smart host filter`}\n            value={<Label variant=\"outline\">{host_filter}</Label>}\n          />\n          <Detail label={t`Total hosts`} value={total_hosts} />\n          <Detail\n            fullWidth\n            label={t`Instance groups`}\n            value={\n              <ChipGroup\n                numChips={5}\n                totalChips={instanceGroups.length}\n                ouiaId=\"instance-group-chips\"\n              >\n                {instanceGroups.map((ig) => (\n                  <Chip\n                    key={ig.id}\n                    isReadOnly\n                    ouiaId={`instance-group-${ig.id}-chip`}\n                  >\n                    {ig.name}\n                  </Chip>\n                ))}\n              </ChipGroup>\n            }\n            isEmpty={instanceGroups.length === 0}\n          />\n          <VariablesDetail\n            label={t`Variables`}\n            value={variables}\n            rows={4}\n            name=\"variables\"\n            dataCy=\"smart-inventory-detail-variables\"\n          />\n          <UserDateDetail label={t`Created`} date={created} user={created_by} />\n          <UserDateDetail\n            label={t`Last modified`}\n            date={modified}\n            user={modified_by}\n          />\n        </DetailList>\n        <CardActionsRow>\n          {user_capabilities?.edit && (\n            <Button\n              ouiaId=\"smart-inventory-detail-edit-button\"\n              component={Link}\n              aria-label={t`edit`}\n              to={`/inventories/smart_inventory/${id}/edit`}\n            >\n              {t`Edit`}\n            </Button>\n          )}\n          {user_capabilities?.delete && (\n            <DeleteButton\n              name={name}\n              modalTitle={t`Delete smart inventory`}\n              onConfirm={handleDelete}\n              isDisabled={isLoading}\n            >\n              {t`Delete`}\n            </DeleteButton>\n          )}\n        </CardActionsRow>\n      </CardBody>\n      {error && (\n        <AlertModal\n          isOpen={error}\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={dismissError}\n        >\n          {t`Failed to delete smart inventory.`}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nSmartInventoryDetail.propTypes = {\n  inventory: Inventory.isRequired,\n};\n\nexport default SmartInventoryDetail;\n"]},"metadata":{},"sourceType":"module"}