{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _styled from\"styled-components\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import React,{useState,useCallback}from'react';import{Link}from'react-router-dom';import{Button,Popover,Tooltip,Chip}from'@patternfly/react-core';import{Tr,Td,ExpandableRowContent}from'@patternfly/react-table';import{ExclamationTriangleIcon,PencilAltIcon,ProjectDiagramIcon,RocketIcon}from'@patternfly/react-icons';import styled from'styled-components';import{timeOfDay,formatDateString}from'util/dates';import{JobTemplatesAPI,WorkflowJobTemplatesAPI}from'api';import{toTitleCase}from'util/strings';import getDocsBaseUrl from'util/getDocsBaseUrl';import{useConfig}from'contexts/Config';import{ActionsTd,ActionItem,TdBreakWord}from'../PaginatedTable';import{DetailList,Detail,DeletedDetail}from'../DetailList';import ChipGroup from'../ChipGroup';import CredentialChip from'../CredentialChip';import ExecutionEnvironmentDetail from'../ExecutionEnvironmentDetail';import{LaunchButton}from'../LaunchButton';import Sparkline from'../Sparkline';import CopyButton from'../CopyButton';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ExclamationTriangleIconWarning=styled(ExclamationTriangleIcon).withConfig({displayName:\"TemplateListItem__ExclamationTriangleIconWarning\",componentId:\"sc-1ozagjg-0\"})([\"color:var(--pf-global--warning-color--100);margin-left:18px;cursor:pointer;\"]);ExclamationTriangleIconWarning.displayName='ExclamationTriangleIconWarning';var _StyledExclamationTriangleIcon=styled(ExclamationTriangleIcon).withConfig({displayName:\"TemplateListItem___StyledExclamationTriangleIcon\",componentId:\"sc-1ozagjg-1\"})([\"color:#c9190b;margin-left:20px;\"]);function TemplateListItem(_ref){var isExpanded=_ref.isExpanded,onExpand=_ref.onExpand,template=_ref.template,isSelected=_ref.isSelected,onSelect=_ref.onSelect,onCopy=_ref.onCopy,detailUrl=_ref.detailUrl,fetchTemplates=_ref.fetchTemplates,rowIndex=_ref.rowIndex;var config=useConfig();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isDisabled=_useState2[0],setIsDisabled=_useState2[1];var labelId=\"check-action-\".concat(template.id);var docsLink=\"\".concat(getDocsBaseUrl(config),\"/html/upgrade-migration-guide/upgrade_to_ees.html\");var copyTemplate=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(template.type==='job_template')){_context.next=6;break;}_context.next=3;return JobTemplatesAPI.copy(template.id,{name:\"\".concat(template.name,\" @ \").concat(timeOfDay())});case 3:response=_context.sent;_context.next=9;break;case 6:_context.next=8;return WorkflowJobTemplatesAPI.copy(template.id,{name:\"\".concat(template.name,\" @ \").concat(timeOfDay())});case 8:response=_context.sent;case 9:if(response.status===201){onCopy(response.data.id);}_context.next=12;return fetchTemplates();case 12:case\"end\":return _context.stop();}}},_callee);})),[fetchTemplates,template.id,template.name,template.type,onCopy]);var handleCopyStart=useCallback(function(){setIsDisabled(true);},[]);var handleCopyFinish=useCallback(function(){setIsDisabled(false);},[]);var summaryFields=template.summary_fields,askInventoryOnLaunch=template.ask_inventory_on_launch;var missingResourceIcon=template.type==='job_template'&&(!summaryFields.project||!summaryFields.inventory&&!askInventoryOnLaunch);var missingExecutionEnvironment=template.type==='job_template'&&template.custom_virtualenv&&!template.execution_environment;var inventoryValue=function inventoryValue(kind,id){var inventorykind=kind==='smart'?'smart_inventory':'inventory';return askInventoryOnLaunch?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Link,{to:\"/inventories/\".concat(inventorykind,\"/\").concat(id,\"/details\"),children:summaryFields.inventory.name}),/*#__PURE__*/_jsxs(\"span\",{children:[\" \",/*i18n*/i18n._(\"(Prompt on launch)\")]})]}):/*#__PURE__*/_jsx(Link,{to:\"/inventories/\".concat(inventorykind,\"/\").concat(id,\"/details\"),children:summaryFields.inventory.name});};var lastRun='';var mostRecentJob=template.summary_fields.recent_jobs?template.summary_fields.recent_jobs[0]:null;if(mostRecentJob){lastRun=mostRecentJob.finished?formatDateString(mostRecentJob.finished):/*i18n*/i18n._(\"Running\");}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Tr,{id:\"template-row-\".concat(template.id),ouiaId:\"template-row-\".concat(template.id),children:[/*#__PURE__*/_jsx(Td,{expand:{rowIndex:rowIndex,isExpanded:isExpanded,onToggle:onExpand}}),/*#__PURE__*/_jsx(Td,{select:{rowIndex:rowIndex,isSelected:isSelected,onSelect:onSelect},dataLabel:/*i18n*/i18n._(\"Selected\")}),/*#__PURE__*/_jsxs(TdBreakWord,{id:labelId,dataLabel:/*i18n*/i18n._(\"Name\"),children:[/*#__PURE__*/_jsx(Link,{to:\"\".concat(detailUrl),children:/*#__PURE__*/_jsx(\"b\",{children:template.name})}),missingResourceIcon&&/*#__PURE__*/_jsx(\"span\",{children:/*#__PURE__*/_jsx(Tooltip,{content:/*i18n*/i18n._(\"Resources are missing from this template.\"),position:\"right\",children:/*#__PURE__*/_jsx(_StyledExclamationTriangleIcon,{})})}),missingExecutionEnvironment&&/*#__PURE__*/_jsx(\"span\",{children:/*#__PURE__*/_jsx(Popover,{className:\"missing-execution-environment\",headerContent:/*#__PURE__*/_jsx(\"div\",{children:/*i18n*/i18n._(\"Execution Environment Missing\")}),bodyContent:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Trans,{id:\"Custom virtual environment {0} must be replaced by an execution environment. For more information about migrating to execution environments see <0>the documentation.</0>\",values:{0:template.custom_virtualenv},components:{0:/*#__PURE__*/_jsx(\"a\",{href:docsLink,target:\"_blank\",rel:\"noopener noreferrer\"})}})}),position:\"right\",children:/*#__PURE__*/_jsx(ExclamationTriangleIconWarning,{})})})]}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Type\"),children:toTitleCase(template.type)}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Organization\"),children:summaryFields.organization?/*#__PURE__*/_jsx(Link,{to:\"/organizations/\".concat(summaryFields.organization.id,\"/details\"),children:summaryFields.organization.name}):null}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Last Ran\"),children:lastRun}),/*#__PURE__*/_jsxs(ActionsTd,{dataLabel:/*i18n*/i18n._(\"Actions\"),children:[/*#__PURE__*/_jsx(ActionItem,{visible:template.type==='workflow_job_template',tooltip:/*i18n*/i18n._(\"Visualizer\"),children:/*#__PURE__*/_jsx(Button,{ouiaId:\"\".concat(template.id,\"-visualizer-button\"),id:\"template-action-visualizer-\".concat(template.id),isDisabled:isDisabled,\"aria-label\":/*i18n*/i18n._(\"Visualizer\"),variant:\"plain\",component:Link,to:\"/templates/workflow_job_template/\".concat(template.id,\"/visualizer\"),children:/*#__PURE__*/_jsx(ProjectDiagramIcon,{})})}),/*#__PURE__*/_jsx(ActionItem,{visible:template.summary_fields.user_capabilities.start,tooltip:/*i18n*/i18n._(\"Launch Template\"),children:/*#__PURE__*/_jsx(LaunchButton,{resource:template,children:function children(_ref3){var handleLaunch=_ref3.handleLaunch,isLaunching=_ref3.isLaunching;return/*#__PURE__*/_jsx(Button,{ouiaId:\"\".concat(template.id,\"-launch-button\"),id:\"template-action-launch-\".concat(template.id),isDisabled:isDisabled||isLaunching,\"aria-label\":/*i18n*/i18n._(\"Launch template\"),variant:\"plain\",onClick:handleLaunch,children:/*#__PURE__*/_jsx(RocketIcon,{})});}})}),/*#__PURE__*/_jsx(ActionItem,{visible:template.summary_fields.user_capabilities.edit,tooltip:/*i18n*/i18n._(\"Edit Template\"),children:/*#__PURE__*/_jsx(Button,{ouiaId:\"\".concat(template.id,\"-edit-button\"),id:\"template-action-edit-\".concat(template.id),isDisabled:isDisabled,\"aria-label\":/*i18n*/i18n._(\"Edit Template\"),variant:\"plain\",component:Link,to:\"/templates/\".concat(template.type,\"/\").concat(template.id,\"/edit\"),children:/*#__PURE__*/_jsx(PencilAltIcon,{})})}),/*#__PURE__*/_jsx(ActionItem,{tooltip:/*i18n*/i18n._(\"Copy Template\"),visible:template.summary_fields.user_capabilities.copy,children:/*#__PURE__*/_jsx(CopyButton,{id:\"template-action-copy-\".concat(template.id),errorMessage:/*i18n*/i18n._(\"Failed to copy template.\"),isDisabled:isDisabled,onCopyStart:handleCopyStart,onCopyFinish:handleCopyFinish,copyItem:copyTemplate})})]})]}),/*#__PURE__*/_jsxs(Tr,{isExpanded:isExpanded,ouiaId:\"template-row-\".concat(template.id,\"-expanded\"),children:[/*#__PURE__*/_jsx(Td,{colSpan:2}),/*#__PURE__*/_jsx(Td,{colSpan:4,children:/*#__PURE__*/_jsx(ExpandableRowContent,{children:/*#__PURE__*/_jsxs(DetailList,{children:[/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Description\"),value:template.description,dataCy:\"template-\".concat(template.id,\"-description\")}),summaryFields.recent_jobs?/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Activity\"),value:/*#__PURE__*/_jsx(Sparkline,{jobs:summaryFields.recent_jobs}),dataCy:\"template-\".concat(template.id,\"-activity\"),isEmpty:summaryFields.recent_jobs.length===0}):null,summaryFields.inventory?/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Inventory\"),value:inventoryValue(summaryFields.inventory.kind,summaryFields.inventory.id),dataCy:\"template-\".concat(template.id,\"-inventory\")}):!askInventoryOnLaunch&&template.type==='job_template'&&/*#__PURE__*/_jsx(DeletedDetail,{label:/*i18n*/i18n._(\"Inventory\")}),summaryFields.project&&/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Project\"),value:/*#__PURE__*/_jsx(Link,{to:\"/projects/\".concat(summaryFields.project.id,\"/details\"),children:summaryFields.project.name}),dataCy:\"template-\".concat(template.id,\"-project\")}),template.type==='job_template'&&/*#__PURE__*/_jsx(ExecutionEnvironmentDetail,{virtualEnvironment:template.custom_virtualenv,executionEnvironment:summaryFields===null||summaryFields===void 0?void 0:summaryFields.execution_environment}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Last Modified\"),value:formatDateString(template.modified),dataCy:\"template-\".concat(template.id,\"-last-modified\")}),summaryFields.credentials?/*#__PURE__*/_jsx(Detail,{fullWidth:true,label:/*i18n*/i18n._(\"Credentials\"),value:/*#__PURE__*/_jsx(ChipGroup,{numChips:5,totalChips:summaryFields.credentials.length,ouiaId:\"template-\".concat(template.id,\"-credential-chips\"),children:summaryFields.credentials.map(function(c){return/*#__PURE__*/_jsx(CredentialChip,{credential:c,isReadOnly:true,ouiaId:\"credential-\".concat(c.id,\"-chip\")},c.id);})}),dataCy:\"template-\".concat(template.id,\"-credentials\"),isEmpty:summaryFields.credentials.length===0}):null,summaryFields.labels&&/*#__PURE__*/_jsx(Detail,{fullWidth:true,label:/*i18n*/i18n._(\"Labels\"),value:/*#__PURE__*/_jsx(ChipGroup,{numChips:5,totalChips:summaryFields.labels.results.length,ouiaId:\"template-\".concat(template.id,\"-label-chips\"),children:summaryFields.labels.results.map(function(l){return/*#__PURE__*/_jsx(Chip,{isReadOnly:true,ouiaId:\"label-\".concat(l.id,\"-chip\"),children:l.name},l.id);})}),dataCy:\"template-\".concat(template.id,\"-labels\"),isEmpty:summaryFields.labels.results.length===0})]})})})]})]});}export{TemplateListItem as _TemplateListItem};export default TemplateListItem;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/TemplateList/TemplateListItem.js"],"names":["React","useState","useCallback","Link","Button","Popover","Tooltip","Chip","Tr","Td","ExpandableRowContent","ExclamationTriangleIcon","PencilAltIcon","ProjectDiagramIcon","RocketIcon","styled","timeOfDay","formatDateString","JobTemplatesAPI","WorkflowJobTemplatesAPI","toTitleCase","getDocsBaseUrl","useConfig","ActionsTd","ActionItem","TdBreakWord","DetailList","Detail","DeletedDetail","ChipGroup","CredentialChip","ExecutionEnvironmentDetail","LaunchButton","Sparkline","CopyButton","ExclamationTriangleIconWarning","displayName","TemplateListItem","isExpanded","onExpand","template","isSelected","onSelect","onCopy","detailUrl","fetchTemplates","rowIndex","config","isDisabled","setIsDisabled","labelId","id","docsLink","copyTemplate","type","copy","name","response","status","data","handleCopyStart","handleCopyFinish","summaryFields","summary_fields","askInventoryOnLaunch","ask_inventory_on_launch","missingResourceIcon","project","inventory","missingExecutionEnvironment","custom_virtualenv","execution_environment","inventoryValue","kind","inventorykind","lastRun","mostRecentJob","recent_jobs","finished","onToggle","organization","user_capabilities","start","handleLaunch","isLaunching","edit","description","length","modified","credentials","map","c","labels","results","l","_TemplateListItem"],"mappings":"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","sourcesContent":["import 'styled-components/macro';\nimport React, { useState, useCallback } from 'react';\nimport { Link } from 'react-router-dom';\nimport { Button, Popover, Tooltip, Chip } from '@patternfly/react-core';\nimport { Tr, Td, ExpandableRowContent } from '@patternfly/react-table';\nimport { t, Trans } from '@lingui/macro';\nimport {\n  ExclamationTriangleIcon,\n  PencilAltIcon,\n  ProjectDiagramIcon,\n  RocketIcon,\n} from '@patternfly/react-icons';\nimport styled from 'styled-components';\nimport { timeOfDay, formatDateString } from 'util/dates';\nimport { JobTemplatesAPI, WorkflowJobTemplatesAPI } from 'api';\nimport { toTitleCase } from 'util/strings';\nimport getDocsBaseUrl from 'util/getDocsBaseUrl';\nimport { useConfig } from 'contexts/Config';\nimport { ActionsTd, ActionItem, TdBreakWord } from '../PaginatedTable';\nimport { DetailList, Detail, DeletedDetail } from '../DetailList';\nimport ChipGroup from '../ChipGroup';\nimport CredentialChip from '../CredentialChip';\nimport ExecutionEnvironmentDetail from '../ExecutionEnvironmentDetail';\nimport { LaunchButton } from '../LaunchButton';\nimport Sparkline from '../Sparkline';\nimport CopyButton from '../CopyButton';\n\nconst ExclamationTriangleIconWarning = styled(ExclamationTriangleIcon)`\n  color: var(--pf-global--warning-color--100);\n  margin-left: 18px;\n  cursor: pointer;\n`;\n\nExclamationTriangleIconWarning.displayName = 'ExclamationTriangleIconWarning';\n\nfunction TemplateListItem({\n  isExpanded,\n  onExpand,\n  template,\n  isSelected,\n  onSelect,\n  onCopy,\n  detailUrl,\n  fetchTemplates,\n  rowIndex,\n}) {\n  const config = useConfig();\n  const [isDisabled, setIsDisabled] = useState(false);\n  const labelId = `check-action-${template.id}`;\n\n  const docsLink = `${getDocsBaseUrl(\n    config\n  )}/html/upgrade-migration-guide/upgrade_to_ees.html`;\n\n  const copyTemplate = useCallback(async () => {\n    let response;\n    if (template.type === 'job_template') {\n      response = await JobTemplatesAPI.copy(template.id, {\n        name: `${template.name} @ ${timeOfDay()}`,\n      });\n    } else {\n      response = await WorkflowJobTemplatesAPI.copy(template.id, {\n        name: `${template.name} @ ${timeOfDay()}`,\n      });\n    }\n    if (response.status === 201) {\n      onCopy(response.data.id);\n    }\n    await fetchTemplates();\n  }, [fetchTemplates, template.id, template.name, template.type, onCopy]);\n\n  const handleCopyStart = useCallback(() => {\n    setIsDisabled(true);\n  }, []);\n\n  const handleCopyFinish = useCallback(() => {\n    setIsDisabled(false);\n  }, []);\n\n  const {\n    summary_fields: summaryFields,\n    ask_inventory_on_launch: askInventoryOnLaunch,\n  } = template;\n\n  const missingResourceIcon =\n    template.type === 'job_template' &&\n    (!summaryFields.project ||\n      (!summaryFields.inventory && !askInventoryOnLaunch));\n\n  const missingExecutionEnvironment =\n    template.type === 'job_template' &&\n    template.custom_virtualenv &&\n    !template.execution_environment;\n\n  const inventoryValue = (kind, id) => {\n    const inventorykind = kind === 'smart' ? 'smart_inventory' : 'inventory';\n\n    return askInventoryOnLaunch ? (\n      <>\n        <Link to={`/inventories/${inventorykind}/${id}/details`}>\n          {summaryFields.inventory.name}\n        </Link>\n        <span> {t`(Prompt on launch)`}</span>\n      </>\n    ) : (\n      <Link to={`/inventories/${inventorykind}/${id}/details`}>\n        {summaryFields.inventory.name}\n      </Link>\n    );\n  };\n  let lastRun = '';\n  const mostRecentJob = template.summary_fields.recent_jobs\n    ? template.summary_fields.recent_jobs[0]\n    : null;\n  if (mostRecentJob) {\n    lastRun = mostRecentJob.finished\n      ? formatDateString(mostRecentJob.finished)\n      : t`Running`;\n  }\n\n  return (\n    <>\n      <Tr\n        id={`template-row-${template.id}`}\n        ouiaId={`template-row-${template.id}`}\n      >\n        <Td\n          expand={{\n            rowIndex,\n            isExpanded,\n            onToggle: onExpand,\n          }}\n        />\n        <Td\n          select={{\n            rowIndex,\n            isSelected,\n            onSelect,\n          }}\n          dataLabel={t`Selected`}\n        />\n        <TdBreakWord id={labelId} dataLabel={t`Name`}>\n          <Link to={`${detailUrl}`}>\n            <b>{template.name}</b>\n          </Link>\n          {missingResourceIcon && (\n            <span>\n              <Tooltip\n                content={t`Resources are missing from this template.`}\n                position=\"right\"\n              >\n                <ExclamationTriangleIcon css=\"color: #c9190b; margin-left: 20px;\" />\n              </Tooltip>\n            </span>\n          )}\n          {missingExecutionEnvironment && (\n            <span>\n              <Popover\n                className=\"missing-execution-environment\"\n                headerContent={<div>{t`Execution Environment Missing`}</div>}\n                bodyContent={\n                  <div>\n                    <Trans>\n                      Custom virtual environment {template.custom_virtualenv}{' '}\n                      must be replaced by an execution environment. For more\n                      information about migrating to execution environments see{' '}\n                      <a\n                        href={docsLink}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                      >\n                        the documentation.\n                      </a>\n                    </Trans>\n                  </div>\n                }\n                position=\"right\"\n              >\n                <ExclamationTriangleIconWarning />\n              </Popover>\n            </span>\n          )}\n        </TdBreakWord>\n        <Td dataLabel={t`Type`}>{toTitleCase(template.type)}</Td>\n        <Td dataLabel={t`Organization`}>\n          {summaryFields.organization ? (\n            <Link\n              to={`/organizations/${summaryFields.organization.id}/details`}\n            >\n              {summaryFields.organization.name}\n            </Link>\n          ) : null}\n        </Td>\n        <Td dataLabel={t`Last Ran`}>{lastRun}</Td>\n        <ActionsTd dataLabel={t`Actions`}>\n          <ActionItem\n            visible={template.type === 'workflow_job_template'}\n            tooltip={t`Visualizer`}\n          >\n            <Button\n              ouiaId={`${template.id}-visualizer-button`}\n              id={`template-action-visualizer-${template.id}`}\n              isDisabled={isDisabled}\n              aria-label={t`Visualizer`}\n              variant=\"plain\"\n              component={Link}\n              to={`/templates/workflow_job_template/${template.id}/visualizer`}\n            >\n              <ProjectDiagramIcon />\n            </Button>\n          </ActionItem>\n          <ActionItem\n            visible={template.summary_fields.user_capabilities.start}\n            tooltip={t`Launch Template`}\n          >\n            <LaunchButton resource={template}>\n              {({ handleLaunch, isLaunching }) => (\n                <Button\n                  ouiaId={`${template.id}-launch-button`}\n                  id={`template-action-launch-${template.id}`}\n                  isDisabled={isDisabled || isLaunching}\n                  aria-label={t`Launch template`}\n                  variant=\"plain\"\n                  onClick={handleLaunch}\n                >\n                  <RocketIcon />\n                </Button>\n              )}\n            </LaunchButton>\n          </ActionItem>\n          <ActionItem\n            visible={template.summary_fields.user_capabilities.edit}\n            tooltip={t`Edit Template`}\n          >\n            <Button\n              ouiaId={`${template.id}-edit-button`}\n              id={`template-action-edit-${template.id}`}\n              isDisabled={isDisabled}\n              aria-label={t`Edit Template`}\n              variant=\"plain\"\n              component={Link}\n              to={`/templates/${template.type}/${template.id}/edit`}\n            >\n              <PencilAltIcon />\n            </Button>\n          </ActionItem>\n          <ActionItem\n            tooltip={t`Copy Template`}\n            visible={template.summary_fields.user_capabilities.copy}\n          >\n            <CopyButton\n              id={`template-action-copy-${template.id}`}\n              errorMessage={t`Failed to copy template.`}\n              isDisabled={isDisabled}\n              onCopyStart={handleCopyStart}\n              onCopyFinish={handleCopyFinish}\n              copyItem={copyTemplate}\n            />\n          </ActionItem>\n        </ActionsTd>\n      </Tr>\n      <Tr\n        isExpanded={isExpanded}\n        ouiaId={`template-row-${template.id}-expanded`}\n      >\n        <Td colSpan={2} />\n        <Td colSpan={4}>\n          <ExpandableRowContent>\n            <DetailList>\n              <Detail\n                label={t`Description`}\n                value={template.description}\n                dataCy={`template-${template.id}-description`}\n              />\n              {summaryFields.recent_jobs ? (\n                <Detail\n                  label={t`Activity`}\n                  value={<Sparkline jobs={summaryFields.recent_jobs} />}\n                  dataCy={`template-${template.id}-activity`}\n                  isEmpty={summaryFields.recent_jobs.length === 0}\n                />\n              ) : null}\n              {summaryFields.inventory ? (\n                <Detail\n                  label={t`Inventory`}\n                  value={inventoryValue(\n                    summaryFields.inventory.kind,\n                    summaryFields.inventory.id\n                  )}\n                  dataCy={`template-${template.id}-inventory`}\n                />\n              ) : (\n                !askInventoryOnLaunch &&\n                template.type === 'job_template' && (\n                  <DeletedDetail label={t`Inventory`} />\n                )\n              )}\n              {summaryFields.project && (\n                <Detail\n                  label={t`Project`}\n                  value={\n                    <Link to={`/projects/${summaryFields.project.id}/details`}>\n                      {summaryFields.project.name}\n                    </Link>\n                  }\n                  dataCy={`template-${template.id}-project`}\n                />\n              )}\n              {template.type === 'job_template' && (\n                <ExecutionEnvironmentDetail\n                  virtualEnvironment={template.custom_virtualenv}\n                  executionEnvironment={summaryFields?.execution_environment}\n                />\n              )}\n              <Detail\n                label={t`Last Modified`}\n                value={formatDateString(template.modified)}\n                dataCy={`template-${template.id}-last-modified`}\n              />\n              {summaryFields.credentials ? (\n                <Detail\n                  fullWidth\n                  label={t`Credentials`}\n                  value={\n                    <ChipGroup\n                      numChips={5}\n                      totalChips={summaryFields.credentials.length}\n                      ouiaId={`template-${template.id}-credential-chips`}\n                    >\n                      {summaryFields.credentials.map((c) => (\n                        <CredentialChip\n                          key={c.id}\n                          credential={c}\n                          isReadOnly\n                          ouiaId={`credential-${c.id}-chip`}\n                        />\n                      ))}\n                    </ChipGroup>\n                  }\n                  dataCy={`template-${template.id}-credentials`}\n                  isEmpty={summaryFields.credentials.length === 0}\n                />\n              ) : null}\n              {summaryFields.labels && (\n                <Detail\n                  fullWidth\n                  label={t`Labels`}\n                  value={\n                    <ChipGroup\n                      numChips={5}\n                      totalChips={summaryFields.labels.results.length}\n                      ouiaId={`template-${template.id}-label-chips`}\n                    >\n                      {summaryFields.labels.results.map((l) => (\n                        <Chip\n                          key={l.id}\n                          isReadOnly\n                          ouiaId={`label-${l.id}-chip`}\n                        >\n                          {l.name}\n                        </Chip>\n                      ))}\n                    </ChipGroup>\n                  }\n                  dataCy={`template-${template.id}-labels`}\n                  isEmpty={summaryFields.labels.results.length === 0}\n                />\n              )}\n            </DetailList>\n          </ExpandableRowContent>\n        </Td>\n      </Tr>\n    </>\n  );\n}\n\nexport { TemplateListItem as _TemplateListItem };\nexport default TemplateListItem;\n"]},"metadata":{},"sourceType":"module"}