{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect,useState}from'react';import{SelectVariant,Select,SelectOption}from'@patternfly/react-core';import{ProjectsAPI}from'api';import useRequest from'hooks/useRequest';import{jsx as _jsx}from\"react/jsx-runtime\";function PlaybookSelect(_ref){var projectId=_ref.projectId,isValid=_ref.isValid,selected=_ref.selected,onBlur=_ref.onBlur,onError=_ref.onError,onChange=_ref.onChange;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isDisabled=_useState2[0],setIsDisabled=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isOpen=_useState4[0],setIsOpen=_useState4[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$ProjectsAPI$re,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(projectId){_context.next=2;break;}return _context.abrupt(\"return\",[]);case 2:_context.next=4;return ProjectsAPI.readPlaybooks(projectId);case 4:_yield$ProjectsAPI$re=_context.sent;data=_yield$ProjectsAPI$re.data;if(data.length===1){onChange(data[0]);}return _context.abrupt(\"return\",data);case 8:case\"end\":return _context.stop();}}},_callee);})),[projectId,onChange]),[]),options=_useRequest.result,fetchOptions=_useRequest.request,isLoading=_useRequest.isLoading,error=_useRequest.error;useEffect(function(){fetchOptions();},[fetchOptions]);useEffect(function(){if(error){if(error.response.status===403){setIsDisabled(true);}else{onError(error);}}},[error,onError]);return/*#__PURE__*/_jsx(Select,{ouiaId:\"JobTemplateForm-playbook\",isOpen:isOpen,variant:SelectVariant.typeahead,selections:selected,onToggle:setIsOpen,placeholderText:/*i18n*/i18n._(\"Select a playbook\"),typeAheadAriaLabel:/*i18n*/i18n._(\"Select a playbook\"),isCreatable:false,onSelect:function onSelect(event,value){setIsOpen(false);onChange(value);},id:\"template-playbook\",isValid:isValid,onBlur:onBlur,isDisabled:isLoading||isDisabled,maxHeight:\"1000%\",noResultsFoundText:/*i18n*/i18n._(\"No results found\"),children:options.map(function(opt){return/*#__PURE__*/_jsx(SelectOption,{value:opt},opt);})});}PlaybookSelect.defaultProps={projectId:null,onChange:function onChange(){}};export{PlaybookSelect as _PlaybookSelect};export default PlaybookSelect;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Template/shared/PlaybookSelect.js"],"names":["React","useCallback","useEffect","useState","SelectVariant","Select","SelectOption","ProjectsAPI","useRequest","PlaybookSelect","projectId","isValid","selected","onBlur","onError","onChange","isDisabled","setIsDisabled","isOpen","setIsOpen","readPlaybooks","data","length","options","result","fetchOptions","request","isLoading","error","response","status","typeahead","event","value","map","opt","defaultProps","_PlaybookSelect"],"mappings":"uVAAA,MAAOA,CAAAA,KAAP,EAAgBC,WAAhB,CAA6BC,SAA7B,CAAwCC,QAAxC,KAAwD,OAAxD,CAIA,OAASC,aAAT,CAAwBC,MAAxB,CAAgCC,YAAhC,KAAoD,wBAApD,CACA,OAASC,WAAT,KAA4B,KAA5B,CACA,MAAOC,CAAAA,UAAP,KAAuB,kBAAvB,C,2CAEA,QAASC,CAAAA,cAAT,MAOG,IANDC,CAAAA,SAMC,MANDA,SAMC,CALDC,OAKC,MALDA,OAKC,CAJDC,QAIC,MAJDA,QAIC,CAHDC,MAGC,MAHDA,MAGC,CAFDC,OAEC,MAFDA,OAEC,CADDC,QACC,MADDA,QACC,CACD,cAAoCZ,QAAQ,CAAC,KAAD,CAA5C,wCAAOa,UAAP,eAAmBC,aAAnB,eACA,eAA4Bd,QAAQ,CAAC,KAAD,CAApC,yCAAOe,MAAP,eAAeC,SAAf,eACA,gBAKIX,UAAU,CACZP,WAAW,sEAAC,qKACLS,SADK,yDAED,EAFC,+BAIaH,CAAAA,WAAW,CAACa,aAAZ,CAA0BV,SAA1B,CAJb,4CAIFW,IAJE,uBAIFA,IAJE,CAMV,GAAIA,IAAI,CAACC,MAAL,GAAgB,CAApB,CAAuB,CACrBP,QAAQ,CAACM,IAAI,CAAC,CAAD,CAAL,CAAR,CACD,CARS,gCASHA,IATG,wDAAD,GAUR,CAACX,SAAD,CAAYK,QAAZ,CAVQ,CADC,CAYZ,EAZY,CALd,CACUQ,OADV,aACEC,MADF,CAEWC,YAFX,aAEEC,OAFF,CAGEC,SAHF,aAGEA,SAHF,CAIEC,KAJF,aAIEA,KAJF,CAoBA1B,SAAS,CAAC,UAAM,CACduB,YAAY,GACb,CAFQ,CAEN,CAACA,YAAD,CAFM,CAAT,CAIAvB,SAAS,CAAC,UAAM,CACd,GAAI0B,KAAJ,CAAW,CACT,GAAIA,KAAK,CAACC,QAAN,CAAeC,MAAf,GAA0B,GAA9B,CAAmC,CACjCb,aAAa,CAAC,IAAD,CAAb,CACD,CAFD,IAEO,CACLH,OAAO,CAACc,KAAD,CAAP,CACD,CACF,CACF,CARQ,CAQN,CAACA,KAAD,CAAQd,OAAR,CARM,CAAT,CAUA,mBACE,KAAC,MAAD,EACE,MAAM,CAAC,0BADT,CAEE,MAAM,CAAEI,MAFV,CAGE,OAAO,CAAEd,aAAa,CAAC2B,SAHzB,CAIE,UAAU,CAAEnB,QAJd,CAKE,QAAQ,CAAEO,SALZ,CAME,eAAe,SAAE,2BANnB,CAOE,kBAAkB,SAAE,2BAPtB,CAQE,WAAW,CAAE,KARf,CASE,QAAQ,CAAE,kBAACa,KAAD,CAAQC,KAAR,CAAkB,CAC1Bd,SAAS,CAAC,KAAD,CAAT,CACAJ,QAAQ,CAACkB,KAAD,CAAR,CACD,CAZH,CAaE,EAAE,CAAC,mBAbL,CAcE,OAAO,CAAEtB,OAdX,CAeE,MAAM,CAAEE,MAfV,CAgBE,UAAU,CAAEc,SAAS,EAAIX,UAhB3B,CAiBE,SAAS,CAAC,OAjBZ,CAkBE,kBAAkB,SAAE,0BAlBtB,UAoBGO,OAAO,CAACW,GAAR,CAAY,SAACC,GAAD,qBACX,KAAC,YAAD,EAAwB,KAAK,CAAEA,GAA/B,EAAmBA,GAAnB,CADW,EAAZ,CApBH,EADF,CA0BD,CAKD1B,cAAc,CAAC2B,YAAf,CAA8B,CAC5B1B,SAAS,CAAE,IADiB,CAE5BK,QAAQ,CAAE,mBAAM,CAAE,CAFU,CAA9B,CAKA,OAASN,cAAc,GAAI4B,CAAAA,eAA3B,EACA,cAAe5B,CAAAA,cAAf","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { func, number, string, oneOfType } from 'prop-types';\n\nimport { t } from '@lingui/macro';\nimport { SelectVariant, Select, SelectOption } from '@patternfly/react-core';\nimport { ProjectsAPI } from 'api';\nimport useRequest from 'hooks/useRequest';\n\nfunction PlaybookSelect({\n  projectId,\n  isValid,\n  selected,\n  onBlur,\n  onError,\n  onChange,\n}) {\n  const [isDisabled, setIsDisabled] = useState(false);\n  const [isOpen, setIsOpen] = useState(false);\n  const {\n    result: options,\n    request: fetchOptions,\n    isLoading,\n    error,\n  } = useRequest(\n    useCallback(async () => {\n      if (!projectId) {\n        return [];\n      }\n      const { data } = await ProjectsAPI.readPlaybooks(projectId);\n\n      if (data.length === 1) {\n        onChange(data[0]);\n      }\n      return data;\n    }, [projectId, onChange]),\n    []\n  );\n\n  useEffect(() => {\n    fetchOptions();\n  }, [fetchOptions]);\n\n  useEffect(() => {\n    if (error) {\n      if (error.response.status === 403) {\n        setIsDisabled(true);\n      } else {\n        onError(error);\n      }\n    }\n  }, [error, onError]);\n\n  return (\n    <Select\n      ouiaId=\"JobTemplateForm-playbook\"\n      isOpen={isOpen}\n      variant={SelectVariant.typeahead}\n      selections={selected}\n      onToggle={setIsOpen}\n      placeholderText={t`Select a playbook`}\n      typeAheadAriaLabel={t`Select a playbook`}\n      isCreatable={false}\n      onSelect={(event, value) => {\n        setIsOpen(false);\n        onChange(value);\n      }}\n      id=\"template-playbook\"\n      isValid={isValid}\n      onBlur={onBlur}\n      isDisabled={isLoading || isDisabled}\n      maxHeight=\"1000%\"\n      noResultsFoundText={t`No results found`}\n    >\n      {options.map((opt) => (\n        <SelectOption key={opt} value={opt} />\n      ))}\n    </Select>\n  );\n}\nPlaybookSelect.propTypes = {\n  projectId: oneOfType([number, string]),\n  onChange: func,\n};\nPlaybookSelect.defaultProps = {\n  projectId: null,\n  onChange: () => {},\n};\n\nexport { PlaybookSelect as _PlaybookSelect };\nexport default PlaybookSelect;\n"]},"metadata":{},"sourceType":"module"}