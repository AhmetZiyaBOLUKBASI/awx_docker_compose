{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{useEffect,useState,useCallback}from'react';import{useLocation,useHistory}from'react-router-dom';import{parseQueryString,updateQueryString}from'util/qs';import useIsMounted from'./useIsMounted';/*\n * The useRequest hook accepts a request function and returns an object with\n * five values:\n *   request: a function to call to invoke the request\n *   result: the value returned from the request function (once invoked)\n *   isLoading: boolean state indicating whether the request is in active/in flight\n *   error: any caught error resulting from the request\n *   setValue: setter to explicitly set the result value\n *\n * The hook also accepts an optional second parameter which is a default\n * value to set as result before the first time the request is made.\n */export default function useRequest(makeRequest,initialValue){var _useState=useState(initialValue),_useState2=_slicedToArray(_useState,2),result=_useState2[0],setResult=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var _useState5=useState((initialValue===null||initialValue===void 0?void 0:initialValue.isLoading)||false),_useState6=_slicedToArray(_useState5,2),isLoading=_useState6[0],setIsLoading=_useState6[1];var isMounted=useIsMounted();return{result:result,error:error,isLoading:isLoading,request:useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsLoading(true);_context.prev=1;_context.next=4;return makeRequest.apply(void 0,_args);case 4:response=_context.sent;if(isMounted.current){setResult(response);setError(null);}_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);if(isMounted.current){setError(_context.t0);setResult(initialValue);}case 11:_context.prev=11;if(isMounted.current){setIsLoading(false);}return _context.finish(11);case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,8,11,14]]);})),/* eslint-disable-next-line react-hooks/exhaustive-deps */[makeRequest]),setValue:setResult};}/*\n * Provides controls for \"dismissing\" an error message\n *\n * Params: an error object\n * Returns: { error, dismissError }\n *   The returned error object is the same object passed in via the paremeter,\n *   until the dismissError function is called, at which point the returned\n *   error will be set to null on the subsequent render.\n */export function useDismissableError(error){var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),showError=_useState8[0],setShowError=_useState8[1];useEffect(function(){if(error){setShowError(true);}},[error]);return{error:showError?error:null,dismissError:function dismissError(){setShowError(false);}};}/*\n * Hook to assist with deletion of items from a paginated item list. The page\n * url will be navigated back one page on a paginated list if needed to prevent\n * the UI from re-loading an empty set and displaying a \"No items found\"\n * message.\n *\n * Params: a callback function that will be invoked in order to delete items,\n *   and an object with structure { qsConfig, allItemsSelected, fetchItems }\n * Returns: { isLoading, deleteItems, deletionError, clearDeletionError }\n */export function useDeleteItems(makeRequest){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$qsConfig=_ref2.qsConfig,qsConfig=_ref2$qsConfig===void 0?null:_ref2$qsConfig,_ref2$allItemsSelecte=_ref2.allItemsSelected,allItemsSelected=_ref2$allItemsSelecte===void 0?false:_ref2$allItemsSelecte,_ref2$fetchItems=_ref2.fetchItems,fetchItems=_ref2$fetchItems===void 0?null:_ref2$fetchItems;var location=useLocation();var history=useHistory();var _useRequest=useRequest(makeRequest,null),requestError=_useRequest.error,isLoading=_useRequest.isLoading,request=_useRequest.request;var _useDismissableError=useDismissableError(requestError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;var deleteItems=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var params,qs;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return request();case 2:if(qsConfig){_context2.next=4;break;}return _context2.abrupt(\"return\");case 4:params=parseQueryString(qsConfig,location.search);if(params.page>1&&allItemsSelected){qs=updateQueryString(qsConfig,location.search,{page:params.page-1});history.push(\"\".concat(location.pathname,\"?\").concat(qs));}else{fetchItems();}case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function deleteItems(){return _ref3.apply(this,arguments);};}();return{isLoading:isLoading,deleteItems:deleteItems,deletionError:error,clearDeletionError:dismissError};}","map":{"version":3,"sources":["/awx_devel/awx/ui/src/hooks/useRequest.js"],"names":["useEffect","useState","useCallback","useLocation","useHistory","parseQueryString","updateQueryString","useIsMounted","useRequest","makeRequest","initialValue","result","setResult","error","setError","isLoading","setIsLoading","isMounted","request","response","current","setValue","useDismissableError","showError","setShowError","dismissError","useDeleteItems","qsConfig","allItemsSelected","fetchItems","location","history","requestError","deleteItems","params","search","page","qs","push","pathname","deletionError","clearDeletionError"],"mappings":"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","sourcesContent":["import { useEffect, useState, useCallback } from 'react';\nimport { useLocation, useHistory } from 'react-router-dom';\nimport { parseQueryString, updateQueryString } from 'util/qs';\nimport useIsMounted from './useIsMounted';\n\n/*\n * The useRequest hook accepts a request function and returns an object with\n * five values:\n *   request: a function to call to invoke the request\n *   result: the value returned from the request function (once invoked)\n *   isLoading: boolean state indicating whether the request is in active/in flight\n *   error: any caught error resulting from the request\n *   setValue: setter to explicitly set the result value\n *\n * The hook also accepts an optional second parameter which is a default\n * value to set as result before the first time the request is made.\n */\nexport default function useRequest(makeRequest, initialValue) {\n  const [result, setResult] = useState(initialValue);\n  const [error, setError] = useState(null);\n  const [isLoading, setIsLoading] = useState(initialValue?.isLoading || false);\n  const isMounted = useIsMounted();\n\n  return {\n    result,\n    error,\n    isLoading,\n    request: useCallback(\n      async (...args) => {\n        setIsLoading(true);\n        try {\n          const response = await makeRequest(...args);\n          if (isMounted.current) {\n            setResult(response);\n            setError(null);\n          }\n        } catch (err) {\n          if (isMounted.current) {\n            setError(err);\n            setResult(initialValue);\n          }\n        } finally {\n          if (isMounted.current) {\n            setIsLoading(false);\n          }\n        }\n      },\n      /* eslint-disable-next-line react-hooks/exhaustive-deps */\n      [makeRequest]\n    ),\n    setValue: setResult,\n  };\n}\n\n/*\n * Provides controls for \"dismissing\" an error message\n *\n * Params: an error object\n * Returns: { error, dismissError }\n *   The returned error object is the same object passed in via the paremeter,\n *   until the dismissError function is called, at which point the returned\n *   error will be set to null on the subsequent render.\n */\nexport function useDismissableError(error) {\n  const [showError, setShowError] = useState(false);\n\n  useEffect(() => {\n    if (error) {\n      setShowError(true);\n    }\n  }, [error]);\n\n  return {\n    error: showError ? error : null,\n    dismissError: () => {\n      setShowError(false);\n    },\n  };\n}\n\n/*\n * Hook to assist with deletion of items from a paginated item list. The page\n * url will be navigated back one page on a paginated list if needed to prevent\n * the UI from re-loading an empty set and displaying a \"No items found\"\n * message.\n *\n * Params: a callback function that will be invoked in order to delete items,\n *   and an object with structure { qsConfig, allItemsSelected, fetchItems }\n * Returns: { isLoading, deleteItems, deletionError, clearDeletionError }\n */\nexport function useDeleteItems(\n  makeRequest,\n  { qsConfig = null, allItemsSelected = false, fetchItems = null } = {}\n) {\n  const location = useLocation();\n  const history = useHistory();\n  const {\n    error: requestError,\n    isLoading,\n    request,\n  } = useRequest(makeRequest, null);\n  const { error, dismissError } = useDismissableError(requestError);\n\n  const deleteItems = async () => {\n    await request();\n    if (!qsConfig) {\n      return;\n    }\n    const params = parseQueryString(qsConfig, location.search);\n    if (params.page > 1 && allItemsSelected) {\n      const qs = updateQueryString(qsConfig, location.search, {\n        page: params.page - 1,\n      });\n      history.push(`${location.pathname}?${qs}`);\n    } else {\n      fetchItems();\n    }\n  };\n\n  return {\n    isLoading,\n    deleteItems,\n    deletionError: error,\n    clearDeletionError: dismissError,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}