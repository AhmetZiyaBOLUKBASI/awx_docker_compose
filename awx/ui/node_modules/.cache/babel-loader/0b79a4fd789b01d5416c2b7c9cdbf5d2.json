{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback}from'react';import{Button}from'@patternfly/react-core';import{OutlinedThumbsUpIcon}from'@patternfly/react-icons';import{WorkflowApprovalsAPI}from'api';import useRequest,{useDismissableError}from'hooks/useRequest';import AlertModal from'components/AlertModal';import ErrorDetail from'components/ErrorDetail';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function WorkflowApprovalButton(_ref){var isDetailView=_ref.isDetailView,workflowApproval=_ref.workflowApproval,onHandleToast=_ref.onHandleToast;var id=workflowApproval.id;var hasBeenActedOn=Object.keys(workflowApproval.summary_fields.approved_or_denied_by||{}).length>0||workflowApproval.status==='canceled';var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",WorkflowApprovalsAPI.approve(id));case 1:case\"end\":return _context.stop();}}},_callee);})),[id]),{}),approveApprovalError=_useRequest.error,approveWorkflowApprovals=_useRequest.request;var handleApprove=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return approveWorkflowApprovals();case 2:onHandleToast(workflowApproval.id,/*i18n*/i18n._(\"Successfully Approved\"));case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleApprove(){return _ref3.apply(this,arguments);};}();var _useDismissableError=useDismissableError(approveApprovalError),approveError=_useDismissableError.error,dismissApproveError=_useDismissableError.dismissError;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{isDisabled:hasBeenActedOn,variant:isDetailView?'primary':'plain',ouiaId:\"workflow-approve-button\",onClick:function onClick(){return handleApprove();},\"aria-label\":hasBeenActedOn?/*i18n*/i18n._(\"This workflow has already been acted on\"):/*i18n*/i18n._(\"Approve\"),children:isDetailView?/*i18n*/i18n._(\"Approve\"):/*#__PURE__*/_jsx(OutlinedThumbsUpIcon,{})}),approveError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:approveError,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:dismissApproveError,children:[/*i18n*/i18n._(\"Failed to approve {0}.\",{0:workflowApproval.name}),/*#__PURE__*/_jsx(ErrorDetail,{error:approveError})]})]});}export default WorkflowApprovalButton;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/WorkflowApproval/shared/WorkflowApprovalButton.js"],"names":["React","useCallback","Button","OutlinedThumbsUpIcon","WorkflowApprovalsAPI","useRequest","useDismissableError","AlertModal","ErrorDetail","WorkflowApprovalButton","isDetailView","workflowApproval","onHandleToast","id","hasBeenActedOn","Object","keys","summary_fields","approved_or_denied_by","length","status","approve","approveApprovalError","error","approveWorkflowApprovals","request","handleApprove","approveError","dismissApproveError","dismissError","name"],"mappings":"gPAAA,MAAOA,CAAAA,KAAP,EAAgBC,WAAhB,KAAmC,OAAnC,CAEA,OAASC,MAAT,KAAuB,wBAAvB,CACA,OAASC,oBAAT,KAAqC,yBAArC,CACA,OAASC,oBAAT,KAAqC,KAArC,CACA,MAAOC,CAAAA,UAAP,EAAqBC,mBAArB,KAAgD,kBAAhD,CAEA,MAAOC,CAAAA,UAAP,KAAuB,uBAAvB,CACA,MAAOC,CAAAA,WAAP,KAAwB,wBAAxB,C,6IAEA,QAASC,CAAAA,sBAAT,MAIG,IAHDC,CAAAA,YAGC,MAHDA,YAGC,CAFDC,gBAEC,MAFDA,gBAEC,CADDC,aACC,MADDA,aACC,CACD,GAAQC,CAAAA,EAAR,CAAeF,gBAAf,CAAQE,EAAR,CACA,GAAMC,CAAAA,cAAc,CAClBC,MAAM,CAACC,IAAP,CAAYL,gBAAgB,CAACM,cAAjB,CAAgCC,qBAAhC,EAAyD,EAArE,EACGC,MADH,CACY,CADZ,EACiBR,gBAAgB,CAACS,MAAjB,GAA4B,UAF/C,CAGA,gBACEf,UAAU,CACRJ,WAAW,sEAAC,mKAAYG,oBAAoB,CAACiB,OAArB,CAA6BR,EAA7B,CAAZ,wDAAD,GAA+C,CAACA,EAAD,CAA/C,CADH,CAER,EAFQ,CADZ,CAAeS,oBAAf,aAAQC,KAAR,CAA8CC,wBAA9C,aAAqCC,OAArC,CAMA,GAAMC,CAAAA,aAAa,2FAAG,+JACdF,CAAAA,wBAAwB,EADV,QAEpBZ,aAAa,CAACD,gBAAgB,CAACE,EAAlB,SAAsB,+BAAtB,CAAb,CAFoB,wDAAH,kBAAba,CAAAA,aAAa,2CAAnB,CAKA,yBACEpB,mBAAmB,CAACgB,oBAAD,CADrB,CAAeK,YAAf,sBAAQJ,KAAR,CAA2CK,mBAA3C,sBAA6BC,YAA7B,CAGA,mBACE,wCACE,KAAC,MAAD,EACE,UAAU,CAAEf,cADd,CAEE,OAAO,CAAEJ,YAAY,CAAG,SAAH,CAAe,OAFtC,CAGE,MAAM,CAAC,yBAHT,CAIE,OAAO,CAAE,yBAAMgB,CAAAA,aAAa,EAAnB,EAJX,CAKE,aACEZ,cAAc,SACV,iDADU,SAEV,iBARR,UAWGJ,YAAY,SAAG,iBAAH,cAAgB,KAAC,oBAAD,IAX/B,EADF,CAcGiB,YAAY,eACX,MAAC,UAAD,EACE,MAAM,CAAEA,YADV,CAEE,OAAO,CAAC,OAFV,CAGE,KAAK,SAAE,gBAHT,CAIE,OAAO,CAAEC,mBAJX,mBAMG,mCAAsBjB,gBAAgB,CAACmB,IAAvC,EANH,cAOE,KAAC,WAAD,EAAa,KAAK,CAAEH,YAApB,EAPF,GAfJ,GADF,CA4BD,CACD,cAAelB,CAAAA,sBAAf","sourcesContent":["import React, { useCallback } from 'react';\nimport { t } from '@lingui/macro';\nimport { Button } from '@patternfly/react-core';\nimport { OutlinedThumbsUpIcon } from '@patternfly/react-icons';\nimport { WorkflowApprovalsAPI } from 'api';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\n\nimport AlertModal from 'components/AlertModal';\nimport ErrorDetail from 'components/ErrorDetail';\n\nfunction WorkflowApprovalButton({\n  isDetailView,\n  workflowApproval,\n  onHandleToast,\n}) {\n  const { id } = workflowApproval;\n  const hasBeenActedOn =\n    Object.keys(workflowApproval.summary_fields.approved_or_denied_by || {})\n      .length > 0 || workflowApproval.status === 'canceled';\n  const { error: approveApprovalError, request: approveWorkflowApprovals } =\n    useRequest(\n      useCallback(async () => WorkflowApprovalsAPI.approve(id), [id]),\n      {}\n    );\n\n  const handleApprove = async () => {\n    await approveWorkflowApprovals();\n    onHandleToast(workflowApproval.id, t`Successfully Approved`);\n  };\n\n  const { error: approveError, dismissError: dismissApproveError } =\n    useDismissableError(approveApprovalError);\n\n  return (\n    <>\n      <Button\n        isDisabled={hasBeenActedOn}\n        variant={isDetailView ? 'primary' : 'plain'}\n        ouiaId=\"workflow-approve-button\"\n        onClick={() => handleApprove()}\n        aria-label={\n          hasBeenActedOn\n            ? t`This workflow has already been acted on`\n            : t`Approve`\n        }\n      >\n        {isDetailView ? t`Approve` : <OutlinedThumbsUpIcon />}\n      </Button>\n      {approveError && (\n        <AlertModal\n          isOpen={approveError}\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={dismissApproveError}\n        >\n          {t`Failed to approve ${workflowApproval.name}.`}\n          <ErrorDetail error={approveError} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\nexport default WorkflowApprovalButton;\n"]},"metadata":{},"sourceType":"module"}