{"ast":null,"code":"import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _defineProperty from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _createClass from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _classCallCheck from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _inherits from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import _wrapNativeSuper from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js\";var _frequencyTypes;import{RRule,rrulestr}from'rrule';import{dateToInputDateTime}from'util/dates';import{DateTime}from'luxon';import sortFrequencies from'./sortFrequencies';export var UnsupportedRRuleError=/*#__PURE__*/function(_Error){_inherits(UnsupportedRRuleError,_Error);var _super=_createSuper(UnsupportedRRuleError);function UnsupportedRRuleError(message){var _this;_classCallCheck(this,UnsupportedRRuleError);_this=_super.call(this,message);_this.name='UnsupportedRRuleError';return _this;}return _createClass(UnsupportedRRuleError);}(/*#__PURE__*/_wrapNativeSuper(Error));export default function parseRuleObj(schedule){var values={frequency:[],frequencyOptions:{},exceptionFrequency:[],exceptionOptions:{},timezone:schedule.timezone};var ruleset=rrulestr(schedule.rrule.replace(' ','\\n'),{forceset:true});var ruleStrings=ruleset.valueOf();ruleStrings.forEach(function(ruleString){var type=ruleString.match(/^[A-Z]+/)[0];switch(type){case'DTSTART':values=parseDtstart(schedule,values);break;case'RRULE':values=parseRrule(ruleString,schedule,values);break;default:throw new UnsupportedRRuleError(\"Unsupported rrule type: \".concat(type));}});if(isSingleOccurrence(values)){values.frequency=[];values.frequencyOptions={};}return values;}function isSingleOccurrence(values){if(values.frequency.length>1){return false;}if(values.frequency[0]!=='minute'){return false;}var options=values.frequencyOptions.minute;return options.end==='after'&&options.occurrences===1;}function parseDtstart(schedule,values){// TODO: should this rely on DTSTART in rruleset rather than schedule.dtstart?\nvar _dateToInputDateTime=dateToInputDateTime(schedule.dtstart,schedule.timezone),_dateToInputDateTime2=_slicedToArray(_dateToInputDateTime,2),startDate=_dateToInputDateTime2[0],startTime=_dateToInputDateTime2[1];return _objectSpread(_objectSpread({},values),{},{startDate:startDate,startTime:startTime});}var frequencyTypes=(_frequencyTypes={},_defineProperty(_frequencyTypes,RRule.MINUTELY,'minute'),_defineProperty(_frequencyTypes,RRule.HOURLY,'hour'),_defineProperty(_frequencyTypes,RRule.DAILY,'day'),_defineProperty(_frequencyTypes,RRule.WEEKLY,'week'),_defineProperty(_frequencyTypes,RRule.MONTHLY,'month'),_defineProperty(_frequencyTypes,RRule.YEARLY,'year'),_frequencyTypes);function parseRrule(rruleString,schedule,values){var _RRule$fromString=RRule.fromString(rruleString),_RRule$fromString$ori=_RRule$fromString.origOptions,bymonth=_RRule$fromString$ori.bymonth,bymonthday=_RRule$fromString$ori.bymonthday,bysetpos=_RRule$fromString$ori.bysetpos,byweekday=_RRule$fromString$ori.byweekday,count=_RRule$fromString$ori.count,freq=_RRule$fromString$ori.freq,interval=_RRule$fromString$ori.interval,until=_RRule$fromString$ori.until;var now=DateTime.now();var closestQuarterHour=DateTime.fromMillis(Math.ceil(now.ts/900000)*900000);var tomorrow=closestQuarterHour.plus({days:1});var _dateToInputDateTime3=dateToInputDateTime(closestQuarterHour.toISO()),_dateToInputDateTime4=_slicedToArray(_dateToInputDateTime3,2),time=_dateToInputDateTime4[1];var _dateToInputDateTime5=dateToInputDateTime(tomorrow.toISO()),_dateToInputDateTime6=_slicedToArray(_dateToInputDateTime5,1),tomorrowDate=_dateToInputDateTime6[0];var options={endDate:tomorrowDate,endTime:time,occurrences:1,interval:1,end:'never'};if(until){options.end='onDate';var end=DateTime.fromISO(until.toISOString());var _dateToInputDateTime7=dateToInputDateTime(end,schedule.timezone),_dateToInputDateTime8=_slicedToArray(_dateToInputDateTime7,2),endDate=_dateToInputDateTime8[0],endTime=_dateToInputDateTime8[1];options.endDate=endDate;options.endTime=endTime;}else if(count){options.end='after';options.occurrences=count;}if(interval){options.interval=interval;}if(typeof freq!=='number'){throw new Error(\"Unexpected rrule frequency: \".concat(freq));}var frequency=frequencyTypes[freq];if(values.frequency.includes(frequency)){throw new Error(\"Duplicate frequency types not supported (\".concat(frequency,\")\"));}if(freq===RRule.WEEKLY&&byweekday){options.daysOfWeek=byweekday;}if(freq===RRule.MONTHLY){options.runOn='day';options.runOnTheOccurrence=1;options.runOnTheDay='sunday';options.runOnDayNumber=1;if(bymonthday){options.runOnDayNumber=bymonthday;}if(bysetpos){options.runOn='the';options.runOnTheOccurrence=bysetpos;options.runOnTheDay=generateRunOnTheDay(byweekday);}}if(freq===RRule.YEARLY){options.runOn='day';options.runOnTheOccurrence=1;options.runOnTheDay='sunday';options.runOnTheMonth=1;options.runOnDayMonth=1;options.runOnDayNumber=1;if(bymonthday){options.runOnDayNumber=bymonthday;options.runOnDayMonth=bymonth;}if(bysetpos){options.runOn='the';options.runOnTheOccurrence=bysetpos;options.runOnTheDay=generateRunOnTheDay(byweekday);options.runOnTheMonth=bymonth;}}if(values.frequencyOptions.frequency){throw new UnsupportedRRuleError('Duplicate frequency types not supported');}return _objectSpread(_objectSpread({},values),{},{frequency:[].concat(_toConsumableArray(values.frequency),[frequency]).sort(sortFrequencies),frequencyOptions:_objectSpread(_objectSpread({},values.frequencyOptions),{},_defineProperty({},frequency,options))});}function generateRunOnTheDay(){var days=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if([RRule.MO,RRule.TU,RRule.WE,RRule.TH,RRule.FR,RRule.SA,RRule.SU].every(function(element){return days.indexOf(element)>-1;})){return'day';}if([RRule.MO,RRule.TU,RRule.WE,RRule.TH,RRule.FR].every(function(element){return days.indexOf(element)>-1;})){return'weekday';}if([RRule.SA,RRule.SU].every(function(element){return days.indexOf(element)>-1;})){return'weekendDay';}if(days.indexOf(RRule.MO)>-1){return'monday';}if(days.indexOf(RRule.TU)>-1){return'tuesday';}if(days.indexOf(RRule.WE)>-1){return'wednesday';}if(days.indexOf(RRule.TH)>-1){return'thursday';}if(days.indexOf(RRule.FR)>-1){return'friday';}if(days.indexOf(RRule.SA)>-1){return'saturday';}if(days.indexOf(RRule.SU)>-1){return'sunday';}return null;}","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/Schedule/shared/parseRuleObj.js"],"names":["RRule","rrulestr","dateToInputDateTime","DateTime","sortFrequencies","UnsupportedRRuleError","message","name","Error","parseRuleObj","schedule","values","frequency","frequencyOptions","exceptionFrequency","exceptionOptions","timezone","ruleset","rrule","replace","forceset","ruleStrings","valueOf","forEach","ruleString","type","match","parseDtstart","parseRrule","isSingleOccurrence","length","options","minute","end","occurrences","dtstart","startDate","startTime","frequencyTypes","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY","rruleString","fromString","origOptions","bymonth","bymonthday","bysetpos","byweekday","count","freq","interval","until","now","closestQuarterHour","fromMillis","Math","ceil","ts","tomorrow","plus","days","toISO","time","tomorrowDate","endDate","endTime","fromISO","toISOString","includes","daysOfWeek","runOn","runOnTheOccurrence","runOnTheDay","runOnDayNumber","generateRunOnTheDay","runOnTheMonth","runOnDayMonth","sort","MO","TU","WE","TH","FR","SA","SU","every","element","indexOf"],"mappings":"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","sourcesContent":["import { RRule, rrulestr } from 'rrule';\nimport { dateToInputDateTime } from 'util/dates';\nimport { DateTime } from 'luxon';\nimport sortFrequencies from './sortFrequencies';\n\nexport class UnsupportedRRuleError extends Error {\n  constructor(message) {\n    super(message);\n    this.name = 'UnsupportedRRuleError';\n  }\n}\n\nexport default function parseRuleObj(schedule) {\n  let values = {\n    frequency: [],\n    frequencyOptions: {},\n    exceptionFrequency: [],\n    exceptionOptions: {},\n    timezone: schedule.timezone,\n  };\n  const ruleset = rrulestr(schedule.rrule.replace(' ', '\\n'), {\n    forceset: true,\n  });\n\n  const ruleStrings = ruleset.valueOf();\n  ruleStrings.forEach((ruleString) => {\n    const type = ruleString.match(/^[A-Z]+/)[0];\n    switch (type) {\n      case 'DTSTART':\n        values = parseDtstart(schedule, values);\n        break;\n      case 'RRULE':\n        values = parseRrule(ruleString, schedule, values);\n        break;\n      default:\n        throw new UnsupportedRRuleError(`Unsupported rrule type: ${type}`);\n    }\n  });\n\n  if (isSingleOccurrence(values)) {\n    values.frequency = [];\n    values.frequencyOptions = {};\n  }\n\n  return values;\n}\n\nfunction isSingleOccurrence(values) {\n  if (values.frequency.length > 1) {\n    return false;\n  }\n  if (values.frequency[0] !== 'minute') {\n    return false;\n  }\n  const options = values.frequencyOptions.minute;\n  return options.end === 'after' && options.occurrences === 1;\n}\n\nfunction parseDtstart(schedule, values) {\n  // TODO: should this rely on DTSTART in rruleset rather than schedule.dtstart?\n  const [startDate, startTime] = dateToInputDateTime(\n    schedule.dtstart,\n    schedule.timezone\n  );\n  return {\n    ...values,\n    startDate,\n    startTime,\n  };\n}\n\nconst frequencyTypes = {\n  [RRule.MINUTELY]: 'minute',\n  [RRule.HOURLY]: 'hour',\n  [RRule.DAILY]: 'day',\n  [RRule.WEEKLY]: 'week',\n  [RRule.MONTHLY]: 'month',\n  [RRule.YEARLY]: 'year',\n};\n\nfunction parseRrule(rruleString, schedule, values) {\n  const {\n    origOptions: {\n      bymonth,\n      bymonthday,\n      bysetpos,\n      byweekday,\n      count,\n      freq,\n      interval,\n      until,\n    },\n  } = RRule.fromString(rruleString);\n\n  const now = DateTime.now();\n  const closestQuarterHour = DateTime.fromMillis(\n    Math.ceil(now.ts / 900000) * 900000\n  );\n  const tomorrow = closestQuarterHour.plus({ days: 1 });\n  const [, time] = dateToInputDateTime(closestQuarterHour.toISO());\n  const [tomorrowDate] = dateToInputDateTime(tomorrow.toISO());\n\n  const options = {\n    endDate: tomorrowDate,\n    endTime: time,\n    occurrences: 1,\n    interval: 1,\n    end: 'never',\n  };\n\n  if (until) {\n    options.end = 'onDate';\n    const end = DateTime.fromISO(until.toISOString());\n    const [endDate, endTime] = dateToInputDateTime(end, schedule.timezone);\n    options.endDate = endDate;\n    options.endTime = endTime;\n  } else if (count) {\n    options.end = 'after';\n    options.occurrences = count;\n  }\n\n  if (interval) {\n    options.interval = interval;\n  }\n\n  if (typeof freq !== 'number') {\n    throw new Error(`Unexpected rrule frequency: ${freq}`);\n  }\n  const frequency = frequencyTypes[freq];\n  if (values.frequency.includes(frequency)) {\n    throw new Error(`Duplicate frequency types not supported (${frequency})`);\n  }\n\n  if (freq === RRule.WEEKLY && byweekday) {\n    options.daysOfWeek = byweekday;\n  }\n\n  if (freq === RRule.MONTHLY) {\n    options.runOn = 'day';\n    options.runOnTheOccurrence = 1;\n    options.runOnTheDay = 'sunday';\n    options.runOnDayNumber = 1;\n\n    if (bymonthday) {\n      options.runOnDayNumber = bymonthday;\n    }\n    if (bysetpos) {\n      options.runOn = 'the';\n      options.runOnTheOccurrence = bysetpos;\n      options.runOnTheDay = generateRunOnTheDay(byweekday);\n    }\n  }\n\n  if (freq === RRule.YEARLY) {\n    options.runOn = 'day';\n    options.runOnTheOccurrence = 1;\n    options.runOnTheDay = 'sunday';\n    options.runOnTheMonth = 1;\n    options.runOnDayMonth = 1;\n    options.runOnDayNumber = 1;\n\n    if (bymonthday) {\n      options.runOnDayNumber = bymonthday;\n      options.runOnDayMonth = bymonth;\n    }\n    if (bysetpos) {\n      options.runOn = 'the';\n      options.runOnTheOccurrence = bysetpos;\n      options.runOnTheDay = generateRunOnTheDay(byweekday);\n      options.runOnTheMonth = bymonth;\n    }\n  }\n\n  if (values.frequencyOptions.frequency) {\n    throw new UnsupportedRRuleError('Duplicate frequency types not supported');\n  }\n\n  return {\n    ...values,\n    frequency: [...values.frequency, frequency].sort(sortFrequencies),\n    frequencyOptions: {\n      ...values.frequencyOptions,\n      [frequency]: options,\n    },\n  };\n}\n\nfunction generateRunOnTheDay(days = []) {\n  if (\n    [\n      RRule.MO,\n      RRule.TU,\n      RRule.WE,\n      RRule.TH,\n      RRule.FR,\n      RRule.SA,\n      RRule.SU,\n    ].every((element) => days.indexOf(element) > -1)\n  ) {\n    return 'day';\n  }\n  if (\n    [RRule.MO, RRule.TU, RRule.WE, RRule.TH, RRule.FR].every(\n      (element) => days.indexOf(element) > -1\n    )\n  ) {\n    return 'weekday';\n  }\n  if ([RRule.SA, RRule.SU].every((element) => days.indexOf(element) > -1)) {\n    return 'weekendDay';\n  }\n  if (days.indexOf(RRule.MO) > -1) {\n    return 'monday';\n  }\n  if (days.indexOf(RRule.TU) > -1) {\n    return 'tuesday';\n  }\n  if (days.indexOf(RRule.WE) > -1) {\n    return 'wednesday';\n  }\n  if (days.indexOf(RRule.TH) > -1) {\n    return 'thursday';\n  }\n  if (days.indexOf(RRule.FR) > -1) {\n    return 'friday';\n  }\n  if (days.indexOf(RRule.SA) > -1) {\n    return 'saturday';\n  }\n  if (days.indexOf(RRule.SU) > -1) {\n    return 'sunday';\n  }\n\n  return null;\n}\n"]},"metadata":{},"sourceType":"module"}