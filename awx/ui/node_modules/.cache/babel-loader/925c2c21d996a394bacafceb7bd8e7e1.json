{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3;import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{Link,useHistory,useParams}from'react-router-dom';import styled from'styled-components';import{Divider as PFDivider,Title as PFTitle,Chip}from'@patternfly/react-core';import AlertModal from'components/AlertModal';import ChipGroup from'components/ChipGroup';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import DeleteButton from'components/DeleteButton';import ErrorDetail from'components/ErrorDetail';import{CardBody,CardActionsRow}from'components/Card';import{Detail,DetailList,UserDateDetail}from'components/DetailList';import{VariablesDetail}from'components/CodeEditor';import{formatDateString,secondsToHHMMSS}from'util/dates';import{WorkflowApprovalsAPI,WorkflowJobTemplatesAPI,WorkflowJobsAPI}from'api';import useRequest,{useDismissableError}from'hooks/useRequest';import{WorkflowApproval}from'types';import StatusLabel from'components/StatusLabel';import JobCancelButton from'components/JobCancelButton';import useToast,{AlertVariant}from'hooks/useToast';import WorkflowApprovalButton from'../shared/WorkflowApprovalButton';import WorkflowDenyButton from'../shared/WorkflowDenyButton';import{getDetailPendingLabel,getStatus}from'../shared/WorkflowApprovalUtils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Divider=styled(PFDivider)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin-top: var(--pf-global--spacer--lg);\\n  margin-bottom: var(--pf-global--spacer--lg);\\n\"])));var Title=styled(PFTitle)(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  margin-top: var(--pf-global--spacer--xl);\\n  --pf-c-title--m-md--FontWeight: 700;\\n\"])));var WFDetailList=styled(DetailList)(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  padding: 0px var(--pf-global--spacer--lg);\\n\"])));function WorkflowApprovalDetail(_ref){var _workflowApproval$sum,_workflowApproval$sum2,_workflowApproval$sum3,_workflowApproval$sum4,_workflowJob$summary_,_workflowJob$summary_2,_workflowJob$summary_3,_workflowJob$summary_4,_workflowJob$summary_5,_workflowJob$summary_6,_workflowJob$summary_7;var workflowApproval=_ref.workflowApproval,fetchWorkflowApproval=_ref.fetchWorkflowApproval;var _useParams=useParams(),workflowApprovalId=_useParams.id;var history=useHistory();var _useToast=useToast(),addToast=_useToast.addToast,Toast=_useToast.Toast,toastProps=_useToast.toastProps;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return WorkflowApprovalsAPI.destroy(workflowApprovalId);case 2:history.push(\"/workflow_approvals\");case 3:case\"end\":return _context.stop();}}},_callee);})),[workflowApprovalId,history])),deleteWorkflowApproval=_useRequest.request,isDeleteLoading=_useRequest.isLoading,deleteApprovalError=_useRequest.error;var _useDismissableError=useDismissableError(deleteApprovalError),deleteError=_useDismissableError.error,dismissDeleteError=_useDismissableError.dismissError;var workflowJobTemplateId=workflowApproval.summary_fields.workflow_job_template.id;var _useRequest2=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _workflowJobTemplate$,_workflowJobTemplate$2;var _yield$WorkflowJobTem,workflowJobTemplate,jobId,_yield$WorkflowJobsAP,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(workflowJobTemplateId){_context2.next=2;break;}return _context2.abrupt(\"return\",{});case 2:_context2.next=4;return WorkflowJobTemplatesAPI.readDetail(workflowJobTemplateId);case 4:_yield$WorkflowJobTem=_context2.sent;workflowJobTemplate=_yield$WorkflowJobTem.data;jobId=null;if((_workflowJobTemplate$=workflowJobTemplate.summary_fields)!==null&&_workflowJobTemplate$!==void 0&&_workflowJobTemplate$.current_job){jobId=workflowJobTemplate.summary_fields.current_job.id;}else if((_workflowJobTemplate$2=workflowJobTemplate.summary_fields)!==null&&_workflowJobTemplate$2!==void 0&&_workflowJobTemplate$2.last_job){jobId=workflowJobTemplate.summary_fields.last_job.id;}_context2.next=10;return WorkflowJobsAPI.readDetail(jobId);case 10:_yield$WorkflowJobsAP=_context2.sent;data=_yield$WorkflowJobsAP.data;return _context2.abrupt(\"return\",data);case 13:case\"end\":return _context2.stop();}}},_callee2);})),[workflowJobTemplateId]),{workflowJob:null,isLoading:true}),fetchWorkflowJobError=_useRequest2.error,isLoadingWorkflowJob=_useRequest2.isLoading,fetchWorkflowJob=_useRequest2.request,workflowJob=_useRequest2.result;useEffect(function(){fetchWorkflowJob();},[fetchWorkflowJob]);var handleToast=useCallback(function(id,title){addToast({id:id,title:title,variant:AlertVariant.success,hasTimeout:true});fetchWorkflowApproval();},[addToast,fetchWorkflowApproval]);var sourceWorkflowJob=workflowApproval===null||workflowApproval===void 0?void 0:(_workflowApproval$sum=workflowApproval.summary_fields)===null||_workflowApproval$sum===void 0?void 0:_workflowApproval$sum.source_workflow_job;var sourceWorkflowJobTemplate=workflowApproval===null||workflowApproval===void 0?void 0:(_workflowApproval$sum2=workflowApproval.summary_fields)===null||_workflowApproval$sum2===void 0?void 0:_workflowApproval$sum2.workflow_job_template;var isLoading=isDeleteLoading||isLoadingWorkflowJob;if(isLoadingWorkflowJob){return/*#__PURE__*/_jsx(ContentLoading,{});}if(fetchWorkflowJobError){return/*#__PURE__*/_jsx(ContentError,{error:fetchWorkflowJobError});}var showDeleteButton=workflowApproval.status!=='pending'&&((_workflowApproval$sum3=workflowApproval.summary_fields)===null||_workflowApproval$sum3===void 0?void 0:(_workflowApproval$sum4=_workflowApproval$sum3.user_capabilities)===null||_workflowApproval$sum4===void 0?void 0:_workflowApproval$sum4.delete);return/*#__PURE__*/_jsxs(CardBody,{children:[/*#__PURE__*/_jsxs(DetailList,{gutter:\"sm\",children:[/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Name\"),value:workflowApproval.name,dataCy:\"wa-detail-name\"}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Description\"),value:workflowApproval.description,dataCy:\"wa-detail-description\"}),workflowApproval.status==='pending'&&/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Expires\"),value:/*#__PURE__*/_jsx(StatusLabel,{status:workflowApproval.status,children:getDetailPendingLabel(workflowApproval)}),dataCy:\"wa-detail-expires\"}),workflowApproval.status!=='pending'&&/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Status\"),value:/*#__PURE__*/_jsx(StatusLabel,{status:getStatus(workflowApproval)}),dataCy:\"wa-detail-status\"}),workflowApproval.summary_fields.approved_or_denied_by&&/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Actor\"),value:/*#__PURE__*/_jsx(Link,{to:\"/users/\".concat(workflowApproval.summary_fields.approved_or_denied_by.id),children:workflowApproval.summary_fields.approved_or_denied_by.username}),dataCy:\"wa-detail-actor\"}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Explanation\"),value:workflowApproval.job_explanation,dataCy:\"wa-detail-explanation\"}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Workflow Job Template\"),value:sourceWorkflowJobTemplate&&/*#__PURE__*/_jsx(Link,{to:\"/templates/workflow_job_template/\".concat(sourceWorkflowJobTemplate===null||sourceWorkflowJobTemplate===void 0?void 0:sourceWorkflowJobTemplate.id),children:sourceWorkflowJobTemplate===null||sourceWorkflowJobTemplate===void 0?void 0:sourceWorkflowJobTemplate.name}),dataCy:\"wa-detail-source-workflow\"}),/*#__PURE__*/_jsx(UserDateDetail,{label:/*i18n*/i18n._(\"Created\"),date:workflowApproval.created,user:workflowApproval.summary_fields.created_by}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Last Modified\"),value:formatDateString(workflowApproval.modified)}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Finished\"),value:formatDateString(workflowApproval.finished)}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Canceled\"),value:formatDateString(workflowApproval.canceled_on)}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Elapsed\"),value:secondsToHHMMSS(workflowApproval.elapsed)})]}),/*#__PURE__*/_jsx(Title,{headingLevel:\"h2\",children:/*i18n*/i18n._(\"Workflow job details\")}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(WFDetailList,{gutter:\"sm\",children:[/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Workflow Job\"),value:sourceWorkflowJob&&sourceWorkflowJob!==null&&sourceWorkflowJob!==void 0&&sourceWorkflowJob.id?/*#__PURE__*/_jsx(Link,{to:\"/jobs/workflow/\".concat(sourceWorkflowJob===null||sourceWorkflowJob===void 0?void 0:sourceWorkflowJob.id),children:\"\".concat(sourceWorkflowJob===null||sourceWorkflowJob===void 0?void 0:sourceWorkflowJob.id,\" - \").concat(sourceWorkflowJob===null||sourceWorkflowJob===void 0?void 0:sourceWorkflowJob.name)}):/*i18n*/i18n._(\"Deleted\"),dataCy:\"wa-detail-source-job\"}),workflowJob!==null&&workflowJob!==void 0&&workflowJob.limit?/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Limit\"),value:workflowJob.limit,dataCy:\"wa-detail-source-job-limit\"}):null,workflowJob!==null&&workflowJob!==void 0&&workflowJob.scm_branch?/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Source Control Branch\"),value:workflowJob.scm_branch,dataCy:\"wa-detail-source-job-scm\"}):null,workflowJob!==null&&workflowJob!==void 0&&(_workflowJob$summary_=workflowJob.summary_fields)!==null&&_workflowJob$summary_!==void 0&&_workflowJob$summary_.inventory?/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Inventory\"),value:workflowJob.summary_fields.inventory?/*#__PURE__*/_jsx(Link,{to:\"/inventories/\".concat(((_workflowJob$summary_2=workflowJob.summary_fields.inventory)===null||_workflowJob$summary_2===void 0?void 0:_workflowJob$summary_2.kind)==='smart'?'smart_inventory':'inventory',\"/\").concat((_workflowJob$summary_3=workflowJob.summary_fields.inventory)===null||_workflowJob$summary_3===void 0?void 0:_workflowJob$summary_3.id,\"/details\"),children:(_workflowJob$summary_4=workflowJob.summary_fields.inventory)===null||_workflowJob$summary_4===void 0?void 0:_workflowJob$summary_4.name}):' ',dataCy:\"wa-detail-inventory\"}):null,/*#__PURE__*/_jsx(Detail,{fullWidth:true,label:/*i18n*/i18n._(\"Labels\"),value:/*#__PURE__*/_jsx(ChipGroup,{numChips:5,totalChips:workflowJob.summary_fields.labels.results.length,ouiaId:\"wa-detail-label-chips\",children:workflowJob.summary_fields.labels.results.map(function(label){return/*#__PURE__*/_jsx(Chip,{isReadOnly:true,children:label.name},label.id);})}),isEmpty:!(workflowJob!==null&&workflowJob!==void 0&&(_workflowJob$summary_5=workflowJob.summary_fields)!==null&&_workflowJob$summary_5!==void 0&&(_workflowJob$summary_6=_workflowJob$summary_5.labels)!==null&&_workflowJob$summary_6!==void 0&&(_workflowJob$summary_7=_workflowJob$summary_6.results)!==null&&_workflowJob$summary_7!==void 0&&_workflowJob$summary_7.length)}),workflowJob!==null&&workflowJob!==void 0&&workflowJob.extra_vars?/*#__PURE__*/_jsx(VariablesDetail,{dataCy:\"wa-detail-variables\",id:\"wa-detail-extra-vars\",label:/*i18n*/i18n._(\"Variables\"),name:\"extra_vars\",rows:5,value:workflowJob.extra_vars}):null]}),/*#__PURE__*/_jsxs(CardActionsRow,{children:[workflowApproval.status==='pending'&&workflowApproval.can_approve_or_deny&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(WorkflowApprovalButton,{workflowApproval:workflowApproval,isDetailView:true,onHandleToast:handleToast}),/*#__PURE__*/_jsx(WorkflowDenyButton,{workflowApproval:workflowApproval,isDetailView:true,onHandleToast:handleToast}),/*#__PURE__*/_jsx(JobCancelButton,{onCancelWorkflow:function onCancelWorkflow(){return handleToast(workflowApproval.summary_fields.source_workflow_job.id,'Workflow Cancelled ');},title:/*i18n*/i18n._(\"Cancel Workflow\"),job:_objectSpread(_objectSpread({},workflowApproval.summary_fields.source_workflow_job),{},{type:'workflow_job'}),buttonText:/*i18n*/i18n._(\"Cancel Workflow\"),cancelationMessage:/*i18n*/i18n._(\"This will cancel all subsequent nodes in this workflow.\")})]}),showDeleteButton&&/*#__PURE__*/_jsx(DeleteButton,{name:workflowApproval.name,modalTitle:/*i18n*/i18n._(\"Delete Workflow Approval\"),onConfirm:deleteWorkflowApproval,isDisabled:isLoading,children:/*i18n*/i18n._(\"Delete\")})]}),deleteError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:deleteError,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:dismissDeleteError,children:[/*i18n*/i18n._(\"Failed to delete workflow approval.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:deleteError})]}),/*#__PURE__*/_jsx(Toast,_objectSpread({},toastProps))]});}WorkflowApprovalDetail.defaultProps={workflowApproval:WorkflowApproval.isRequired};export default WorkflowApprovalDetail;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/WorkflowApproval/WorkflowApprovalDetail/WorkflowApprovalDetail.js"],"names":["React","useCallback","useEffect","Link","useHistory","useParams","styled","Divider","PFDivider","Title","PFTitle","Chip","AlertModal","ChipGroup","ContentError","ContentLoading","DeleteButton","ErrorDetail","CardBody","CardActionsRow","Detail","DetailList","UserDateDetail","VariablesDetail","formatDateString","secondsToHHMMSS","WorkflowApprovalsAPI","WorkflowJobTemplatesAPI","WorkflowJobsAPI","useRequest","useDismissableError","WorkflowApproval","StatusLabel","JobCancelButton","useToast","AlertVariant","WorkflowApprovalButton","WorkflowDenyButton","getDetailPendingLabel","getStatus","WFDetailList","WorkflowApprovalDetail","workflowApproval","fetchWorkflowApproval","workflowApprovalId","id","history","addToast","Toast","toastProps","destroy","push","deleteWorkflowApproval","request","isDeleteLoading","isLoading","deleteApprovalError","error","deleteError","dismissDeleteError","dismissError","workflowJobTemplateId","summary_fields","workflow_job_template","readDetail","workflowJobTemplate","data","jobId","current_job","last_job","workflowJob","fetchWorkflowJobError","isLoadingWorkflowJob","fetchWorkflowJob","result","handleToast","title","variant","success","hasTimeout","sourceWorkflowJob","source_workflow_job","sourceWorkflowJobTemplate","showDeleteButton","status","user_capabilities","delete","name","description","approved_or_denied_by","username","job_explanation","created","created_by","modified","finished","canceled_on","elapsed","limit","scm_branch","inventory","kind","labels","results","length","map","label","extra_vars","can_approve_or_deny","type","defaultProps","isRequired"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { t } from '@lingui/macro';\nimport { Link, useHistory, useParams } from 'react-router-dom';\nimport styled from 'styled-components';\nimport {\n  Divider as PFDivider,\n  Title as PFTitle,\n  Chip,\n} from '@patternfly/react-core';\nimport AlertModal from 'components/AlertModal';\nimport ChipGroup from 'components/ChipGroup';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport DeleteButton from 'components/DeleteButton';\nimport ErrorDetail from 'components/ErrorDetail';\nimport { CardBody, CardActionsRow } from 'components/Card';\nimport { Detail, DetailList, UserDateDetail } from 'components/DetailList';\nimport { VariablesDetail } from 'components/CodeEditor';\nimport { formatDateString, secondsToHHMMSS } from 'util/dates';\nimport {\n  WorkflowApprovalsAPI,\n  WorkflowJobTemplatesAPI,\n  WorkflowJobsAPI,\n} from 'api';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport { WorkflowApproval } from 'types';\nimport StatusLabel from 'components/StatusLabel';\nimport JobCancelButton from 'components/JobCancelButton';\nimport useToast, { AlertVariant } from 'hooks/useToast';\nimport WorkflowApprovalButton from '../shared/WorkflowApprovalButton';\nimport WorkflowDenyButton from '../shared/WorkflowDenyButton';\nimport {\n  getDetailPendingLabel,\n  getStatus,\n} from '../shared/WorkflowApprovalUtils';\n\nconst Divider = styled(PFDivider)`\n  margin-top: var(--pf-global--spacer--lg);\n  margin-bottom: var(--pf-global--spacer--lg);\n`;\n\nconst Title = styled(PFTitle)`\n  margin-top: var(--pf-global--spacer--xl);\n  --pf-c-title--m-md--FontWeight: 700;\n`;\n\nconst WFDetailList = styled(DetailList)`\n  padding: 0px var(--pf-global--spacer--lg);\n`;\n\nfunction WorkflowApprovalDetail({ workflowApproval, fetchWorkflowApproval }) {\n  const { id: workflowApprovalId } = useParams();\n  const history = useHistory();\n  const { addToast, Toast, toastProps } = useToast();\n\n  const {\n    request: deleteWorkflowApproval,\n    isLoading: isDeleteLoading,\n    error: deleteApprovalError,\n  } = useRequest(\n    useCallback(async () => {\n      await WorkflowApprovalsAPI.destroy(workflowApprovalId);\n      history.push(`/workflow_approvals`);\n    }, [workflowApprovalId, history])\n  );\n\n  const { error: deleteError, dismissError: dismissDeleteError } =\n    useDismissableError(deleteApprovalError);\n\n  const workflowJobTemplateId =\n    workflowApproval.summary_fields.workflow_job_template.id;\n\n  const {\n    error: fetchWorkflowJobError,\n    isLoading: isLoadingWorkflowJob,\n    request: fetchWorkflowJob,\n    result: workflowJob,\n  } = useRequest(\n    useCallback(async () => {\n      if (!workflowJobTemplateId) {\n        return {};\n      }\n      const { data: workflowJobTemplate } =\n        await WorkflowJobTemplatesAPI.readDetail(workflowJobTemplateId);\n\n      let jobId = null;\n\n      if (workflowJobTemplate.summary_fields?.current_job) {\n        jobId = workflowJobTemplate.summary_fields.current_job.id;\n      } else if (workflowJobTemplate.summary_fields?.last_job) {\n        jobId = workflowJobTemplate.summary_fields.last_job.id;\n      }\n      const { data } = await WorkflowJobsAPI.readDetail(jobId);\n\n      return data;\n    }, [workflowJobTemplateId]),\n    {\n      workflowJob: null,\n      isLoading: true,\n    }\n  );\n\n  useEffect(() => {\n    fetchWorkflowJob();\n  }, [fetchWorkflowJob]);\n\n  const handleToast = useCallback(\n    (id, title) => {\n      addToast({\n        id,\n        title,\n        variant: AlertVariant.success,\n        hasTimeout: true,\n      });\n      fetchWorkflowApproval();\n    },\n    [addToast, fetchWorkflowApproval]\n  );\n  const sourceWorkflowJob =\n    workflowApproval?.summary_fields?.source_workflow_job;\n\n  const sourceWorkflowJobTemplate =\n    workflowApproval?.summary_fields?.workflow_job_template;\n\n  const isLoading = isDeleteLoading || isLoadingWorkflowJob;\n\n  if (isLoadingWorkflowJob) {\n    return <ContentLoading />;\n  }\n  if (fetchWorkflowJobError) {\n    return <ContentError error={fetchWorkflowJobError} />;\n  }\n  const showDeleteButton =\n    workflowApproval.status !== 'pending' &&\n    workflowApproval.summary_fields?.user_capabilities?.delete;\n  return (\n    <CardBody>\n      <DetailList gutter=\"sm\">\n        <Detail\n          label={t`Name`}\n          value={workflowApproval.name}\n          dataCy=\"wa-detail-name\"\n        />\n        <Detail\n          label={t`Description`}\n          value={workflowApproval.description}\n          dataCy=\"wa-detail-description\"\n        />\n        {workflowApproval.status === 'pending' && (\n          <Detail\n            label={t`Expires`}\n            value={\n              <StatusLabel status={workflowApproval.status}>\n                {getDetailPendingLabel(workflowApproval)}\n              </StatusLabel>\n            }\n            dataCy=\"wa-detail-expires\"\n          />\n        )}\n        {workflowApproval.status !== 'pending' && (\n          <Detail\n            label={t`Status`}\n            value={<StatusLabel status={getStatus(workflowApproval)} />}\n            dataCy=\"wa-detail-status\"\n          />\n        )}\n        {workflowApproval.summary_fields.approved_or_denied_by && (\n          <Detail\n            label={t`Actor`}\n            value={\n              <Link\n                to={`/users/${workflowApproval.summary_fields.approved_or_denied_by.id}`}\n              >\n                {workflowApproval.summary_fields.approved_or_denied_by.username}\n              </Link>\n            }\n            dataCy=\"wa-detail-actor\"\n          />\n        )}\n        <Detail\n          label={t`Explanation`}\n          value={workflowApproval.job_explanation}\n          dataCy=\"wa-detail-explanation\"\n        />\n        <Detail\n          label={t`Workflow Job Template`}\n          value={\n            sourceWorkflowJobTemplate && (\n              <Link\n                to={`/templates/workflow_job_template/${sourceWorkflowJobTemplate?.id}`}\n              >\n                {sourceWorkflowJobTemplate?.name}\n              </Link>\n            )\n          }\n          dataCy=\"wa-detail-source-workflow\"\n        />\n        <UserDateDetail\n          label={t`Created`}\n          date={workflowApproval.created}\n          user={workflowApproval.summary_fields.created_by}\n        />\n        <Detail\n          label={t`Last Modified`}\n          value={formatDateString(workflowApproval.modified)}\n        />\n        <Detail\n          label={t`Finished`}\n          value={formatDateString(workflowApproval.finished)}\n        />\n        <Detail\n          label={t`Canceled`}\n          value={formatDateString(workflowApproval.canceled_on)}\n        />\n        <Detail\n          label={t`Elapsed`}\n          value={secondsToHHMMSS(workflowApproval.elapsed)}\n        />\n      </DetailList>\n      <Title headingLevel=\"h2\">{t`Workflow job details`}</Title>\n      <Divider />\n      <WFDetailList gutter=\"sm\">\n        <Detail\n          label={t`Workflow Job`}\n          value={\n            sourceWorkflowJob && sourceWorkflowJob?.id ? (\n              <Link to={`/jobs/workflow/${sourceWorkflowJob?.id}`}>\n                {`${sourceWorkflowJob?.id} - ${sourceWorkflowJob?.name}`}\n              </Link>\n            ) : (\n              t`Deleted`\n            )\n          }\n          dataCy=\"wa-detail-source-job\"\n        />\n        {workflowJob?.limit ? (\n          <Detail\n            label={t`Limit`}\n            value={workflowJob.limit}\n            dataCy=\"wa-detail-source-job-limit\"\n          />\n        ) : null}\n        {workflowJob?.scm_branch ? (\n          <Detail\n            label={t`Source Control Branch`}\n            value={workflowJob.scm_branch}\n            dataCy=\"wa-detail-source-job-scm\"\n          />\n        ) : null}\n        {workflowJob?.summary_fields?.inventory ? (\n          <Detail\n            label={t`Inventory`}\n            value={\n              workflowJob.summary_fields.inventory ? (\n                <Link\n                  to={`/inventories/${\n                    workflowJob.summary_fields.inventory?.kind === 'smart'\n                      ? 'smart_inventory'\n                      : 'inventory'\n                  }/${workflowJob.summary_fields.inventory?.id}/details`}\n                >\n                  {workflowJob.summary_fields.inventory?.name}\n                </Link>\n              ) : (\n                ' '\n              )\n            }\n            dataCy=\"wa-detail-inventory\"\n          />\n        ) : null}\n        <Detail\n          fullWidth\n          label={t`Labels`}\n          value={\n            <ChipGroup\n              numChips={5}\n              totalChips={workflowJob.summary_fields.labels.results.length}\n              ouiaId=\"wa-detail-label-chips\"\n            >\n              {workflowJob.summary_fields.labels.results.map((label) => (\n                <Chip key={label.id} isReadOnly>\n                  {label.name}\n                </Chip>\n              ))}\n            </ChipGroup>\n          }\n          isEmpty={!workflowJob?.summary_fields?.labels?.results?.length}\n        />\n        {workflowJob?.extra_vars ? (\n          <VariablesDetail\n            dataCy=\"wa-detail-variables\"\n            id=\"wa-detail-extra-vars\"\n            label={t`Variables`}\n            name=\"extra_vars\"\n            rows={5}\n            value={workflowJob.extra_vars}\n          />\n        ) : null}\n      </WFDetailList>\n\n      <CardActionsRow>\n        {workflowApproval.status === 'pending' &&\n          workflowApproval.can_approve_or_deny && (\n            <>\n              <WorkflowApprovalButton\n                workflowApproval={workflowApproval}\n                isDetailView\n                onHandleToast={handleToast}\n              />\n              <WorkflowDenyButton\n                workflowApproval={workflowApproval}\n                isDetailView\n                onHandleToast={handleToast}\n              />\n              <JobCancelButton\n                onCancelWorkflow={() =>\n                  handleToast(\n                    workflowApproval.summary_fields.source_workflow_job.id,\n                    'Workflow Cancelled '\n                  )\n                }\n                title={t`Cancel Workflow`}\n                job={{\n                  ...workflowApproval.summary_fields.source_workflow_job,\n                  type: 'workflow_job',\n                }}\n                buttonText={t`Cancel Workflow`}\n                cancelationMessage={t`This will cancel all subsequent nodes in this workflow.\n            `}\n              />\n            </>\n          )}\n        {showDeleteButton && (\n          <DeleteButton\n            name={workflowApproval.name}\n            modalTitle={t`Delete Workflow Approval`}\n            onConfirm={deleteWorkflowApproval}\n            isDisabled={isLoading}\n          >\n            {t`Delete`}\n          </DeleteButton>\n        )}\n      </CardActionsRow>\n      {deleteError && (\n        <AlertModal\n          isOpen={deleteError}\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={dismissDeleteError}\n        >\n          {t`Failed to delete workflow approval.`}\n          <ErrorDetail error={deleteError} />\n        </AlertModal>\n      )}\n      <Toast {...toastProps} />\n    </CardBody>\n  );\n}\n\nWorkflowApprovalDetail.defaultProps = {\n  workflowApproval: WorkflowApproval.isRequired,\n};\n\nexport default WorkflowApprovalDetail;\n"]},"metadata":{},"sourceType":"module"}