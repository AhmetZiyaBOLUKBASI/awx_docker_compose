{"ast":null,"code":"import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _styled from\"styled-components\";import{i18n}from\"@lingui/core\";import React,{useEffect,useState}from'react';import{Button,ButtonVariant,Divider,InputGroup,Select,SelectGroup,SelectOption,SelectVariant,TextInput,Tooltip}from'@patternfly/react-core';import{SearchIcon,QuestionCircleIcon}from'@patternfly/react-icons';import styled from'styled-components';import{useLocation}from'react-router-dom';import{useConfig}from'contexts/Config';import getDocsBaseUrl from'util/getDocsBaseUrl';import{SearchableKeys}from'types';import RelatedLookupTypeInput from'./RelatedLookupTypeInput';import LookupTypeInput from'./LookupTypeInput';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AdvancedGroup=styled.div.withConfig({displayName:\"AdvancedSearch__AdvancedGroup\",componentId:\"sc-1wuv834-0\"})([\"display:flex;@media (max-width:991px){display:grid;grid-gap:var(--pf-c-toolbar__expandable-content--m-expanded--GridRowGap);}& .pf-c-select{min-width:150px;}\"]);var _StyledDiv=styled(\"div\").withConfig({displayName:\"AdvancedSearch___StyledDiv\",componentId:\"sc-1wuv834-1\"})([\"\",\"\"],function(p){return p._css;});function AdvancedSearch(_ref){var onSearch=_ref.onSearch,searchableKeys=_ref.searchableKeys,relatedSearchableKeys=_ref.relatedSearchableKeys,maxSelectHeight=_ref.maxSelectHeight,enableNegativeFiltering=_ref.enableNegativeFiltering,enableRelatedFuzzyFiltering=_ref.enableRelatedFuzzyFiltering,handleIsAnsibleFactsSelected=_ref.handleIsAnsibleFactsSelected,isFilterCleared=_ref.isFilterCleared;var relatedKeys=relatedSearchableKeys.filter(function(sKey){return!searchableKeys.map(function(_ref2){var key=_ref2.key;return key;}).includes(sKey);});var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isPrefixDropdownOpen=_useState2[0],setIsPrefixDropdownOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isKeyDropdownOpen=_useState4[0],setIsKeyDropdownOpen=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),prefixSelection=_useState6[0],setPrefixSelection=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),lookupSelection=_useState8[0],setLookupSelection=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),keySelection=_useState10[0],setKeySelection=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),searchValue=_useState12[0],setSearchValue=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isTextInputDisabled=_useState14[0],setIsTextInputDisabled=_useState14[1];var _useLocation=useLocation(),pathname=_useLocation.pathname,search=_useLocation.search;useEffect(function(){if(keySelection==='ansible_facts'){handleIsAnsibleFactsSelected(true);setPrefixSelection(null);}else{handleIsAnsibleFactsSelected(false);}},[keySelection]);// eslint-disable-line react-hooks/exhaustive-deps\nuseEffect(function(){if(isFilterCleared&&keySelection==='ansible_facts'){setIsTextInputDisabled(false);}},[isFilterCleared,keySelection]);useEffect(function(){if((pathname.includes('edit')||pathname.includes('add'))&&keySelection==='ansible_facts'&&search.includes('ansible_facts')){setIsTextInputDisabled(true);}else{setIsTextInputDisabled(false);}},[keySelection,pathname,search]);var config=useConfig();var selectedKey=searchableKeys.find(function(k){return k.key===keySelection;});var relatedSearchKeySelected=keySelection&&relatedSearchableKeys.indexOf(keySelection)>-1&&!selectedKey;var lookupKeyType=keySelection&&!relatedSearchKeySelected?selectedKey===null||selectedKey===void 0?void 0:selectedKey.type:null;useEffect(function(){if(relatedSearchKeySelected&&keySelection!=='ansible_facts'){setLookupSelection('name__icontains');}else{setLookupSelection(null);}},[keySelection]);// eslint-disable-line react-hooks/exhaustive-deps\nuseEffect(function(){if(lookupSelection==='search'){setPrefixSelection(null);}},[lookupSelection]);// eslint-disable-line react-hooks/exhaustive-deps\nvar handleAdvancedSearch=function handleAdvancedSearch(e){// keeps page from fully reloading\ne.preventDefault();if(searchValue){var actualPrefix=prefixSelection==='and'?null:prefixSelection;var actualSearchKey=[actualPrefix,keySelection,lookupSelection].filter(function(val){return!!val;}).join('__');if(keySelection==='ansible_facts'){var ansibleFactValue=\"\".concat(actualSearchKey,\"__\").concat(searchValue);onSearch('host_filter',ansibleFactValue);}else{onSearch(actualSearchKey,searchValue);}setSearchValue('');}};var handleAdvancedTextKeyDown=function handleAdvancedTextKeyDown(e){if(e.key&&e.key==='Enter'){handleAdvancedSearch(e);}};var renderSetType=function renderSetType(){return/*#__PURE__*/_jsxs(Select,{ouiaId:\"set-type-typeahead\",\"aria-label\":/*i18n*/i18n._(\"Set type select\"),className:\"setTypeSelect\",variant:SelectVariant.typeahead,typeAheadAriaLabel:/*i18n*/i18n._(\"Set type typeahead\"),onToggle:setIsPrefixDropdownOpen,onSelect:function onSelect(event,selection){return setPrefixSelection(selection);},onClear:function onClear(){return setPrefixSelection(null);},selections:prefixSelection,isOpen:isPrefixDropdownOpen,placeholderText:/*i18n*/i18n._(\"Set type\"),maxHeight:maxSelectHeight,noResultsFoundText:/*i18n*/i18n._(\"No results found\"),isDisabled:lookupSelection==='search',children:[/*#__PURE__*/_jsx(SelectOption,{id:\"and-option-select\",value:\"and\",description:/*i18n*/i18n._(\"Returns results that satisfy this one as well as other filters.  This is the default set type if nothing is selected.\")},\"and\"),/*#__PURE__*/_jsx(SelectOption,{id:\"or-option-select\",value:\"or\",description:/*i18n*/i18n._(\"Returns results that satisfy this one or any other filters.\")},\"or\"),enableNegativeFiltering&&/*#__PURE__*/_jsx(SelectOption,{id:\"not-option-select\",value:\"not\",description:/*i18n*/i18n._(\"Returns results that have values other than this one as well as other filters.\")},\"not\")]});};var renderLookupType=function renderLookupType(){if(keySelection==='ansible_facts')return null;return relatedSearchKeySelected?/*#__PURE__*/_jsx(RelatedLookupTypeInput,{value:lookupSelection,setValue:setLookupSelection,maxSelectHeight:maxSelectHeight,enableFuzzyFiltering:enableRelatedFuzzyFiltering}):/*#__PURE__*/_jsx(LookupTypeInput,{value:lookupSelection,type:lookupKeyType,setValue:setLookupSelection,maxSelectHeight:maxSelectHeight});};var renderTextInput=function renderTextInput(){var placeholderText;if(keySelection==='labels'&&lookupSelection==='search'){placeholderText='e.g. label_1,label_2';}if(isTextInputDisabled){return/*#__PURE__*/_jsx(Tooltip,{content:/*i18n*/i18n._(\"Remove the current search related to ansible facts to enable another search using this key.\"),children:/*#__PURE__*/_jsx(TextInput,{\"data-cy\":\"advanced-search-text-input\",type:\"search\",\"aria-label\":/*i18n*/i18n._(\"Advanced search value input\"),isDisabled:!keySelection||isTextInputDisabled,value:!keySelection&&/*i18n*/i18n._(\"First, select a key\")||searchValue,onChange:setSearchValue,onKeyDown:handleAdvancedTextKeyDown})});}return/*#__PURE__*/_jsx(TextInput,{\"data-cy\":\"advanced-search-text-input\",type:\"search\",\"aria-label\":/*i18n*/i18n._(\"Advanced search value input\"),isDisabled:!keySelection,value:!keySelection&&/*i18n*/i18n._(\"First, select a key\")||searchValue,onChange:setSearchValue,onKeyDown:handleAdvancedTextKeyDown,placeholder:placeholderText});};var renderLookupSelection=function renderLookupSelection(){if(keySelection==='ansible_facts')return null;return lookupSelection==='search'?/*#__PURE__*/_jsx(Tooltip,{content:/*i18n*/i18n._(\"Set type disabled for related search field fuzzy searches\"),children:renderSetType()}):renderSetType();};return/*#__PURE__*/_jsxs(AdvancedGroup,{children:[renderLookupSelection(),/*#__PURE__*/_jsx(Select,{ouiaId:\"set-key-typeahead\",\"aria-label\":/*i18n*/i18n._(\"Key select\"),className:\"keySelect\",variant:SelectVariant.typeahead,typeAheadAriaLabel:/*i18n*/i18n._(\"Key typeahead\"),onToggle:setIsKeyDropdownOpen,onSelect:function onSelect(event,selection){return setKeySelection(selection);},onClear:function onClear(){return setKeySelection(null);},selections:keySelection,isOpen:isKeyDropdownOpen,placeholderText:/*i18n*/i18n._(\"Key\"),isGrouped:true,onCreateOption:setKeySelection,maxHeight:maxSelectHeight,noResultsFoundText:/*i18n*/i18n._(\"No results found\"),children:[].concat(_toConsumableArray(searchableKeys.length?[/*#__PURE__*/_jsx(SelectGroup,{label:/*i18n*/i18n._(\"Direct Keys\"),children:searchableKeys.map(function(k){return/*#__PURE__*/_jsx(SelectOption,{value:k.key,id:\"select-option-\".concat(k.key),children:k.key},k.key);})},\"direct keys\"),/*#__PURE__*/_jsx(Divider,{},\"divider\")]:[]),_toConsumableArray(relatedKeys.length?[/*#__PURE__*/_jsx(SelectGroup,{label:/*i18n*/i18n._(\"Related Keys\"),children:relatedKeys.map(function(rKey){return/*#__PURE__*/_jsx(SelectOption,{value:rKey,id:\"select-option-\".concat(rKey),children:rKey},rKey);})},\"related keys\")]:[]))}),renderLookupType(),/*#__PURE__*/_jsxs(InputGroup,{children:[renderTextInput(),/*#__PURE__*/_jsx(_StyledDiv,{_css:!searchValue&&\"cursor:not-allowed\",children:/*#__PURE__*/_jsx(Button,{ouiaId:\"advanced-search-text-input\",variant:ButtonVariant.control,isDisabled:!searchValue,\"aria-label\":/*i18n*/i18n._(\"Search submit button\"),onClick:handleAdvancedSearch,children:/*#__PURE__*/_jsx(SearchIcon,{})})})]}),/*#__PURE__*/_jsx(Tooltip,{content:/*i18n*/i18n._(\"Advanced search documentation\"),position:\"bottom\",children:/*#__PURE__*/_jsx(Button,{ouiaId:\"search-docs-button\",component:\"a\",variant:\"plain\",target:\"_blank\",href:\"\".concat(getDocsBaseUrl(config),\"/html/userguide/search_sort.html\"),children:/*#__PURE__*/_jsx(QuestionCircleIcon,{})})})]});}AdvancedSearch.defaultProps={searchableKeys:[],relatedSearchableKeys:[],maxSelectHeight:'300px',enableNegativeFiltering:true,enableRelatedFuzzyFiltering:true,handleIsAnsibleFactsSelected:function handleIsAnsibleFactsSelected(){}};export default AdvancedSearch;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/Search/AdvancedSearch.js"],"names":["React","useEffect","useState","Button","ButtonVariant","Divider","InputGroup","Select","SelectGroup","SelectOption","SelectVariant","TextInput","Tooltip","SearchIcon","QuestionCircleIcon","styled","useLocation","useConfig","getDocsBaseUrl","SearchableKeys","RelatedLookupTypeInput","LookupTypeInput","AdvancedGroup","div","AdvancedSearch","onSearch","searchableKeys","relatedSearchableKeys","maxSelectHeight","enableNegativeFiltering","enableRelatedFuzzyFiltering","handleIsAnsibleFactsSelected","isFilterCleared","relatedKeys","filter","sKey","map","key","includes","isPrefixDropdownOpen","setIsPrefixDropdownOpen","isKeyDropdownOpen","setIsKeyDropdownOpen","prefixSelection","setPrefixSelection","lookupSelection","setLookupSelection","keySelection","setKeySelection","searchValue","setSearchValue","isTextInputDisabled","setIsTextInputDisabled","pathname","search","config","selectedKey","find","k","relatedSearchKeySelected","indexOf","lookupKeyType","type","handleAdvancedSearch","e","preventDefault","actualPrefix","actualSearchKey","val","join","ansibleFactValue","handleAdvancedTextKeyDown","renderSetType","typeahead","event","selection","renderLookupType","renderTextInput","placeholderText","renderLookupSelection","length","rKey","control","defaultProps"],"mappings":"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","sourcesContent":["import 'styled-components/macro';\nimport React, { useEffect, useState } from 'react';\nimport { string, func, bool, arrayOf } from 'prop-types';\nimport { t } from '@lingui/macro';\nimport {\n  Button,\n  ButtonVariant,\n  Divider,\n  InputGroup,\n  Select,\n  SelectGroup,\n  SelectOption,\n  SelectVariant,\n  TextInput,\n  Tooltip,\n} from '@patternfly/react-core';\nimport { SearchIcon, QuestionCircleIcon } from '@patternfly/react-icons';\nimport styled from 'styled-components';\nimport { useLocation } from 'react-router-dom';\nimport { useConfig } from 'contexts/Config';\nimport getDocsBaseUrl from 'util/getDocsBaseUrl';\nimport { SearchableKeys } from 'types';\nimport RelatedLookupTypeInput from './RelatedLookupTypeInput';\nimport LookupTypeInput from './LookupTypeInput';\n\nconst AdvancedGroup = styled.div`\n  display: flex;\n\n  @media (max-width: 991px) {\n    display: grid;\n    grid-gap: var(--pf-c-toolbar__expandable-content--m-expanded--GridRowGap);\n  }\n\n  & .pf-c-select {\n    min-width: 150px;\n  }\n`;\n\nfunction AdvancedSearch({\n  onSearch,\n  searchableKeys,\n  relatedSearchableKeys,\n  maxSelectHeight,\n  enableNegativeFiltering,\n  enableRelatedFuzzyFiltering,\n  handleIsAnsibleFactsSelected,\n  isFilterCleared,\n}) {\n  const relatedKeys = relatedSearchableKeys.filter(\n    (sKey) => !searchableKeys.map(({ key }) => key).includes(sKey)\n  );\n  const [isPrefixDropdownOpen, setIsPrefixDropdownOpen] = useState(false);\n  const [isKeyDropdownOpen, setIsKeyDropdownOpen] = useState(false);\n  const [prefixSelection, setPrefixSelection] = useState(null);\n  const [lookupSelection, setLookupSelection] = useState(null);\n  const [keySelection, setKeySelection] = useState(null);\n  const [searchValue, setSearchValue] = useState('');\n  const [isTextInputDisabled, setIsTextInputDisabled] = useState(false);\n  const { pathname, search } = useLocation();\n\n  useEffect(() => {\n    if (keySelection === 'ansible_facts') {\n      handleIsAnsibleFactsSelected(true);\n      setPrefixSelection(null);\n    } else {\n      handleIsAnsibleFactsSelected(false);\n    }\n  }, [keySelection]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(() => {\n    if (isFilterCleared && keySelection === 'ansible_facts') {\n      setIsTextInputDisabled(false);\n    }\n  }, [isFilterCleared, keySelection]);\n\n  useEffect(() => {\n    if (\n      (pathname.includes('edit') || pathname.includes('add')) &&\n      keySelection === 'ansible_facts' &&\n      search.includes('ansible_facts')\n    ) {\n      setIsTextInputDisabled(true);\n    } else {\n      setIsTextInputDisabled(false);\n    }\n  }, [keySelection, pathname, search]);\n\n  const config = useConfig();\n\n  const selectedKey = searchableKeys.find((k) => k.key === keySelection);\n  const relatedSearchKeySelected =\n    keySelection &&\n    relatedSearchableKeys.indexOf(keySelection) > -1 &&\n    !selectedKey;\n  const lookupKeyType =\n    keySelection && !relatedSearchKeySelected ? selectedKey?.type : null;\n\n  useEffect(() => {\n    if (relatedSearchKeySelected && keySelection !== 'ansible_facts') {\n      setLookupSelection('name__icontains');\n    } else {\n      setLookupSelection(null);\n    }\n  }, [keySelection]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(() => {\n    if (lookupSelection === 'search') {\n      setPrefixSelection(null);\n    }\n  }, [lookupSelection]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const handleAdvancedSearch = (e) => {\n    // keeps page from fully reloading\n    e.preventDefault();\n\n    if (searchValue) {\n      const actualPrefix = prefixSelection === 'and' ? null : prefixSelection;\n      const actualSearchKey = [actualPrefix, keySelection, lookupSelection]\n        .filter((val) => !!val)\n        .join('__');\n      if (keySelection === 'ansible_facts') {\n        const ansibleFactValue = `${actualSearchKey}__${searchValue}`;\n        onSearch('host_filter', ansibleFactValue);\n      } else {\n        onSearch(actualSearchKey, searchValue);\n      }\n      setSearchValue('');\n    }\n  };\n\n  const handleAdvancedTextKeyDown = (e) => {\n    if (e.key && e.key === 'Enter') {\n      handleAdvancedSearch(e);\n    }\n  };\n\n  const renderSetType = () => (\n    <Select\n      ouiaId=\"set-type-typeahead\"\n      aria-label={t`Set type select`}\n      className=\"setTypeSelect\"\n      variant={SelectVariant.typeahead}\n      typeAheadAriaLabel={t`Set type typeahead`}\n      onToggle={setIsPrefixDropdownOpen}\n      onSelect={(event, selection) => setPrefixSelection(selection)}\n      onClear={() => setPrefixSelection(null)}\n      selections={prefixSelection}\n      isOpen={isPrefixDropdownOpen}\n      placeholderText={t`Set type`}\n      maxHeight={maxSelectHeight}\n      noResultsFoundText={t`No results found`}\n      isDisabled={lookupSelection === 'search'}\n    >\n      <SelectOption\n        id=\"and-option-select\"\n        key=\"and\"\n        value=\"and\"\n        description={t`Returns results that satisfy this one as well as other filters.  This is the default set type if nothing is selected.`}\n      />\n      <SelectOption\n        id=\"or-option-select\"\n        key=\"or\"\n        value=\"or\"\n        description={t`Returns results that satisfy this one or any other filters.`}\n      />\n      {enableNegativeFiltering && (\n        <SelectOption\n          id=\"not-option-select\"\n          key=\"not\"\n          value=\"not\"\n          description={t`Returns results that have values other than this one as well as other filters.`}\n        />\n      )}\n    </Select>\n  );\n\n  const renderLookupType = () => {\n    if (keySelection === 'ansible_facts') return null;\n\n    return relatedSearchKeySelected ? (\n      <RelatedLookupTypeInput\n        value={lookupSelection}\n        setValue={setLookupSelection}\n        maxSelectHeight={maxSelectHeight}\n        enableFuzzyFiltering={enableRelatedFuzzyFiltering}\n      />\n    ) : (\n      <LookupTypeInput\n        value={lookupSelection}\n        type={lookupKeyType}\n        setValue={setLookupSelection}\n        maxSelectHeight={maxSelectHeight}\n      />\n    );\n  };\n\n  const renderTextInput = () => {\n    let placeholderText;\n    if (keySelection === 'labels' && lookupSelection === 'search') {\n      placeholderText = 'e.g. label_1,label_2';\n    }\n\n    if (isTextInputDisabled) {\n      return (\n        <Tooltip\n          content={t`Remove the current search related to ansible facts to enable another search using this key.`}\n        >\n          <TextInput\n            data-cy=\"advanced-search-text-input\"\n            type=\"search\"\n            aria-label={t`Advanced search value input`}\n            isDisabled={!keySelection || isTextInputDisabled}\n            value={(!keySelection && t`First, select a key`) || searchValue}\n            onChange={setSearchValue}\n            onKeyDown={handleAdvancedTextKeyDown}\n          />\n        </Tooltip>\n      );\n    }\n\n    return (\n      <TextInput\n        data-cy=\"advanced-search-text-input\"\n        type=\"search\"\n        aria-label={t`Advanced search value input`}\n        isDisabled={!keySelection}\n        value={(!keySelection && t`First, select a key`) || searchValue}\n        onChange={setSearchValue}\n        onKeyDown={handleAdvancedTextKeyDown}\n        placeholder={placeholderText}\n      />\n    );\n  };\n\n  const renderLookupSelection = () => {\n    if (keySelection === 'ansible_facts') return null;\n    return lookupSelection === 'search' ? (\n      <Tooltip\n        content={t`Set type disabled for related search field fuzzy searches`}\n      >\n        {renderSetType()}\n      </Tooltip>\n    ) : (\n      renderSetType()\n    );\n  };\n\n  return (\n    <AdvancedGroup>\n      {renderLookupSelection()}\n      <Select\n        ouiaId=\"set-key-typeahead\"\n        aria-label={t`Key select`}\n        className=\"keySelect\"\n        variant={SelectVariant.typeahead}\n        typeAheadAriaLabel={t`Key typeahead`}\n        onToggle={setIsKeyDropdownOpen}\n        onSelect={(event, selection) => setKeySelection(selection)}\n        onClear={() => setKeySelection(null)}\n        selections={keySelection}\n        isOpen={isKeyDropdownOpen}\n        placeholderText={t`Key`}\n        isGrouped\n        onCreateOption={setKeySelection}\n        maxHeight={maxSelectHeight}\n        noResultsFoundText={t`No results found`}\n      >\n        {[\n          ...(searchableKeys.length\n            ? [\n                <SelectGroup key=\"direct keys\" label={t`Direct Keys`}>\n                  {searchableKeys.map((k) => (\n                    <SelectOption\n                      value={k.key}\n                      key={k.key}\n                      id={`select-option-${k.key}`}\n                    >\n                      {k.key}\n                    </SelectOption>\n                  ))}\n                </SelectGroup>,\n                <Divider key=\"divider\" />,\n              ]\n            : []),\n          ...(relatedKeys.length\n            ? [\n                <SelectGroup key=\"related keys\" label={t`Related Keys`}>\n                  {relatedKeys.map((rKey) => (\n                    <SelectOption\n                      value={rKey}\n                      key={rKey}\n                      id={`select-option-${rKey}`}\n                    >\n                      {rKey}\n                    </SelectOption>\n                  ))}\n                </SelectGroup>,\n              ]\n            : []),\n        ]}\n      </Select>\n      {renderLookupType()}\n\n      <InputGroup>\n        {renderTextInput()}\n        <div css={!searchValue && `cursor:not-allowed`}>\n          <Button\n            ouiaId=\"advanced-search-text-input\"\n            variant={ButtonVariant.control}\n            isDisabled={!searchValue}\n            aria-label={t`Search submit button`}\n            onClick={handleAdvancedSearch}\n          >\n            <SearchIcon />\n          </Button>\n        </div>\n      </InputGroup>\n      <Tooltip content={t`Advanced search documentation`} position=\"bottom\">\n        <Button\n          ouiaId=\"search-docs-button\"\n          component=\"a\"\n          variant=\"plain\"\n          target=\"_blank\"\n          href={`${getDocsBaseUrl(config)}/html/userguide/search_sort.html`}\n        >\n          <QuestionCircleIcon />\n        </Button>\n      </Tooltip>\n    </AdvancedGroup>\n  );\n}\n\nAdvancedSearch.propTypes = {\n  onSearch: func.isRequired,\n  searchableKeys: SearchableKeys,\n  relatedSearchableKeys: arrayOf(string),\n  maxSelectHeight: string,\n  enableNegativeFiltering: bool,\n  enableRelatedFuzzyFiltering: bool,\n  handleIsAnsibleFactsSelected: func,\n};\n\nAdvancedSearch.defaultProps = {\n  searchableKeys: [],\n  relatedSearchableKeys: [],\n  maxSelectHeight: '300px',\n  enableNegativeFiltering: true,\n  enableRelatedFuzzyFiltering: true,\n  handleIsAnsibleFactsSelected: () => {},\n};\n\nexport default AdvancedSearch;\n"]},"metadata":{},"sourceType":"module"}