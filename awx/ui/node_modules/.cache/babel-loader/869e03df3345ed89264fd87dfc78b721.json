{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useContext,useEffect,useState,useRef,useCallback,useMemo}from'react';import{useHistory,Redirect}from'react-router-dom';import{DateTime}from'luxon';import{RootAPI,MeAPI}from'api';import{isAuthenticated}from'util/auth';import useRequest from'hooks/useRequest';import{SESSION_TIMEOUT_KEY,SESSION_USER_ID}from'../constants';// The maximum supported timeout for setTimeout(), in milliseconds,\n// is the highest number you can represent as a signed 32bit\n// integer (approximately 25 days)\nimport{jsx as _jsx}from\"react/jsx-runtime\";var MAX_TIMEOUT=Math.pow(2,32-1)-1;// The number of seconds the session timeout warning is displayed\n// before the user is logged out. Increasing this number (up to\n// the total session time, which is 1800s by default) will cause\n// the session timeout warning to display sooner.\nvar SESSION_WARNING_DURATION=10;/**\n * The useStorage hook integrates with the browser's localStorage api.\n * It accepts a storage key as its only argument and returns a state\n * variable and setter function for that state variable.\n *\n * This utility behaves much like the standard useState hook with some\n * key differences:\n *   1. You don't pass it an initial value. Instead, the provided key\n *      is used to retrieve the initial value from local storage. If\n *      the key doesn't exist in local storage, null is returned.\n *   2. Behind the scenes, this hook registers an event listener with\n *      the Web Storage api to establish a two-way binding between the\n *      state variable and its corresponding local storage value. This\n *      means that updates to the state variable with the setter\n *      function will produce a corresponding update to the local\n *      storage value and vice-versa.\n *   3. When local storage is shared across browser tabs, the data\n *      binding is also shared across browser tabs. This means that\n *      updates to the state variable using the setter function on\n *      one tab will also update the state variable on any other tab\n *      using this hook with the same key and vice-versa.\n */function useStorage(key){var _useState=useState(window.localStorage.getItem(key)),_useState2=_slicedToArray(_useState,2),storageVal=_useState2[0],setStorageVal=_useState2[1];window.addEventListener('storage',function(){var newVal=window.localStorage.getItem(key);if(newVal!==storageVal){setStorageVal(newVal);}});var setValue=function setValue(val){window.localStorage.setItem(key,JSON.stringify(val));setStorageVal(val);};return[storageVal,setValue];}var SessionContext=/*#__PURE__*/React.createContext({});SessionContext.displayName='SessionContext';function SessionProvider(_ref){var children=_ref.children;var history=useHistory();var isSessionExpired=useRef(false);var sessionTimeoutId=useRef(null);var sessionIntervalId=useRef(null);var _useStorage=useStorage(SESSION_TIMEOUT_KEY),_useStorage2=_slicedToArray(_useStorage,2),sessionTimeout=_useStorage2[0],setSessionTimeout=_useStorage2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),sessionCountdown=_useState4[0],setSessionCountdown=_useState4[1];var _useState5=useState('/'),_useState6=_slicedToArray(_useState5,2),authRedirectTo=_useState6[0],setAuthRedirectTo=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isUserBeingLoggedOut=_useState8[0],setIsUserBeingLoggedOut=_useState8[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$RootAPI$read,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return RootAPI.read();case 2:_yield$RootAPI$read=_context.sent;data=_yield$RootAPI$read.data;return _context.abrupt(\"return\",{loginRedirectOverride:data===null||data===void 0?void 0:data.login_redirect_override});case 5:case\"end\":return _context.stop();}}},_callee);})),[]),{loginRedirectOverride:null,isLoading:true}),fetchLoginRedirectOverride=_useRequest.request,loginRedirectOverride=_useRequest.result.loginRedirectOverride,isLoading=_useRequest.isLoading;useEffect(function(){fetchLoginRedirectOverride();},[fetchLoginRedirectOverride]);var logout=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setIsUserBeingLoggedOut(true);if(!isSessionExpired.current){setAuthRedirectTo('/logout');window.localStorage.setItem(SESSION_USER_ID,null);}sessionStorage.clear();_context2.next=5;return RootAPI.logout();case 5:setSessionTimeout(0);setSessionCountdown(0);clearTimeout(sessionTimeoutId.current);clearInterval(sessionIntervalId.current);return _context2.abrupt(\"return\",/*#__PURE__*/_jsx(Redirect,{to:\"/login\"}));case 10:case\"end\":return _context2.stop();}}},_callee2);})),[setSessionTimeout,setSessionCountdown]);useEffect(function(){if(!isAuthenticated(document.cookie)){return function(){};}var calcRemaining=function calcRemaining(){if(sessionTimeout){return Math.max(parseInt(sessionTimeout,10)-DateTime.now().toMillis(),0);}return 0;};var handleSessionTimeout=function handleSessionTimeout(){var countDown=SESSION_WARNING_DURATION;setSessionCountdown(countDown);sessionIntervalId.current=setInterval(function(){if(countDown>0){setSessionCountdown(--countDown);}else{isSessionExpired.current=true;logout();}},1000);};setSessionCountdown(0);clearTimeout(sessionTimeoutId.current);clearInterval(sessionIntervalId.current);var calcTimeOut=calcRemaining()-SESSION_WARNING_DURATION*1000;isSessionExpired.current=false;sessionTimeoutId.current=setTimeout(handleSessionTimeout,calcTimeOut<=0?MAX_TIMEOUT:Math.min(calcTimeOut,MAX_TIMEOUT));return function(){clearTimeout(sessionTimeoutId.current);clearInterval(sessionIntervalId.current);};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[history,sessionTimeout]);var handleSessionContinue=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return MeAPI.read();case 2:setSessionCountdown(0);clearTimeout(sessionTimeoutId.current);clearInterval(sessionIntervalId.current);case 5:case\"end\":return _context3.stop();}}},_callee3);})),[]);var sessionValue=useMemo(function(){return{authRedirectTo:authRedirectTo,handleSessionContinue:handleSessionContinue,isSessionExpired:isSessionExpired,isUserBeingLoggedOut:isUserBeingLoggedOut,loginRedirectOverride:loginRedirectOverride,logout:logout,sessionCountdown:sessionCountdown,setAuthRedirectTo:setAuthRedirectTo};},[authRedirectTo,handleSessionContinue,isSessionExpired,isUserBeingLoggedOut,loginRedirectOverride,logout,sessionCountdown,setAuthRedirectTo]);if(isLoading){return null;}return/*#__PURE__*/_jsx(SessionContext.Provider,{value:sessionValue,children:children});}function useSession(){var context=useContext(SessionContext);if(context===undefined){throw new Error('useSession must be used within a SessionProvider');}return context;}export{SessionContext,SessionProvider,useSession};","map":{"version":3,"sources":["/awx_devel/awx/ui/src/contexts/Session.js"],"names":["React","useContext","useEffect","useState","useRef","useCallback","useMemo","useHistory","Redirect","DateTime","RootAPI","MeAPI","isAuthenticated","useRequest","SESSION_TIMEOUT_KEY","SESSION_USER_ID","MAX_TIMEOUT","SESSION_WARNING_DURATION","useStorage","key","window","localStorage","getItem","storageVal","setStorageVal","addEventListener","newVal","setValue","val","setItem","JSON","stringify","SessionContext","createContext","displayName","SessionProvider","children","history","isSessionExpired","sessionTimeoutId","sessionIntervalId","sessionTimeout","setSessionTimeout","sessionCountdown","setSessionCountdown","authRedirectTo","setAuthRedirectTo","isUserBeingLoggedOut","setIsUserBeingLoggedOut","read","data","loginRedirectOverride","login_redirect_override","isLoading","fetchLoginRedirectOverride","request","result","logout","current","sessionStorage","clear","clearTimeout","clearInterval","document","cookie","calcRemaining","Math","max","parseInt","now","toMillis","handleSessionTimeout","countDown","setInterval","calcTimeOut","setTimeout","min","handleSessionContinue","sessionValue","useSession","context","undefined","Error"],"mappings":"wTAAA,MAAOA,CAAAA,KAAP,EACEC,UADF,CAEEC,SAFF,CAGEC,QAHF,CAIEC,MAJF,CAKEC,WALF,CAMEC,OANF,KAOO,OAPP,CAQA,OAASC,UAAT,CAAqBC,QAArB,KAAqC,kBAArC,CACA,OAASC,QAAT,KAAyB,OAAzB,CACA,OAASC,OAAT,CAAkBC,KAAlB,KAA+B,KAA/B,CACA,OAASC,eAAT,KAAgC,WAAhC,CACA,MAAOC,CAAAA,UAAP,KAAuB,kBAAvB,CACA,OAASC,mBAAT,CAA8BC,eAA9B,KAAqD,cAArD,CAEA;AACA;AACA;2CACA,GAAMC,CAAAA,WAAW,CAAG,WAAM,GAAK,CAAX,EAAgB,CAApC,CAEA;AACA;AACA;AACA;AACA,GAAMC,CAAAA,wBAAwB,CAAG,EAAjC,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACA,QAASC,CAAAA,UAAT,CAAoBC,GAApB,CAAyB,CACvB,cAAoChB,QAAQ,CAC1CiB,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4BH,GAA5B,CAD0C,CAA5C,wCAAOI,UAAP,eAAmBC,aAAnB,eAGAJ,MAAM,CAACK,gBAAP,CAAwB,SAAxB,CAAmC,UAAM,CACvC,GAAMC,CAAAA,MAAM,CAAGN,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4BH,GAA5B,CAAf,CACA,GAAIO,MAAM,GAAKH,UAAf,CAA2B,CACzBC,aAAa,CAACE,MAAD,CAAb,CACD,CACF,CALD,EAMA,GAAMC,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACC,GAAD,CAAS,CACxBR,MAAM,CAACC,YAAP,CAAoBQ,OAApB,CAA4BV,GAA5B,CAAiCW,IAAI,CAACC,SAAL,CAAeH,GAAf,CAAjC,EACAJ,aAAa,CAACI,GAAD,CAAb,CACD,CAHD,CAIA,MAAO,CAACL,UAAD,CAAaI,QAAb,CAAP,CACD,CAED,GAAMK,CAAAA,cAAc,cAAGhC,KAAK,CAACiC,aAAN,CAAoB,EAApB,CAAvB,CACAD,cAAc,CAACE,WAAf,CAA6B,gBAA7B,CAEA,QAASC,CAAAA,eAAT,MAAuC,IAAZC,CAAAA,QAAY,MAAZA,QAAY,CACrC,GAAMC,CAAAA,OAAO,CAAG9B,UAAU,EAA1B,CACA,GAAM+B,CAAAA,gBAAgB,CAAGlC,MAAM,CAAC,KAAD,CAA/B,CACA,GAAMmC,CAAAA,gBAAgB,CAAGnC,MAAM,CAAC,IAAD,CAA/B,CACA,GAAMoC,CAAAA,iBAAiB,CAAGpC,MAAM,CAAC,IAAD,CAAhC,CACA,gBAA4Cc,UAAU,CAACJ,mBAAD,CAAtD,4CAAO2B,cAAP,iBAAuBC,iBAAvB,iBACA,eAAgDvC,QAAQ,CAAC,CAAD,CAAxD,yCAAOwC,gBAAP,eAAyBC,mBAAzB,eACA,eAA4CzC,QAAQ,CAAC,GAAD,CAApD,yCAAO0C,cAAP,eAAuBC,iBAAvB,eACA,eAAwD3C,QAAQ,CAAC,KAAD,CAAhE,yCAAO4C,oBAAP,eAA6BC,uBAA7B,eAEA,gBAIInC,UAAU,CACZR,WAAW,sEAAC,sLACaK,CAAAA,OAAO,CAACuC,IAAR,EADb,0CACFC,IADE,qBACFA,IADE,iCAEH,CACLC,qBAAqB,CAAED,IAAF,SAAEA,IAAF,iBAAEA,IAAI,CAAEE,uBADxB,CAFG,wDAAD,GAKR,EALQ,CADC,CAOZ,CACED,qBAAqB,CAAE,IADzB,CAEEE,SAAS,CAAE,IAFb,CAPY,CAJd,CACWC,0BADX,aACEC,OADF,CAEYJ,qBAFZ,aAEEK,MAFF,CAEYL,qBAFZ,CAGEE,SAHF,aAGEA,SAHF,CAiBAnD,SAAS,CAAC,UAAM,CACdoD,0BAA0B,GAC3B,CAFQ,CAEN,CAACA,0BAAD,CAFM,CAAT,CAIA,GAAMG,CAAAA,MAAM,CAAGpD,WAAW,sEAAC,wIACzB2C,uBAAuB,CAAC,IAAD,CAAvB,CACA,GAAI,CAACV,gBAAgB,CAACoB,OAAtB,CAA+B,CAC7BZ,iBAAiB,CAAC,SAAD,CAAjB,CACA1B,MAAM,CAACC,YAAP,CAAoBQ,OAApB,CAA4Bd,eAA5B,CAA6C,IAA7C,EACD,CACD4C,cAAc,CAACC,KAAf,GANyB,uBAOnBlD,CAAAA,OAAO,CAAC+C,MAAR,EAPmB,QAQzBf,iBAAiB,CAAC,CAAD,CAAjB,CACAE,mBAAmB,CAAC,CAAD,CAAnB,CACAiB,YAAY,CAACtB,gBAAgB,CAACmB,OAAlB,CAAZ,CACAI,aAAa,CAACtB,iBAAiB,CAACkB,OAAnB,CAAb,CAXyB,8CAYlB,KAAC,QAAD,EAAU,EAAE,CAAC,QAAb,EAZkB,2DAAD,GAavB,CAAChB,iBAAD,CAAoBE,mBAApB,CAbuB,CAA1B,CAeA1C,SAAS,CAAC,UAAM,CACd,GAAI,CAACU,eAAe,CAACmD,QAAQ,CAACC,MAAV,CAApB,CAAuC,CACrC,MAAO,WAAM,CAAE,CAAf,CACD,CACD,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,EAAM,CAC1B,GAAIxB,cAAJ,CAAoB,CAClB,MAAOyB,CAAAA,IAAI,CAACC,GAAL,CACLC,QAAQ,CAAC3B,cAAD,CAAiB,EAAjB,CAAR,CAA+BhC,QAAQ,CAAC4D,GAAT,GAAeC,QAAf,EAD1B,CAEL,CAFK,CAAP,CAID,CACD,MAAO,EAAP,CACD,CARD,CAUA,GAAMC,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,EAAM,CACjC,GAAIC,CAAAA,SAAS,CAAGvD,wBAAhB,CACA2B,mBAAmB,CAAC4B,SAAD,CAAnB,CAEAhC,iBAAiB,CAACkB,OAAlB,CAA4Be,WAAW,CAAC,UAAM,CAC5C,GAAID,SAAS,CAAG,CAAhB,CAAmB,CACjB5B,mBAAmB,CAAC,EAAE4B,SAAH,CAAnB,CACD,CAFD,IAEO,CACLlC,gBAAgB,CAACoB,OAAjB,CAA2B,IAA3B,CACAD,MAAM,GACP,CACF,CAPsC,CAOpC,IAPoC,CAAvC,CAQD,CAZD,CAcAb,mBAAmB,CAAC,CAAD,CAAnB,CACAiB,YAAY,CAACtB,gBAAgB,CAACmB,OAAlB,CAAZ,CACAI,aAAa,CAACtB,iBAAiB,CAACkB,OAAnB,CAAb,CAEA,GAAMgB,CAAAA,WAAW,CAAGT,aAAa,GAAKhD,wBAAwB,CAAG,IAAjE,CAEAqB,gBAAgB,CAACoB,OAAjB,CAA2B,KAA3B,CACAnB,gBAAgB,CAACmB,OAAjB,CAA2BiB,UAAU,CACnCJ,oBADmC,CAEnCG,WAAW,EAAI,CAAf,CAAmB1D,WAAnB,CAAiCkD,IAAI,CAACU,GAAL,CAASF,WAAT,CAAsB1D,WAAtB,CAFE,CAArC,CAKA,MAAO,WAAM,CACX6C,YAAY,CAACtB,gBAAgB,CAACmB,OAAlB,CAAZ,CACAI,aAAa,CAACtB,iBAAiB,CAACkB,OAAnB,CAAb,CACD,CAHD,CAIA;AACD,CA7CQ,CA6CN,CAACrB,OAAD,CAAUI,cAAV,CA7CM,CAAT,CA+CA,GAAMoC,CAAAA,qBAAqB,CAAGxE,WAAW,sEAAC,+JAClCM,CAAAA,KAAK,CAACsC,IAAN,EADkC,QAExCL,mBAAmB,CAAC,CAAD,CAAnB,CACAiB,YAAY,CAACtB,gBAAgB,CAACmB,OAAlB,CAAZ,CACAI,aAAa,CAACtB,iBAAiB,CAACkB,OAAnB,CAAb,CAJwC,wDAAD,GAKtC,EALsC,CAAzC,CAOA,GAAMoB,CAAAA,YAAY,CAAGxE,OAAO,CAC1B,iBAAO,CACLuC,cAAc,CAAdA,cADK,CAELgC,qBAAqB,CAArBA,qBAFK,CAGLvC,gBAAgB,CAAhBA,gBAHK,CAILS,oBAAoB,CAApBA,oBAJK,CAKLI,qBAAqB,CAArBA,qBALK,CAMLM,MAAM,CAANA,MANK,CAOLd,gBAAgB,CAAhBA,gBAPK,CAQLG,iBAAiB,CAAjBA,iBARK,CAAP,EAD0B,CAW1B,CACED,cADF,CAEEgC,qBAFF,CAGEvC,gBAHF,CAIES,oBAJF,CAKEI,qBALF,CAMEM,MANF,CAOEd,gBAPF,CAQEG,iBARF,CAX0B,CAA5B,CAuBA,GAAIO,SAAJ,CAAe,CACb,MAAO,KAAP,CACD,CAED,mBACE,KAAC,cAAD,CAAgB,QAAhB,EAAyB,KAAK,CAAEyB,YAAhC,UACG1C,QADH,EADF,CAKD,CAED,QAAS2C,CAAAA,UAAT,EAAsB,CACpB,GAAMC,CAAAA,OAAO,CAAG/E,UAAU,CAAC+B,cAAD,CAA1B,CACA,GAAIgD,OAAO,GAAKC,SAAhB,CAA2B,CACzB,KAAM,IAAIC,CAAAA,KAAJ,CAAU,kDAAV,CAAN,CACD,CACD,MAAOF,CAAAA,OAAP,CACD,CAED,OAAShD,cAAT,CAAyBG,eAAzB,CAA0C4C,UAA1C","sourcesContent":["import React, {\n  useContext,\n  useEffect,\n  useState,\n  useRef,\n  useCallback,\n  useMemo,\n} from 'react';\nimport { useHistory, Redirect } from 'react-router-dom';\nimport { DateTime } from 'luxon';\nimport { RootAPI, MeAPI } from 'api';\nimport { isAuthenticated } from 'util/auth';\nimport useRequest from 'hooks/useRequest';\nimport { SESSION_TIMEOUT_KEY, SESSION_USER_ID } from '../constants';\n\n// The maximum supported timeout for setTimeout(), in milliseconds,\n// is the highest number you can represent as a signed 32bit\n// integer (approximately 25 days)\nconst MAX_TIMEOUT = 2 ** (32 - 1) - 1;\n\n// The number of seconds the session timeout warning is displayed\n// before the user is logged out. Increasing this number (up to\n// the total session time, which is 1800s by default) will cause\n// the session timeout warning to display sooner.\nconst SESSION_WARNING_DURATION = 10;\n\n/**\n * The useStorage hook integrates with the browser's localStorage api.\n * It accepts a storage key as its only argument and returns a state\n * variable and setter function for that state variable.\n *\n * This utility behaves much like the standard useState hook with some\n * key differences:\n *   1. You don't pass it an initial value. Instead, the provided key\n *      is used to retrieve the initial value from local storage. If\n *      the key doesn't exist in local storage, null is returned.\n *   2. Behind the scenes, this hook registers an event listener with\n *      the Web Storage api to establish a two-way binding between the\n *      state variable and its corresponding local storage value. This\n *      means that updates to the state variable with the setter\n *      function will produce a corresponding update to the local\n *      storage value and vice-versa.\n *   3. When local storage is shared across browser tabs, the data\n *      binding is also shared across browser tabs. This means that\n *      updates to the state variable using the setter function on\n *      one tab will also update the state variable on any other tab\n *      using this hook with the same key and vice-versa.\n */\nfunction useStorage(key) {\n  const [storageVal, setStorageVal] = useState(\n    window.localStorage.getItem(key)\n  );\n  window.addEventListener('storage', () => {\n    const newVal = window.localStorage.getItem(key);\n    if (newVal !== storageVal) {\n      setStorageVal(newVal);\n    }\n  });\n  const setValue = (val) => {\n    window.localStorage.setItem(key, JSON.stringify(val));\n    setStorageVal(val);\n  };\n  return [storageVal, setValue];\n}\n\nconst SessionContext = React.createContext({});\nSessionContext.displayName = 'SessionContext';\n\nfunction SessionProvider({ children }) {\n  const history = useHistory();\n  const isSessionExpired = useRef(false);\n  const sessionTimeoutId = useRef(null);\n  const sessionIntervalId = useRef(null);\n  const [sessionTimeout, setSessionTimeout] = useStorage(SESSION_TIMEOUT_KEY);\n  const [sessionCountdown, setSessionCountdown] = useState(0);\n  const [authRedirectTo, setAuthRedirectTo] = useState('/');\n  const [isUserBeingLoggedOut, setIsUserBeingLoggedOut] = useState(false);\n\n  const {\n    request: fetchLoginRedirectOverride,\n    result: { loginRedirectOverride },\n    isLoading,\n  } = useRequest(\n    useCallback(async () => {\n      const { data } = await RootAPI.read();\n      return {\n        loginRedirectOverride: data?.login_redirect_override,\n      };\n    }, []),\n    {\n      loginRedirectOverride: null,\n      isLoading: true,\n    }\n  );\n\n  useEffect(() => {\n    fetchLoginRedirectOverride();\n  }, [fetchLoginRedirectOverride]);\n\n  const logout = useCallback(async () => {\n    setIsUserBeingLoggedOut(true);\n    if (!isSessionExpired.current) {\n      setAuthRedirectTo('/logout');\n      window.localStorage.setItem(SESSION_USER_ID, null);\n    }\n    sessionStorage.clear();\n    await RootAPI.logout();\n    setSessionTimeout(0);\n    setSessionCountdown(0);\n    clearTimeout(sessionTimeoutId.current);\n    clearInterval(sessionIntervalId.current);\n    return <Redirect to=\"/login\" />;\n  }, [setSessionTimeout, setSessionCountdown]);\n\n  useEffect(() => {\n    if (!isAuthenticated(document.cookie)) {\n      return () => {};\n    }\n    const calcRemaining = () => {\n      if (sessionTimeout) {\n        return Math.max(\n          parseInt(sessionTimeout, 10) - DateTime.now().toMillis(),\n          0\n        );\n      }\n      return 0;\n    };\n\n    const handleSessionTimeout = () => {\n      let countDown = SESSION_WARNING_DURATION;\n      setSessionCountdown(countDown);\n\n      sessionIntervalId.current = setInterval(() => {\n        if (countDown > 0) {\n          setSessionCountdown(--countDown);\n        } else {\n          isSessionExpired.current = true;\n          logout();\n        }\n      }, 1000);\n    };\n\n    setSessionCountdown(0);\n    clearTimeout(sessionTimeoutId.current);\n    clearInterval(sessionIntervalId.current);\n\n    const calcTimeOut = calcRemaining() - SESSION_WARNING_DURATION * 1000;\n\n    isSessionExpired.current = false;\n    sessionTimeoutId.current = setTimeout(\n      handleSessionTimeout,\n      calcTimeOut <= 0 ? MAX_TIMEOUT : Math.min(calcTimeOut, MAX_TIMEOUT)\n    );\n\n    return () => {\n      clearTimeout(sessionTimeoutId.current);\n      clearInterval(sessionIntervalId.current);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [history, sessionTimeout]);\n\n  const handleSessionContinue = useCallback(async () => {\n    await MeAPI.read();\n    setSessionCountdown(0);\n    clearTimeout(sessionTimeoutId.current);\n    clearInterval(sessionIntervalId.current);\n  }, []);\n\n  const sessionValue = useMemo(\n    () => ({\n      authRedirectTo,\n      handleSessionContinue,\n      isSessionExpired,\n      isUserBeingLoggedOut,\n      loginRedirectOverride,\n      logout,\n      sessionCountdown,\n      setAuthRedirectTo,\n    }),\n    [\n      authRedirectTo,\n      handleSessionContinue,\n      isSessionExpired,\n      isUserBeingLoggedOut,\n      loginRedirectOverride,\n      logout,\n      sessionCountdown,\n      setAuthRedirectTo,\n    ]\n  );\n\n  if (isLoading) {\n    return null;\n  }\n\n  return (\n    <SessionContext.Provider value={sessionValue}>\n      {children}\n    </SessionContext.Provider>\n  );\n}\n\nfunction useSession() {\n  const context = useContext(SessionContext);\n  if (context === undefined) {\n    throw new Error('useSession must be used within a SessionProvider');\n  }\n  return context;\n}\n\nexport { SessionContext, SessionProvider, useSession };\n"]},"metadata":{},"sourceType":"module"}