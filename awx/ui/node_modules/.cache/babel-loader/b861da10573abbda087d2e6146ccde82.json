{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2;import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{Link,useHistory}from'react-router-dom';import styled from'styled-components';import{Button,TextList,TextListItem,TextListVariants,TextListItemVariants}from'@patternfly/react-core';import AlertModal from'components/AlertModal';import{CardBody,CardActionsRow}from'components/Card';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import DeleteButton from'components/DeleteButton';import{Detail,DetailList,UserDateDetail}from'components/DetailList';import ChipGroup from'components/ChipGroup';import CodeEditor from'components/CodeEditor';import CredentialChip from'components/CredentialChip';import ErrorDetail from'components/ErrorDetail';import{CredentialsAPI,CredentialTypesAPI}from'api';import{Credential}from'types';import useRequest,{useDismissableError}from'hooks/useRequest';import{relatedResourceDeleteRequests}from'util/getRelatedResourceDeleteDetails';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var PluginInputMetadata=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  grid-column: 1 / -1;\\n\"])));var PluginFieldText=styled.p(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  margin-top: 10px;\\n\"])));function CredentialDetail(_ref){var credential=_ref.credential;var credentialId=credential.id,name=credential.name,description=credential.description,inputs=credential.inputs,created=credential.created,modified=credential.modified,_credential$summary_f=credential.summary_fields,credential_type=_credential$summary_f.credential_type,organization=_credential$summary_f.organization,created_by=_credential$summary_f.created_by,modified_by=_credential$summary_f.modified_by,user_capabilities=_credential$summary_f.user_capabilities;var history=useHistory();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,credentialTypeInputs,managed,loadedInputSources;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Promise.all([CredentialTypesAPI.readDetail(credential_type.id),CredentialsAPI.readInputSources(credentialId)]);case 2:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);_yield$Promise$all2$=_yield$Promise$all2[0].data;credentialTypeInputs=_yield$Promise$all2$.inputs;managed=_yield$Promise$all2$.managed;loadedInputSources=_yield$Promise$all2[1].data.results;return _context.abrupt(\"return\",{fields:credentialTypeInputs.fields||[],managedByTower:managed,inputSources:loadedInputSources.reduce(function(inputSourcesMap,inputSource){inputSourcesMap[inputSource.input_field_name]=inputSource;return inputSourcesMap;},{})});case 9:case\"end\":return _context.stop();}}},_callee);})),[credentialId,credential_type.id]),{fields:[],managedByTower:true,inputSources:{}}),_useRequest$result=_useRequest.result,fields=_useRequest$result.fields,managedByTower=_useRequest$result.managedByTower,inputSources=_useRequest$result.inputSources,fetchDetails=_useRequest.request,hasContentLoading=_useRequest.isLoading,contentError=_useRequest.error;var _useRequest2=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return CredentialsAPI.destroy(credentialId);case 2:history.push('/credentials');case 3:case\"end\":return _context2.stop();}}},_callee2);})),[credentialId,history])),deleteCredential=_useRequest2.request,isLoading=_useRequest2.isLoading,deleteError=_useRequest2.error;var _useDismissableError=useDismissableError(deleteError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;var renderDetail=function renderDetail(_ref4){var id=_ref4.id,label=_ref4.label,type=_ref4.type,ask_at_runtime=_ref4.ask_at_runtime,_ref4$help_text=_ref4.help_text,help_text=_ref4$help_text===void 0?'':_ref4$help_text;if(inputSources[id]){return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(Detail,{dataCy:\"credential-\".concat(id,\"-detail\"),helpText:help_text,id:\"credential-\".concat(id,\"-detail\"),fullWidth:true,label:/*#__PURE__*/_jsxs(\"span\",{children:[label,\" *\"]}),value:/*#__PURE__*/_jsx(ChipGroup,{numChips:1,totalChips:1,ouiaId:\"credential-\".concat(id,\"-chips\"),children:/*#__PURE__*/_jsx(CredentialChip,{credential:inputSources[id].summary_fields.source_credential,ouiaId:\"credential-\".concat(id,\"-chip\"),isReadOnly:true})})}),/*#__PURE__*/_jsx(PluginInputMetadata,{children:/*#__PURE__*/_jsx(CodeEditor,{dataCy:\"credential-\".concat(id,\"-detail\"),id:\"credential-\".concat(id,\"-metadata\"),mode:\"javascript\",readOnly:true,value:JSON.stringify(inputSources[id].metadata,null,2),onChange:function onChange(){},rows:5,hasErrors:false})})]},id);}if(type==='boolean'){return null;}if(inputs[id]==='$encrypted$'){return/*#__PURE__*/_jsx(Detail,{dataCy:\"credential-\".concat(id,\"-detail\"),id:\"credential-\".concat(id,\"-detail\"),label:label,value:/*i18n*/i18n._(\"Encrypted\"),helpText:help_text,isEncrypted:true},id);}if(ask_at_runtime&&inputs[id]==='ASK'){return/*#__PURE__*/_jsx(Detail,{dataCy:\"credential-\".concat(id,\"-detail\"),helpText:help_text,id:\"credential-\".concat(id,\"-detail\"),label:label,value:/*i18n*/i18n._(\"Prompt on launch\")},id);}return/*#__PURE__*/_jsx(Detail,{dataCy:\"credential-\".concat(id,\"-detail\"),id:\"credential-\".concat(id,\"-detail\"),label:label,value:inputs[id],helpText:help_text},id);};useEffect(function(){fetchDetails();},[fetchDetails]);var deleteDetailsRequests=relatedResourceDeleteRequests.credential(credential);var enabledBooleanFields=fields.filter(function(_ref5){var id=_ref5.id,type=_ref5.type;return type==='boolean'&&inputs[id];});if(hasContentLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}if(contentError){return/*#__PURE__*/_jsx(ContentError,{error:contentError});}return/*#__PURE__*/_jsxs(CardBody,{children:[/*#__PURE__*/_jsxs(DetailList,{children:[/*#__PURE__*/_jsx(Detail,{dataCy:\"credential-name-detail\",id:\"credential-name-detail\",label:/*i18n*/i18n._(\"Name\"),value:name}),/*#__PURE__*/_jsx(Detail,{dataCy:\"credential-description-detail\",id:\"credential-description-detail\",label:/*i18n*/i18n._(\"Description\"),value:description}),organization&&/*#__PURE__*/_jsx(Detail,{dataCy:\"credential-organization-detail\",id:\"credential-organization-detail\",label:/*i18n*/i18n._(\"Organization\"),value:/*#__PURE__*/_jsx(Link,{to:\"/organizations/\".concat(organization.id,\"/details\"),children:organization.name})}),/*#__PURE__*/_jsx(Detail,{dataCy:\"credential-credential_type-detail\",id:\"credential-credential_type-detail\",label:/*i18n*/i18n._(\"Credential Type\"),value:managedByTower?credential_type.name:/*#__PURE__*/_jsx(Link,{to:\"/credential_types/\".concat(credential_type.id,\"/details\"),children:credential_type.name})}),fields.map(function(field){return renderDetail(field);}),/*#__PURE__*/_jsx(UserDateDetail,{id:\"credential-created-detail\",label:/*i18n*/i18n._(\"Created\"),date:created,user:created_by}),/*#__PURE__*/_jsx(UserDateDetail,{id:\"credential-last_modified-detail\",label:/*i18n*/i18n._(\"Last Modified\"),date:modified,user:modified_by}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Enabled Options\"),value:/*#__PURE__*/_jsx(TextList,{component:TextListVariants.ul,children:enabledBooleanFields.map(function(_ref6){var id=_ref6.id,label=_ref6.label;return/*#__PURE__*/_jsx(TextListItem,{component:TextListItemVariants.li,children:label},id);})}),isEmpty:enabledBooleanFields.length===0})]}),Object.keys(inputSources).length>0&&/*#__PURE__*/_jsx(PluginFieldText,{children:/*i18n*/i18n._(\"* This field will be retrieved from an external secret management system using the specified credential.\")}),/*#__PURE__*/_jsxs(CardActionsRow,{children:[user_capabilities.edit&&/*#__PURE__*/_jsx(Button,{ouiaId:\"credential-detail-edit-button\",component:Link,to:\"/credentials/\".concat(credentialId,\"/edit\"),children:/*i18n*/i18n._(\"Edit\")}),user_capabilities.delete&&/*#__PURE__*/_jsx(DeleteButton,{name:name,itemToDelete:credential,modalTitle:/*i18n*/i18n._(\"Delete Credential\"),onConfirm:deleteCredential,isLoading:isLoading,deleteDetailsRequests:deleteDetailsRequests,deleteMessage:/*i18n*/i18n._(\"This credential is currently being used by other resources. Are you sure you want to delete it?\"),children:/*i18n*/i18n._(\"Delete\")})]}),error&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:error,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:dismissError,children:[/*i18n*/i18n._(\"Failed to delete credential.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]})]});}export default CredentialDetail;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Credential/CredentialDetail/CredentialDetail.js"],"names":["React","useEffect","useCallback","Link","useHistory","styled","Button","TextList","TextListItem","TextListVariants","TextListItemVariants","AlertModal","CardBody","CardActionsRow","ContentError","ContentLoading","DeleteButton","Detail","DetailList","UserDateDetail","ChipGroup","CodeEditor","CredentialChip","ErrorDetail","CredentialsAPI","CredentialTypesAPI","Credential","useRequest","useDismissableError","relatedResourceDeleteRequests","PluginInputMetadata","div","PluginFieldText","p","CredentialDetail","credential","credentialId","id","name","description","inputs","created","modified","summary_fields","credential_type","organization","created_by","modified_by","user_capabilities","history","Promise","all","readDetail","readInputSources","data","credentialTypeInputs","managed","loadedInputSources","results","fields","managedByTower","inputSources","reduce","inputSourcesMap","inputSource","input_field_name","result","fetchDetails","request","hasContentLoading","isLoading","contentError","error","destroy","push","deleteCredential","deleteError","dismissError","renderDetail","label","type","ask_at_runtime","help_text","source_credential","JSON","stringify","metadata","deleteDetailsRequests","enabledBooleanFields","filter","map","field","ul","li","length","Object","keys","edit","delete"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { Link, useHistory } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport styled from 'styled-components';\nimport {\n  Button,\n  TextList,\n  TextListItem,\n  TextListVariants,\n  TextListItemVariants,\n} from '@patternfly/react-core';\nimport AlertModal from 'components/AlertModal';\nimport { CardBody, CardActionsRow } from 'components/Card';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport DeleteButton from 'components/DeleteButton';\nimport { Detail, DetailList, UserDateDetail } from 'components/DetailList';\nimport ChipGroup from 'components/ChipGroup';\nimport CodeEditor from 'components/CodeEditor';\nimport CredentialChip from 'components/CredentialChip';\nimport ErrorDetail from 'components/ErrorDetail';\nimport { CredentialsAPI, CredentialTypesAPI } from 'api';\nimport { Credential } from 'types';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport { relatedResourceDeleteRequests } from 'util/getRelatedResourceDeleteDetails';\n\nconst PluginInputMetadata = styled.div`\n  grid-column: 1 / -1;\n`;\n\nconst PluginFieldText = styled.p`\n  margin-top: 10px;\n`;\n\nfunction CredentialDetail({ credential }) {\n  const {\n    id: credentialId,\n    name,\n    description,\n    inputs,\n    created,\n    modified,\n    summary_fields: {\n      credential_type,\n      organization,\n      created_by,\n      modified_by,\n      user_capabilities,\n    },\n  } = credential;\n  const history = useHistory();\n\n  const {\n    result: { fields, managedByTower, inputSources },\n    request: fetchDetails,\n    isLoading: hasContentLoading,\n    error: contentError,\n  } = useRequest(\n    useCallback(async () => {\n      const [\n        {\n          data: { inputs: credentialTypeInputs, managed },\n        },\n        {\n          data: { results: loadedInputSources },\n        },\n      ] = await Promise.all([\n        CredentialTypesAPI.readDetail(credential_type.id),\n        CredentialsAPI.readInputSources(credentialId),\n      ]);\n      return {\n        fields: credentialTypeInputs.fields || [],\n        managedByTower: managed,\n        inputSources: loadedInputSources.reduce(\n          (inputSourcesMap, inputSource) => {\n            inputSourcesMap[inputSource.input_field_name] = inputSource;\n            return inputSourcesMap;\n          },\n          {}\n        ),\n      };\n    }, [credentialId, credential_type.id]),\n    {\n      fields: [],\n      managedByTower: true,\n      inputSources: {},\n    }\n  );\n\n  const {\n    request: deleteCredential,\n    isLoading,\n    error: deleteError,\n  } = useRequest(\n    useCallback(async () => {\n      await CredentialsAPI.destroy(credentialId);\n      history.push('/credentials');\n    }, [credentialId, history])\n  );\n\n  const { error, dismissError } = useDismissableError(deleteError);\n\n  const renderDetail = ({\n    id,\n    label,\n    type,\n    ask_at_runtime,\n    help_text = '',\n  }) => {\n    if (inputSources[id]) {\n      return (\n        <React.Fragment key={id}>\n          <Detail\n            dataCy={`credential-${id}-detail`}\n            helpText={help_text}\n            id={`credential-${id}-detail`}\n            fullWidth\n            label={<span>{label} *</span>}\n            value={\n              <ChipGroup\n                numChips={1}\n                totalChips={1}\n                ouiaId={`credential-${id}-chips`}\n              >\n                <CredentialChip\n                  credential={inputSources[id].summary_fields.source_credential}\n                  ouiaId={`credential-${id}-chip`}\n                  isReadOnly\n                />\n              </ChipGroup>\n            }\n          />\n          <PluginInputMetadata>\n            <CodeEditor\n              dataCy={`credential-${id}-detail`}\n              id={`credential-${id}-metadata`}\n              mode=\"javascript\"\n              readOnly\n              value={JSON.stringify(inputSources[id].metadata, null, 2)}\n              onChange={() => {}}\n              rows={5}\n              hasErrors={false}\n            />\n          </PluginInputMetadata>\n        </React.Fragment>\n      );\n    }\n\n    if (type === 'boolean') {\n      return null;\n    }\n\n    if (inputs[id] === '$encrypted$') {\n      return (\n        <Detail\n          dataCy={`credential-${id}-detail`}\n          id={`credential-${id}-detail`}\n          key={id}\n          label={label}\n          value={t`Encrypted`}\n          helpText={help_text}\n          isEncrypted\n        />\n      );\n    }\n\n    if (ask_at_runtime && inputs[id] === 'ASK') {\n      return (\n        <Detail\n          dataCy={`credential-${id}-detail`}\n          helpText={help_text}\n          id={`credential-${id}-detail`}\n          key={id}\n          label={label}\n          value={t`Prompt on launch`}\n        />\n      );\n    }\n\n    return (\n      <Detail\n        dataCy={`credential-${id}-detail`}\n        id={`credential-${id}-detail`}\n        key={id}\n        label={label}\n        value={inputs[id]}\n        helpText={help_text}\n      />\n    );\n  };\n\n  useEffect(() => {\n    fetchDetails();\n  }, [fetchDetails]);\n\n  const deleteDetailsRequests =\n    relatedResourceDeleteRequests.credential(credential);\n\n  const enabledBooleanFields = fields.filter(\n    ({ id, type }) => type === 'boolean' && inputs[id]\n  );\n\n  if (hasContentLoading) {\n    return <ContentLoading />;\n  }\n\n  if (contentError) {\n    return <ContentError error={contentError} />;\n  }\n\n  return (\n    <CardBody>\n      <DetailList>\n        <Detail\n          dataCy=\"credential-name-detail\"\n          id=\"credential-name-detail\"\n          label={t`Name`}\n          value={name}\n        />\n        <Detail\n          dataCy=\"credential-description-detail\"\n          id=\"credential-description-detail\"\n          label={t`Description`}\n          value={description}\n        />\n        {organization && (\n          <Detail\n            dataCy=\"credential-organization-detail\"\n            id=\"credential-organization-detail\"\n            label={t`Organization`}\n            value={\n              <Link to={`/organizations/${organization.id}/details`}>\n                {organization.name}\n              </Link>\n            }\n          />\n        )}\n        <Detail\n          dataCy=\"credential-credential_type-detail\"\n          id=\"credential-credential_type-detail\"\n          label={t`Credential Type`}\n          value={\n            managedByTower ? (\n              credential_type.name\n            ) : (\n              <Link to={`/credential_types/${credential_type.id}/details`}>\n                {credential_type.name}\n              </Link>\n            )\n          }\n        />\n\n        {fields.map((field) => renderDetail(field))}\n\n        <UserDateDetail\n          id=\"credential-created-detail\"\n          label={t`Created`}\n          date={created}\n          user={created_by}\n        />\n        <UserDateDetail\n          id=\"credential-last_modified-detail\"\n          label={t`Last Modified`}\n          date={modified}\n          user={modified_by}\n        />\n        <Detail\n          label={t`Enabled Options`}\n          value={\n            <TextList component={TextListVariants.ul}>\n              {enabledBooleanFields.map(({ id, label }) => (\n                <TextListItem key={id} component={TextListItemVariants.li}>\n                  {label}\n                </TextListItem>\n              ))}\n            </TextList>\n          }\n          isEmpty={enabledBooleanFields.length === 0}\n        />\n      </DetailList>\n      {Object.keys(inputSources).length > 0 && (\n        <PluginFieldText>\n          {t`* This field will be retrieved from an external secret management system using the specified credential.`}\n        </PluginFieldText>\n      )}\n      <CardActionsRow>\n        {user_capabilities.edit && (\n          <Button\n            ouiaId=\"credential-detail-edit-button\"\n            component={Link}\n            to={`/credentials/${credentialId}/edit`}\n          >\n            {t`Edit`}\n          </Button>\n        )}\n        {user_capabilities.delete && (\n          <DeleteButton\n            name={name}\n            itemToDelete={credential}\n            modalTitle={t`Delete Credential`}\n            onConfirm={deleteCredential}\n            isLoading={isLoading}\n            deleteDetailsRequests={deleteDetailsRequests}\n            deleteMessage={t`This credential is currently being used by other resources. Are you sure you want to delete it?`}\n          >\n            {t`Delete`}\n          </DeleteButton>\n        )}\n      </CardActionsRow>\n      {error && (\n        <AlertModal\n          isOpen={error}\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={dismissError}\n        >\n          {t`Failed to delete credential.`}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </CardBody>\n  );\n}\n\nCredentialDetail.propTypes = {\n  credential: Credential.isRequired,\n};\n\nexport default CredentialDetail;\n"]},"metadata":{},"sourceType":"module"}