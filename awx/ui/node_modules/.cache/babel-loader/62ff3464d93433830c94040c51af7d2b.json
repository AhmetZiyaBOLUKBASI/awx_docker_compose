{"ast":null,"code":"import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect,useState}from'react';import{useField,useFormikContext}from'formik';import{FormGroup,SelectVariant,Select,SelectOption}from'@patternfly/react-core';import{ProjectsAPI}from'api';import useRequest from'hooks/useRequest';import{required}from'util/validators';import CredentialLookup from'components/Lookup/CredentialLookup';import ProjectLookup from'components/Lookup/ProjectLookup';import Popover from'components/Popover';import{OptionsField,SourceVarsField,VerbosityField,EnabledVarField,EnabledValueField,HostFilterField}from'./SharedFields';import helpText from'../Inventory.helptext';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SCMSubForm=function SCMSubForm(_ref){var autoPopulateProject=_ref.autoPopulateProject;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isOpen=_useState2[0],setIsOpen=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),sourcePath=_useState4[0],setSourcePath=_useState4[1];var _useFormikContext=useFormikContext(),setFieldValue=_useFormikContext.setFieldValue,setFieldTouched=_useFormikContext.setFieldTouched;var _useField=useField('credential'),_useField2=_slicedToArray(_useField,1),credentialField=_useField2[0];var _useField3=useField('source_project'),_useField4=_slicedToArray(_useField3,3),projectField=_useField4[0],projectMeta=_useField4[1],projectHelpers=_useField4[2];var _useField5=useField({name:'source_path',validate:required(/*i18n*/i18n._(\"Select a value for this field\"))}),_useField6=_slicedToArray(_useField5,3),sourcePathField=_useField6[0],sourcePathMeta=_useField6[1],sourcePathHelpers=_useField6[2];var _useRequest=useRequest(useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(projectId){var _yield$ProjectsAPI$re,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return ProjectsAPI.readInventories(projectId);case 2:_yield$ProjectsAPI$re=_context.sent;data=_yield$ProjectsAPI$re.data;setSourcePath([].concat(_toConsumableArray(data),['/ (project root)']));case 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}(),[]),[]),sourcePathError=_useRequest.error,fetchSourcePath=_useRequest.request;useEffect(function(){if(projectMeta.initialValue){fetchSourcePath(projectMeta.initialValue.id);if(sourcePathField.value===''){sourcePathHelpers.setValue('/ (project root)');}}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[fetchSourcePath,projectMeta.initialValue]);var handleProjectUpdate=useCallback(function(value){setFieldValue('source_project',value);setFieldTouched('source_project',true,false);if(sourcePathField.value){setFieldValue('source_path','');setFieldTouched('source_path',false);}if(value){fetchSourcePath(value.id);}},[fetchSourcePath,setFieldValue,setFieldTouched,sourcePathField.value]);var handleCredentialUpdate=useCallback(function(value){setFieldValue('credential',value);setFieldTouched('credential',true,false);},[setFieldValue,setFieldTouched]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CredentialLookup,{credentialTypeKind:\"cloud\",label:/*i18n*/i18n._(\"Credential\"),value:credentialField.value,onChange:handleCredentialUpdate}),/*#__PURE__*/_jsx(ProjectLookup,{value:projectField.value,isValid:!projectMeta.touched||!projectMeta.error,helperTextInvalid:projectMeta.error,onBlur:function onBlur(){return projectHelpers.setTouched();},onChange:handleProjectUpdate,required:true,autoPopulate:autoPopulateProject,fieldName:\"source_project\",validate:required(/*i18n*/i18n._(\"Select a value for this field\"))}),/*#__PURE__*/_jsx(FormGroup,{fieldId:\"source_path\",helperTextInvalid:(sourcePathError===null||sourcePathError===void 0?void 0:sourcePathError.message)||sourcePathMeta.error,validated:(!sourcePathMeta.error||!sourcePathMeta.touched)&&!(sourcePathError!==null&&sourcePathError!==void 0&&sourcePathError.message)?'default':'error',isRequired:true,label:/*i18n*/i18n._(\"Inventory file\"),labelIcon:/*#__PURE__*/_jsx(Popover,{content:helpText.sourcePath}),children:/*#__PURE__*/_jsx(Select,{ouiaId:\"InventorySourceForm-source_path\",variant:SelectVariant.typeahead,onToggle:setIsOpen,isOpen:isOpen,selections:sourcePathField.value,id:\"source_path\",isValid:(!sourcePathMeta.error||!sourcePathMeta.touched)&&!(sourcePathError!==null&&sourcePathError!==void 0&&sourcePathError.message),onSelect:function onSelect(event,value){setIsOpen(false);value=value.trim();sourcePathHelpers.setValue(value);},\"aria-label\":/*i18n*/i18n._(\"Select source path\"),typeAheadAriaLabel:/*i18n*/i18n._(\"Select source path\"),placeholder:/*i18n*/i18n._(\"Select source path\"),createText:/*i18n*/i18n._(\"Set source path to\"),isCreatable:true,onCreateOption:function onCreateOption(value){value.trim();setSourcePath([].concat(_toConsumableArray(sourcePath),[value]));},noResultsFoundText:/*i18n*/i18n._(\"No results found\"),children:sourcePath.map(function(path){return/*#__PURE__*/_jsx(SelectOption,{id:path,value:path},path);})})}),/*#__PURE__*/_jsx(VerbosityField,{}),/*#__PURE__*/_jsx(HostFilterField,{}),/*#__PURE__*/_jsx(EnabledVarField,{}),/*#__PURE__*/_jsx(EnabledValueField,{}),/*#__PURE__*/_jsx(OptionsField,{showProjectUpdate:true}),/*#__PURE__*/_jsx(SourceVarsField,{})]});};export default SCMSubForm;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Inventory/shared/InventorySourceSubForms/SCMSubForm.js"],"names":["React","useCallback","useEffect","useState","useField","useFormikContext","FormGroup","SelectVariant","Select","SelectOption","ProjectsAPI","useRequest","required","CredentialLookup","ProjectLookup","Popover","OptionsField","SourceVarsField","VerbosityField","EnabledVarField","EnabledValueField","HostFilterField","helpText","SCMSubForm","autoPopulateProject","isOpen","setIsOpen","sourcePath","setSourcePath","setFieldValue","setFieldTouched","credentialField","projectField","projectMeta","projectHelpers","name","validate","sourcePathField","sourcePathMeta","sourcePathHelpers","projectId","readInventories","data","sourcePathError","error","fetchSourcePath","request","initialValue","id","value","setValue","handleProjectUpdate","handleCredentialUpdate","touched","setTouched","message","typeahead","event","trim","map","path"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { useField, useFormikContext } from 'formik';\nimport { t } from '@lingui/macro';\nimport {\n  FormGroup,\n  SelectVariant,\n  Select,\n  SelectOption,\n} from '@patternfly/react-core';\nimport { ProjectsAPI } from 'api';\nimport useRequest from 'hooks/useRequest';\nimport { required } from 'util/validators';\nimport CredentialLookup from 'components/Lookup/CredentialLookup';\nimport ProjectLookup from 'components/Lookup/ProjectLookup';\nimport Popover from 'components/Popover';\nimport {\n  OptionsField,\n  SourceVarsField,\n  VerbosityField,\n  EnabledVarField,\n  EnabledValueField,\n  HostFilterField,\n} from './SharedFields';\nimport helpText from '../Inventory.helptext';\n\nconst SCMSubForm = ({ autoPopulateProject }) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [sourcePath, setSourcePath] = useState([]);\n  const { setFieldValue, setFieldTouched } = useFormikContext();\n  const [credentialField] = useField('credential');\n\n  const [projectField, projectMeta, projectHelpers] =\n    useField('source_project');\n  const [sourcePathField, sourcePathMeta, sourcePathHelpers] = useField({\n    name: 'source_path',\n    validate: required(t`Select a value for this field`),\n  });\n\n  const { error: sourcePathError, request: fetchSourcePath } = useRequest(\n    useCallback(async (projectId) => {\n      const { data } = await ProjectsAPI.readInventories(projectId);\n      setSourcePath([...data, '/ (project root)']);\n    }, []),\n    []\n  );\n\n  useEffect(() => {\n    if (projectMeta.initialValue) {\n      fetchSourcePath(projectMeta.initialValue.id);\n      if (sourcePathField.value === '') {\n        sourcePathHelpers.setValue('/ (project root)');\n      }\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [fetchSourcePath, projectMeta.initialValue]);\n\n  const handleProjectUpdate = useCallback(\n    (value) => {\n      setFieldValue('source_project', value);\n      setFieldTouched('source_project', true, false);\n      if (sourcePathField.value) {\n        setFieldValue('source_path', '');\n        setFieldTouched('source_path', false);\n      }\n      if (value) {\n        fetchSourcePath(value.id);\n      }\n    },\n    [fetchSourcePath, setFieldValue, setFieldTouched, sourcePathField.value]\n  );\n\n  const handleCredentialUpdate = useCallback(\n    (value) => {\n      setFieldValue('credential', value);\n      setFieldTouched('credential', true, false);\n    },\n    [setFieldValue, setFieldTouched]\n  );\n\n  return (\n    <>\n      <CredentialLookup\n        credentialTypeKind=\"cloud\"\n        label={t`Credential`}\n        value={credentialField.value}\n        onChange={handleCredentialUpdate}\n      />\n      <ProjectLookup\n        value={projectField.value}\n        isValid={!projectMeta.touched || !projectMeta.error}\n        helperTextInvalid={projectMeta.error}\n        onBlur={() => projectHelpers.setTouched()}\n        onChange={handleProjectUpdate}\n        required\n        autoPopulate={autoPopulateProject}\n        fieldName=\"source_project\"\n        validate={required(t`Select a value for this field`)}\n      />\n      <FormGroup\n        fieldId=\"source_path\"\n        helperTextInvalid={sourcePathError?.message || sourcePathMeta.error}\n        validated={\n          (!sourcePathMeta.error || !sourcePathMeta.touched) &&\n          !sourcePathError?.message\n            ? 'default'\n            : 'error'\n        }\n        isRequired\n        label={t`Inventory file`}\n        labelIcon={<Popover content={helpText.sourcePath} />}\n      >\n        <Select\n          ouiaId=\"InventorySourceForm-source_path\"\n          variant={SelectVariant.typeahead}\n          onToggle={setIsOpen}\n          isOpen={isOpen}\n          selections={sourcePathField.value}\n          id=\"source_path\"\n          isValid={\n            (!sourcePathMeta.error || !sourcePathMeta.touched) &&\n            !sourcePathError?.message\n          }\n          onSelect={(event, value) => {\n            setIsOpen(false);\n            value = value.trim();\n            sourcePathHelpers.setValue(value);\n          }}\n          aria-label={t`Select source path`}\n          typeAheadAriaLabel={t`Select source path`}\n          placeholder={t`Select source path`}\n          createText={t`Set source path to`}\n          isCreatable\n          onCreateOption={(value) => {\n            value.trim();\n            setSourcePath([...sourcePath, value]);\n          }}\n          noResultsFoundText={t`No results found`}\n        >\n          {sourcePath.map((path) => (\n            <SelectOption key={path} id={path} value={path} />\n          ))}\n        </Select>\n      </FormGroup>\n      <VerbosityField />\n      <HostFilterField />\n      <EnabledVarField />\n      <EnabledValueField />\n      <OptionsField showProjectUpdate />\n      <SourceVarsField />\n    </>\n  );\n};\n\nexport default SCMSubForm;\n"]},"metadata":{},"sourceType":"module"}