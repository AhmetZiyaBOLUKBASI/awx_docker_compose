{"ast":null,"code":"import _defineProperty from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import{useFormikContext}from'formik';import useInventoryStep from'./steps/useInventoryStep';import useCredentialsStep from'./steps/useCredentialsStep';import useCredentialPasswordsStep from'./steps/useCredentialPasswordsStep';import useOtherPromptsStep from'./steps/useOtherPromptsStep';import useSurveyStep from'./steps/useSurveyStep';import usePreviewStep from'./steps/usePreviewStep';function showCredentialPasswordsStep(launchConfig){var credentials=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(!(launchConfig!==null&&launchConfig!==void 0&&launchConfig.ask_credential_on_launch)&&launchConfig!==null&&launchConfig!==void 0&&launchConfig.passwords_needed_to_start){return launchConfig.passwords_needed_to_start.length>0;}var credentialPasswordStepRequired=false;credentials.forEach(function(credential){var _credential$inputs,_credential$inputs2,_credential$inputs3,_credential$inputs4;if(!credential.inputs){var launchConfigCredential=launchConfig.defaults.credentials.find(function(defaultCred){return defaultCred.id===credential.id;});if((launchConfigCredential===null||launchConfigCredential===void 0?void 0:launchConfigCredential.passwords_needed.length)>0){credentialPasswordStepRequired=true;}}else if((credential===null||credential===void 0?void 0:(_credential$inputs=credential.inputs)===null||_credential$inputs===void 0?void 0:_credential$inputs.password)==='ASK'||(credential===null||credential===void 0?void 0:(_credential$inputs2=credential.inputs)===null||_credential$inputs2===void 0?void 0:_credential$inputs2.become_password)==='ASK'||(credential===null||credential===void 0?void 0:(_credential$inputs3=credential.inputs)===null||_credential$inputs3===void 0?void 0:_credential$inputs3.ssh_key_unlock)==='ASK'||(credential===null||credential===void 0?void 0:(_credential$inputs4=credential.inputs)===null||_credential$inputs4===void 0?void 0:_credential$inputs4.vault_password)==='ASK'){credentialPasswordStepRequired=true;}});return credentialPasswordStepRequired;}export default function useLaunchSteps(launchConfig,surveyConfig,resource){var _useState=useState({}),_useState2=_slicedToArray(_useState,2),visited=_useState2[0],setVisited=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isReady=_useState4[0],setIsReady=_useState4[1];var _useFormikContext=useFormikContext(),touched=_useFormikContext.touched,formikValues=_useFormikContext.values;var steps=[useInventoryStep(launchConfig,resource,visited),useCredentialsStep(launchConfig,resource,resource.summary_fields.credentials||[],true),useCredentialPasswordsStep(launchConfig,showCredentialPasswordsStep(launchConfig,formikValues.credentials),visited),useOtherPromptsStep(launchConfig,resource),useSurveyStep(launchConfig,surveyConfig,resource,visited)];var _useFormikContext2=useFormikContext(),resetForm=_useFormikContext2.resetForm;var hasErrors=steps.some(function(step){return step.hasError;});steps.push(usePreviewStep(launchConfig,resource,surveyConfig,hasErrors,true));var pfSteps=steps.map(function(s){return s.step;}).filter(function(s){return s!=null;});var stepsAreReady=!steps.some(function(s){return!s.isReady;});useEffect(function(){if(!stepsAreReady){return;}var initialValues=steps.reduce(function(acc,cur){return _objectSpread(_objectSpread({},acc),cur.initialValues);},{});var newFormValues=_objectSpread({},initialValues);Object.keys(formikValues).forEach(function(formikValueKey){if(formikValueKey==='credential_passwords'&&Object.prototype.hasOwnProperty.call(newFormValues,'credential_passwords')){var formikCredentialPasswords=formikValues.credential_passwords;Object.keys(formikCredentialPasswords).forEach(function(credentialPasswordValueKey){if(Object.prototype.hasOwnProperty.call(newFormValues.credential_passwords,credentialPasswordValueKey)){newFormValues.credential_passwords[credentialPasswordValueKey]=formikCredentialPasswords[credentialPasswordValueKey];}});}else if(Object.prototype.hasOwnProperty.call(newFormValues,formikValueKey)){newFormValues[formikValueKey]=formikValues[formikValueKey];}});resetForm({values:newFormValues,touched:touched});setIsReady(true);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[formikValues.credentials,stepsAreReady]);var stepWithError=steps.find(function(s){return s.contentError;});var contentError=stepWithError?stepWithError.contentError:null;return{steps:pfSteps,isReady:isReady,validateStep:function validateStep(stepId){steps.find(function(s){var _s$step;return(s===null||s===void 0?void 0:(_s$step=s.step)===null||_s$step===void 0?void 0:_s$step.id)===stepId;}).validate();},visitStep:function visitStep(prevStepId,setFieldTouched){setVisited(_objectSpread(_objectSpread({},visited),{},_defineProperty({},prevStepId,true)));steps.find(function(s){var _s$step2;return(s===null||s===void 0?void 0:(_s$step2=s.step)===null||_s$step2===void 0?void 0:_s$step2.id)===prevStepId;}).setTouched(setFieldTouched);},visitAllSteps:function visitAllSteps(setFieldTouched){setVisited({inventory:true,credentials:true,credentialPasswords:true,other:true,survey:true,preview:true});steps.forEach(function(s){return s.setTouched(setFieldTouched);});},contentError:contentError};}","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/LaunchPrompt/useLaunchSteps.js"],"names":["useState","useEffect","useFormikContext","useInventoryStep","useCredentialsStep","useCredentialPasswordsStep","useOtherPromptsStep","useSurveyStep","usePreviewStep","showCredentialPasswordsStep","launchConfig","credentials","ask_credential_on_launch","passwords_needed_to_start","length","credentialPasswordStepRequired","forEach","credential","inputs","launchConfigCredential","defaults","find","defaultCred","id","passwords_needed","password","become_password","ssh_key_unlock","vault_password","useLaunchSteps","surveyConfig","resource","visited","setVisited","isReady","setIsReady","touched","formikValues","values","steps","summary_fields","resetForm","hasErrors","some","step","hasError","push","pfSteps","map","s","filter","stepsAreReady","initialValues","reduce","acc","cur","newFormValues","Object","keys","formikValueKey","prototype","hasOwnProperty","call","formikCredentialPasswords","credential_passwords","credentialPasswordValueKey","stepWithError","contentError","validateStep","stepId","validate","visitStep","prevStepId","setFieldTouched","setTouched","visitAllSteps","inventory","credentialPasswords","other","survey","preview"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react';\nimport { useFormikContext } from 'formik';\nimport useInventoryStep from './steps/useInventoryStep';\nimport useCredentialsStep from './steps/useCredentialsStep';\nimport useCredentialPasswordsStep from './steps/useCredentialPasswordsStep';\nimport useOtherPromptsStep from './steps/useOtherPromptsStep';\nimport useSurveyStep from './steps/useSurveyStep';\nimport usePreviewStep from './steps/usePreviewStep';\n\nfunction showCredentialPasswordsStep(launchConfig, credentials = []) {\n  if (\n    !launchConfig?.ask_credential_on_launch &&\n    launchConfig?.passwords_needed_to_start\n  ) {\n    return launchConfig.passwords_needed_to_start.length > 0;\n  }\n\n  let credentialPasswordStepRequired = false;\n\n  credentials.forEach((credential) => {\n    if (!credential.inputs) {\n      const launchConfigCredential = launchConfig.defaults.credentials.find(\n        (defaultCred) => defaultCred.id === credential.id\n      );\n\n      if (launchConfigCredential?.passwords_needed.length > 0) {\n        credentialPasswordStepRequired = true;\n      }\n    } else if (\n      credential?.inputs?.password === 'ASK' ||\n      credential?.inputs?.become_password === 'ASK' ||\n      credential?.inputs?.ssh_key_unlock === 'ASK' ||\n      credential?.inputs?.vault_password === 'ASK'\n    ) {\n      credentialPasswordStepRequired = true;\n    }\n  });\n\n  return credentialPasswordStepRequired;\n}\n\nexport default function useLaunchSteps(launchConfig, surveyConfig, resource) {\n  const [visited, setVisited] = useState({});\n  const [isReady, setIsReady] = useState(false);\n  const { touched, values: formikValues } = useFormikContext();\n  const steps = [\n    useInventoryStep(launchConfig, resource, visited),\n    useCredentialsStep(\n      launchConfig,\n      resource,\n      resource.summary_fields.credentials || [],\n      true\n    ),\n    useCredentialPasswordsStep(\n      launchConfig,\n      showCredentialPasswordsStep(launchConfig, formikValues.credentials),\n      visited\n    ),\n    useOtherPromptsStep(launchConfig, resource),\n    useSurveyStep(launchConfig, surveyConfig, resource, visited),\n  ];\n  const { resetForm } = useFormikContext();\n  const hasErrors = steps.some((step) => step.hasError);\n\n  steps.push(\n    usePreviewStep(launchConfig, resource, surveyConfig, hasErrors, true)\n  );\n\n  const pfSteps = steps.map((s) => s.step).filter((s) => s != null);\n  const stepsAreReady = !steps.some((s) => !s.isReady);\n\n  useEffect(() => {\n    if (!stepsAreReady) {\n      return;\n    }\n\n    const initialValues = steps.reduce(\n      (acc, cur) => ({\n        ...acc,\n        ...cur.initialValues,\n      }),\n      {}\n    );\n\n    const newFormValues = { ...initialValues };\n\n    Object.keys(formikValues).forEach((formikValueKey) => {\n      if (\n        formikValueKey === 'credential_passwords' &&\n        Object.prototype.hasOwnProperty.call(\n          newFormValues,\n          'credential_passwords'\n        )\n      ) {\n        const formikCredentialPasswords = formikValues.credential_passwords;\n        Object.keys(formikCredentialPasswords).forEach(\n          (credentialPasswordValueKey) => {\n            if (\n              Object.prototype.hasOwnProperty.call(\n                newFormValues.credential_passwords,\n                credentialPasswordValueKey\n              )\n            ) {\n              newFormValues.credential_passwords[credentialPasswordValueKey] =\n                formikCredentialPasswords[credentialPasswordValueKey];\n            }\n          }\n        );\n      } else if (\n        Object.prototype.hasOwnProperty.call(newFormValues, formikValueKey)\n      ) {\n        newFormValues[formikValueKey] = formikValues[formikValueKey];\n      }\n    });\n\n    resetForm({\n      values: newFormValues,\n      touched,\n    });\n\n    setIsReady(true);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [formikValues.credentials, stepsAreReady]);\n\n  const stepWithError = steps.find((s) => s.contentError);\n  const contentError = stepWithError ? stepWithError.contentError : null;\n\n  return {\n    steps: pfSteps,\n    isReady,\n    validateStep: (stepId) => {\n      steps.find((s) => s?.step?.id === stepId).validate();\n    },\n    visitStep: (prevStepId, setFieldTouched) => {\n      setVisited({\n        ...visited,\n        [prevStepId]: true,\n      });\n      steps.find((s) => s?.step?.id === prevStepId).setTouched(setFieldTouched);\n    },\n    visitAllSteps: (setFieldTouched) => {\n      setVisited({\n        inventory: true,\n        credentials: true,\n        credentialPasswords: true,\n        other: true,\n        survey: true,\n        preview: true,\n      });\n      steps.forEach((s) => s.setTouched(setFieldTouched));\n    },\n    contentError,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}