{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import*as d3 from'd3';import{PageContextConsumer}from'@patternfly/react-core';import ChartTooltip from'./ChartTooltip';import{jsx as _jsx}from\"react/jsx-runtime\";function LineChart(_ref){var id=_ref.id,data=_ref.data,height=_ref.height,pageContext=_ref.pageContext,jobStatus=_ref.jobStatus;var isNavOpen=pageContext.isNavOpen;// Methods\nvar draw=useCallback(function(){var margin={top:15,right:15,bottom:35,left:70};var getWidth=function getWidth(){var width;// This is in an a try/catch due to an error from jest.\n// Even though the d3.select returns a valid selector with\n// style function, it says it is null in the test\ntry{width=parseInt(d3.select(\"#\".concat(id)).style('width'),10)-margin.left-margin.right||700;}catch(error){width=700;}return width;};// Clear our chart container element first\nd3.selectAll(\"#\".concat(id,\" > *\")).remove();var width=getWidth();function transition(path){path.transition().duration(1000).attrTween('stroke-dasharray',tweenDash);}function tweenDash(){for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++){params[_key]=arguments[_key];}var l=params[2][params[1]].getTotalLength();var i=d3.interpolateString(\"0,\".concat(l),\"\".concat(l,\",\").concat(l));return function(val){return i(val);};}var x=d3.scaleTime().rangeRound([0,width]);var y=d3.scaleLinear().range([height,0]);// [success, fail, total]\nvar colors=d3.scaleOrdinal(['#6EC664','#A30000','#06C']);var svg=d3.select(\"#\".concat(id)).append('svg').attr('width',width+margin.left+margin.right).attr('height',height+margin.top+margin.bottom)// .attr('id', 'foo')\n.attr('z',100).append('g').attr('id','chart-container').attr('transform',\"translate(\".concat(margin.left,\", \").concat(margin.top,\")\"));// Tooltip\nvar tooltip=new ChartTooltip({svg:\"#\".concat(id),colors:colors,label:/*i18n*/i18n._(\"Jobs\")});var parseTime=d3.timeParse('%Y-%m-%d');var formattedData=data.reduce(function(formatted,_ref2){var created=_ref2.created,successful=_ref2.successful,failed=_ref2.failed;var DATE=parseTime(created)||new Date();var RAN=+successful||0;var FAIL=+failed||0;var TOTAL=+successful+failed||0;return formatted.concat({DATE:DATE,RAN:RAN,FAIL:FAIL,TOTAL:TOTAL});},[]);// Scale the range of the data\nvar largestY=formattedData.reduce(function(a_max,b){var b_max=Math.max(b.RAN>b.FAIL?b.RAN:b.FAIL);return a_max>b_max?a_max:b_max;},0);x.domain(d3.extent(formattedData,function(d){return d.DATE;}));y.domain([0,largestY>4?largestY+Math.max(largestY/10,1):5]).nice();var successLine=d3.line().curve(d3.curveMonotoneX).x(function(d){return x(d.DATE);}).y(function(d){return y(d.RAN);});var failLine=d3.line().defined(function(d){return typeof d.FAIL==='number';}).curve(d3.curveMonotoneX).x(function(d){return x(d.DATE);}).y(function(d){return y(d.FAIL);});// Add the Y Axis\nsvg.append('g').attr('class','y-axis').call(d3.axisLeft(y).ticks(largestY>3?Math.min(largestY+Math.max(largestY/10,1),10):5).tickSize(-width).tickFormat(d3.format('d'))).selectAll('line').attr('stroke','#d7d7d7');svg.selectAll('.y-axis .tick text').attr('x',-5);// text label for the y axis\nsvg.append('text').attr('transform','rotate(-90)').attr('y',0-margin.left).attr('x',0-height/2).attr('dy','1em').style('text-anchor','middle').text(/*i18n*/i18n._(\"Job Runs\"));// Add the X Axis\nvar ticks;var maxTicks=Math.round(formattedData.length/(formattedData.length/2));ticks=formattedData.map(function(d){return d.DATE;});if(formattedData.length===31){ticks=formattedData.map(function(d,i){return i%maxTicks===0?d.DATE:undefined;}).filter(function(item){return item;});}svg.select('.domain').attr('stroke','#d7d7d7');svg.append('g').attr('class','x-axis').attr('transform',\"translate(0, \".concat(height,\")\")).call(d3.axisBottom(x).tickValues(ticks).tickSize(-height).tickFormat(d3.timeFormat('%-m/%-d'))// \"1/19\"\n)// \"Jan-01\"\n.selectAll('line').attr('stroke','#d7d7d7');svg.selectAll('.x-axis .tick text').attr('y',10);// text label for the x axis\nsvg.append('text').attr('transform',\"translate(\".concat(width/2,\" , \").concat(height+margin.top+20,\")\")).style('text-anchor','middle').text(/*i18n*/i18n._(\"Date\"));var vertical=svg.append('path').attr('class','mouse-line').style('stroke','black').style('stroke-width','3px').style('stroke-dasharray','3, 3').style('opacity','0');var handleMouseOver=function handleMouseOver(event,d){tooltip.handleMouseOver(event,d);// show vertical line\nvertical.transition().style('opacity','1');};var handleMouseMove=function mouseMove(event){var _d3$pointer=d3.pointer(event),_d3$pointer2=_slicedToArray(_d3$pointer,1),pointerX=_d3$pointer2[0];vertical.attr('d',function(){return\"M\".concat(pointerX,\",\").concat(height,\" \").concat(pointerX,\",\",0);});};var handleMouseOut=function handleMouseOut(){// hide tooltip\ntooltip.handleMouseOut();// hide vertical line\nvertical.transition().style('opacity',0);};var dateFormat=d3.timeFormat('%-m-%-d');if(jobStatus!=='failed'){// Add the success line path.\nsvg.append('path').data([formattedData]).attr('class','line').style('fill','none').style('stroke',function(){return colors(1);}).attr('stroke-width',2).attr('d',successLine).call(transition);// create our success line circles\nsvg.selectAll('dot').data(formattedData).enter().append('circle').attr('r',3).style('stroke',function(){return colors(1);}).style('fill',function(){return colors(1);}).attr('cx',function(d){return x(d.DATE);}).attr('cy',function(d){return y(d.RAN);}).attr('id',function(d){return\"success-dot-\".concat(dateFormat(d.DATE));}).on('mouseover',function(event,d){return handleMouseOver(event,d);}).on('mousemove',handleMouseMove).on('mouseout',handleMouseOut);}if(jobStatus!=='successful'){// Add the failed line path.\nsvg.append('path').data([formattedData]).attr('class','line').style('fill','none').style('stroke',function(){return colors(0);}).attr('stroke-width',2).attr('d',failLine).call(transition);// create our failed line circles\nsvg.selectAll('dot').data(formattedData).enter().append('circle').attr('r',3).style('stroke',function(){return colors(0);}).style('fill',function(){return colors(0);}).attr('cx',function(d){return x(d.DATE);}).attr('cy',function(d){return y(d.FAIL);}).attr('id',function(d){return\"fail-dot-\".concat(dateFormat(d.DATE));}).on('mouseover',handleMouseOver).on('mousemove',handleMouseMove).on('mouseout',handleMouseOut);}},[data,height,id,jobStatus]);useEffect(function(){draw();},[draw,isNavOpen]);useEffect(function(){function handleResize(){draw();}window.addEventListener('resize',handleResize);handleResize();return function(){return window.removeEventListener('resize',handleResize);};},[draw]);return/*#__PURE__*/_jsx(\"div\",{id:id});}var withPageContext=function withPageContext(Component){return function contextComponent(props){return/*#__PURE__*/_jsx(PageContextConsumer,{children:function children(pageContext){return/*#__PURE__*/_jsx(Component,_objectSpread(_objectSpread({},props),{},{pageContext:pageContext}));}});};};export default withPageContext(LineChart);","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Dashboard/shared/LineChart.js"],"names":["React","useEffect","useCallback","d3","PageContextConsumer","ChartTooltip","LineChart","id","data","height","pageContext","jobStatus","isNavOpen","draw","margin","top","right","bottom","left","getWidth","width","parseInt","select","style","error","selectAll","remove","transition","path","duration","attrTween","tweenDash","params","l","getTotalLength","i","interpolateString","val","x","scaleTime","rangeRound","y","scaleLinear","range","colors","scaleOrdinal","svg","append","attr","tooltip","label","parseTime","timeParse","formattedData","reduce","formatted","created","successful","failed","DATE","Date","RAN","FAIL","TOTAL","concat","largestY","a_max","b","b_max","Math","max","domain","extent","d","nice","successLine","line","curve","curveMonotoneX","failLine","defined","call","axisLeft","ticks","min","tickSize","tickFormat","format","text","maxTicks","round","length","map","undefined","filter","item","axisBottom","tickValues","timeFormat","vertical","handleMouseOver","event","handleMouseMove","mouseMove","pointer","pointerX","handleMouseOut","dateFormat","enter","on","handleResize","window","addEventListener","removeEventListener","withPageContext","Component","contextComponent","props"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { string, number, shape, arrayOf } from 'prop-types';\nimport * as d3 from 'd3';\nimport { t } from '@lingui/macro';\nimport { PageContextConsumer } from '@patternfly/react-core';\nimport ChartTooltip from './ChartTooltip';\n\nfunction LineChart({ id, data, height, pageContext, jobStatus }) {\n  const { isNavOpen } = pageContext;\n\n  // Methods\n  const draw = useCallback(() => {\n    const margin = { top: 15, right: 15, bottom: 35, left: 70 };\n\n    const getWidth = () => {\n      let width;\n      // This is in an a try/catch due to an error from jest.\n      // Even though the d3.select returns a valid selector with\n      // style function, it says it is null in the test\n      try {\n        width =\n          parseInt(d3.select(`#${id}`).style('width'), 10) -\n            margin.left -\n            margin.right || 700;\n      } catch (error) {\n        width = 700;\n      }\n      return width;\n    };\n\n    // Clear our chart container element first\n    d3.selectAll(`#${id} > *`).remove();\n    const width = getWidth();\n\n    function transition(path) {\n      path.transition().duration(1000).attrTween('stroke-dasharray', tweenDash);\n    }\n\n    function tweenDash(...params) {\n      const l = params[2][params[1]].getTotalLength();\n      const i = d3.interpolateString(`0,${l}`, `${l},${l}`);\n      return (val) => i(val);\n    }\n\n    const x = d3.scaleTime().rangeRound([0, width]);\n    const y = d3.scaleLinear().range([height, 0]);\n\n    // [success, fail, total]\n    const colors = d3.scaleOrdinal(['#6EC664', '#A30000', '#06C']);\n    const svg = d3\n      .select(`#${id}`)\n      .append('svg')\n      .attr('width', width + margin.left + margin.right)\n      .attr('height', height + margin.top + margin.bottom)\n      // .attr('id', 'foo')\n      .attr('z', 100)\n      .append('g')\n      .attr('id', 'chart-container')\n      .attr('transform', `translate(${margin.left}, ${margin.top})`);\n    // Tooltip\n    const tooltip = new ChartTooltip({\n      svg: `#${id}`,\n      colors,\n      label: t`Jobs`,\n    });\n    const parseTime = d3.timeParse('%Y-%m-%d');\n\n    const formattedData = data.reduce(\n      (formatted, { created, successful, failed }) => {\n        const DATE = parseTime(created) || new Date();\n        const RAN = +successful || 0;\n        const FAIL = +failed || 0;\n        const TOTAL = +successful + failed || 0;\n        return formatted.concat({ DATE, RAN, FAIL, TOTAL });\n      },\n      []\n    );\n    // Scale the range of the data\n    const largestY = formattedData.reduce((a_max, b) => {\n      const b_max = Math.max(b.RAN > b.FAIL ? b.RAN : b.FAIL);\n      return a_max > b_max ? a_max : b_max;\n    }, 0);\n    x.domain(d3.extent(formattedData, (d) => d.DATE));\n    y.domain([\n      0,\n      largestY > 4 ? largestY + Math.max(largestY / 10, 1) : 5,\n    ]).nice();\n\n    const successLine = d3\n      .line()\n      .curve(d3.curveMonotoneX)\n      .x((d) => x(d.DATE))\n      .y((d) => y(d.RAN));\n\n    const failLine = d3\n      .line()\n      .defined((d) => typeof d.FAIL === 'number')\n      .curve(d3.curveMonotoneX)\n      .x((d) => x(d.DATE))\n      .y((d) => y(d.FAIL));\n    // Add the Y Axis\n    svg\n      .append('g')\n      .attr('class', 'y-axis')\n      .call(\n        d3\n          .axisLeft(y)\n          .ticks(\n            largestY > 3\n              ? Math.min(largestY + Math.max(largestY / 10, 1), 10)\n              : 5\n          )\n          .tickSize(-width)\n          .tickFormat(d3.format('d'))\n      )\n      .selectAll('line')\n      .attr('stroke', '#d7d7d7');\n    svg.selectAll('.y-axis .tick text').attr('x', -5);\n\n    // text label for the y axis\n    svg\n      .append('text')\n      .attr('transform', 'rotate(-90)')\n      .attr('y', 0 - margin.left)\n      .attr('x', 0 - height / 2)\n      .attr('dy', '1em')\n      .style('text-anchor', 'middle')\n      .text(t`Job Runs`);\n\n    // Add the X Axis\n    let ticks;\n    const maxTicks = Math.round(\n      formattedData.length / (formattedData.length / 2)\n    );\n    ticks = formattedData.map((d) => d.DATE);\n    if (formattedData.length === 31) {\n      ticks = formattedData\n        .map((d, i) => (i % maxTicks === 0 ? d.DATE : undefined))\n        .filter((item) => item);\n    }\n\n    svg.select('.domain').attr('stroke', '#d7d7d7');\n\n    svg\n      .append('g')\n      .attr('class', 'x-axis')\n      .attr('transform', `translate(0, ${height})`)\n      .call(\n        d3\n          .axisBottom(x)\n          .tickValues(ticks)\n          .tickSize(-height)\n          .tickFormat(d3.timeFormat('%-m/%-d')) // \"1/19\"\n      ) // \"Jan-01\"\n      .selectAll('line')\n      .attr('stroke', '#d7d7d7');\n\n    svg.selectAll('.x-axis .tick text').attr('y', 10);\n\n    // text label for the x axis\n    svg\n      .append('text')\n      .attr(\n        'transform',\n        `translate(${width / 2} , ${height + margin.top + 20})`\n      )\n      .style('text-anchor', 'middle')\n      .text(t`Date`);\n    const vertical = svg\n      .append('path')\n      .attr('class', 'mouse-line')\n      .style('stroke', 'black')\n      .style('stroke-width', '3px')\n      .style('stroke-dasharray', '3, 3')\n      .style('opacity', '0');\n\n    const handleMouseOver = (event, d) => {\n      tooltip.handleMouseOver(event, d);\n      // show vertical line\n      vertical.transition().style('opacity', '1');\n    };\n    const handleMouseMove = function mouseMove(event) {\n      const [pointerX] = d3.pointer(event);\n      vertical.attr('d', () => `M${pointerX},${height} ${pointerX},${0}`);\n    };\n\n    const handleMouseOut = () => {\n      // hide tooltip\n      tooltip.handleMouseOut();\n      // hide vertical line\n      vertical.transition().style('opacity', 0);\n    };\n\n    const dateFormat = d3.timeFormat('%-m-%-d');\n\n    if (jobStatus !== 'failed') {\n      // Add the success line path.\n      svg\n        .append('path')\n        .data([formattedData])\n        .attr('class', 'line')\n        .style('fill', 'none')\n        .style('stroke', () => colors(1))\n        .attr('stroke-width', 2)\n        .attr('d', successLine)\n        .call(transition);\n\n      // create our success line circles\n\n      svg\n        .selectAll('dot')\n        .data(formattedData)\n        .enter()\n        .append('circle')\n        .attr('r', 3)\n        .style('stroke', () => colors(1))\n        .style('fill', () => colors(1))\n        .attr('cx', (d) => x(d.DATE))\n        .attr('cy', (d) => y(d.RAN))\n        .attr('id', (d) => `success-dot-${dateFormat(d.DATE)}`)\n        .on('mouseover', (event, d) => handleMouseOver(event, d))\n        .on('mousemove', handleMouseMove)\n        .on('mouseout', handleMouseOut);\n    }\n\n    if (jobStatus !== 'successful') {\n      // Add the failed line path.\n      svg\n        .append('path')\n        .data([formattedData])\n        .attr('class', 'line')\n        .style('fill', 'none')\n        .style('stroke', () => colors(0))\n        .attr('stroke-width', 2)\n        .attr('d', failLine)\n        .call(transition);\n\n      // create our failed line circles\n\n      svg\n        .selectAll('dot')\n        .data(formattedData)\n        .enter()\n        .append('circle')\n        .attr('r', 3)\n        .style('stroke', () => colors(0))\n        .style('fill', () => colors(0))\n        .attr('cx', (d) => x(d.DATE))\n        .attr('cy', (d) => y(d.FAIL))\n        .attr('id', (d) => `fail-dot-${dateFormat(d.DATE)}`)\n        .on('mouseover', handleMouseOver)\n        .on('mousemove', handleMouseMove)\n        .on('mouseout', handleMouseOut);\n    }\n  }, [data, height, id, jobStatus]);\n\n  useEffect(() => {\n    draw();\n  }, [draw, isNavOpen]);\n\n  useEffect(() => {\n    function handleResize() {\n      draw();\n    }\n\n    window.addEventListener('resize', handleResize);\n\n    handleResize();\n\n    return () => window.removeEventListener('resize', handleResize);\n  }, [draw]);\n\n  return <div id={id} />;\n}\n\nLineChart.propTypes = {\n  id: string.isRequired,\n  data: arrayOf(shape({})).isRequired,\n  height: number.isRequired,\n};\n\nconst withPageContext = (Component) =>\n  function contextComponent(props) {\n    return (\n      <PageContextConsumer>\n        {(pageContext) => <Component {...props} pageContext={pageContext} />}\n      </PageContextConsumer>\n    );\n  };\n\nexport default withPageContext(LineChart);\n"]},"metadata":{},"sourceType":"module"}