{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _excluded=[\"OAUTH2_PROVIDER\"],_excluded2=[\"OAUTH2_PROVIDER\"],_excluded3=[\"ACCESS_TOKEN_EXPIRE_SECONDS\",\"REFRESH_TOKEN_EXPIRE_SECONDS\",\"AUTHORIZATION_CODE_EXPIRE_SECONDS\"];import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{Formik}from'formik';import{Form}from'@patternfly/react-core';import{CardBody}from'components/Card';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import{FormSubmitError}from'components/FormField';import{FormColumnLayout}from'components/FormLayout';import{useSettings}from'contexts/Settings';import useModal from'hooks/useModal';import useRequest from'hooks/useRequest';import{SettingsAPI}from'api';import{BooleanField,InputField,ObjectField,InputAlertField}from'../../shared/SharedFields';import{RevertAllAlert,RevertFormActionGroup}from'../../shared';import{formatJson,pluck}from'../../shared/settingUtils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function MiscAuthenticationEdit(){var history=useHistory();var _useModal=useModal(),isModalOpen=_useModal.isModalOpen,toggleModal=_useModal.toggleModal,closeModal=_useModal.closeModal;var _useSettings=useSettings(),options=_useSettings.PUT;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$SettingsAPI$re,data,_pluck,_pluck$OAUTH2_PROVIDE,ACCESS_TOKEN_EXPIRE_SECONDS,REFRESH_TOKEN_EXPIRE_SECONDS,AUTHORIZATION_CODE_EXPIRE_SECONDS,pluckedAuthenticationData,authenticationData,OAUTH2_PROVIDER_OPTIONS,restOptions,authenticationOptions,mergedData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return SettingsAPI.readCategory('authentication');case 2:_yield$SettingsAPI$re=_context.sent;data=_yield$SettingsAPI$re.data;_pluck=pluck(data,'ALLOW_OAUTH2_FOR_EXTERNAL_USERS','AUTH_BASIC_ENABLED','LOGIN_REDIRECT_OVERRIDE','DISABLE_LOCAL_AUTH','OAUTH2_PROVIDER','SESSIONS_PER_USER','SESSION_COOKIE_AGE','SOCIAL_AUTH_ORGANIZATION_MAP','SOCIAL_AUTH_TEAM_MAP','SOCIAL_AUTH_USER_FIELDS'),_pluck$OAUTH2_PROVIDE=_pluck.OAUTH2_PROVIDER,ACCESS_TOKEN_EXPIRE_SECONDS=_pluck$OAUTH2_PROVIDE.ACCESS_TOKEN_EXPIRE_SECONDS,REFRESH_TOKEN_EXPIRE_SECONDS=_pluck$OAUTH2_PROVIDE.REFRESH_TOKEN_EXPIRE_SECONDS,AUTHORIZATION_CODE_EXPIRE_SECONDS=_pluck$OAUTH2_PROVIDE.AUTHORIZATION_CODE_EXPIRE_SECONDS,pluckedAuthenticationData=_objectWithoutProperties(_pluck,_excluded);authenticationData=_objectSpread({ACCESS_TOKEN_EXPIRE_SECONDS:ACCESS_TOKEN_EXPIRE_SECONDS,REFRESH_TOKEN_EXPIRE_SECONDS:REFRESH_TOKEN_EXPIRE_SECONDS,AUTHORIZATION_CODE_EXPIRE_SECONDS:AUTHORIZATION_CODE_EXPIRE_SECONDS},pluckedAuthenticationData);OAUTH2_PROVIDER_OPTIONS=options.OAUTH2_PROVIDER,restOptions=_objectWithoutProperties(options,_excluded2);authenticationOptions=_objectSpread(_objectSpread({},restOptions),{},{ACCESS_TOKEN_EXPIRE_SECONDS:_objectSpread(_objectSpread({},OAUTH2_PROVIDER_OPTIONS),{},{default:OAUTH2_PROVIDER_OPTIONS.default.ACCESS_TOKEN_EXPIRE_SECONDS,type:OAUTH2_PROVIDER_OPTIONS.child.type,label:/*i18n*/i18n._(\"Access Token Expiration\")}),REFRESH_TOKEN_EXPIRE_SECONDS:_objectSpread(_objectSpread({},OAUTH2_PROVIDER_OPTIONS),{},{default:OAUTH2_PROVIDER_OPTIONS.default.REFRESH_TOKEN_EXPIRE_SECONDS,type:OAUTH2_PROVIDER_OPTIONS.child.type,label:/*i18n*/i18n._(\"Refresh Token Expiration\")}),AUTHORIZATION_CODE_EXPIRE_SECONDS:_objectSpread(_objectSpread({},OAUTH2_PROVIDER_OPTIONS),{},{default:OAUTH2_PROVIDER_OPTIONS.default.AUTHORIZATION_CODE_EXPIRE_SECONDS,type:OAUTH2_PROVIDER_OPTIONS.child.type,label:/*i18n*/i18n._(\"Authorization Code Expiration\")})});mergedData={};Object.keys(authenticationData).forEach(function(key){if(!authenticationOptions[key]){return;}mergedData[key]=authenticationOptions[key];mergedData[key].value=authenticationData[key];});return _context.abrupt(\"return\",mergedData);case 11:case\"end\":return _context.stop();}}},_callee);})),[options]),null),isLoading=_useRequest.isLoading,error=_useRequest.error,fetchAuthentication=_useRequest.request,authentication=_useRequest.result;useEffect(function(){fetchAuthentication();},[fetchAuthentication]);var _useRequest2=useRequest(useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return SettingsAPI.updateAll(values);case 2:history.push('/settings/miscellaneous_authentication/details');case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}(),[history]),null),submitError=_useRequest2.error,submitForm=_useRequest2.request;var _useRequest3=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return SettingsAPI.revertCategory('authentication');case 2:case\"end\":return _context3.stop();}}},_callee3);})),[]),null),revertError=_useRequest3.error,revertAll=_useRequest3.request;var handleSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(form){var ACCESS_TOKEN_EXPIRE_SECONDS,REFRESH_TOKEN_EXPIRE_SECONDS,AUTHORIZATION_CODE_EXPIRE_SECONDS,formData;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:ACCESS_TOKEN_EXPIRE_SECONDS=form.ACCESS_TOKEN_EXPIRE_SECONDS,REFRESH_TOKEN_EXPIRE_SECONDS=form.REFRESH_TOKEN_EXPIRE_SECONDS,AUTHORIZATION_CODE_EXPIRE_SECONDS=form.AUTHORIZATION_CODE_EXPIRE_SECONDS,formData=_objectWithoutProperties(form,_excluded3);_context4.next=3;return submitForm(_objectSpread(_objectSpread({},formData),{},{OAUTH2_PROVIDER:{ACCESS_TOKEN_EXPIRE_SECONDS:ACCESS_TOKEN_EXPIRE_SECONDS,REFRESH_TOKEN_EXPIRE_SECONDS:REFRESH_TOKEN_EXPIRE_SECONDS,AUTHORIZATION_CODE_EXPIRE_SECONDS:AUTHORIZATION_CODE_EXPIRE_SECONDS},SOCIAL_AUTH_ORGANIZATION_MAP:formatJson(formData.SOCIAL_AUTH_ORGANIZATION_MAP),SOCIAL_AUTH_TEAM_MAP:formatJson(formData.SOCIAL_AUTH_TEAM_MAP),SOCIAL_AUTH_USER_FIELDS:formatJson(formData.SOCIAL_AUTH_USER_FIELDS)}));case 3:case\"end\":return _context4.stop();}}},_callee4);}));return function handleSubmit(_x2){return _ref4.apply(this,arguments);};}();var handleRevertAll=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return revertAll();case 2:closeModal();history.push('/settings/miscellaneous_authentication/details');case 4:case\"end\":return _context5.stop();}}},_callee5);}));return function handleRevertAll(){return _ref5.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push('/settings/miscellaneous_authentication/details');};var initialValues=function initialValues(fields){return Object.keys(fields).reduce(function(acc,key){if(fields[key].type==='list'||fields[key].type==='nested object'){acc[key]=fields[key].value?JSON.stringify(fields[key].value,null,2):null;}else{var _fields$key$value;acc[key]=(_fields$key$value=fields[key].value)!==null&&_fields$key$value!==void 0?_fields$key$value:'';}return acc;},{});};return/*#__PURE__*/_jsxs(CardBody,{children:[isLoading&&/*#__PURE__*/_jsx(ContentLoading,{}),!isLoading&&error&&/*#__PURE__*/_jsx(ContentError,{error:error}),!isLoading&&authentication&&/*#__PURE__*/_jsx(Formik,{initialValues:initialValues(authentication),onSubmit:handleSubmit,children:function children(formik){return/*#__PURE__*/_jsxs(Form,{autoComplete:\"off\",onSubmit:formik.handleSubmit,children:[/*#__PURE__*/_jsxs(FormColumnLayout,{children:[/*#__PURE__*/_jsx(BooleanField,{name:\"DISABLE_LOCAL_AUTH\",needsConfirmationModal:true,modalTitle:/*i18n*/i18n._(\"Confirm Disable Local Authorization\"),config:authentication.DISABLE_LOCAL_AUTH}),/*#__PURE__*/_jsx(InputField,{name:\"SESSION_COOKIE_AGE\",config:authentication.SESSION_COOKIE_AGE,type:\"number\",isRequired:true}),/*#__PURE__*/_jsx(InputField,{name:\"SESSIONS_PER_USER\",config:authentication.SESSIONS_PER_USER,type:\"number\",isRequired:true}),/*#__PURE__*/_jsx(BooleanField,{name:\"AUTH_BASIC_ENABLED\",config:authentication.AUTH_BASIC_ENABLED}),/*#__PURE__*/_jsx(BooleanField,{name:\"ALLOW_OAUTH2_FOR_EXTERNAL_USERS\",config:authentication.ALLOW_OAUTH2_FOR_EXTERNAL_USERS}),/*#__PURE__*/_jsx(InputAlertField,{name:\"LOGIN_REDIRECT_OVERRIDE\",config:authentication.LOGIN_REDIRECT_OVERRIDE}),/*#__PURE__*/_jsx(InputField,{name:\"ACCESS_TOKEN_EXPIRE_SECONDS\",config:authentication.ACCESS_TOKEN_EXPIRE_SECONDS,type:\"number\"}),/*#__PURE__*/_jsx(InputField,{name:\"REFRESH_TOKEN_EXPIRE_SECONDS\",config:authentication.REFRESH_TOKEN_EXPIRE_SECONDS,type:\"number\"}),/*#__PURE__*/_jsx(InputField,{name:\"AUTHORIZATION_CODE_EXPIRE_SECONDS\",config:authentication.AUTHORIZATION_CODE_EXPIRE_SECONDS,type:\"number\"}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_ORGANIZATION_MAP\",config:authentication.SOCIAL_AUTH_ORGANIZATION_MAP}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_TEAM_MAP\",config:authentication.SOCIAL_AUTH_TEAM_MAP}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_USER_FIELDS\",config:authentication.SOCIAL_AUTH_USER_FIELDS}),submitError&&/*#__PURE__*/_jsx(FormSubmitError,{error:submitError}),revertError&&/*#__PURE__*/_jsx(FormSubmitError,{error:revertError})]}),/*#__PURE__*/_jsx(RevertFormActionGroup,{onCancel:handleCancel,onSubmit:formik.handleSubmit,onRevert:toggleModal}),isModalOpen&&/*#__PURE__*/_jsx(RevertAllAlert,{onClose:closeModal,onRevertAll:handleRevertAll})]});}})]});}export default MiscAuthenticationEdit;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Setting/MiscAuthentication/MiscAuthenticationEdit/MiscAuthenticationEdit.js"],"names":["React","useCallback","useEffect","useHistory","Formik","Form","CardBody","ContentError","ContentLoading","FormSubmitError","FormColumnLayout","useSettings","useModal","useRequest","SettingsAPI","BooleanField","InputField","ObjectField","InputAlertField","RevertAllAlert","RevertFormActionGroup","formatJson","pluck","MiscAuthenticationEdit","history","isModalOpen","toggleModal","closeModal","options","PUT","readCategory","data","OAUTH2_PROVIDER","ACCESS_TOKEN_EXPIRE_SECONDS","REFRESH_TOKEN_EXPIRE_SECONDS","AUTHORIZATION_CODE_EXPIRE_SECONDS","pluckedAuthenticationData","authenticationData","OAUTH2_PROVIDER_OPTIONS","restOptions","authenticationOptions","default","type","child","label","mergedData","Object","keys","forEach","key","value","isLoading","error","fetchAuthentication","request","authentication","result","values","updateAll","push","submitError","submitForm","revertCategory","revertError","revertAll","handleSubmit","form","formData","SOCIAL_AUTH_ORGANIZATION_MAP","SOCIAL_AUTH_TEAM_MAP","SOCIAL_AUTH_USER_FIELDS","handleRevertAll","handleCancel","initialValues","fields","reduce","acc","JSON","stringify","formik","DISABLE_LOCAL_AUTH","SESSION_COOKIE_AGE","SESSIONS_PER_USER","AUTH_BASIC_ENABLED","ALLOW_OAUTH2_FOR_EXTERNAL_USERS","LOGIN_REDIRECT_OVERRIDE"],"mappings":"goBAAA,MAAOA,CAAAA,KAAP,EAAgBC,WAAhB,CAA6BC,SAA7B,KAA8C,OAA9C,CACA,OAASC,UAAT,KAA2B,kBAA3B,CAEA,OAASC,MAAT,KAAuB,QAAvB,CACA,OAASC,IAAT,KAAqB,wBAArB,CACA,OAASC,QAAT,KAAyB,iBAAzB,CACA,MAAOC,CAAAA,YAAP,KAAyB,yBAAzB,CACA,MAAOC,CAAAA,cAAP,KAA2B,2BAA3B,CACA,OAASC,eAAT,KAAgC,sBAAhC,CACA,OAASC,gBAAT,KAAiC,uBAAjC,CACA,OAASC,WAAT,KAA4B,mBAA5B,CACA,MAAOC,CAAAA,QAAP,KAAqB,gBAArB,CACA,MAAOC,CAAAA,UAAP,KAAuB,kBAAvB,CACA,OAASC,WAAT,KAA4B,KAA5B,CACA,OACEC,YADF,CAEEC,UAFF,CAGEC,WAHF,CAIEC,eAJF,KAKO,2BALP,CAMA,OAASC,cAAT,CAAyBC,qBAAzB,KAAsD,cAAtD,CACA,OAASC,UAAT,CAAqBC,KAArB,KAAkC,2BAAlC,C,wFAEA,QAASC,CAAAA,sBAAT,EAAkC,CAChC,GAAMC,CAAAA,OAAO,CAAGrB,UAAU,EAA1B,CACA,cAAiDS,QAAQ,EAAzD,CAAQa,WAAR,WAAQA,WAAR,CAAqBC,WAArB,WAAqBA,WAArB,CAAkCC,UAAlC,WAAkCA,UAAlC,CACA,iBAAyBhB,WAAW,EAApC,CAAaiB,OAAb,cAAQC,GAAR,CAEA,gBAKIhB,UAAU,CACZZ,WAAW,sEAAC,kaACaa,CAAAA,WAAW,CAACgB,YAAZ,CAAyB,gBAAzB,CADb,4CACFC,IADE,uBACFA,IADE,QAUNT,KAAK,CACPS,IADO,CAEP,iCAFO,CAGP,oBAHO,CAIP,yBAJO,CAKP,oBALO,CAMP,iBANO,CAOP,mBAPO,CAQP,oBARO,CASP,8BATO,CAUP,sBAVO,CAWP,yBAXO,CAVC,8BAIRC,eAJQ,CAKNC,2BALM,uBAKNA,2BALM,CAMNC,4BANM,uBAMNA,4BANM,CAONC,iCAPM,uBAONA,iCAPM,CASLC,yBATK,4CAwBJC,kBAxBI,gBAyBRJ,2BAA2B,CAA3BA,2BAzBQ,CA0BRC,4BAA4B,CAA5BA,4BA1BQ,CA2BRC,iCAAiC,CAAjCA,iCA3BQ,EA4BLC,yBA5BK,EA+BeE,uBA/Bf,CAgCRV,OAhCQ,CA+BFI,eA/BE,CA+B2CO,WA/B3C,0BAgCRX,OAhCQ,aAkCJY,qBAlCI,gCAmCLD,WAnCK,MAoCRN,2BAA2B,gCACtBK,uBADsB,MAEzBG,OAAO,CAAEH,uBAAuB,CAACG,OAAxB,CAAgCR,2BAFhB,CAGzBS,IAAI,CAAEJ,uBAAuB,CAACK,KAAxB,CAA8BD,IAHX,CAIzBE,KAAK,SAAE,iCAJkB,EApCnB,CA0CRV,4BAA4B,gCACvBI,uBADuB,MAE1BG,OAAO,CAAEH,uBAAuB,CAACG,OAAxB,CAAgCP,4BAFf,CAG1BQ,IAAI,CAAEJ,uBAAuB,CAACK,KAAxB,CAA8BD,IAHV,CAI1BE,KAAK,SAAE,kCAJmB,EA1CpB,CAgDRT,iCAAiC,gCAC5BG,uBAD4B,MAE/BG,OAAO,CACLH,uBAAuB,CAACG,OAAxB,CAAgCN,iCAHH,CAI/BO,IAAI,CAAEJ,uBAAuB,CAACK,KAAxB,CAA8BD,IAJL,CAK/BE,KAAK,SAAE,uCALwB,EAhDzB,GAyDJC,UAzDI,CAyDS,EAzDT,CA2DVC,MAAM,CAACC,IAAP,CAAYV,kBAAZ,EAAgCW,OAAhC,CAAwC,SAACC,GAAD,CAAS,CAC/C,GAAI,CAACT,qBAAqB,CAACS,GAAD,CAA1B,CAAiC,CAC/B,OACD,CACDJ,UAAU,CAACI,GAAD,CAAV,CAAkBT,qBAAqB,CAACS,GAAD,CAAvC,CACAJ,UAAU,CAACI,GAAD,CAAV,CAAgBC,KAAhB,CAAwBb,kBAAkB,CAACY,GAAD,CAA1C,CACD,CAND,EA3DU,gCAmEHJ,UAnEG,yDAAD,GAoER,CAACjB,OAAD,CApEQ,CADC,CAsEZ,IAtEY,CALd,CACEuB,SADF,aACEA,SADF,CAEEC,KAFF,aAEEA,KAFF,CAGWC,mBAHX,aAGEC,OAHF,CAIUC,cAJV,aAIEC,MAJF,CA8EAtD,SAAS,CAAC,UAAM,CACdmD,mBAAmB,GACpB,CAFQ,CAEN,CAACA,mBAAD,CAFM,CAAT,CAIA,iBAAoDxC,UAAU,CAC5DZ,WAAW,2FACT,kBAAOwD,MAAP,6IACQ3C,CAAAA,WAAW,CAAC4C,SAAZ,CAAsBD,MAAtB,CADR,QAEEjC,OAAO,CAACmC,IAAR,CAAa,gDAAb,EAFF,wDADS,gEAKT,CAACnC,OAAD,CALS,CADiD,CAQ5D,IAR4D,CAA9D,CAAeoC,WAAf,cAAQR,KAAR,CAAqCS,UAArC,cAA4BP,OAA5B,CAWA,iBAAmDzC,UAAU,CAC3DZ,WAAW,sEAAC,+JACJa,CAAAA,WAAW,CAACgD,cAAZ,CAA2B,gBAA3B,CADI,yDAAD,GAER,EAFQ,CADgD,CAI3D,IAJ2D,CAA7D,CAAeC,WAAf,cAAQX,KAAR,CAAqCY,SAArC,cAA4BV,OAA5B,CAOA,GAAMW,CAAAA,YAAY,2FAAG,kBAAOC,IAAP,8NAEjBjC,2BAFiB,CAMfiC,IANe,CAEjBjC,2BAFiB,CAGjBC,4BAHiB,CAMfgC,IANe,CAGjBhC,4BAHiB,CAIjBC,iCAJiB,CAMf+B,IANe,CAIjB/B,iCAJiB,CAKdgC,QALc,0BAMfD,IANe,oCAQbL,CAAAA,UAAU,gCACXM,QADW,MAEdnC,eAAe,CAAE,CACfC,2BAA2B,CAA3BA,2BADe,CAEfC,4BAA4B,CAA5BA,4BAFe,CAGfC,iCAAiC,CAAjCA,iCAHe,CAFH,CAOdiC,4BAA4B,CAAE/C,UAAU,CACtC8C,QAAQ,CAACC,4BAD6B,CAP1B,CAUdC,oBAAoB,CAAEhD,UAAU,CAAC8C,QAAQ,CAACE,oBAAV,CAVlB,CAWdC,uBAAuB,CAAEjD,UAAU,CAAC8C,QAAQ,CAACG,uBAAV,CAXrB,GARG,yDAAH,kBAAZL,CAAAA,YAAY,8CAAlB,CAuBA,GAAMM,CAAAA,eAAe,2FAAG,+JAChBP,CAAAA,SAAS,EADO,QAGtBrC,UAAU,GAEVH,OAAO,CAACmC,IAAR,CAAa,gDAAb,EALsB,wDAAH,kBAAfY,CAAAA,eAAe,2CAArB,CAQA,GAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CACzBhD,OAAO,CAACmC,IAAR,CAAa,gDAAb,EACD,CAFD,CAIA,GAAMc,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,MAAD,QACpB5B,CAAAA,MAAM,CAACC,IAAP,CAAY2B,MAAZ,EAAoBC,MAApB,CAA2B,SAACC,GAAD,CAAM3B,GAAN,CAAc,CACvC,GAAIyB,MAAM,CAACzB,GAAD,CAAN,CAAYP,IAAZ,GAAqB,MAArB,EAA+BgC,MAAM,CAACzB,GAAD,CAAN,CAAYP,IAAZ,GAAqB,eAAxD,CAAyE,CACvEkC,GAAG,CAAC3B,GAAD,CAAH,CAAWyB,MAAM,CAACzB,GAAD,CAAN,CAAYC,KAAZ,CACP2B,IAAI,CAACC,SAAL,CAAeJ,MAAM,CAACzB,GAAD,CAAN,CAAYC,KAA3B,CAAkC,IAAlC,CAAwC,CAAxC,CADO,CAEP,IAFJ,CAGD,CAJD,IAIO,uBACL0B,GAAG,CAAC3B,GAAD,CAAH,oBAAWyB,MAAM,CAACzB,GAAD,CAAN,CAAYC,KAAvB,uDAAgC,EAAhC,CACD,CACD,MAAO0B,CAAAA,GAAP,CACD,CATD,CASG,EATH,CADoB,EAAtB,CAYA,mBACE,MAAC,QAAD,YACGzB,SAAS,eAAI,KAAC,cAAD,IADhB,CAEG,CAACA,SAAD,EAAcC,KAAd,eAAuB,KAAC,YAAD,EAAc,KAAK,CAAEA,KAArB,EAF1B,CAGG,CAACD,SAAD,EAAcI,cAAd,eACC,KAAC,MAAD,EACE,aAAa,CAAEkB,aAAa,CAAClB,cAAD,CAD9B,CAEE,QAAQ,CAAEU,YAFZ,UAIG,kBAACc,MAAD,qBACC,MAAC,IAAD,EAAM,YAAY,CAAC,KAAnB,CAAyB,QAAQ,CAAEA,MAAM,CAACd,YAA1C,wBACE,MAAC,gBAAD,yBACE,KAAC,YAAD,EACE,IAAI,CAAC,oBADP,CAEE,sBAAsB,KAFxB,CAGE,UAAU,SAAE,6CAHd,CAIE,MAAM,CAAEV,cAAc,CAACyB,kBAJzB,EADF,cAOE,KAAC,UAAD,EACE,IAAI,CAAC,oBADP,CAEE,MAAM,CAAEzB,cAAc,CAAC0B,kBAFzB,CAGE,IAAI,CAAC,QAHP,CAIE,UAAU,KAJZ,EAPF,cAaE,KAAC,UAAD,EACE,IAAI,CAAC,mBADP,CAEE,MAAM,CAAE1B,cAAc,CAAC2B,iBAFzB,CAGE,IAAI,CAAC,QAHP,CAIE,UAAU,KAJZ,EAbF,cAmBE,KAAC,YAAD,EACE,IAAI,CAAC,oBADP,CAEE,MAAM,CAAE3B,cAAc,CAAC4B,kBAFzB,EAnBF,cAuBE,KAAC,YAAD,EACE,IAAI,CAAC,iCADP,CAEE,MAAM,CAAE5B,cAAc,CAAC6B,+BAFzB,EAvBF,cA2BE,KAAC,eAAD,EACE,IAAI,CAAC,yBADP,CAEE,MAAM,CAAE7B,cAAc,CAAC8B,uBAFzB,EA3BF,cA+BE,KAAC,UAAD,EACE,IAAI,CAAC,6BADP,CAEE,MAAM,CAAE9B,cAAc,CAACtB,2BAFzB,CAGE,IAAI,CAAC,QAHP,EA/BF,cAoCE,KAAC,UAAD,EACE,IAAI,CAAC,8BADP,CAEE,MAAM,CAAEsB,cAAc,CAACrB,4BAFzB,CAGE,IAAI,CAAC,QAHP,EApCF,cAyCE,KAAC,UAAD,EACE,IAAI,CAAC,mCADP,CAEE,MAAM,CAAEqB,cAAc,CAACpB,iCAFzB,CAGE,IAAI,CAAC,QAHP,EAzCF,cA8CE,KAAC,WAAD,EACE,IAAI,CAAC,8BADP,CAEE,MAAM,CAAEoB,cAAc,CAACa,4BAFzB,EA9CF,cAkDE,KAAC,WAAD,EACE,IAAI,CAAC,sBADP,CAEE,MAAM,CAAEb,cAAc,CAACc,oBAFzB,EAlDF,cAsDE,KAAC,WAAD,EACE,IAAI,CAAC,yBADP,CAEE,MAAM,CAAEd,cAAc,CAACe,uBAFzB,EAtDF,CA0DGV,WAAW,eAAI,KAAC,eAAD,EAAiB,KAAK,CAAEA,WAAxB,EA1DlB,CA2DGG,WAAW,eAAI,KAAC,eAAD,EAAiB,KAAK,CAAEA,WAAxB,EA3DlB,GADF,cA8DE,KAAC,qBAAD,EACE,QAAQ,CAAES,YADZ,CAEE,QAAQ,CAAEO,MAAM,CAACd,YAFnB,CAGE,QAAQ,CAAEvC,WAHZ,EA9DF,CAmEGD,WAAW,eACV,KAAC,cAAD,EACE,OAAO,CAAEE,UADX,CAEE,WAAW,CAAE4C,eAFf,EApEJ,GADD,EAJH,EAJJ,GADF,CAyFD,CAED,cAAehD,CAAAA,sBAAf","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport { Formik } from 'formik';\nimport { Form } from '@patternfly/react-core';\nimport { CardBody } from 'components/Card';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport { FormSubmitError } from 'components/FormField';\nimport { FormColumnLayout } from 'components/FormLayout';\nimport { useSettings } from 'contexts/Settings';\nimport useModal from 'hooks/useModal';\nimport useRequest from 'hooks/useRequest';\nimport { SettingsAPI } from 'api';\nimport {\n  BooleanField,\n  InputField,\n  ObjectField,\n  InputAlertField,\n} from '../../shared/SharedFields';\nimport { RevertAllAlert, RevertFormActionGroup } from '../../shared';\nimport { formatJson, pluck } from '../../shared/settingUtils';\n\nfunction MiscAuthenticationEdit() {\n  const history = useHistory();\n  const { isModalOpen, toggleModal, closeModal } = useModal();\n  const { PUT: options } = useSettings();\n\n  const {\n    isLoading,\n    error,\n    request: fetchAuthentication,\n    result: authentication,\n  } = useRequest(\n    useCallback(async () => {\n      const { data } = await SettingsAPI.readCategory('authentication');\n\n      const {\n        OAUTH2_PROVIDER: {\n          ACCESS_TOKEN_EXPIRE_SECONDS,\n          REFRESH_TOKEN_EXPIRE_SECONDS,\n          AUTHORIZATION_CODE_EXPIRE_SECONDS,\n        },\n        ...pluckedAuthenticationData\n      } = pluck(\n        data,\n        'ALLOW_OAUTH2_FOR_EXTERNAL_USERS',\n        'AUTH_BASIC_ENABLED',\n        'LOGIN_REDIRECT_OVERRIDE',\n        'DISABLE_LOCAL_AUTH',\n        'OAUTH2_PROVIDER',\n        'SESSIONS_PER_USER',\n        'SESSION_COOKIE_AGE',\n        'SOCIAL_AUTH_ORGANIZATION_MAP',\n        'SOCIAL_AUTH_TEAM_MAP',\n        'SOCIAL_AUTH_USER_FIELDS'\n      );\n\n      const authenticationData = {\n        ACCESS_TOKEN_EXPIRE_SECONDS,\n        REFRESH_TOKEN_EXPIRE_SECONDS,\n        AUTHORIZATION_CODE_EXPIRE_SECONDS,\n        ...pluckedAuthenticationData,\n      };\n\n      const { OAUTH2_PROVIDER: OAUTH2_PROVIDER_OPTIONS, ...restOptions } =\n        options;\n\n      const authenticationOptions = {\n        ...restOptions,\n        ACCESS_TOKEN_EXPIRE_SECONDS: {\n          ...OAUTH2_PROVIDER_OPTIONS,\n          default: OAUTH2_PROVIDER_OPTIONS.default.ACCESS_TOKEN_EXPIRE_SECONDS,\n          type: OAUTH2_PROVIDER_OPTIONS.child.type,\n          label: t`Access Token Expiration`,\n        },\n        REFRESH_TOKEN_EXPIRE_SECONDS: {\n          ...OAUTH2_PROVIDER_OPTIONS,\n          default: OAUTH2_PROVIDER_OPTIONS.default.REFRESH_TOKEN_EXPIRE_SECONDS,\n          type: OAUTH2_PROVIDER_OPTIONS.child.type,\n          label: t`Refresh Token Expiration`,\n        },\n        AUTHORIZATION_CODE_EXPIRE_SECONDS: {\n          ...OAUTH2_PROVIDER_OPTIONS,\n          default:\n            OAUTH2_PROVIDER_OPTIONS.default.AUTHORIZATION_CODE_EXPIRE_SECONDS,\n          type: OAUTH2_PROVIDER_OPTIONS.child.type,\n          label: t`Authorization Code Expiration`,\n        },\n      };\n\n      const mergedData = {};\n\n      Object.keys(authenticationData).forEach((key) => {\n        if (!authenticationOptions[key]) {\n          return;\n        }\n        mergedData[key] = authenticationOptions[key];\n        mergedData[key].value = authenticationData[key];\n      });\n\n      return mergedData;\n    }, [options]),\n    null\n  );\n\n  useEffect(() => {\n    fetchAuthentication();\n  }, [fetchAuthentication]);\n\n  const { error: submitError, request: submitForm } = useRequest(\n    useCallback(\n      async (values) => {\n        await SettingsAPI.updateAll(values);\n        history.push('/settings/miscellaneous_authentication/details');\n      },\n      [history]\n    ),\n    null\n  );\n\n  const { error: revertError, request: revertAll } = useRequest(\n    useCallback(async () => {\n      await SettingsAPI.revertCategory('authentication');\n    }, []),\n    null\n  );\n\n  const handleSubmit = async (form) => {\n    const {\n      ACCESS_TOKEN_EXPIRE_SECONDS,\n      REFRESH_TOKEN_EXPIRE_SECONDS,\n      AUTHORIZATION_CODE_EXPIRE_SECONDS,\n      ...formData\n    } = form;\n\n    await submitForm({\n      ...formData,\n      OAUTH2_PROVIDER: {\n        ACCESS_TOKEN_EXPIRE_SECONDS,\n        REFRESH_TOKEN_EXPIRE_SECONDS,\n        AUTHORIZATION_CODE_EXPIRE_SECONDS,\n      },\n      SOCIAL_AUTH_ORGANIZATION_MAP: formatJson(\n        formData.SOCIAL_AUTH_ORGANIZATION_MAP\n      ),\n      SOCIAL_AUTH_TEAM_MAP: formatJson(formData.SOCIAL_AUTH_TEAM_MAP),\n      SOCIAL_AUTH_USER_FIELDS: formatJson(formData.SOCIAL_AUTH_USER_FIELDS),\n    });\n  };\n\n  const handleRevertAll = async () => {\n    await revertAll();\n\n    closeModal();\n\n    history.push('/settings/miscellaneous_authentication/details');\n  };\n\n  const handleCancel = () => {\n    history.push('/settings/miscellaneous_authentication/details');\n  };\n\n  const initialValues = (fields) =>\n    Object.keys(fields).reduce((acc, key) => {\n      if (fields[key].type === 'list' || fields[key].type === 'nested object') {\n        acc[key] = fields[key].value\n          ? JSON.stringify(fields[key].value, null, 2)\n          : null;\n      } else {\n        acc[key] = fields[key].value ?? '';\n      }\n      return acc;\n    }, {});\n\n  return (\n    <CardBody>\n      {isLoading && <ContentLoading />}\n      {!isLoading && error && <ContentError error={error} />}\n      {!isLoading && authentication && (\n        <Formik\n          initialValues={initialValues(authentication)}\n          onSubmit={handleSubmit}\n        >\n          {(formik) => (\n            <Form autoComplete=\"off\" onSubmit={formik.handleSubmit}>\n              <FormColumnLayout>\n                <BooleanField\n                  name=\"DISABLE_LOCAL_AUTH\"\n                  needsConfirmationModal\n                  modalTitle={t`Confirm Disable Local Authorization`}\n                  config={authentication.DISABLE_LOCAL_AUTH}\n                />\n                <InputField\n                  name=\"SESSION_COOKIE_AGE\"\n                  config={authentication.SESSION_COOKIE_AGE}\n                  type=\"number\"\n                  isRequired\n                />\n                <InputField\n                  name=\"SESSIONS_PER_USER\"\n                  config={authentication.SESSIONS_PER_USER}\n                  type=\"number\"\n                  isRequired\n                />\n                <BooleanField\n                  name=\"AUTH_BASIC_ENABLED\"\n                  config={authentication.AUTH_BASIC_ENABLED}\n                />\n                <BooleanField\n                  name=\"ALLOW_OAUTH2_FOR_EXTERNAL_USERS\"\n                  config={authentication.ALLOW_OAUTH2_FOR_EXTERNAL_USERS}\n                />\n                <InputAlertField\n                  name=\"LOGIN_REDIRECT_OVERRIDE\"\n                  config={authentication.LOGIN_REDIRECT_OVERRIDE}\n                />\n                <InputField\n                  name=\"ACCESS_TOKEN_EXPIRE_SECONDS\"\n                  config={authentication.ACCESS_TOKEN_EXPIRE_SECONDS}\n                  type=\"number\"\n                />\n                <InputField\n                  name=\"REFRESH_TOKEN_EXPIRE_SECONDS\"\n                  config={authentication.REFRESH_TOKEN_EXPIRE_SECONDS}\n                  type=\"number\"\n                />\n                <InputField\n                  name=\"AUTHORIZATION_CODE_EXPIRE_SECONDS\"\n                  config={authentication.AUTHORIZATION_CODE_EXPIRE_SECONDS}\n                  type=\"number\"\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_ORGANIZATION_MAP\"\n                  config={authentication.SOCIAL_AUTH_ORGANIZATION_MAP}\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_TEAM_MAP\"\n                  config={authentication.SOCIAL_AUTH_TEAM_MAP}\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_USER_FIELDS\"\n                  config={authentication.SOCIAL_AUTH_USER_FIELDS}\n                />\n                {submitError && <FormSubmitError error={submitError} />}\n                {revertError && <FormSubmitError error={revertError} />}\n              </FormColumnLayout>\n              <RevertFormActionGroup\n                onCancel={handleCancel}\n                onSubmit={formik.handleSubmit}\n                onRevert={toggleModal}\n              />\n              {isModalOpen && (\n                <RevertAllAlert\n                  onClose={closeModal}\n                  onRevertAll={handleRevertAll}\n                />\n              )}\n            </Form>\n          )}\n        </Formik>\n      )}\n    </CardBody>\n  );\n}\n\nexport default MiscAuthenticationEdit;\n"]},"metadata":{},"sourceType":"module"}