{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{Formik}from'formik';import{Form}from'@patternfly/react-core';import{CardBody}from'components/Card';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import{FormSubmitError}from'components/FormField';import{FormColumnLayout}from'components/FormLayout';import{useSettings}from'contexts/Settings';import useModal from'hooks/useModal';import useRequest from'hooks/useRequest';import{SettingsAPI}from'api';import{RevertAllAlert,RevertFormActionGroup}from'../../shared';import{BooleanField,FileUploadField,InputField,ObjectField}from'../../shared/SharedFields';import{formatJson}from'../../shared/settingUtils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function SAMLEdit(){var history=useHistory();var _useModal=useModal(),isModalOpen=_useModal.isModalOpen,toggleModal=_useModal.toggleModal,closeModal=_useModal.closeModal;var _useSettings=useSettings(),options=_useSettings.PUT;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$SettingsAPI$re,data,mergedData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return SettingsAPI.readCategory('saml');case 2:_yield$SettingsAPI$re=_context.sent;data=_yield$SettingsAPI$re.data;mergedData={};Object.keys(data).forEach(function(key){if(!options[key]){return;}mergedData[key]=options[key];mergedData[key].value=data[key];});return _context.abrupt(\"return\",mergedData);case 7:case\"end\":return _context.stop();}}},_callee);})),[options]),null),isLoading=_useRequest.isLoading,error=_useRequest.error,fetchSAML=_useRequest.request,saml=_useRequest.result;useEffect(function(){fetchSAML();},[fetchSAML]);var _useRequest2=useRequest(useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return SettingsAPI.updateAll(values);case 2:history.push('/settings/saml/details');case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}(),[history]),null),submitError=_useRequest2.error,submitForm=_useRequest2.request;var _useRequest3=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return SettingsAPI.revertCategory('saml');case 2:case\"end\":return _context3.stop();}}},_callee3);})),[]),null),revertError=_useRequest3.error,revertAll=_useRequest3.request;var handleSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(form){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return submitForm(_objectSpread(_objectSpread({},form),{},{SOCIAL_AUTH_SAML_ORG_INFO:formatJson(form.SOCIAL_AUTH_SAML_ORG_INFO),SOCIAL_AUTH_SAML_TECHNICAL_CONTACT:formatJson(form.SOCIAL_AUTH_SAML_TECHNICAL_CONTACT),SOCIAL_AUTH_SAML_SUPPORT_CONTACT:formatJson(form.SOCIAL_AUTH_SAML_SUPPORT_CONTACT),SOCIAL_AUTH_SAML_ENABLED_IDPS:formatJson(form.SOCIAL_AUTH_SAML_ENABLED_IDPS),SOCIAL_AUTH_SAML_ORGANIZATION_MAP:formatJson(form.SOCIAL_AUTH_SAML_ORGANIZATION_MAP),SOCIAL_AUTH_SAML_ORGANIZATION_ATTR:formatJson(form.SOCIAL_AUTH_SAML_ORGANIZATION_ATTR),SOCIAL_AUTH_SAML_TEAM_MAP:formatJson(form.SOCIAL_AUTH_SAML_TEAM_MAP),SOCIAL_AUTH_SAML_TEAM_ATTR:formatJson(form.SOCIAL_AUTH_SAML_TEAM_ATTR),SOCIAL_AUTH_SAML_USER_FLAGS_BY_ATTR:formatJson(form.SOCIAL_AUTH_SAML_USER_FLAGS_BY_ATTR),SOCIAL_AUTH_SAML_SECURITY_CONFIG:formatJson(form.SOCIAL_AUTH_SAML_SECURITY_CONFIG),SOCIAL_AUTH_SAML_SP_EXTRA:formatJson(form.SOCIAL_AUTH_SAML_SP_EXTRA),SOCIAL_AUTH_SAML_EXTRA_DATA:formatJson(form.SOCIAL_AUTH_SAML_EXTRA_DATA)}));case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function handleSubmit(_x2){return _ref4.apply(this,arguments);};}();var handleRevertAll=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return revertAll();case 2:closeModal();history.push('/settings/saml/details');case 4:case\"end\":return _context5.stop();}}},_callee5);}));return function handleRevertAll(){return _ref5.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push('/settings/saml/details');};var initialValues=function initialValues(fields){return Object.keys(fields).reduce(function(acc,key){if(fields[key].type==='list'||fields[key].type==='nested object'){acc[key]=fields[key].value?JSON.stringify(fields[key].value,null,2):null;}else{var _fields$key$value;acc[key]=(_fields$key$value=fields[key].value)!==null&&_fields$key$value!==void 0?_fields$key$value:'';}return acc;},{});};return/*#__PURE__*/_jsxs(CardBody,{children:[isLoading&&/*#__PURE__*/_jsx(ContentLoading,{}),!isLoading&&error&&/*#__PURE__*/_jsx(ContentError,{error:error}),!isLoading&&saml&&/*#__PURE__*/_jsx(Formik,{initialValues:initialValues(saml),onSubmit:handleSubmit,children:function children(formik){return/*#__PURE__*/_jsxs(Form,{autoComplete:\"off\",onSubmit:formik.handleSubmit,children:[/*#__PURE__*/_jsxs(FormColumnLayout,{children:[/*#__PURE__*/_jsx(InputField,{name:\"SOCIAL_AUTH_SAML_SP_ENTITY_ID\",config:saml.SOCIAL_AUTH_SAML_SP_ENTITY_ID,isRequired:true}),/*#__PURE__*/_jsx(BooleanField,{name:\"SAML_AUTO_CREATE_OBJECTS\",config:saml.SAML_AUTO_CREATE_OBJECTS}),/*#__PURE__*/_jsx(FileUploadField,{name:\"SOCIAL_AUTH_SAML_SP_PUBLIC_CERT\",config:saml.SOCIAL_AUTH_SAML_SP_PUBLIC_CERT,isRequired:true}),/*#__PURE__*/_jsx(FileUploadField,{name:\"SOCIAL_AUTH_SAML_SP_PRIVATE_KEY\",config:saml.SOCIAL_AUTH_SAML_SP_PRIVATE_KEY,isRequired:true}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_SAML_ORG_INFO\",config:saml.SOCIAL_AUTH_SAML_ORG_INFO}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_SAML_TECHNICAL_CONTACT\",config:saml.SOCIAL_AUTH_SAML_TECHNICAL_CONTACT}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_SAML_SUPPORT_CONTACT\",config:saml.SOCIAL_AUTH_SAML_SUPPORT_CONTACT}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_SAML_ENABLED_IDPS\",config:saml.SOCIAL_AUTH_SAML_ENABLED_IDPS}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_SAML_ORGANIZATION_MAP\",config:saml.SOCIAL_AUTH_SAML_ORGANIZATION_MAP}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_SAML_ORGANIZATION_ATTR\",config:saml.SOCIAL_AUTH_SAML_ORGANIZATION_ATTR}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_SAML_TEAM_MAP\",config:saml.SOCIAL_AUTH_SAML_TEAM_MAP}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_SAML_TEAM_ATTR\",config:saml.SOCIAL_AUTH_SAML_TEAM_ATTR}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_SAML_USER_FLAGS_BY_ATTR\",config:saml.SOCIAL_AUTH_SAML_USER_FLAGS_BY_ATTR}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_SAML_SECURITY_CONFIG\",config:saml.SOCIAL_AUTH_SAML_SECURITY_CONFIG}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_SAML_SP_EXTRA\",config:saml.SOCIAL_AUTH_SAML_SP_EXTRA}),/*#__PURE__*/_jsx(ObjectField,{name:\"SOCIAL_AUTH_SAML_EXTRA_DATA\",config:saml.SOCIAL_AUTH_SAML_EXTRA_DATA}),submitError&&/*#__PURE__*/_jsx(FormSubmitError,{error:submitError}),revertError&&/*#__PURE__*/_jsx(FormSubmitError,{error:revertError})]}),/*#__PURE__*/_jsx(RevertFormActionGroup,{onCancel:handleCancel,onSubmit:formik.handleSubmit,onRevert:toggleModal}),isModalOpen&&/*#__PURE__*/_jsx(RevertAllAlert,{onClose:closeModal,onRevertAll:handleRevertAll})]});}})]});}export default SAMLEdit;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Setting/SAML/SAMLEdit/SAMLEdit.js"],"names":["React","useCallback","useEffect","useHistory","Formik","Form","CardBody","ContentError","ContentLoading","FormSubmitError","FormColumnLayout","useSettings","useModal","useRequest","SettingsAPI","RevertAllAlert","RevertFormActionGroup","BooleanField","FileUploadField","InputField","ObjectField","formatJson","SAMLEdit","history","isModalOpen","toggleModal","closeModal","options","PUT","readCategory","data","mergedData","Object","keys","forEach","key","value","isLoading","error","fetchSAML","request","saml","result","values","updateAll","push","submitError","submitForm","revertCategory","revertError","revertAll","handleSubmit","form","SOCIAL_AUTH_SAML_ORG_INFO","SOCIAL_AUTH_SAML_TECHNICAL_CONTACT","SOCIAL_AUTH_SAML_SUPPORT_CONTACT","SOCIAL_AUTH_SAML_ENABLED_IDPS","SOCIAL_AUTH_SAML_ORGANIZATION_MAP","SOCIAL_AUTH_SAML_ORGANIZATION_ATTR","SOCIAL_AUTH_SAML_TEAM_MAP","SOCIAL_AUTH_SAML_TEAM_ATTR","SOCIAL_AUTH_SAML_USER_FLAGS_BY_ATTR","SOCIAL_AUTH_SAML_SECURITY_CONFIG","SOCIAL_AUTH_SAML_SP_EXTRA","SOCIAL_AUTH_SAML_EXTRA_DATA","handleRevertAll","handleCancel","initialValues","fields","reduce","acc","type","JSON","stringify","formik","SOCIAL_AUTH_SAML_SP_ENTITY_ID","SAML_AUTO_CREATE_OBJECTS","SOCIAL_AUTH_SAML_SP_PUBLIC_CERT","SOCIAL_AUTH_SAML_SP_PRIVATE_KEY"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Formik } from 'formik';\nimport { Form } from '@patternfly/react-core';\nimport { CardBody } from 'components/Card';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport { FormSubmitError } from 'components/FormField';\nimport { FormColumnLayout } from 'components/FormLayout';\nimport { useSettings } from 'contexts/Settings';\nimport useModal from 'hooks/useModal';\nimport useRequest from 'hooks/useRequest';\nimport { SettingsAPI } from 'api';\nimport { RevertAllAlert, RevertFormActionGroup } from '../../shared';\nimport {\n  BooleanField,\n  FileUploadField,\n  InputField,\n  ObjectField,\n} from '../../shared/SharedFields';\nimport { formatJson } from '../../shared/settingUtils';\n\nfunction SAMLEdit() {\n  const history = useHistory();\n  const { isModalOpen, toggleModal, closeModal } = useModal();\n  const { PUT: options } = useSettings();\n\n  const {\n    isLoading,\n    error,\n    request: fetchSAML,\n    result: saml,\n  } = useRequest(\n    useCallback(async () => {\n      const { data } = await SettingsAPI.readCategory('saml');\n      const mergedData = {};\n      Object.keys(data).forEach((key) => {\n        if (!options[key]) {\n          return;\n        }\n        mergedData[key] = options[key];\n        mergedData[key].value = data[key];\n      });\n      return mergedData;\n    }, [options]),\n    null\n  );\n\n  useEffect(() => {\n    fetchSAML();\n  }, [fetchSAML]);\n\n  const { error: submitError, request: submitForm } = useRequest(\n    useCallback(\n      async (values) => {\n        await SettingsAPI.updateAll(values);\n        history.push('/settings/saml/details');\n      },\n      [history]\n    ),\n    null\n  );\n\n  const { error: revertError, request: revertAll } = useRequest(\n    useCallback(async () => {\n      await SettingsAPI.revertCategory('saml');\n    }, []),\n    null\n  );\n\n  const handleSubmit = async (form) => {\n    await submitForm({\n      ...form,\n      SOCIAL_AUTH_SAML_ORG_INFO: formatJson(form.SOCIAL_AUTH_SAML_ORG_INFO),\n      SOCIAL_AUTH_SAML_TECHNICAL_CONTACT: formatJson(\n        form.SOCIAL_AUTH_SAML_TECHNICAL_CONTACT\n      ),\n      SOCIAL_AUTH_SAML_SUPPORT_CONTACT: formatJson(\n        form.SOCIAL_AUTH_SAML_SUPPORT_CONTACT\n      ),\n      SOCIAL_AUTH_SAML_ENABLED_IDPS: formatJson(\n        form.SOCIAL_AUTH_SAML_ENABLED_IDPS\n      ),\n      SOCIAL_AUTH_SAML_ORGANIZATION_MAP: formatJson(\n        form.SOCIAL_AUTH_SAML_ORGANIZATION_MAP\n      ),\n      SOCIAL_AUTH_SAML_ORGANIZATION_ATTR: formatJson(\n        form.SOCIAL_AUTH_SAML_ORGANIZATION_ATTR\n      ),\n      SOCIAL_AUTH_SAML_TEAM_MAP: formatJson(form.SOCIAL_AUTH_SAML_TEAM_MAP),\n      SOCIAL_AUTH_SAML_TEAM_ATTR: formatJson(form.SOCIAL_AUTH_SAML_TEAM_ATTR),\n      SOCIAL_AUTH_SAML_USER_FLAGS_BY_ATTR: formatJson(\n        form.SOCIAL_AUTH_SAML_USER_FLAGS_BY_ATTR\n      ),\n      SOCIAL_AUTH_SAML_SECURITY_CONFIG: formatJson(\n        form.SOCIAL_AUTH_SAML_SECURITY_CONFIG\n      ),\n      SOCIAL_AUTH_SAML_SP_EXTRA: formatJson(form.SOCIAL_AUTH_SAML_SP_EXTRA),\n      SOCIAL_AUTH_SAML_EXTRA_DATA: formatJson(form.SOCIAL_AUTH_SAML_EXTRA_DATA),\n    });\n  };\n\n  const handleRevertAll = async () => {\n    await revertAll();\n\n    closeModal();\n\n    history.push('/settings/saml/details');\n  };\n\n  const handleCancel = () => {\n    history.push('/settings/saml/details');\n  };\n\n  const initialValues = (fields) =>\n    Object.keys(fields).reduce((acc, key) => {\n      if (fields[key].type === 'list' || fields[key].type === 'nested object') {\n        acc[key] = fields[key].value\n          ? JSON.stringify(fields[key].value, null, 2)\n          : null;\n      } else {\n        acc[key] = fields[key].value ?? '';\n      }\n      return acc;\n    }, {});\n\n  return (\n    <CardBody>\n      {isLoading && <ContentLoading />}\n      {!isLoading && error && <ContentError error={error} />}\n      {!isLoading && saml && (\n        <Formik initialValues={initialValues(saml)} onSubmit={handleSubmit}>\n          {(formik) => (\n            <Form autoComplete=\"off\" onSubmit={formik.handleSubmit}>\n              <FormColumnLayout>\n                <InputField\n                  name=\"SOCIAL_AUTH_SAML_SP_ENTITY_ID\"\n                  config={saml.SOCIAL_AUTH_SAML_SP_ENTITY_ID}\n                  isRequired\n                />\n                <BooleanField\n                  name=\"SAML_AUTO_CREATE_OBJECTS\"\n                  config={saml.SAML_AUTO_CREATE_OBJECTS}\n                />\n                <FileUploadField\n                  name=\"SOCIAL_AUTH_SAML_SP_PUBLIC_CERT\"\n                  config={saml.SOCIAL_AUTH_SAML_SP_PUBLIC_CERT}\n                  isRequired\n                />\n                <FileUploadField\n                  name=\"SOCIAL_AUTH_SAML_SP_PRIVATE_KEY\"\n                  config={saml.SOCIAL_AUTH_SAML_SP_PRIVATE_KEY}\n                  isRequired\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_SAML_ORG_INFO\"\n                  config={saml.SOCIAL_AUTH_SAML_ORG_INFO}\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_SAML_TECHNICAL_CONTACT\"\n                  config={saml.SOCIAL_AUTH_SAML_TECHNICAL_CONTACT}\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_SAML_SUPPORT_CONTACT\"\n                  config={saml.SOCIAL_AUTH_SAML_SUPPORT_CONTACT}\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_SAML_ENABLED_IDPS\"\n                  config={saml.SOCIAL_AUTH_SAML_ENABLED_IDPS}\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_SAML_ORGANIZATION_MAP\"\n                  config={saml.SOCIAL_AUTH_SAML_ORGANIZATION_MAP}\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_SAML_ORGANIZATION_ATTR\"\n                  config={saml.SOCIAL_AUTH_SAML_ORGANIZATION_ATTR}\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_SAML_TEAM_MAP\"\n                  config={saml.SOCIAL_AUTH_SAML_TEAM_MAP}\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_SAML_TEAM_ATTR\"\n                  config={saml.SOCIAL_AUTH_SAML_TEAM_ATTR}\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_SAML_USER_FLAGS_BY_ATTR\"\n                  config={saml.SOCIAL_AUTH_SAML_USER_FLAGS_BY_ATTR}\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_SAML_SECURITY_CONFIG\"\n                  config={saml.SOCIAL_AUTH_SAML_SECURITY_CONFIG}\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_SAML_SP_EXTRA\"\n                  config={saml.SOCIAL_AUTH_SAML_SP_EXTRA}\n                />\n                <ObjectField\n                  name=\"SOCIAL_AUTH_SAML_EXTRA_DATA\"\n                  config={saml.SOCIAL_AUTH_SAML_EXTRA_DATA}\n                />\n                {submitError && <FormSubmitError error={submitError} />}\n                {revertError && <FormSubmitError error={revertError} />}\n              </FormColumnLayout>\n              <RevertFormActionGroup\n                onCancel={handleCancel}\n                onSubmit={formik.handleSubmit}\n                onRevert={toggleModal}\n              />\n              {isModalOpen && (\n                <RevertAllAlert\n                  onClose={closeModal}\n                  onRevertAll={handleRevertAll}\n                />\n              )}\n            </Form>\n          )}\n        </Formik>\n      )}\n    </CardBody>\n  );\n}\n\nexport default SAMLEdit;\n"]},"metadata":{},"sourceType":"module"}