{"ast":null,"code":"import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _createForOfIteratorHelper from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _excluded=[\"instanceGroups\",\"organization\"];import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState}from'react';import{useHistory}from'react-router-dom';import{PageSection,Card}from'@patternfly/react-core';import{CardBody}from'components/Card';import{InventoriesAPI}from'api';import InventoryForm from'../shared/InventoryForm';import{jsx as _jsx}from\"react/jsx-runtime\";function InventoryAdd(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var history=useHistory();var handleCancel=function handleCancel(){history.push('/inventories');};function submitLabels(_x,_x2){return _submitLabels.apply(this,arguments);}function _submitLabels(){_submitLabels=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(inventoryId,orgId){var labels,associationPromises,_args2=arguments;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:labels=_args2.length>2&&_args2[2]!==undefined?_args2[2]:[];associationPromises=labels.map(function(label){return InventoriesAPI.associateLabel(inventoryId,label,orgId);});return _context2.abrupt(\"return\",Promise.all(_toConsumableArray(associationPromises)));case 3:case\"end\":return _context2.stop();}}},_callee2);}));return _submitLabels.apply(this,arguments);}var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var instanceGroups,organization,remainingValues,_values$organization,_yield$InventoriesAPI,inventoryId,_iterator,_step,group,url;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:instanceGroups=values.instanceGroups,organization=values.organization,remainingValues=_objectWithoutProperties(values,_excluded);_context.prev=1;_context.next=4;return InventoriesAPI.create(_objectSpread({organization:organization.id},remainingValues));case 4:_yield$InventoriesAPI=_context.sent;inventoryId=_yield$InventoriesAPI.data.id;_context.next=8;return submitLabels(inventoryId,(_values$organization=values.organization)===null||_values$organization===void 0?void 0:_values$organization.id,values.labels);case 8:_iterator=_createForOfIteratorHelper(instanceGroups);_context.prev=9;_iterator.s();case 11:if((_step=_iterator.n()).done){_context.next=17;break;}group=_step.value;_context.next=15;return InventoriesAPI.associateInstanceGroup(inventoryId,group.id);case 15:_context.next=11;break;case 17:_context.next=22;break;case 19:_context.prev=19;_context.t0=_context[\"catch\"](9);_iterator.e(_context.t0);case 22:_context.prev=22;_iterator.f();return _context.finish(22);case 25:/* eslint-enable no-await-in-loop, no-restricted-syntax */url=history.location.pathname.startsWith('/inventories/smart_inventory')?\"/inventories/smart_inventory/\".concat(inventoryId,\"/details\"):\"/inventories/inventory/\".concat(inventoryId,\"/details\");history.push(\"\".concat(url));_context.next=32;break;case 29:_context.prev=29;_context.t1=_context[\"catch\"](1);setError(_context.t1);case 32:case\"end\":return _context.stop();}}},_callee,null,[[1,29],[9,19,22,25]]);}));return function handleSubmit(_x3){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(InventoryForm,{onCancel:handleCancel,onSubmit:handleSubmit,submitError:error})})})});}export{InventoryAdd as _InventoryAdd};export default InventoryAdd;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Inventory/InventoryAdd/InventoryAdd.js"],"names":["React","useState","useHistory","PageSection","Card","CardBody","InventoriesAPI","InventoryForm","InventoryAdd","error","setError","history","handleCancel","push","submitLabels","inventoryId","orgId","labels","associationPromises","map","label","associateLabel","Promise","all","handleSubmit","values","instanceGroups","organization","remainingValues","create","id","data","group","associateInstanceGroup","url","location","pathname","startsWith","_InventoryAdd"],"mappings":"uzBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,WAAT,CAAsBC,IAAtB,KAAkC,wBAAlC,CACA,OAASC,QAAT,KAAyB,iBAAzB,CAEA,OAASC,cAAT,KAA+B,KAA/B,CACA,MAAOC,CAAAA,aAAP,KAA0B,yBAA1B,C,2CAEA,QAASC,CAAAA,YAAT,EAAwB,CACtB,cAA0BP,QAAQ,CAAC,IAAD,CAAlC,wCAAOQ,KAAP,eAAcC,QAAd,eACA,GAAMC,CAAAA,OAAO,CAAGT,UAAU,EAA1B,CAEA,GAAMU,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CACzBD,OAAO,CAACE,IAAR,CAAa,cAAb,EACD,CAFD,CAJsB,QAQPC,CAAAA,YARO,oJAQtB,kBAA4BC,WAA5B,CAAyCC,KAAzC,sKAAgDC,MAAhD,kDAAyD,EAAzD,CACQC,mBADR,CAC8BD,MAAM,CAACE,GAAP,CAAW,SAACC,KAAD,QACrCd,CAAAA,cAAc,CAACe,cAAf,CAA8BN,WAA9B,CAA2CK,KAA3C,CAAkDJ,KAAlD,CADqC,EAAX,CAD9B,kCAKSM,OAAO,CAACC,GAAR,oBAAgBL,mBAAhB,EALT,0DARsB,+CAgBtB,GAAMM,CAAAA,YAAY,0FAAG,iBAAOC,MAAP,mPACXC,cADW,CAC0CD,MAD1C,CACXC,cADW,CACKC,YADL,CAC0CF,MAD1C,CACKE,YADL,CACsBC,eADtB,0BAC0CH,MAD1C,kDAKPnB,CAAAA,cAAc,CAACuB,MAAf,gBACRF,YAAY,CAAEA,YAAY,CAACG,EADnB,EAELF,eAFK,EALO,4CAIHb,WAJG,uBAIfgB,IAJe,CAIPD,EAJO,uBAYXhB,CAAAA,YAAY,CAACC,WAAD,uBAAcU,MAAM,CAACE,YAArB,+CAAc,qBAAqBG,EAAnC,CAAuCL,MAAM,CAACR,MAA9C,CAZD,6CAaGS,cAbH,+FAaNM,KAbM,oCAcT1B,CAAAA,cAAc,CAAC2B,sBAAf,CAAsClB,WAAtC,CAAmDiB,KAAK,CAACF,EAAzD,CAdS,4NAgBjB,0DACMI,GAjBW,CAiBLvB,OAAO,CAACwB,QAAR,CAAiBC,QAAjB,CAA0BC,UAA1B,CACV,8BADU,yCAGwBtB,WAHxB,8CAIkBA,WAJlB,YAjBK,CAuBjBJ,OAAO,CAACE,IAAR,WAAgBqB,GAAhB,GAvBiB,iFAyBjBxB,QAAQ,aAAR,CAzBiB,kFAAH,kBAAZc,CAAAA,YAAY,6CAAlB,CA6BA,mBACE,KAAC,WAAD,wBACE,KAAC,IAAD,wBACE,KAAC,QAAD,wBACE,KAAC,aAAD,EACE,QAAQ,CAAEZ,YADZ,CAEE,QAAQ,CAAEY,YAFZ,CAGE,WAAW,CAAEf,KAHf,EADF,EADF,EADF,EADF,CAaD,CAED,OAASD,YAAY,GAAI8B,CAAAA,aAAzB,EACA,cAAe9B,CAAAA,YAAf","sourcesContent":["import React, { useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { PageSection, Card } from '@patternfly/react-core';\nimport { CardBody } from 'components/Card';\n\nimport { InventoriesAPI } from 'api';\nimport InventoryForm from '../shared/InventoryForm';\n\nfunction InventoryAdd() {\n  const [error, setError] = useState(null);\n  const history = useHistory();\n\n  const handleCancel = () => {\n    history.push('/inventories');\n  };\n\n  async function submitLabels(inventoryId, orgId, labels = []) {\n    const associationPromises = labels.map((label) =>\n      InventoriesAPI.associateLabel(inventoryId, label, orgId)\n    );\n\n    return Promise.all([...associationPromises]);\n  }\n\n  const handleSubmit = async (values) => {\n    const { instanceGroups, organization, ...remainingValues } = values;\n    try {\n      const {\n        data: { id: inventoryId },\n      } = await InventoriesAPI.create({\n        organization: organization.id,\n        ...remainingValues,\n      });\n      /* eslint-disable no-await-in-loop, no-restricted-syntax */\n      // Resolve Promises sequentially to maintain order and avoid race condition\n\n      await submitLabels(inventoryId, values.organization?.id, values.labels);\n      for (const group of instanceGroups) {\n        await InventoriesAPI.associateInstanceGroup(inventoryId, group.id);\n      }\n      /* eslint-enable no-await-in-loop, no-restricted-syntax */\n      const url = history.location.pathname.startsWith(\n        '/inventories/smart_inventory'\n      )\n        ? `/inventories/smart_inventory/${inventoryId}/details`\n        : `/inventories/inventory/${inventoryId}/details`;\n\n      history.push(`${url}`);\n    } catch (err) {\n      setError(err);\n    }\n  };\n\n  return (\n    <PageSection>\n      <Card>\n        <CardBody>\n          <InventoryForm\n            onCancel={handleCancel}\n            onSubmit={handleSubmit}\n            submitError={error}\n          />\n        </CardBody>\n      </Card>\n    </PageSection>\n  );\n}\n\nexport { InventoryAdd as _InventoryAdd };\nexport default InventoryAdd;\n"]},"metadata":{},"sourceType":"module"}