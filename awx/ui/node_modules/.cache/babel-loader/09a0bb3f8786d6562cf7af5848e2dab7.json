{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback,useState}from'react';import{DateTime}from'luxon';import{Formik}from'formik';import{RRule}from'rrule';import{Button,Form,ActionGroup}from'@patternfly/react-core';import{Config}from'contexts/Config';import{SchedulesAPI}from'api';import{dateToInputDateTime}from'util/dates';import useRequest from'hooks/useRequest';import{parseVariableField}from'util/yaml';import ContentError from'../../ContentError';import ContentLoading from'../../ContentLoading';import{FormSubmitError}from'../../FormField';import{FormColumnLayout,FormFullWidthLayout}from'../../FormLayout';import SchedulePromptableFields from'./SchedulePromptableFields';import ScheduleFormFields from'./ScheduleFormFields';import UnsupportedScheduleForm from'./UnsupportedScheduleForm';import parseRuleObj,{UnsupportedRRuleError}from'./parseRuleObj';import buildRuleObj from'./buildRuleObj';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var NUM_DAYS_PER_FREQUENCY={week:7,month:31,year:365};function ScheduleForm(_ref){var _launchConfig$variabl;var hasDaysToKeepField=_ref.hasDaysToKeepField,handleCancel=_ref.handleCancel,handleSubmit=_ref.handleSubmit,schedule=_ref.schedule,submitError=_ref.submitError,resource=_ref.resource,launchConfig=_ref.launchConfig,surveyConfig=_ref.surveyConfig,resourceDefaultCredentials=_ref.resourceDefaultCredentials;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isWizardOpen=_useState2[0],setIsWizardOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isSaveDisabled=_useState4[0],setIsSaveDisabled=_useState4[1];var rruleError;var now=DateTime.now();var closestQuarterHour=DateTime.fromMillis(Math.ceil(now.ts/900000)*900000);var tomorrow=closestQuarterHour.plus({days:1});var isTemplate=resource.type==='workflow_job_template'||resource.type==='job_template';var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$SchedulesAPI$r,data,creds,_yield$SchedulesAPI$r2,results,zones;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return SchedulesAPI.readZoneInfo();case 2:_yield$SchedulesAPI$r=_context.sent;data=_yield$SchedulesAPI$r.data;if(!schedule.id){_context.next=10;break;}_context.next=7;return SchedulesAPI.readCredentials(schedule.id);case 7:_yield$SchedulesAPI$r2=_context.sent;results=_yield$SchedulesAPI$r2.data.results;creds=results;case 10:zones=(data.zones||[]).map(function(zone){return{value:zone,key:zone,label:zone};});return _context.abrupt(\"return\",{zoneOptions:zones,zoneLinks:data.links,credentials:creds||[]});case 12:case\"end\":return _context.stop();}}},_callee);})),[schedule]),{zonesOptions:[],zoneLinks:{},credentials:[],isLoading:true}),loadScheduleData=_useRequest.request,contentError=_useRequest.error,contentLoading=_useRequest.isLoading,_useRequest$result=_useRequest.result,zoneOptions=_useRequest$result.zoneOptions,zoneLinks=_useRequest$result.zoneLinks,credentials=_useRequest$result.credentials;useEffect(function(){loadScheduleData();},[loadScheduleData]);var missingRequiredInventory=useCallback(function(){var _schedule$summary_fie,_schedule$summary_fie2;var missingInventory=false;if(launchConfig.inventory_needed_to_start&&!(schedule!==null&&schedule!==void 0&&(_schedule$summary_fie=schedule.summary_fields)!==null&&_schedule$summary_fie!==void 0&&(_schedule$summary_fie2=_schedule$summary_fie.inventory)!==null&&_schedule$summary_fie2!==void 0&&_schedule$summary_fie2.id)){missingInventory=true;}return missingInventory;},[launchConfig,schedule]);var hasMissingSurveyValue=useCallback(function(){var missingValues=false;if(launchConfig!==null&&launchConfig!==void 0&&launchConfig.survey_enabled){surveyConfig.spec.forEach(function(question){var hasDefaultValue=Boolean(question.default);var hasSchedule=Object.keys(schedule).length;var isRequired=question.required;if(isRequired&&!hasDefaultValue){if(!hasSchedule){missingValues=true;}else{var hasMatchingKey=Object.keys(schedule===null||schedule===void 0?void 0:schedule.extra_data).includes(question.variable);Object.values(schedule===null||schedule===void 0?void 0:schedule.extra_data).forEach(function(value){if(!value||!hasMatchingKey){missingValues=true;}else{missingValues=false;}});if(!Object.values(schedule.extra_data).length){missingValues=true;}}}});}return missingValues;},[launchConfig,schedule,surveyConfig]);var hasCredentialsThatPrompt=useCallback(function(){if(launchConfig!==null&&launchConfig!==void 0&&launchConfig.ask_credential_on_launch){var _launchConfig$default;if(Object.keys(schedule).length>0){var defaultCredsWithoutOverrides=[];var credentialHasOverride=function credentialHasOverride(templateDefaultCred){var hasOverride=false;credentials.forEach(function(nodeCredential){if(templateDefaultCred.credential_type===nodeCredential.credential_type){if(!templateDefaultCred.vault_id&&!nodeCredential.inputs.vault_id||templateDefaultCred.vault_id&&nodeCredential.inputs.vault_id&&templateDefaultCred.vault_id===nodeCredential.inputs.vault_id){hasOverride=true;}}});return hasOverride;};if(resourceDefaultCredentials){resourceDefaultCredentials.forEach(function(defaultCred){if(!credentialHasOverride(defaultCred)){defaultCredsWithoutOverrides.push(defaultCred);}});}return credentials.concat(defaultCredsWithoutOverrides).filter(function(credential){var credentialRequiresPass=false;Object.entries(credential.inputs).forEach(function(_ref3){var _ref4=_slicedToArray(_ref3,2),key=_ref4[0],value=_ref4[1];if(key!=='vault_id'&&value==='ASK'){credentialRequiresPass=true;}});return credentialRequiresPass;}).length>0;}return launchConfig!==null&&launchConfig!==void 0&&(_launchConfig$default=launchConfig.defaults)!==null&&_launchConfig$default!==void 0&&_launchConfig$default.credentials?launchConfig.defaults.credentials.filter(function(credential){return(credential===null||credential===void 0?void 0:credential.passwords_needed.length)>0;}).length>0:false;}return false;},[launchConfig,schedule,credentials,resourceDefaultCredentials]);useEffect(function(){if(isTemplate&&(missingRequiredInventory()||hasMissingSurveyValue()||hasCredentialsThatPrompt())){setIsSaveDisabled(true);}},[isTemplate,hasMissingSurveyValue,missingRequiredInventory,hasCredentialsThatPrompt]);var showPromptButton=false;if(launchConfig&&(launchConfig.ask_inventory_on_launch||launchConfig.ask_variables_on_launch||launchConfig.ask_job_type_on_launch||launchConfig.ask_limit_on_launch||launchConfig.ask_credential_on_launch||launchConfig.ask_scm_branch_on_launch||launchConfig.ask_tags_on_launch||launchConfig.ask_skip_tags_on_launch||launchConfig.survey_enabled||launchConfig.inventory_needed_to_start||((_launchConfig$variabl=launchConfig.variables_needed_to_start)===null||_launchConfig$variabl===void 0?void 0:_launchConfig$variabl.length)>0)){showPromptButton=true;}var _dateToInputDateTime=dateToInputDateTime(closestQuarterHour.toISO()),_dateToInputDateTime2=_slicedToArray(_dateToInputDateTime,2),currentDate=_dateToInputDateTime2[0],time=_dateToInputDateTime2[1];var _dateToInputDateTime3=dateToInputDateTime(tomorrow.toISO()),_dateToInputDateTime4=_slicedToArray(_dateToInputDateTime3,1),tomorrowDate=_dateToInputDateTime4[0];var initialFrequencyOptions={minute:{interval:1,end:'never',occurrences:1,endDate:tomorrowDate,endTime:time},hour:{interval:1,end:'never',occurrences:1,endDate:tomorrowDate,endTime:time},day:{interval:1,end:'never',occurrences:1,endDate:tomorrowDate,endTime:time},week:{interval:1,end:'never',occurrences:1,endDate:tomorrowDate,endTime:time,daysOfWeek:[]},month:{interval:1,end:'never',occurrences:1,endDate:tomorrowDate,endTime:time,runOn:'day',runOnTheOccurrence:1,runOnTheDay:'sunday',runOnDayNumber:1},year:{interval:1,end:'never',occurrences:1,endDate:tomorrowDate,endTime:time,runOn:'day',runOnTheOccurrence:1,runOnTheDay:'sunday',runOnTheMonth:1,runOnDayMonth:1,runOnDayNumber:1}};var initialValues={description:schedule.description||'',frequency:[],exceptionFrequency:[],frequencyOptions:initialFrequencyOptions,exceptionOptions:initialFrequencyOptions,name:schedule.name||'',startDate:currentDate,startTime:time,timezone:schedule.timezone||now.zoneName};var submitSchedule=function submitSchedule(values,launchConfiguration,surveyConfiguration,scheduleCredentials){handleSubmit(values,launchConfiguration,surveyConfiguration,scheduleCredentials);};if(hasDaysToKeepField){var initialDaysToKeep=30;if(schedule!==null&&schedule!==void 0&&schedule.extra_data){if(typeof(schedule===null||schedule===void 0?void 0:schedule.extra_data)==='string'&&(schedule===null||schedule===void 0?void 0:schedule.extra_data)!==''){initialDaysToKeep=parseVariableField(schedule===null||schedule===void 0?void 0:schedule.extra_data).days;}if(typeof(schedule===null||schedule===void 0?void 0:schedule.extra_data)==='object'){var _schedule$extra_data;initialDaysToKeep=schedule===null||schedule===void 0?void 0:(_schedule$extra_data=schedule.extra_data)===null||_schedule$extra_data===void 0?void 0:_schedule$extra_data.days;}}initialValues.daysToKeep=initialDaysToKeep;}var overriddenValues={};if(schedule.rrule){try{overriddenValues=parseRuleObj(schedule);}catch(error){if(error instanceof UnsupportedRRuleError){return/*#__PURE__*/_jsx(UnsupportedScheduleForm,{schedule:schedule,handleCancel:handleCancel});}rruleError=error;}}else if(schedule.id){rruleError=new Error(/*i18n*/i18n._(\"Schedule is missing rrule\"));}if(contentError||rruleError){return/*#__PURE__*/_jsx(ContentError,{error:contentError||rruleError});}if(contentLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}var validate=function validate(values){var errors={};values.frequency.forEach(function(freq){var options=values.frequencyOptions[freq];var freqErrors={};if((freq==='month'||freq==='year')&&options.runOn==='day'&&(options.runOnDayNumber<1||options.runOnDayNumber>31)){freqErrors.runOn=/*i18n*/i18n._(\"Please select a day number between 1 and 31.\");}if(options.end==='after'&&!options.occurrences){freqErrors.occurrences=/*i18n*/i18n._(\"Please enter a number of occurrences.\");}if(options.end==='onDate'){if(DateTime.fromISO(values.startDate)>=DateTime.fromISO(options.endDate)){freqErrors.endDate=/*i18n*/i18n._(\"Please select an end date/time that comes after the start date/time.\");}if(DateTime.fromISO(options.endDate).diff(DateTime.fromISO(values.startDate),'days').toObject().days<NUM_DAYS_PER_FREQUENCY[freq]){var rule=new RRule(buildRuleObj(_objectSpread({startDate:values.startDate,startTime:values.startTime,frequency:freq},options)));if(rule.all().length===0){errors.startDate=/*i18n*/i18n._(\"Selected date range must have at least 1 schedule occurrence.\");freqErrors.endDate=/*i18n*/i18n._(\"Selected date range must have at least 1 schedule occurrence.\");}}}if(Object.keys(freqErrors).length>0){if(!errors.frequencyOptions){errors.frequencyOptions={};}errors.frequencyOptions[freq]=freqErrors;}});return errors;};return/*#__PURE__*/_jsx(Config,{children:function children(){return/*#__PURE__*/_jsx(Formik,{initialValues:_objectSpread(_objectSpread(_objectSpread({},initialValues),overriddenValues),{},{frequencyOptions:_objectSpread(_objectSpread({},initialValues.frequencyOptions),overriddenValues.frequencyOptions),exceptionOptions:_objectSpread(_objectSpread({},initialValues.exceptionOptions),overriddenValues.exceptionOptions)}),onSubmit:function onSubmit(values){submitSchedule(values,launchConfig,surveyConfig,credentials);},validate:validate,children:function children(formik){return/*#__PURE__*/_jsx(Form,{autoComplete:\"off\",onSubmit:formik.handleSubmit,children:/*#__PURE__*/_jsxs(FormColumnLayout,{children:[/*#__PURE__*/_jsx(ScheduleFormFields,{hasDaysToKeepField:hasDaysToKeepField,zoneOptions:zoneOptions,zoneLinks:zoneLinks}),isWizardOpen&&/*#__PURE__*/_jsx(SchedulePromptableFields,{schedule:schedule,credentials:credentials,surveyConfig:surveyConfig,launchConfig:launchConfig,resource:resource,onCloseWizard:function onCloseWizard(){setIsWizardOpen(false);},onSave:function onSave(){setIsWizardOpen(false);setIsSaveDisabled(false);},resourceDefaultCredentials:resourceDefaultCredentials}),/*#__PURE__*/_jsx(FormSubmitError,{error:submitError}),/*#__PURE__*/_jsx(FormFullWidthLayout,{children:/*#__PURE__*/_jsxs(ActionGroup,{children:[/*#__PURE__*/_jsx(Button,{ouiaId:\"schedule-form-save-button\",\"aria-label\":/*i18n*/i18n._(\"Save\"),variant:\"primary\",type:\"button\",onClick:formik.handleSubmit,isDisabled:isSaveDisabled,children:/*i18n*/i18n._(\"Save\")}),isTemplate&&showPromptButton&&/*#__PURE__*/_jsx(Button,{ouiaId:\"schedule-form-prompt-button\",variant:\"secondary\",type:\"button\",\"aria-label\":/*i18n*/i18n._(\"Prompt\"),onClick:function onClick(){return setIsWizardOpen(true);},children:/*i18n*/i18n._(\"Prompt\")}),/*#__PURE__*/_jsx(Button,{ouiaId:\"schedule-form-cancel-button\",\"aria-label\":/*i18n*/i18n._(\"Cancel\"),variant:\"secondary\",type:\"button\",onClick:handleCancel,children:/*i18n*/i18n._(\"Cancel\")})]})})]})});}});}});}ScheduleForm.defaultProps={schedule:{},submitError:null};export default ScheduleForm;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/Schedule/shared/ScheduleForm.js"],"names":["React","useEffect","useCallback","useState","DateTime","Formik","RRule","Button","Form","ActionGroup","Config","SchedulesAPI","dateToInputDateTime","useRequest","parseVariableField","ContentError","ContentLoading","FormSubmitError","FormColumnLayout","FormFullWidthLayout","SchedulePromptableFields","ScheduleFormFields","UnsupportedScheduleForm","parseRuleObj","UnsupportedRRuleError","buildRuleObj","NUM_DAYS_PER_FREQUENCY","week","month","year","ScheduleForm","hasDaysToKeepField","handleCancel","handleSubmit","schedule","submitError","resource","launchConfig","surveyConfig","resourceDefaultCredentials","isWizardOpen","setIsWizardOpen","isSaveDisabled","setIsSaveDisabled","rruleError","now","closestQuarterHour","fromMillis","Math","ceil","ts","tomorrow","plus","days","isTemplate","type","readZoneInfo","data","id","readCredentials","results","creds","zones","map","zone","value","key","label","zoneOptions","zoneLinks","links","credentials","zonesOptions","isLoading","loadScheduleData","request","contentError","error","contentLoading","result","missingRequiredInventory","missingInventory","inventory_needed_to_start","summary_fields","inventory","hasMissingSurveyValue","missingValues","survey_enabled","spec","forEach","question","hasDefaultValue","Boolean","default","hasSchedule","Object","keys","length","isRequired","required","hasMatchingKey","extra_data","includes","variable","values","hasCredentialsThatPrompt","ask_credential_on_launch","defaultCredsWithoutOverrides","credentialHasOverride","templateDefaultCred","hasOverride","nodeCredential","credential_type","vault_id","inputs","defaultCred","push","concat","filter","credential","credentialRequiresPass","entries","defaults","passwords_needed","showPromptButton","ask_inventory_on_launch","ask_variables_on_launch","ask_job_type_on_launch","ask_limit_on_launch","ask_scm_branch_on_launch","ask_tags_on_launch","ask_skip_tags_on_launch","variables_needed_to_start","toISO","currentDate","time","tomorrowDate","initialFrequencyOptions","minute","interval","end","occurrences","endDate","endTime","hour","day","daysOfWeek","runOn","runOnTheOccurrence","runOnTheDay","runOnDayNumber","runOnTheMonth","runOnDayMonth","initialValues","description","frequency","exceptionFrequency","frequencyOptions","exceptionOptions","name","startDate","startTime","timezone","zoneName","submitSchedule","launchConfiguration","surveyConfiguration","scheduleCredentials","initialDaysToKeep","daysToKeep","overriddenValues","rrule","Error","validate","errors","freq","options","freqErrors","fromISO","diff","toObject","rule","all","formik","defaultProps"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback, useState } from 'react';\nimport { shape, func } from 'prop-types';\n\nimport { DateTime } from 'luxon';\nimport { t } from '@lingui/macro';\nimport { Formik } from 'formik';\nimport { RRule } from 'rrule';\nimport { Button, Form, ActionGroup } from '@patternfly/react-core';\nimport { Config } from 'contexts/Config';\nimport { SchedulesAPI } from 'api';\nimport { dateToInputDateTime } from 'util/dates';\nimport useRequest from 'hooks/useRequest';\nimport { parseVariableField } from 'util/yaml';\nimport ContentError from '../../ContentError';\nimport ContentLoading from '../../ContentLoading';\nimport { FormSubmitError } from '../../FormField';\nimport { FormColumnLayout, FormFullWidthLayout } from '../../FormLayout';\nimport SchedulePromptableFields from './SchedulePromptableFields';\nimport ScheduleFormFields from './ScheduleFormFields';\nimport UnsupportedScheduleForm from './UnsupportedScheduleForm';\nimport parseRuleObj, { UnsupportedRRuleError } from './parseRuleObj';\nimport buildRuleObj from './buildRuleObj';\n\nconst NUM_DAYS_PER_FREQUENCY = {\n  week: 7,\n  month: 31,\n  year: 365,\n};\n\nfunction ScheduleForm({\n  hasDaysToKeepField,\n  handleCancel,\n  handleSubmit,\n  schedule,\n  submitError,\n  resource,\n  launchConfig,\n  surveyConfig,\n  resourceDefaultCredentials,\n}) {\n  const [isWizardOpen, setIsWizardOpen] = useState(false);\n  const [isSaveDisabled, setIsSaveDisabled] = useState(false);\n\n  let rruleError;\n  const now = DateTime.now();\n  const closestQuarterHour = DateTime.fromMillis(\n    Math.ceil(now.ts / 900000) * 900000\n  );\n  const tomorrow = closestQuarterHour.plus({ days: 1 });\n  const isTemplate =\n    resource.type === 'workflow_job_template' ||\n    resource.type === 'job_template';\n  const {\n    request: loadScheduleData,\n    error: contentError,\n    isLoading: contentLoading,\n    result: { zoneOptions, zoneLinks, credentials },\n  } = useRequest(\n    useCallback(async () => {\n      const { data } = await SchedulesAPI.readZoneInfo();\n\n      let creds;\n      if (schedule.id) {\n        const {\n          data: { results },\n        } = await SchedulesAPI.readCredentials(schedule.id);\n        creds = results;\n      }\n\n      const zones = (data.zones || []).map((zone) => ({\n        value: zone,\n        key: zone,\n        label: zone,\n      }));\n\n      return {\n        zoneOptions: zones,\n        zoneLinks: data.links,\n        credentials: creds || [],\n      };\n    }, [schedule]),\n    {\n      zonesOptions: [],\n      zoneLinks: {},\n      credentials: [],\n      isLoading: true,\n    }\n  );\n\n  useEffect(() => {\n    loadScheduleData();\n  }, [loadScheduleData]);\n\n  const missingRequiredInventory = useCallback(() => {\n    let missingInventory = false;\n    if (\n      launchConfig.inventory_needed_to_start &&\n      !schedule?.summary_fields?.inventory?.id\n    ) {\n      missingInventory = true;\n    }\n    return missingInventory;\n  }, [launchConfig, schedule]);\n\n  const hasMissingSurveyValue = useCallback(() => {\n    let missingValues = false;\n    if (launchConfig?.survey_enabled) {\n      surveyConfig.spec.forEach((question) => {\n        const hasDefaultValue = Boolean(question.default);\n        const hasSchedule = Object.keys(schedule).length;\n        const isRequired = question.required;\n        if (isRequired && !hasDefaultValue) {\n          if (!hasSchedule) {\n            missingValues = true;\n          } else {\n            const hasMatchingKey = Object.keys(schedule?.extra_data).includes(\n              question.variable\n            );\n            Object.values(schedule?.extra_data).forEach((value) => {\n              if (!value || !hasMatchingKey) {\n                missingValues = true;\n              } else {\n                missingValues = false;\n              }\n            });\n            if (!Object.values(schedule.extra_data).length) {\n              missingValues = true;\n            }\n          }\n        }\n      });\n    }\n    return missingValues;\n  }, [launchConfig, schedule, surveyConfig]);\n\n  const hasCredentialsThatPrompt = useCallback(() => {\n    if (launchConfig?.ask_credential_on_launch) {\n      if (Object.keys(schedule).length > 0) {\n        const defaultCredsWithoutOverrides = [];\n\n        const credentialHasOverride = (templateDefaultCred) => {\n          let hasOverride = false;\n          credentials.forEach((nodeCredential) => {\n            if (\n              templateDefaultCred.credential_type ===\n              nodeCredential.credential_type\n            ) {\n              if (\n                (!templateDefaultCred.vault_id &&\n                  !nodeCredential.inputs.vault_id) ||\n                (templateDefaultCred.vault_id &&\n                  nodeCredential.inputs.vault_id &&\n                  templateDefaultCred.vault_id ===\n                    nodeCredential.inputs.vault_id)\n              ) {\n                hasOverride = true;\n              }\n            }\n          });\n\n          return hasOverride;\n        };\n\n        if (resourceDefaultCredentials) {\n          resourceDefaultCredentials.forEach((defaultCred) => {\n            if (!credentialHasOverride(defaultCred)) {\n              defaultCredsWithoutOverrides.push(defaultCred);\n            }\n          });\n        }\n\n        return (\n          credentials\n            .concat(defaultCredsWithoutOverrides)\n            .filter((credential) => {\n              let credentialRequiresPass = false;\n\n              Object.entries(credential.inputs).forEach(([key, value]) => {\n                if (key !== 'vault_id' && value === 'ASK') {\n                  credentialRequiresPass = true;\n                }\n              });\n\n              return credentialRequiresPass;\n            }).length > 0\n        );\n      }\n\n      return launchConfig?.defaults?.credentials\n        ? launchConfig.defaults.credentials.filter(\n            (credential) => credential?.passwords_needed.length > 0\n          ).length > 0\n        : false;\n    }\n\n    return false;\n  }, [launchConfig, schedule, credentials, resourceDefaultCredentials]);\n\n  useEffect(() => {\n    if (\n      isTemplate &&\n      (missingRequiredInventory() ||\n        hasMissingSurveyValue() ||\n        hasCredentialsThatPrompt())\n    ) {\n      setIsSaveDisabled(true);\n    }\n  }, [\n    isTemplate,\n    hasMissingSurveyValue,\n    missingRequiredInventory,\n    hasCredentialsThatPrompt,\n  ]);\n\n  let showPromptButton = false;\n\n  if (\n    launchConfig &&\n    (launchConfig.ask_inventory_on_launch ||\n      launchConfig.ask_variables_on_launch ||\n      launchConfig.ask_job_type_on_launch ||\n      launchConfig.ask_limit_on_launch ||\n      launchConfig.ask_credential_on_launch ||\n      launchConfig.ask_scm_branch_on_launch ||\n      launchConfig.ask_tags_on_launch ||\n      launchConfig.ask_skip_tags_on_launch ||\n      launchConfig.survey_enabled ||\n      launchConfig.inventory_needed_to_start ||\n      launchConfig.variables_needed_to_start?.length > 0)\n  ) {\n    showPromptButton = true;\n  }\n  const [currentDate, time] = dateToInputDateTime(closestQuarterHour.toISO());\n\n  const [tomorrowDate] = dateToInputDateTime(tomorrow.toISO());\n  const initialFrequencyOptions = {\n    minute: {\n      interval: 1,\n      end: 'never',\n      occurrences: 1,\n      endDate: tomorrowDate,\n      endTime: time,\n    },\n    hour: {\n      interval: 1,\n      end: 'never',\n      occurrences: 1,\n      endDate: tomorrowDate,\n      endTime: time,\n    },\n    day: {\n      interval: 1,\n      end: 'never',\n      occurrences: 1,\n      endDate: tomorrowDate,\n      endTime: time,\n    },\n    week: {\n      interval: 1,\n      end: 'never',\n      occurrences: 1,\n      endDate: tomorrowDate,\n      endTime: time,\n      daysOfWeek: [],\n    },\n    month: {\n      interval: 1,\n      end: 'never',\n      occurrences: 1,\n      endDate: tomorrowDate,\n      endTime: time,\n      runOn: 'day',\n      runOnTheOccurrence: 1,\n      runOnTheDay: 'sunday',\n      runOnDayNumber: 1,\n    },\n    year: {\n      interval: 1,\n      end: 'never',\n      occurrences: 1,\n      endDate: tomorrowDate,\n      endTime: time,\n      runOn: 'day',\n      runOnTheOccurrence: 1,\n      runOnTheDay: 'sunday',\n      runOnTheMonth: 1,\n      runOnDayMonth: 1,\n      runOnDayNumber: 1,\n    },\n  };\n\n  const initialValues = {\n    description: schedule.description || '',\n    frequency: [],\n    exceptionFrequency: [],\n    frequencyOptions: initialFrequencyOptions,\n    exceptionOptions: initialFrequencyOptions,\n    name: schedule.name || '',\n    startDate: currentDate,\n    startTime: time,\n    timezone: schedule.timezone || now.zoneName,\n  };\n  const submitSchedule = (\n    values,\n    launchConfiguration,\n    surveyConfiguration,\n    scheduleCredentials\n  ) => {\n    handleSubmit(\n      values,\n      launchConfiguration,\n      surveyConfiguration,\n      scheduleCredentials\n    );\n  };\n\n  if (hasDaysToKeepField) {\n    let initialDaysToKeep = 30;\n    if (schedule?.extra_data) {\n      if (\n        typeof schedule?.extra_data === 'string' &&\n        schedule?.extra_data !== ''\n      ) {\n        initialDaysToKeep = parseVariableField(schedule?.extra_data).days;\n      }\n      if (typeof schedule?.extra_data === 'object') {\n        initialDaysToKeep = schedule?.extra_data?.days;\n      }\n    }\n    initialValues.daysToKeep = initialDaysToKeep;\n  }\n\n  let overriddenValues = {};\n  if (schedule.rrule) {\n    try {\n      overriddenValues = parseRuleObj(schedule);\n    } catch (error) {\n      if (error instanceof UnsupportedRRuleError) {\n        return (\n          <UnsupportedScheduleForm\n            schedule={schedule}\n            handleCancel={handleCancel}\n          />\n        );\n      }\n      rruleError = error;\n    }\n  } else if (schedule.id) {\n    rruleError = new Error(t`Schedule is missing rrule`);\n  }\n\n  if (contentError || rruleError) {\n    return <ContentError error={contentError || rruleError} />;\n  }\n\n  if (contentLoading) {\n    return <ContentLoading />;\n  }\n\n  const validate = (values) => {\n    const errors = {};\n\n    values.frequency.forEach((freq) => {\n      const options = values.frequencyOptions[freq];\n      const freqErrors = {};\n\n      if (\n        (freq === 'month' || freq === 'year') &&\n        options.runOn === 'day' &&\n        (options.runOnDayNumber < 1 || options.runOnDayNumber > 31)\n      ) {\n        freqErrors.runOn = t`Please select a day number between 1 and 31.`;\n      }\n\n      if (options.end === 'after' && !options.occurrences) {\n        freqErrors.occurrences = t`Please enter a number of occurrences.`;\n      }\n\n      if (options.end === 'onDate') {\n        if (\n          DateTime.fromISO(values.startDate) >=\n          DateTime.fromISO(options.endDate)\n        ) {\n          freqErrors.endDate = t`Please select an end date/time that comes after the start date/time.`;\n        }\n\n        if (\n          DateTime.fromISO(options.endDate)\n            .diff(DateTime.fromISO(values.startDate), 'days')\n            .toObject().days < NUM_DAYS_PER_FREQUENCY[freq]\n        ) {\n          const rule = new RRule(\n            buildRuleObj({\n              startDate: values.startDate,\n              startTime: values.startTime,\n              frequency: freq,\n              ...options,\n            })\n          );\n          if (rule.all().length === 0) {\n            errors.startDate = t`Selected date range must have at least 1 schedule occurrence.`;\n            freqErrors.endDate = t`Selected date range must have at least 1 schedule occurrence.`;\n          }\n        }\n      }\n      if (Object.keys(freqErrors).length > 0) {\n        if (!errors.frequencyOptions) {\n          errors.frequencyOptions = {};\n        }\n        errors.frequencyOptions[freq] = freqErrors;\n      }\n    });\n\n    return errors;\n  };\n\n  return (\n    <Config>\n      {() => (\n        <Formik\n          initialValues={{\n            ...initialValues,\n            ...overriddenValues,\n            frequencyOptions: {\n              ...initialValues.frequencyOptions,\n              ...overriddenValues.frequencyOptions,\n            },\n            exceptionOptions: {\n              ...initialValues.exceptionOptions,\n              ...overriddenValues.exceptionOptions,\n            },\n          }}\n          onSubmit={(values) => {\n            submitSchedule(values, launchConfig, surveyConfig, credentials);\n          }}\n          validate={validate}\n        >\n          {(formik) => (\n            <Form autoComplete=\"off\" onSubmit={formik.handleSubmit}>\n              <FormColumnLayout>\n                <ScheduleFormFields\n                  hasDaysToKeepField={hasDaysToKeepField}\n                  zoneOptions={zoneOptions}\n                  zoneLinks={zoneLinks}\n                />\n                {isWizardOpen && (\n                  <SchedulePromptableFields\n                    schedule={schedule}\n                    credentials={credentials}\n                    surveyConfig={surveyConfig}\n                    launchConfig={launchConfig}\n                    resource={resource}\n                    onCloseWizard={() => {\n                      setIsWizardOpen(false);\n                    }}\n                    onSave={() => {\n                      setIsWizardOpen(false);\n                      setIsSaveDisabled(false);\n                    }}\n                    resourceDefaultCredentials={resourceDefaultCredentials}\n                  />\n                )}\n                <FormSubmitError error={submitError} />\n                <FormFullWidthLayout>\n                  <ActionGroup>\n                    <Button\n                      ouiaId=\"schedule-form-save-button\"\n                      aria-label={t`Save`}\n                      variant=\"primary\"\n                      type=\"button\"\n                      onClick={formik.handleSubmit}\n                      isDisabled={isSaveDisabled}\n                    >\n                      {t`Save`}\n                    </Button>\n\n                    {isTemplate && showPromptButton && (\n                      <Button\n                        ouiaId=\"schedule-form-prompt-button\"\n                        variant=\"secondary\"\n                        type=\"button\"\n                        aria-label={t`Prompt`}\n                        onClick={() => setIsWizardOpen(true)}\n                      >\n                        {t`Prompt`}\n                      </Button>\n                    )}\n                    <Button\n                      ouiaId=\"schedule-form-cancel-button\"\n                      aria-label={t`Cancel`}\n                      variant=\"secondary\"\n                      type=\"button\"\n                      onClick={handleCancel}\n                    >\n                      {t`Cancel`}\n                    </Button>\n                  </ActionGroup>\n                </FormFullWidthLayout>\n              </FormColumnLayout>\n            </Form>\n          )}\n        </Formik>\n      )}\n    </Config>\n  );\n}\n\nScheduleForm.propTypes = {\n  handleCancel: func.isRequired,\n  handleSubmit: func.isRequired,\n  schedule: shape({}),\n  submitError: shape(),\n};\n\nScheduleForm.defaultProps = {\n  schedule: {},\n  submitError: null,\n};\n\nexport default ScheduleForm;\n"]},"metadata":{},"sourceType":"module"}