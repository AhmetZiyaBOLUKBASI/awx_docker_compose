{"ast":null,"code":"import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{useHistory,Link,useRouteMatch}from'react-router-dom';import{Formik,useFormikContext}from'formik';import{Alert,AlertGroup,Button,Form,Wizard,WizardContextConsumer,WizardFooter}from'@patternfly/react-core';import{ConfigAPI,SettingsAPI,RootAPI}from'api';import useRequest,{useDismissableError}from'hooks/useRequest';import ContentLoading from'components/ContentLoading';import ContentError from'components/ContentError';import{FormSubmitError}from'components/FormField';import{useConfig}from'contexts/Config';import SubscriptionStep from'./SubscriptionStep';import AnalyticsStep from'./AnalyticsStep';import EulaStep from'./EulaStep';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CustomFooter=function CustomFooter(_ref){var isSubmitLoading=_ref.isSubmitLoading;var _useFormikContext=useFormikContext(),values=_useFormikContext.values,errors=_useFormikContext.errors;var _useConfig=useConfig(),me=_useConfig.me,license_info=_useConfig.license_info;var history=useHistory();return/*#__PURE__*/_jsx(WizardFooter,{children:/*#__PURE__*/_jsx(WizardContextConsumer,{children:function children(_ref2){var activeStep=_ref2.activeStep,onNext=_ref2.onNext,onBack=_ref2.onBack;return/*#__PURE__*/_jsxs(_Fragment,{children:[activeStep.id==='eula-step'?/*#__PURE__*/_jsx(Button,{id:\"subscription-wizard-submit\",\"aria-label\":/*i18n*/i18n._(\"Submit\"),variant:\"primary\",onClick:onNext,isDisabled:!values.manifest_file&&!values.subscription||!(me!==null&&me!==void 0&&me.is_superuser)||Object.keys(errors).length!==0,type:\"button\",ouiaId:\"subscription-wizard-submit\",isLoading:isSubmitLoading,children:/*#__PURE__*/_jsx(Trans,{id:\"Submit\"})}):/*#__PURE__*/_jsx(Button,{id:\"subscription-wizard-next\",ouiaId:\"subscription-wizard-next\",variant:\"primary\",onClick:onNext,type:\"button\",children:/*#__PURE__*/_jsx(Trans,{id:\"Next\"})}),/*#__PURE__*/_jsx(Button,{id:\"subscription-wizard-back\",variant:\"secondary\",ouiaId:\"subscription-wizard-back\",onClick:onBack,isDisabled:activeStep.id==='subscription-step',type:\"button\",children:/*#__PURE__*/_jsx(Trans,{id:\"Back\"})}),(license_info===null||license_info===void 0?void 0:license_info.valid_key)&&/*#__PURE__*/_jsx(Button,{id:\"subscription-wizard-cancel\",ouiaId:\"subscription-wizard-cancel\",variant:\"link\",\"aria-label\":/*i18n*/i18n._(\"Cancel subscription edit\"),onClick:function onClick(){return history.push('/settings/subscription/details');},children:/*#__PURE__*/_jsx(Trans,{id:\"Cancel\"})})]});}})});};function SubscriptionEdit(){var history=useHistory();var _useConfig2=useConfig(),updateConfig=_useConfig2.request,license_info=_useConfig2.license_info;var hasValidKey=Boolean(license_info===null||license_info===void 0?void 0:license_info.valid_key);var subscriptionMgmtRoute=useRouteMatch({path:'/subscription_management'});var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$RootAPI$readAs,BRAND_NAME;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return RootAPI.readAssetVariables();case 2:_yield$RootAPI$readAs=_context.sent;BRAND_NAME=_yield$RootAPI$readAs.data.BRAND_NAME;return _context.abrupt(\"return\",{brandName:BRAND_NAME});case 5:case\"end\":return _context.stop();}}},_callee);})),[]),{brandName:null}),isContentLoading=_useRequest.isLoading,contentError=_useRequest.error,fetchContent=_useRequest.request,brandName=_useRequest.result.brandName;useEffect(function(){if(subscriptionMgmtRoute&&hasValidKey){history.push('/settings/subscription/edit');}fetchContent();},[fetchContent]);// eslint-disable-line react-hooks/exhaustive-deps\nvar _useRequest2=useRequest(useCallback(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(form){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!form.manifest_file){_context2.next=5;break;}_context2.next=3;return ConfigAPI.create({manifest:form.manifest_file});case 3:_context2.next=8;break;case 5:if(!form.subscription){_context2.next=8;break;}_context2.next=8;return ConfigAPI.attach({pool_id:form.subscription.pool_id});case 8:if(hasValidKey){_context2.next=23;break;}if(!form.pendo){_context2.next=14;break;}_context2.next=12;return SettingsAPI.updateCategory('ui',{PENDO_TRACKING_STATE:'detailed'});case 12:_context2.next=16;break;case 14:_context2.next=16;return SettingsAPI.updateCategory('ui',{PENDO_TRACKING_STATE:'off'});case 16:if(!form.insights){_context2.next=21;break;}_context2.next=19;return SettingsAPI.updateCategory('system',{INSIGHTS_TRACKING_STATE:true});case 19:_context2.next=23;break;case 21:_context2.next=23;return SettingsAPI.updateCategory('system',{INSIGHTS_TRACKING_STATE:false});case 23:_context2.next=25;return updateConfig();case 25:return _context2.abrupt(\"return\",true);case 26:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref4.apply(this,arguments);};}(),[])// eslint-disable-line react-hooks/exhaustive-deps\n),submitError=_useRequest2.error,submitLoading=_useRequest2.isLoading,submitSuccessful=_useRequest2.result,submitRequest=_useRequest2.request;useEffect(function(){if(submitSuccessful){setTimeout(function(){history.push(subscriptionMgmtRoute?'/home':'/settings/subscription/details');},3000);}},[submitSuccessful,history,subscriptionMgmtRoute]);var _useDismissableError=useDismissableError(submitError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;var handleSubmit=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(values){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:dismissError();_context3.next=3;return submitRequest(values);case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function handleSubmit(_x2){return _ref5.apply(this,arguments);};}();if(isContentLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}if(contentError){return/*#__PURE__*/_jsx(ContentError,{});}var steps=[{name:hasValidKey?/*i18n*/i18n._(\"Subscription Management\"):\"\".concat(brandName,\" \").concat(/*i18n*/i18n._(\"Subscription\")),id:'subscription-step',component:/*#__PURE__*/_jsx(SubscriptionStep,{})}].concat(_toConsumableArray(!hasValidKey?[{name:/*i18n*/i18n._(\"User and Automation Analytics\"),id:'analytics-step',component:/*#__PURE__*/_jsx(AnalyticsStep,{})}]:[]),[{name:/*i18n*/i18n._(\"End user license agreement\"),component:/*#__PURE__*/_jsx(EulaStep,{}),id:'eula-step',nextButtonText:/*i18n*/i18n._(\"Submit\")}]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Formik,{initialValues:{insights:true,manifest_file:null,manifest_filename:'',pendo:true,subscription:null,password:'',username:''},onSubmit:handleSubmit,children:function children(formik){return/*#__PURE__*/_jsxs(Form,{onSubmit:function onSubmit(e){e.preventDefault();},children:[/*#__PURE__*/_jsx(Wizard,{steps:steps,onSave:formik.handleSubmit,footer:/*#__PURE__*/_jsx(CustomFooter,{isSubmitLoading:submitLoading}),height:\"fit-content\"}),error&&/*#__PURE__*/_jsx(\"div\",{style:{margin:'0 24px 24px 24px'},children:/*#__PURE__*/_jsx(FormSubmitError,{error:error})})]});}}),/*#__PURE__*/_jsx(AlertGroup,{isToast:true,children:submitSuccessful&&/*#__PURE__*/_jsx(Alert,{variant:\"success\",title:/*i18n*/i18n._(\"Save successful!\"),ouiaId:\"success-alert\",children:subscriptionMgmtRoute?/*#__PURE__*/_jsx(Link,{to:\"/home\",children:/*#__PURE__*/_jsx(Trans,{id:\"Redirecting to dashboard\"})}):/*#__PURE__*/_jsx(Link,{to:\"/settings/subscription/details\",children:/*#__PURE__*/_jsx(Trans,{id:\"Redirecting to subscription detail\"})})})})]});}export default SubscriptionEdit;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Setting/Subscription/SubscriptionEdit/SubscriptionEdit.js"],"names":["React","useCallback","useEffect","useHistory","Link","useRouteMatch","Formik","useFormikContext","Alert","AlertGroup","Button","Form","Wizard","WizardContextConsumer","WizardFooter","ConfigAPI","SettingsAPI","RootAPI","useRequest","useDismissableError","ContentLoading","ContentError","FormSubmitError","useConfig","SubscriptionStep","AnalyticsStep","EulaStep","CustomFooter","isSubmitLoading","values","errors","me","license_info","history","activeStep","onNext","onBack","id","manifest_file","subscription","is_superuser","Object","keys","length","valid_key","push","SubscriptionEdit","updateConfig","request","hasValidKey","Boolean","subscriptionMgmtRoute","path","readAssetVariables","BRAND_NAME","data","brandName","isContentLoading","isLoading","contentError","error","fetchContent","result","form","create","manifest","attach","pool_id","pendo","updateCategory","PENDO_TRACKING_STATE","insights","INSIGHTS_TRACKING_STATE","submitError","submitLoading","submitSuccessful","submitRequest","setTimeout","dismissError","handleSubmit","steps","name","component","nextButtonText","manifest_filename","password","username","formik","e","preventDefault","margin"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory, Link, useRouteMatch } from 'react-router-dom';\nimport { t, Trans } from '@lingui/macro';\nimport { Formik, useFormikContext } from 'formik';\nimport {\n  Alert,\n  AlertGroup,\n  Button,\n  Form,\n  Wizard,\n  WizardContextConsumer,\n  WizardFooter,\n} from '@patternfly/react-core';\nimport { ConfigAPI, SettingsAPI, RootAPI } from 'api';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport ContentLoading from 'components/ContentLoading';\nimport ContentError from 'components/ContentError';\nimport { FormSubmitError } from 'components/FormField';\nimport { useConfig } from 'contexts/Config';\nimport SubscriptionStep from './SubscriptionStep';\nimport AnalyticsStep from './AnalyticsStep';\nimport EulaStep from './EulaStep';\n\nconst CustomFooter = ({ isSubmitLoading }) => {\n  const { values, errors } = useFormikContext();\n  const { me, license_info } = useConfig();\n  const history = useHistory();\n\n  return (\n    <WizardFooter>\n      <WizardContextConsumer>\n        {({ activeStep, onNext, onBack }) => (\n          <>\n            {activeStep.id === 'eula-step' ? (\n              <Button\n                id=\"subscription-wizard-submit\"\n                aria-label={t`Submit`}\n                variant=\"primary\"\n                onClick={onNext}\n                isDisabled={\n                  (!values.manifest_file && !values.subscription) ||\n                  !me?.is_superuser ||\n                  Object.keys(errors).length !== 0\n                }\n                type=\"button\"\n                ouiaId=\"subscription-wizard-submit\"\n                isLoading={isSubmitLoading}\n              >\n                <Trans>Submit</Trans>\n              </Button>\n            ) : (\n              <Button\n                id=\"subscription-wizard-next\"\n                ouiaId=\"subscription-wizard-next\"\n                variant=\"primary\"\n                onClick={onNext}\n                type=\"button\"\n              >\n                <Trans>Next</Trans>\n              </Button>\n            )}\n            <Button\n              id=\"subscription-wizard-back\"\n              variant=\"secondary\"\n              ouiaId=\"subscription-wizard-back\"\n              onClick={onBack}\n              isDisabled={activeStep.id === 'subscription-step'}\n              type=\"button\"\n            >\n              <Trans>Back</Trans>\n            </Button>\n            {license_info?.valid_key && (\n              <Button\n                id=\"subscription-wizard-cancel\"\n                ouiaId=\"subscription-wizard-cancel\"\n                variant=\"link\"\n                aria-label={t`Cancel subscription edit`}\n                onClick={() => history.push('/settings/subscription/details')}\n              >\n                <Trans>Cancel</Trans>\n              </Button>\n            )}\n          </>\n        )}\n      </WizardContextConsumer>\n    </WizardFooter>\n  );\n};\n\nfunction SubscriptionEdit() {\n  const history = useHistory();\n  const { request: updateConfig, license_info } = useConfig();\n  const hasValidKey = Boolean(license_info?.valid_key);\n  const subscriptionMgmtRoute = useRouteMatch({\n    path: '/subscription_management',\n  });\n\n  const {\n    isLoading: isContentLoading,\n    error: contentError,\n    request: fetchContent,\n    result: { brandName },\n  } = useRequest(\n    useCallback(async () => {\n      const {\n        data: { BRAND_NAME },\n      } = await RootAPI.readAssetVariables();\n      return {\n        brandName: BRAND_NAME,\n      };\n    }, []),\n    {\n      brandName: null,\n    }\n  );\n\n  useEffect(() => {\n    if (subscriptionMgmtRoute && hasValidKey) {\n      history.push('/settings/subscription/edit');\n    }\n    fetchContent();\n  }, [fetchContent]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const {\n    error: submitError,\n    isLoading: submitLoading,\n    result: submitSuccessful,\n    request: submitRequest,\n  } = useRequest(\n    useCallback(async (form) => {\n      if (form.manifest_file) {\n        await ConfigAPI.create({\n          manifest: form.manifest_file,\n        });\n      } else if (form.subscription) {\n        await ConfigAPI.attach({ pool_id: form.subscription.pool_id });\n      }\n\n      if (!hasValidKey) {\n        if (form.pendo) {\n          await SettingsAPI.updateCategory('ui', {\n            PENDO_TRACKING_STATE: 'detailed',\n          });\n        } else {\n          await SettingsAPI.updateCategory('ui', {\n            PENDO_TRACKING_STATE: 'off',\n          });\n        }\n\n        if (form.insights) {\n          await SettingsAPI.updateCategory('system', {\n            INSIGHTS_TRACKING_STATE: true,\n          });\n        } else {\n          await SettingsAPI.updateCategory('system', {\n            INSIGHTS_TRACKING_STATE: false,\n          });\n        }\n      }\n\n      await updateConfig();\n\n      return true;\n    }, []) // eslint-disable-line react-hooks/exhaustive-deps\n  );\n\n  useEffect(() => {\n    if (submitSuccessful) {\n      setTimeout(() => {\n        history.push(\n          subscriptionMgmtRoute ? '/home' : '/settings/subscription/details'\n        );\n      }, 3000);\n    }\n  }, [submitSuccessful, history, subscriptionMgmtRoute]);\n\n  const { error, dismissError } = useDismissableError(submitError);\n  const handleSubmit = async (values) => {\n    dismissError();\n    await submitRequest(values);\n  };\n\n  if (isContentLoading) {\n    return <ContentLoading />;\n  }\n\n  if (contentError) {\n    return <ContentError />;\n  }\n\n  const steps = [\n    {\n      name: hasValidKey\n        ? t`Subscription Management`\n        : `${brandName} ${t`Subscription`}`,\n      id: 'subscription-step',\n      component: <SubscriptionStep />,\n    },\n    ...(!hasValidKey\n      ? [\n          {\n            name: t`User and Automation Analytics`,\n            id: 'analytics-step',\n            component: <AnalyticsStep />,\n          },\n        ]\n      : []),\n    {\n      name: t`End user license agreement`,\n      component: <EulaStep />,\n      id: 'eula-step',\n      nextButtonText: t`Submit`,\n    },\n  ];\n\n  return (\n    <>\n      <Formik\n        initialValues={{\n          insights: true,\n          manifest_file: null,\n          manifest_filename: '',\n          pendo: true,\n          subscription: null,\n          password: '',\n          username: '',\n        }}\n        onSubmit={handleSubmit}\n      >\n        {(formik) => (\n          <Form\n            onSubmit={(e) => {\n              e.preventDefault();\n            }}\n          >\n            <Wizard\n              steps={steps}\n              onSave={formik.handleSubmit}\n              footer={<CustomFooter isSubmitLoading={submitLoading} />}\n              height=\"fit-content\"\n            />\n            {error && (\n              <div style={{ margin: '0 24px 24px 24px' }}>\n                <FormSubmitError error={error} />\n              </div>\n            )}\n          </Form>\n        )}\n      </Formik>\n      <AlertGroup isToast>\n        {submitSuccessful && (\n          <Alert\n            variant=\"success\"\n            title={t`Save successful!`}\n            ouiaId=\"success-alert\"\n          >\n            {subscriptionMgmtRoute ? (\n              <Link to=\"/home\">\n                <Trans>Redirecting to dashboard</Trans>\n              </Link>\n            ) : (\n              <Link to=\"/settings/subscription/details\">\n                <Trans>Redirecting to subscription detail</Trans>\n              </Link>\n            )}\n          </Alert>\n        )}\n      </AlertGroup>\n    </>\n  );\n}\n\nexport default SubscriptionEdit;\n"]},"metadata":{},"sourceType":"module"}