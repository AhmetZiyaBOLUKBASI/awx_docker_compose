{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import React,{useContext,useEffect,useState}from'react';import{Button,DropdownItem,Tooltip}from'@patternfly/react-core';import{KebabifiedContext}from'contexts/Kebabified';import{isJobRunning}from'util/jobs';import{Job}from'types';import AlertModal from'../AlertModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function cannotCancelBecausePermissions(job){return!job.summary_fields.user_capabilities.start&&isJobRunning(job.status);}function cannotCancelBecauseNotRunning(job){return!isJobRunning(job.status);}function JobListCancelButton(_ref){var jobsToCancel=_ref.jobsToCancel,onCancel=_ref.onCancel;var _useContext=useContext(KebabifiedContext),isKebabified=_useContext.isKebabified,onKebabModalChange=_useContext.onKebabModalChange;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isModalOpen=_useState2[0],setIsModalOpen=_useState2[1];var numJobsToCancel=jobsToCancel.length;var handleCancelJob=function handleCancelJob(){onCancel();toggleModal();};var toggleModal=function toggleModal(){setIsModalOpen(!isModalOpen);};useEffect(function(){if(isKebabified){onKebabModalChange(isModalOpen);}},[isKebabified,isModalOpen,onKebabModalChange]);var renderTooltip=function renderTooltip(){var cannotCancelPermissions=jobsToCancel.filter(cannotCancelBecausePermissions).map(function(job){return job.name;});var cannotCancelNotRunning=jobsToCancel.filter(cannotCancelBecauseNotRunning).map(function(job){return job.name;});var numJobsUnableToCancel=cannotCancelPermissions.concat(cannotCancelNotRunning).length;if(numJobsUnableToCancel>0){return/*#__PURE__*/_jsxs(\"div\",{children:[cannotCancelPermissions.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Trans,{id:\"{0, plural, one {You do not have permission to cancel the following job:} other {You do not have permission to cancel the following jobs:}}\",values:{0:cannotCancelPermissions.length}}),cannotCancelPermissions.map(function(job,i){return/*#__PURE__*/_jsxs(\"strong\",{children:[' ',job,i!==cannotCancelPermissions.length-1?',':'']},job);})]}),cannotCancelNotRunning.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Trans,{id:\"{0, plural, one {You cannot cancel the following job because it is not running:} other {You cannot cancel the following jobs because they are not running:}}\",values:{0:cannotCancelNotRunning.length}}),cannotCancelNotRunning.map(function(job,i){return/*#__PURE__*/_jsxs(\"strong\",{children:[' ',job,i!==cannotCancelNotRunning.length-1?',':'']},job);})]})]});}if(numJobsToCancel>0){return/*#__PURE__*/_jsx(Trans,{id:\"{numJobsToCancel, plural, one {{0}} other {{1}}}\",values:{0:/*i18n*/i18n._(\"Cancel selected job\"),1:/*i18n*/i18n._(\"Cancel selected jobs\"),numJobsToCancel:numJobsToCancel}});}return(/*i18n*/i18n._(\"Select a job to cancel\"));};var isDisabled=jobsToCancel.length===0||jobsToCancel.some(cannotCancelBecausePermissions)||jobsToCancel.some(cannotCancelBecauseNotRunning);var cancelJobText=/*#__PURE__*/_jsx(Trans,{id:\"{numJobsToCancel, plural, one {Cancel job} other {Cancel jobs}}\",values:{numJobsToCancel:numJobsToCancel}});return/*#__PURE__*/_jsxs(_Fragment,{children:[isKebabified?/*#__PURE__*/_jsx(DropdownItem,{isDisabled:isDisabled,component:\"button\",\"aria-labelledby\":\"jobs-list-cancel-button\",onClick:toggleModal,ouiaId:\"cancel-job-dropdown-item\",children:cancelJobText},\"cancel-job\"):/*#__PURE__*/_jsx(Tooltip,{content:renderTooltip(),position:\"top\",children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Button,{id:\"jobs-list-cancel-button\",ouiaId:\"cancel-job-button\",variant:\"secondary\",\"aria-labelledby\":\"jobs-list-cancel-button\",onClick:toggleModal,isDisabled:isDisabled,children:cancelJobText})})}),isModalOpen&&/*#__PURE__*/_jsxs(AlertModal,{variant:\"danger\",title:cancelJobText,isOpen:isModalOpen,onClose:toggleModal,actions:[/*#__PURE__*/_jsx(Button,{ouiaId:\"cancel-job-confirm-button\",id:\"cancel-job-confirm-button\",variant:\"danger\",\"aria-labelledby\":\"cancel-job-confirm-button\",onClick:handleCancelJob,children:cancelJobText},\"delete\"),/*#__PURE__*/_jsx(Button,{ouiaId:\"cancel-job-return-button\",id:\"cancel-job-return-button\",variant:\"secondary\",\"aria-label\":/*i18n*/i18n._(\"Return\"),onClick:toggleModal,children:/*i18n*/i18n._(\"Return\")},\"cancel\")],children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Trans,{id:\"{numJobsToCancel, plural, one {This action will cancel the following job:} other {This action will cancel the following jobs:}}\",values:{numJobsToCancel:numJobsToCancel}})}),jobsToCancel.map(function(job){return/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:job.name}),/*#__PURE__*/_jsx(\"br\",{})]},job.id);})]})]});}JobListCancelButton.defaultProps={jobsToCancel:[],onCancel:function onCancel(){}};export default JobListCancelButton;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/JobList/JobListCancelButton.js"],"names":["React","useContext","useEffect","useState","Button","DropdownItem","Tooltip","KebabifiedContext","isJobRunning","Job","AlertModal","cannotCancelBecausePermissions","job","summary_fields","user_capabilities","start","status","cannotCancelBecauseNotRunning","JobListCancelButton","jobsToCancel","onCancel","isKebabified","onKebabModalChange","isModalOpen","setIsModalOpen","numJobsToCancel","length","handleCancelJob","toggleModal","renderTooltip","cannotCancelPermissions","filter","map","name","cannotCancelNotRunning","numJobsUnableToCancel","concat","i","isDisabled","some","cancelJobText","id","defaultProps"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\n\nimport { t, Plural } from '@lingui/macro';\nimport { arrayOf, func } from 'prop-types';\nimport { Button, DropdownItem, Tooltip } from '@patternfly/react-core';\nimport { KebabifiedContext } from 'contexts/Kebabified';\nimport { isJobRunning } from 'util/jobs';\nimport { Job } from 'types';\nimport AlertModal from '../AlertModal';\n\nfunction cannotCancelBecausePermissions(job) {\n  return (\n    !job.summary_fields.user_capabilities.start && isJobRunning(job.status)\n  );\n}\n\nfunction cannotCancelBecauseNotRunning(job) {\n  return !isJobRunning(job.status);\n}\n\nfunction JobListCancelButton({ jobsToCancel, onCancel }) {\n  const { isKebabified, onKebabModalChange } = useContext(KebabifiedContext);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const numJobsToCancel = jobsToCancel.length;\n\n  const handleCancelJob = () => {\n    onCancel();\n    toggleModal();\n  };\n\n  const toggleModal = () => {\n    setIsModalOpen(!isModalOpen);\n  };\n\n  useEffect(() => {\n    if (isKebabified) {\n      onKebabModalChange(isModalOpen);\n    }\n  }, [isKebabified, isModalOpen, onKebabModalChange]);\n\n  const renderTooltip = () => {\n    const cannotCancelPermissions = jobsToCancel\n      .filter(cannotCancelBecausePermissions)\n      .map((job) => job.name);\n    const cannotCancelNotRunning = jobsToCancel\n      .filter(cannotCancelBecauseNotRunning)\n      .map((job) => job.name);\n    const numJobsUnableToCancel = cannotCancelPermissions.concat(\n      cannotCancelNotRunning\n    ).length;\n    if (numJobsUnableToCancel > 0) {\n      return (\n        <div>\n          {cannotCancelPermissions.length > 0 && (\n            <div>\n              <Plural\n                value={cannotCancelPermissions.length}\n                one=\"You do not have permission to cancel the following job:\"\n                other=\"You do not have permission to cancel the following jobs:\"\n              />\n              {cannotCancelPermissions.map((job, i) => (\n                <strong key={job}>\n                  {' '}\n                  {job}\n                  {i !== cannotCancelPermissions.length - 1 ? ',' : ''}\n                </strong>\n              ))}\n            </div>\n          )}\n          {cannotCancelNotRunning.length > 0 && (\n            <div>\n              <Plural\n                value={cannotCancelNotRunning.length}\n                one=\"You cannot cancel the following job because it is not running:\"\n                other=\"You cannot cancel the following jobs because they are not running:\"\n              />\n              {cannotCancelNotRunning.map((job, i) => (\n                <strong key={job}>\n                  {' '}\n                  {job}\n                  {i !== cannotCancelNotRunning.length - 1 ? ',' : ''}\n                </strong>\n              ))}\n            </div>\n          )}\n        </div>\n      );\n    }\n    if (numJobsToCancel > 0) {\n      return (\n        <Plural\n          value={numJobsToCancel}\n          one={t`Cancel selected job`}\n          other={t`Cancel selected jobs`}\n        />\n      );\n    }\n    return t`Select a job to cancel`;\n  };\n\n  const isDisabled =\n    jobsToCancel.length === 0 ||\n    jobsToCancel.some(cannotCancelBecausePermissions) ||\n    jobsToCancel.some(cannotCancelBecauseNotRunning);\n  const cancelJobText = (\n    <Plural value={numJobsToCancel} one=\"Cancel job\" other=\"Cancel jobs\" />\n  );\n\n  return (\n    <>\n      {isKebabified ? (\n        <DropdownItem\n          key=\"cancel-job\"\n          isDisabled={isDisabled}\n          component=\"button\"\n          aria-labelledby=\"jobs-list-cancel-button\"\n          onClick={toggleModal}\n          ouiaId=\"cancel-job-dropdown-item\"\n        >\n          {cancelJobText}\n        </DropdownItem>\n      ) : (\n        <Tooltip content={renderTooltip()} position=\"top\">\n          <div>\n            <Button\n              id=\"jobs-list-cancel-button\"\n              ouiaId=\"cancel-job-button\"\n              variant=\"secondary\"\n              aria-labelledby=\"jobs-list-cancel-button\"\n              onClick={toggleModal}\n              isDisabled={isDisabled}\n            >\n              {cancelJobText}\n            </Button>\n          </div>\n        </Tooltip>\n      )}\n      {isModalOpen && (\n        <AlertModal\n          variant=\"danger\"\n          title={cancelJobText}\n          isOpen={isModalOpen}\n          onClose={toggleModal}\n          actions={[\n            <Button\n              ouiaId=\"cancel-job-confirm-button\"\n              id=\"cancel-job-confirm-button\"\n              key=\"delete\"\n              variant=\"danger\"\n              aria-labelledby=\"cancel-job-confirm-button\"\n              onClick={handleCancelJob}\n            >\n              {cancelJobText}\n            </Button>,\n            <Button\n              ouiaId=\"cancel-job-return-button\"\n              id=\"cancel-job-return-button\"\n              key=\"cancel\"\n              variant=\"secondary\"\n              aria-label={t`Return`}\n              onClick={toggleModal}\n            >\n              {t`Return`}\n            </Button>,\n          ]}\n        >\n          <div>\n            <Plural\n              value={numJobsToCancel}\n              one=\"This action will cancel the following job:\"\n              other=\"This action will cancel the following jobs:\"\n            />\n          </div>\n          {jobsToCancel.map((job) => (\n            <span key={job.id}>\n              <strong>{job.name}</strong>\n              <br />\n            </span>\n          ))}\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nJobListCancelButton.propTypes = {\n  jobsToCancel: arrayOf(Job),\n  onCancel: func,\n};\n\nJobListCancelButton.defaultProps = {\n  jobsToCancel: [],\n  onCancel: () => {},\n};\n\nexport default JobListCancelButton;\n"]},"metadata":{},"sourceType":"module"}