{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback,useState}from'react';import{useLocation,useParams,Link}from'react-router-dom';import{DropdownItem}from'@patternfly/react-core';import{getQSConfig,mergeParams,parseQueryString}from'util/qs';import{GroupsAPI,InventoriesAPI}from'api';import useRequest,{useDeleteItems,useDismissableError}from'hooks/useRequest';import useSelected from'hooks/useSelected';import AlertModal from'components/AlertModal';import DataListToolbar from'components/DataListToolbar';import ErrorDetail from'components/ErrorDetail';import PaginatedTable,{HeaderCell,HeaderRow,getSearchableKeys}from'components/PaginatedTable';import AssociateModal from'components/AssociateModal';import DisassociateButton from'components/DisassociateButton';import AdHocCommands from'components/AdHocCommands/AdHocCommands';import AddDropDownButton from'components/AddDropDownButton';import InventoryGroupHostListItem from'./InventoryGroupHostListItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('host',{page:1,page_size:20,order_by:'name'});function InventoryGroupHostList(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isAdHocLaunchLoading=_useState2[0],setIsAdHocLaunchLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isModalOpen=_useState4[0],setIsModalOpen=_useState4[1];var _useParams=useParams(),inventoryId=_useParams.id,groupId=_useParams.groupId;var location=useLocation();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,response,actionsResponse,options;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,location.search);_context.next=3;return Promise.all([GroupsAPI.readAllHosts(groupId,params),InventoriesAPI.readHostsOptions(inventoryId),InventoriesAPI.readAdHocOptions(inventoryId)]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,3);response=_yield$Promise$all2[0];actionsResponse=_yield$Promise$all2[1];options=_yield$Promise$all2[2];return _context.abrupt(\"return\",{moduleOptions:options.data.actions.GET.module_name.choices,isAdHocDisabled:!options.data.actions.POST,hosts:response.data.results,hostCount:response.data.count,actions:actionsResponse.data.actions,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 9:case\"end\":return _context.stop();}}},_callee);})),[groupId,inventoryId,location.search]),{moduleOptions:[],isAdHocDisabled:true,hosts:[],hostCount:0,actions:{},relatedSearchableKeys:[],searchableKeys:[]}),_useRequest$result=_useRequest.result,hosts=_useRequest$result.hosts,hostCount=_useRequest$result.hostCount,actions=_useRequest$result.actions,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,moduleOptions=_useRequest$result.moduleOptions,isAdHocDisabled=_useRequest$result.isAdHocDisabled,contentError=_useRequest.error,isLoading=_useRequest.isLoading,fetchHosts=_useRequest.request;var _useSelected=useSelected(hosts),selected=_useSelected.selected,isAllSelected=_useSelected.isAllSelected,handleSelect=_useSelected.handleSelect,setSelected=_useSelected.setSelected;useEffect(function(){fetchHosts();},[fetchHosts]);var _useDeleteItems=useDeleteItems(useCallback(function(){return Promise.all(selected.map(function(host){return GroupsAPI.disassociateHost(groupId,host);}));},[groupId,selected]),{qsConfig:QS_CONFIG,allItemsSelected:isAllSelected,fetchItems:fetchHosts}),isDisassociateLoading=_useDeleteItems.isLoading,disassociateHosts=_useDeleteItems.deleteItems,disassociateErr=_useDeleteItems.deletionError;var handleDisassociate=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return disassociateHosts();case 2:setSelected([]);case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleDisassociate(){return _ref2.apply(this,arguments);};}();var fetchHostsToAssociate=useCallback(function(params){return InventoriesAPI.readHosts(inventoryId,mergeParams(params,{not__groups:groupId}));},[groupId,inventoryId]);var fetchHostsOptions=useCallback(function(){return InventoriesAPI.readHostsOptions(inventoryId);},[inventoryId]);var _useRequest2=useRequest(useCallback(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(hostsToAssociate){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return Promise.all(hostsToAssociate.map(function(host){return GroupsAPI.associateHost(groupId,host.id);}));case 2:fetchHosts();case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x){return _ref3.apply(this,arguments);};}(),[groupId,fetchHosts])),handleAssociate=_useRequest2.request,associateErr=_useRequest2.error;var _useDismissableError=useDismissableError(associateErr),associateError=_useDismissableError.error,dismissAssociateError=_useDismissableError.dismissError;var _useDismissableError2=useDismissableError(disassociateErr),disassociateError=_useDismissableError2.error,dismissDisassociateError=_useDismissableError2.dismissError;var canAdd=actions&&Object.prototype.hasOwnProperty.call(actions,'POST');var addFormUrl=\"/inventories/inventory/\".concat(inventoryId,\"/groups/\").concat(groupId,\"/nested_hosts/add\");var addExistingHost=/*i18n*/i18n._(\"Add existing host\");var addNewHost=/*i18n*/i18n._(\"Add new host\");var addButton=/*#__PURE__*/_jsx(AddDropDownButton,{ouiaId:\"add-hosts-button\",dropdownItems:[/*#__PURE__*/_jsx(DropdownItem,{onClick:function onClick(){return setIsModalOpen(true);},\"aria-label\":addExistingHost,ouiaId:\"add-existing-host-dropdown-item\",children:addExistingHost},addExistingHost),/*#__PURE__*/_jsx(DropdownItem,{component:Link,to:\"\".concat(addFormUrl),\"aria-label\":addNewHost,ouiaId:\"add-new-host-dropdown-item\",children:addNewHost},addNewHost)]},\"add\");return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PaginatedTable,{contentError:contentError,hasContentLoading:isLoading||isDisassociateLoading||isAdHocLaunchLoading,items:hosts,itemCount:hostCount,pluralizedItemName:/*i18n*/i18n._(\"Hosts\"),qsConfig:QS_CONFIG,onRowClick:handleSelect,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username__icontains'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username__icontains'}],toolbarSortColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name'}],headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"description\",children:/*i18n*/i18n._(\"Description\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Activity\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Actions\")})]}),toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{isAllSelected:isAllSelected,onSelectAll:function onSelectAll(isSelected){return setSelected(isSelected?_toConsumableArray(hosts):[]);},qsConfig:QS_CONFIG,additionalControls:[].concat(_toConsumableArray(canAdd?[addButton]:[]),_toConsumableArray(!isAdHocDisabled?[/*#__PURE__*/_jsx(AdHocCommands,{adHocItems:selected,hasListItems:hostCount>0,moduleOptions:moduleOptions,onLaunchLoading:setIsAdHocLaunchLoading})]:[]),[/*#__PURE__*/_jsx(DisassociateButton,{onDisassociate:handleDisassociate,itemsToDisassociate:selected,modalTitle:/*i18n*/i18n._(\"Disassociate host from group?\"),modalNote:/*i18n*/i18n._(\"Note that only hosts directly in this group can\\nbe disassociated. Hosts in sub-groups must be disassociated\\ndirectly from the sub-group level that they belong.\")},\"disassociate\")])}));},renderRow:function renderRow(host,index){return/*#__PURE__*/_jsx(InventoryGroupHostListItem,{rowIndex:index,host:host,detailUrl:\"/inventories/inventory/\".concat(inventoryId,\"/hosts/\").concat(host.id,\"/details\"),editUrl:\"/inventories/inventory/\".concat(inventoryId,\"/hosts/\").concat(host.id,\"/edit\"),isSelected:selected.some(function(row){return row.id===host.id;}),onSelect:function onSelect(){return handleSelect(host);}},host.id);},emptyStateControls:canAdd&&addButton}),isModalOpen&&/*#__PURE__*/_jsx(AssociateModal,{header:/*i18n*/i18n._(\"Hosts\"),fetchRequest:fetchHostsToAssociate,optionsRequest:fetchHostsOptions,isModalOpen:isModalOpen,onAssociate:handleAssociate,onClose:function onClose(){return setIsModalOpen(false);},title:/*i18n*/i18n._(\"Select Hosts\")}),associateError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:associateError,onClose:dismissAssociateError,title:/*i18n*/i18n._(\"Error!\"),variant:\"error\",children:[/*i18n*/i18n._(\"Failed to associate.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:associateError})]}),disassociateError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:disassociateError,onClose:dismissDisassociateError,title:/*i18n*/i18n._(\"Error!\"),variant:\"error\",children:[/*i18n*/i18n._(\"Failed to disassociate one or more hosts.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:disassociateError})]})]});}export default InventoryGroupHostList;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Inventory/InventoryGroupHosts/InventoryGroupHostList.js"],"names":["React","useEffect","useCallback","useState","useLocation","useParams","Link","DropdownItem","getQSConfig","mergeParams","parseQueryString","GroupsAPI","InventoriesAPI","useRequest","useDeleteItems","useDismissableError","useSelected","AlertModal","DataListToolbar","ErrorDetail","PaginatedTable","HeaderCell","HeaderRow","getSearchableKeys","AssociateModal","DisassociateButton","AdHocCommands","AddDropDownButton","InventoryGroupHostListItem","QS_CONFIG","page","page_size","order_by","InventoryGroupHostList","isAdHocLaunchLoading","setIsAdHocLaunchLoading","isModalOpen","setIsModalOpen","inventoryId","id","groupId","location","params","search","Promise","all","readAllHosts","readHostsOptions","readAdHocOptions","response","actionsResponse","options","moduleOptions","data","actions","GET","module_name","choices","isAdHocDisabled","POST","hosts","results","hostCount","count","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","result","contentError","error","isLoading","fetchHosts","request","selected","isAllSelected","handleSelect","setSelected","host","disassociateHost","qsConfig","allItemsSelected","fetchItems","isDisassociateLoading","disassociateHosts","deleteItems","disassociateErr","deletionError","handleDisassociate","fetchHostsToAssociate","readHosts","not__groups","fetchHostsOptions","hostsToAssociate","associateHost","handleAssociate","associateErr","associateError","dismissAssociateError","dismissError","disassociateError","dismissDisassociateError","canAdd","Object","prototype","hasOwnProperty","call","addFormUrl","addExistingHost","addNewHost","addButton","name","key","isDefault","props","isSelected","index","some","row"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback, useState } from 'react';\nimport { useLocation, useParams, Link } from 'react-router-dom';\n\nimport { t } from '@lingui/macro';\nimport { DropdownItem } from '@patternfly/react-core';\nimport { getQSConfig, mergeParams, parseQueryString } from 'util/qs';\nimport { GroupsAPI, InventoriesAPI } from 'api';\n\nimport useRequest, {\n  useDeleteItems,\n  useDismissableError,\n} from 'hooks/useRequest';\nimport useSelected from 'hooks/useSelected';\nimport AlertModal from 'components/AlertModal';\nimport DataListToolbar from 'components/DataListToolbar';\nimport ErrorDetail from 'components/ErrorDetail';\nimport PaginatedTable, {\n  HeaderCell,\n  HeaderRow,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\nimport AssociateModal from 'components/AssociateModal';\nimport DisassociateButton from 'components/DisassociateButton';\nimport AdHocCommands from 'components/AdHocCommands/AdHocCommands';\nimport AddDropDownButton from 'components/AddDropDownButton';\nimport InventoryGroupHostListItem from './InventoryGroupHostListItem';\n\nconst QS_CONFIG = getQSConfig('host', {\n  page: 1,\n  page_size: 20,\n  order_by: 'name',\n});\n\nfunction InventoryGroupHostList() {\n  const [isAdHocLaunchLoading, setIsAdHocLaunchLoading] = useState(false);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const { id: inventoryId, groupId } = useParams();\n  const location = useLocation();\n\n  const {\n    result: {\n      hosts,\n      hostCount,\n      actions,\n      relatedSearchableKeys,\n      searchableKeys,\n      moduleOptions,\n      isAdHocDisabled,\n    },\n    error: contentError,\n    isLoading,\n    request: fetchHosts,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, location.search);\n      const [response, actionsResponse, options] = await Promise.all([\n        GroupsAPI.readAllHosts(groupId, params),\n        InventoriesAPI.readHostsOptions(inventoryId),\n        InventoriesAPI.readAdHocOptions(inventoryId),\n      ]);\n\n      return {\n        moduleOptions: options.data.actions.GET.module_name.choices,\n        isAdHocDisabled: !options.data.actions.POST,\n        hosts: response.data.results,\n        hostCount: response.data.count,\n        actions: actionsResponse.data.actions,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [groupId, inventoryId, location.search]),\n    {\n      moduleOptions: [],\n      isAdHocDisabled: true,\n      hosts: [],\n      hostCount: 0,\n      actions: {},\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  const { selected, isAllSelected, handleSelect, setSelected } =\n    useSelected(hosts);\n\n  useEffect(() => {\n    fetchHosts();\n  }, [fetchHosts]);\n\n  const {\n    isLoading: isDisassociateLoading,\n    deleteItems: disassociateHosts,\n    deletionError: disassociateErr,\n  } = useDeleteItems(\n    useCallback(\n      () =>\n        Promise.all(\n          selected.map((host) => GroupsAPI.disassociateHost(groupId, host))\n        ),\n      [groupId, selected]\n    ),\n    {\n      qsConfig: QS_CONFIG,\n      allItemsSelected: isAllSelected,\n      fetchItems: fetchHosts,\n    }\n  );\n\n  const handleDisassociate = async () => {\n    await disassociateHosts();\n    setSelected([]);\n  };\n\n  const fetchHostsToAssociate = useCallback(\n    (params) =>\n      InventoriesAPI.readHosts(\n        inventoryId,\n        mergeParams(params, { not__groups: groupId })\n      ),\n    [groupId, inventoryId]\n  );\n\n  const fetchHostsOptions = useCallback(\n    () => InventoriesAPI.readHostsOptions(inventoryId),\n    [inventoryId]\n  );\n\n  const { request: handleAssociate, error: associateErr } = useRequest(\n    useCallback(\n      async (hostsToAssociate) => {\n        await Promise.all(\n          hostsToAssociate.map((host) =>\n            GroupsAPI.associateHost(groupId, host.id)\n          )\n        );\n        fetchHosts();\n      },\n      [groupId, fetchHosts]\n    )\n  );\n\n  const { error: associateError, dismissError: dismissAssociateError } =\n    useDismissableError(associateErr);\n  const { error: disassociateError, dismissError: dismissDisassociateError } =\n    useDismissableError(disassociateErr);\n\n  const canAdd =\n    actions && Object.prototype.hasOwnProperty.call(actions, 'POST');\n  const addFormUrl = `/inventories/inventory/${inventoryId}/groups/${groupId}/nested_hosts/add`;\n  const addExistingHost = t`Add existing host`;\n  const addNewHost = t`Add new host`;\n\n  const addButton = (\n    <AddDropDownButton\n      ouiaId=\"add-hosts-button\"\n      key=\"add\"\n      dropdownItems={[\n        <DropdownItem\n          onClick={() => setIsModalOpen(true)}\n          key={addExistingHost}\n          aria-label={addExistingHost}\n          ouiaId=\"add-existing-host-dropdown-item\"\n        >\n          {addExistingHost}\n        </DropdownItem>,\n        <DropdownItem\n          component={Link}\n          to={`${addFormUrl}`}\n          key={addNewHost}\n          aria-label={addNewHost}\n          ouiaId=\"add-new-host-dropdown-item\"\n        >\n          {addNewHost}\n        </DropdownItem>,\n      ]}\n    />\n  );\n  return (\n    <>\n      <PaginatedTable\n        contentError={contentError}\n        hasContentLoading={\n          isLoading || isDisassociateLoading || isAdHocLaunchLoading\n        }\n        items={hosts}\n        itemCount={hostCount}\n        pluralizedItemName={t`Hosts`}\n        qsConfig={QS_CONFIG}\n        onRowClick={handleSelect}\n        toolbarSearchColumns={[\n          {\n            name: t`Name`,\n            key: 'name__icontains',\n            isDefault: true,\n          },\n          {\n            name: t`Created By (Username)`,\n            key: 'created_by__username__icontains',\n          },\n          {\n            name: t`Modified By (Username)`,\n            key: 'modified_by__username__icontains',\n          },\n        ]}\n        toolbarSortColumns={[\n          {\n            name: t`Name`,\n            key: 'name',\n          },\n        ]}\n        headerRow={\n          <HeaderRow qsConfig={QS_CONFIG}>\n            <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n            <HeaderCell sortKey=\"description\">{t`Description`}</HeaderCell>\n            <HeaderCell>{t`Activity`}</HeaderCell>\n            <HeaderCell>{t`Actions`}</HeaderCell>\n          </HeaderRow>\n        }\n        toolbarSearchableKeys={searchableKeys}\n        toolbarRelatedSearchableKeys={relatedSearchableKeys}\n        renderToolbar={(props) => (\n          <DataListToolbar\n            {...props}\n            isAllSelected={isAllSelected}\n            onSelectAll={(isSelected) =>\n              setSelected(isSelected ? [...hosts] : [])\n            }\n            qsConfig={QS_CONFIG}\n            additionalControls={[\n              ...(canAdd ? [addButton] : []),\n              ...(!isAdHocDisabled\n                ? [\n                    <AdHocCommands\n                      adHocItems={selected}\n                      hasListItems={hostCount > 0}\n                      moduleOptions={moduleOptions}\n                      onLaunchLoading={setIsAdHocLaunchLoading}\n                    />,\n                  ]\n                : []),\n              <DisassociateButton\n                key=\"disassociate\"\n                onDisassociate={handleDisassociate}\n                itemsToDisassociate={selected}\n                modalTitle={t`Disassociate host from group?`}\n                modalNote={t`\n                        Note that only hosts directly in this group can\n                        be disassociated. Hosts in sub-groups must be disassociated\n                        directly from the sub-group level that they belong.\n                      `}\n              />,\n            ]}\n          />\n        )}\n        renderRow={(host, index) => (\n          <InventoryGroupHostListItem\n            key={host.id}\n            rowIndex={index}\n            host={host}\n            detailUrl={`/inventories/inventory/${inventoryId}/hosts/${host.id}/details`}\n            editUrl={`/inventories/inventory/${inventoryId}/hosts/${host.id}/edit`}\n            isSelected={selected.some((row) => row.id === host.id)}\n            onSelect={() => handleSelect(host)}\n          />\n        )}\n        emptyStateControls={canAdd && addButton}\n      />\n      {isModalOpen && (\n        <AssociateModal\n          header={t`Hosts`}\n          fetchRequest={fetchHostsToAssociate}\n          optionsRequest={fetchHostsOptions}\n          isModalOpen={isModalOpen}\n          onAssociate={handleAssociate}\n          onClose={() => setIsModalOpen(false)}\n          title={t`Select Hosts`}\n        />\n      )}\n      {associateError && (\n        <AlertModal\n          isOpen={associateError}\n          onClose={dismissAssociateError}\n          title={t`Error!`}\n          variant=\"error\"\n        >\n          {t`Failed to associate.`}\n          <ErrorDetail error={associateError} />\n        </AlertModal>\n      )}\n      {disassociateError && (\n        <AlertModal\n          isOpen={disassociateError}\n          onClose={dismissDisassociateError}\n          title={t`Error!`}\n          variant=\"error\"\n        >\n          {t`Failed to disassociate one or more hosts.`}\n          <ErrorDetail error={disassociateError} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nexport default InventoryGroupHostList;\n"]},"metadata":{},"sourceType":"module"}