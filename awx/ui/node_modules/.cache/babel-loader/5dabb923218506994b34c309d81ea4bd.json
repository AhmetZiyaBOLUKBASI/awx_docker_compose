{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{withRouter}from'react-router-dom';import{FormGroup}from'@patternfly/react-core';import{InstanceGroupsAPI}from'api';import{InstanceGroup}from'types';import{getSearchableKeys}from'components/PaginatedTable';import{getQSConfig,parseQueryString}from'util/qs';import useRequest from'hooks/useRequest';import Popover from'../Popover';import OptionsList from'../OptionsList';import Lookup from'./Lookup';import LookupErrorMessage from'./shared/LookupErrorMessage';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('instance-groups',{page:1,page_size:5,order_by:'name'});function InstanceGroupsLookup(_ref){var value=_ref.value,onChange=_ref.onChange,tooltip=_ref.tooltip,className=_ref.className,required=_ref.required,history=_ref.history,fieldName=_ref.fieldName,validate=_ref.validate;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,data,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,history.location.search);_context.next=3;return Promise.all([InstanceGroupsAPI.read(params),InstanceGroupsAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);data=_yield$Promise$all2[0].data;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{instanceGroups:data.results,count:data.count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 8:case\"end\":return _context.stop();}}},_callee);})),[history.location]),{instanceGroups:[],count:0,relatedSearchableKeys:[],searchableKeys:[]}),_useRequest$result=_useRequest.result,instanceGroups=_useRequest$result.instanceGroups,count=_useRequest$result.count,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,fetchInstanceGroups=_useRequest.request,error=_useRequest.error,isLoading=_useRequest.isLoading;useEffect(function(){fetchInstanceGroups();},[fetchInstanceGroups]);return/*#__PURE__*/_jsxs(FormGroup,{className:className,label:/*i18n*/i18n._(\"Instance Groups\"),labelIcon:tooltip&&/*#__PURE__*/_jsx(Popover,{content:tooltip}),fieldId:\"org-instance-groups\",children:[/*#__PURE__*/_jsx(Lookup,{id:\"org-instance-groups\",header:/*i18n*/i18n._(\"Instance Groups\"),value:value,onChange:onChange,onUpdate:fetchInstanceGroups,fieldName:fieldName,validate:validate,qsConfig:QS_CONFIG,multiple:true,required:required,isLoading:isLoading,modalDescription:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"b\",{children:/*#__PURE__*/_jsx(Trans,{id:\"Selected\"})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Trans,{id:\"Note: The order in which these are selected sets the execution precedence. Select more than one to enable drag.\"})]}),renderOptionsList:function renderOptionsList(_ref3){var state=_ref3.state,dispatch=_ref3.dispatch,canDelete=_ref3.canDelete;return/*#__PURE__*/_jsx(OptionsList,{value:state.selectedItems,options:instanceGroups,optionCount:count,searchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Credential Name\"),key:'credential__name__icontains'}],sortColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name'}],searchableKeys:searchableKeys,relatedSearchableKeys:relatedSearchableKeys,multiple:state.multiple,header:/*i18n*/i18n._(\"Instance Groups\"),name:\"instanceGroups\",qsConfig:QS_CONFIG,readOnly:!canDelete,selectItem:function selectItem(item){return dispatch({type:'SELECT_ITEM',item:item});},deselectItem:function deselectItem(item){return dispatch({type:'DESELECT_ITEM',item:item});},sortSelectedItems:function sortSelectedItems(selectedItems){return dispatch({type:'SET_SELECTED_ITEMS',selectedItems:selectedItems});},isSelectedDraggable:true});}}),/*#__PURE__*/_jsx(LookupErrorMessage,{error:error})]});}InstanceGroupsLookup.defaultProps={tooltip:'',className:'',required:false,validate:function validate(){return undefined;},fieldName:'instance_groups'};export default withRouter(InstanceGroupsLookup);","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/Lookup/InstanceGroupsLookup.js"],"names":["React","useCallback","useEffect","withRouter","FormGroup","InstanceGroupsAPI","InstanceGroup","getSearchableKeys","getQSConfig","parseQueryString","useRequest","Popover","OptionsList","Lookup","LookupErrorMessage","QS_CONFIG","page","page_size","order_by","InstanceGroupsLookup","value","onChange","tooltip","className","required","history","fieldName","validate","params","location","search","Promise","all","read","readOptions","data","actionsResponse","instanceGroups","results","count","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","result","fetchInstanceGroups","request","error","isLoading","state","dispatch","canDelete","selectedItems","name","key","isDefault","multiple","item","type","defaultProps","undefined"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { arrayOf, string, func, bool } from 'prop-types';\nimport { withRouter } from 'react-router-dom';\n\nimport { t, Trans } from '@lingui/macro';\nimport { FormGroup } from '@patternfly/react-core';\nimport { InstanceGroupsAPI } from 'api';\nimport { InstanceGroup } from 'types';\nimport { getSearchableKeys } from 'components/PaginatedTable';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport useRequest from 'hooks/useRequest';\nimport Popover from '../Popover';\nimport OptionsList from '../OptionsList';\nimport Lookup from './Lookup';\nimport LookupErrorMessage from './shared/LookupErrorMessage';\n\nconst QS_CONFIG = getQSConfig('instance-groups', {\n  page: 1,\n  page_size: 5,\n  order_by: 'name',\n});\n\nfunction InstanceGroupsLookup({\n  value,\n  onChange,\n  tooltip,\n  className,\n  required,\n  history,\n  fieldName,\n  validate,\n}) {\n  const {\n    result: { instanceGroups, count, relatedSearchableKeys, searchableKeys },\n    request: fetchInstanceGroups,\n    error,\n    isLoading,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, history.location.search);\n      const [{ data }, actionsResponse] = await Promise.all([\n        InstanceGroupsAPI.read(params),\n        InstanceGroupsAPI.readOptions(),\n      ]);\n      return {\n        instanceGroups: data.results,\n        count: data.count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [history.location]),\n    {\n      instanceGroups: [],\n      count: 0,\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchInstanceGroups();\n  }, [fetchInstanceGroups]);\n\n  return (\n    <FormGroup\n      className={className}\n      label={t`Instance Groups`}\n      labelIcon={tooltip && <Popover content={tooltip} />}\n      fieldId=\"org-instance-groups\"\n    >\n      <Lookup\n        id=\"org-instance-groups\"\n        header={t`Instance Groups`}\n        value={value}\n        onChange={onChange}\n        onUpdate={fetchInstanceGroups}\n        fieldName={fieldName}\n        validate={validate}\n        qsConfig={QS_CONFIG}\n        multiple\n        required={required}\n        isLoading={isLoading}\n        modalDescription={\n          <>\n            <b>\n              <Trans>Selected</Trans>\n            </b>\n            <br />\n            <Trans>\n              Note: The order in which these are selected sets the execution\n              precedence. Select more than one to enable drag.\n            </Trans>\n          </>\n        }\n        renderOptionsList={({ state, dispatch, canDelete }) => (\n          <OptionsList\n            value={state.selectedItems}\n            options={instanceGroups}\n            optionCount={count}\n            searchColumns={[\n              {\n                name: t`Name`,\n                key: 'name__icontains',\n                isDefault: true,\n              },\n              {\n                name: t`Credential Name`,\n                key: 'credential__name__icontains',\n              },\n            ]}\n            sortColumns={[\n              {\n                name: t`Name`,\n                key: 'name',\n              },\n            ]}\n            searchableKeys={searchableKeys}\n            relatedSearchableKeys={relatedSearchableKeys}\n            multiple={state.multiple}\n            header={t`Instance Groups`}\n            name=\"instanceGroups\"\n            qsConfig={QS_CONFIG}\n            readOnly={!canDelete}\n            selectItem={(item) => dispatch({ type: 'SELECT_ITEM', item })}\n            deselectItem={(item) => dispatch({ type: 'DESELECT_ITEM', item })}\n            sortSelectedItems={(selectedItems) =>\n              dispatch({ type: 'SET_SELECTED_ITEMS', selectedItems })\n            }\n            isSelectedDraggable\n          />\n        )}\n      />\n      <LookupErrorMessage error={error} />\n    </FormGroup>\n  );\n}\n\nInstanceGroupsLookup.propTypes = {\n  value: arrayOf(InstanceGroup).isRequired,\n  tooltip: string,\n  onChange: func.isRequired,\n  className: string,\n  required: bool,\n  validate: func,\n  fieldName: string,\n};\n\nInstanceGroupsLookup.defaultProps = {\n  tooltip: '',\n  className: '',\n  required: false,\n  validate: () => undefined,\n  fieldName: 'instance_groups',\n};\n\nexport default withRouter(InstanceGroupsLookup);\n"]},"metadata":{},"sourceType":"module"}