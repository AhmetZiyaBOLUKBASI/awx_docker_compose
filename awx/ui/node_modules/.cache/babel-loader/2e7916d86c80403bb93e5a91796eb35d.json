{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _styled from\"styled-components\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{Link,useHistory,useLocation}from'react-router-dom';import styled from'styled-components';import{Chip,Divider,Title,Button}from'@patternfly/react-core';import{Schedule}from'types';import{formatDateString}from'util/dates';import useRequest,{useDismissableError}from'hooks/useRequest';import{JobTemplatesAPI,SchedulesAPI,WorkflowJobTemplatesAPI}from'api';import{parseVariableField,jsonToYaml}from'util/yaml';import{useConfig}from'contexts/Config';import parseRuleObj from'../shared/parseRuleObj';import FrequencyDetails from'./FrequencyDetails';import AlertModal from'../../AlertModal';import{CardBody,CardActionsRow}from'../../Card';import ContentError from'../../ContentError';import ContentLoading from'../../ContentLoading';import CredentialChip from'../../CredentialChip';import{DetailList,Detail,UserDateDetail}from'../../DetailList';import ScheduleOccurrences from'../ScheduleOccurrences';import ScheduleToggle from'../ScheduleToggle';import DeleteButton from'../../DeleteButton';import ErrorDetail from'../../ErrorDetail';import ChipGroup from'../../ChipGroup';import{VariablesDetail}from'../../CodeEditor';import{VERBOSITY}from'../../VerbositySelectField';import helpText from'../../../screens/Template/shared/JobTemplate.helptext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var PromptDivider=styled(Divider).withConfig({displayName:\"ScheduleDetail__PromptDivider\",componentId:\"sc-1hz46k8-0\"})([\"margin-top:var(--pf-global--spacer--lg);margin-bottom:var(--pf-global--spacer--lg);\"]);var PromptTitle=styled(Title).withConfig({displayName:\"ScheduleDetail__PromptTitle\",componentId:\"sc-1hz46k8-1\"})([\"margin-top:40px;--pf-c-title--m-md--FontWeight:700;grid-column:1 / -1;\"]);var PromptDetailList=styled(DetailList).withConfig({displayName:\"ScheduleDetail__PromptDetailList\",componentId:\"sc-1hz46k8-2\"})([\"padding:0px 20px;\"]);var FrequencyDetailsContainer=styled.div.withConfig({displayName:\"ScheduleDetail__FrequencyDetailsContainer\",componentId:\"sc-1hz46k8-3\"})([\"background-color:var(--pf-global--palette--black-150);margin-top:var(--pf-global--spacer--lg);margin-bottom:var(--pf-global--spacer--lg);margin-right:calc(var(--pf-c-card--child--PaddingRight) * -1);margin-left:calc(var(--pf-c-card--child--PaddingLeft) * -1);padding:var(--pf-c-card--child--PaddingRight);& > p{margin-bottom:var(--pf-global--spacer--md);}& > *:not(:first-child):not(:last-child){margin-bottom:var(--pf-global--spacer--md);padding-bottom:var(--pf-global--spacer--md);border-bottom:1px solid var(--pf-global--palette--black-300);}\"]);var _StyledScheduleToggle=styled(ScheduleToggle).withConfig({displayName:\"ScheduleDetail___StyledScheduleToggle\",componentId:\"sc-1hz46k8-4\"})([\"padding-bottom:40px\"]);function ScheduleDetail(_ref){var _summary_fields$inven,_summary_fields$inven2,_summary_fields$inven3,_summary_fields$user_,_summary_fields$user_2;var hasDaysToKeepField=_ref.hasDaysToKeepField,schedule=_ref.schedule,surveyConfig=_ref.surveyConfig;var id=schedule.id,created=schedule.created,description=schedule.description,diff_mode=schedule.diff_mode,dtend=schedule.dtend,dtstart=schedule.dtstart,extra_data=schedule.extra_data,inventory=schedule.inventory,job_tags=schedule.job_tags,job_type=schedule.job_type,limit=schedule.limit,modified=schedule.modified,name=schedule.name,next_run=schedule.next_run,rrule=schedule.rrule,scm_branch=schedule.scm_branch,skip_tags=schedule.skip_tags,summary_fields=schedule.summary_fields,timezone=schedule.timezone,verbosity=schedule.verbosity;var history=useHistory();var _useLocation=useLocation(),pathname=_useLocation.pathname;var pathRoot=pathname.substr(0,pathname.indexOf('schedules'));var config=useConfig();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return SchedulesAPI.destroy(id);case 2:history.push(\"\".concat(pathRoot,\"schedules\"));case 3:case\"end\":return _context.stop();}}},_callee);})),[id,history,pathRoot])),deleteSchedule=_useRequest.request,isDeleteLoading=_useRequest.isLoading,deleteError=_useRequest.error;var _useDismissableError=useDismissableError(deleteError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;var _useRequest2=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _schedule$summary_fie,_schedule$summary_fie2,_schedule$summary_fie3,_schedule$summary_fie4;var promises,_yield$Promise$all,_yield$Promise$all2,data,schedulePreview,launch;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:promises=[SchedulesAPI.readCredentials(id),SchedulesAPI.createPreview({rrule:rrule})];if((schedule===null||schedule===void 0?void 0:(_schedule$summary_fie=schedule.summary_fields)===null||_schedule$summary_fie===void 0?void 0:(_schedule$summary_fie2=_schedule$summary_fie.unified_job_template)===null||_schedule$summary_fie2===void 0?void 0:_schedule$summary_fie2.unified_job_type)==='job'){promises.push(JobTemplatesAPI.readLaunch(schedule.summary_fields.unified_job_template.id));}else if((schedule===null||schedule===void 0?void 0:(_schedule$summary_fie3=schedule.summary_fields)===null||_schedule$summary_fie3===void 0?void 0:(_schedule$summary_fie4=_schedule$summary_fie3.unified_job_template)===null||_schedule$summary_fie4===void 0?void 0:_schedule$summary_fie4.unified_job_type)==='workflow_job'){promises.push(WorkflowJobTemplatesAPI.readLaunch(schedule.summary_fields.unified_job_template.id));}else{promises.push(Promise.resolve());}_context2.next=4;return Promise.all(promises);case 4:_yield$Promise$all=_context2.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,3);data=_yield$Promise$all2[0].data;schedulePreview=_yield$Promise$all2[1].data;launch=_yield$Promise$all2[2];return _context2.abrupt(\"return\",[data.results,schedulePreview,launch===null||launch===void 0?void 0:launch.data]);case 10:case\"end\":return _context2.stop();}}},_callee2);})),[id,schedule,rrule]),[]),_useRequest2$result=_slicedToArray(_useRequest2.result,3),credentials=_useRequest2$result[0],preview=_useRequest2$result[1],launchData=_useRequest2$result[2],isLoading=_useRequest2.isLoading,readContentError=_useRequest2.error,fetchCredentialsAndPreview=_useRequest2.request;useEffect(function(){fetchCredentialsAndPreview();},[fetchCredentialsAndPreview]);var frequencies={minute:/*i18n*/i18n._(\"Minute\"),hour:/*i18n*/i18n._(\"Hour\"),day:/*i18n*/i18n._(\"Day\"),week:/*i18n*/i18n._(\"Week\"),month:/*i18n*/i18n._(\"Month\"),year:/*i18n*/i18n._(\"Year\")};var _parseRuleObj=parseRuleObj(schedule),frequency=_parseRuleObj.frequency,frequencyOptions=_parseRuleObj.frequencyOptions;var repeatFrequency=frequency.length?frequency.map(function(f){return frequencies[f];}).join(', '):/*i18n*/i18n._(\"None (Run Once)\");var _ref4=launchData||{},ask_credential_on_launch=_ref4.ask_credential_on_launch,inventory_needed_to_start=_ref4.inventory_needed_to_start,ask_diff_mode_on_launch=_ref4.ask_diff_mode_on_launch,ask_inventory_on_launch=_ref4.ask_inventory_on_launch,ask_job_type_on_launch=_ref4.ask_job_type_on_launch,ask_limit_on_launch=_ref4.ask_limit_on_launch,ask_scm_branch_on_launch=_ref4.ask_scm_branch_on_launch,ask_skip_tags_on_launch=_ref4.ask_skip_tags_on_launch,ask_tags_on_launch=_ref4.ask_tags_on_launch,ask_variables_on_launch=_ref4.ask_variables_on_launch,ask_verbosity_on_launch=_ref4.ask_verbosity_on_launch,survey_enabled=_ref4.survey_enabled;var missingRequiredInventory=function missingRequiredInventory(){var _schedule$summary_fie5,_schedule$summary_fie6;if(!inventory_needed_to_start||schedule!==null&&schedule!==void 0&&(_schedule$summary_fie5=schedule.summary_fields)!==null&&_schedule$summary_fie5!==void 0&&(_schedule$summary_fie6=_schedule$summary_fie5.inventory)!==null&&_schedule$summary_fie6!==void 0&&_schedule$summary_fie6.id){return false;}return true;};var hasMissingSurveyValue=function hasMissingSurveyValue(){var missingValues=false;if(survey_enabled){surveyConfig.spec.forEach(function(question){var hasDefaultValue=Boolean(question.default);if(question.required&&!hasDefaultValue){var extraDataKeys=Object.keys(schedule===null||schedule===void 0?void 0:schedule.extra_data);var hasMatchingKey=extraDataKeys.includes(question.variable);Object.values(schedule===null||schedule===void 0?void 0:schedule.extra_data).forEach(function(value){if(!value||!hasMatchingKey){missingValues=true;}else{missingValues=false;}});if(!Object.values(schedule.extra_data).length){missingValues=true;}}});}return missingValues;};var isDisabled=Boolean(missingRequiredInventory()||hasMissingSurveyValue());var showCredentialsDetail=ask_credential_on_launch&&credentials.length>0;var showInventoryDetail=ask_inventory_on_launch&&inventory;var showVariablesDetail=(ask_variables_on_launch||survey_enabled)&&(typeof extra_data==='string'&&extra_data!==''||typeof extra_data==='object'&&Object.keys(extra_data).length>0);var showTagsDetail=ask_tags_on_launch&&job_tags&&job_tags.length>0;var showSkipTagsDetail=ask_skip_tags_on_launch&&skip_tags&&skip_tags.length>0;var showDiffModeDetail=ask_diff_mode_on_launch&&typeof diff_mode==='boolean';var showLimitDetail=ask_limit_on_launch&&limit;var showJobTypeDetail=ask_job_type_on_launch&&job_type;var showSCMBranchDetail=ask_scm_branch_on_launch&&scm_branch;var showVerbosityDetail=ask_verbosity_on_launch&&VERBOSITY()[verbosity];var showPromptedFields=showCredentialsDetail||showDiffModeDetail||showInventoryDetail||showJobTypeDetail||showLimitDetail||showSCMBranchDetail||showSkipTagsDetail||showTagsDetail||showVerbosityDetail||showVariablesDetail;if(isLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}if(readContentError){return/*#__PURE__*/_jsx(ContentError,{error:readContentError});}var daysToKeep=null;if(hasDaysToKeepField&&extra_data){if(typeof extra_data==='string'&&extra_data!==''){daysToKeep=parseVariableField(extra_data).days;}if(typeof extra_data==='object'){daysToKeep=extra_data===null||extra_data===void 0?void 0:extra_data.days;}}return/*#__PURE__*/_jsxs(CardBody,{children:[/*#__PURE__*/_jsx(_StyledScheduleToggle,{schedule:schedule,isDisabled:isDisabled}),/*#__PURE__*/_jsxs(DetailList,{gutter:\"sm\",children:[/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Name\"),value:name}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Description\"),value:description}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"First Run\"),value:formatDateString(dtstart,timezone)}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Next Run\"),value:formatDateString(next_run,timezone)}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Last Run\"),value:formatDateString(dtend,timezone)}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Local Time Zone\"),value:timezone,helpText:helpText.localTimeZone(config)}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Repeat Frequency\"),value:repeatFrequency})]}),frequency.length?/*#__PURE__*/_jsxs(FrequencyDetailsContainer,{children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:/*i18n*/i18n._(\"Frequency Details\")})}),frequency.map(function(freq){return/*#__PURE__*/_jsx(FrequencyDetails,{type:freq,label:frequencies[freq],options:frequencyOptions[freq],timezone:timezone},freq);})]}):null,/*#__PURE__*/_jsxs(DetailList,{gutter:\"sm\",children:[hasDaysToKeepField?/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Days of Data to Keep\"),value:daysToKeep}):null,/*#__PURE__*/_jsx(ScheduleOccurrences,{preview:preview,tz:timezone}),/*#__PURE__*/_jsx(UserDateDetail,{label:/*i18n*/i18n._(\"Created\"),date:created,user:summary_fields.created_by}),/*#__PURE__*/_jsx(UserDateDetail,{label:/*i18n*/i18n._(\"Last Modified\"),date:modified,user:summary_fields.modified_by})]}),showPromptedFields&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PromptTitle,{headingLevel:\"h2\",children:/*i18n*/i18n._(\"Prompted Values\")}),/*#__PURE__*/_jsx(PromptDivider,{}),/*#__PURE__*/_jsxs(PromptDetailList,{children:[ask_job_type_on_launch&&/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Job Type\"),value:job_type}),showInventoryDetail&&/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Inventory\"),value:summary_fields!==null&&summary_fields!==void 0&&summary_fields.inventory?/*#__PURE__*/_jsx(Link,{to:\"/inventories/\".concat((summary_fields===null||summary_fields===void 0?void 0:(_summary_fields$inven=summary_fields.inventory)===null||_summary_fields$inven===void 0?void 0:_summary_fields$inven.kind)==='smart'?'smart_inventory':'inventory',\"/\").concat(summary_fields===null||summary_fields===void 0?void 0:(_summary_fields$inven2=summary_fields.inventory)===null||_summary_fields$inven2===void 0?void 0:_summary_fields$inven2.id,\"/details\"),children:summary_fields===null||summary_fields===void 0?void 0:(_summary_fields$inven3=summary_fields.inventory)===null||_summary_fields$inven3===void 0?void 0:_summary_fields$inven3.name}):' '}),ask_verbosity_on_launch&&/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Verbosity\"),value:VERBOSITY()[verbosity]}),ask_scm_branch_on_launch&&/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Source Control Branch\"),value:scm_branch}),ask_limit_on_launch&&/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Limit\"),value:limit}),showDiffModeDetail&&/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Show Changes\"),value:diff_mode?/*i18n*/i18n._(\"On\"):/*i18n*/i18n._(\"Off\")}),showCredentialsDetail&&/*#__PURE__*/_jsx(Detail,{fullWidth:true,label:/*i18n*/i18n._(\"Credentials\"),value:/*#__PURE__*/_jsx(ChipGroup,{numChips:5,totalChips:credentials.length,ouiaId:\"schedule-credential-chips\",children:credentials.map(function(c){return/*#__PURE__*/_jsx(CredentialChip,{credential:c,isReadOnly:true,ouiaId:\"credential-\".concat(c.id,\"-chip\")},c.id);})})}),showTagsDetail&&/*#__PURE__*/_jsx(Detail,{fullWidth:true,label:/*i18n*/i18n._(\"Job Tags\"),value:/*#__PURE__*/_jsx(ChipGroup,{numChips:5,totalChips:job_tags.split(',').length,ouiaId:\"schedule-job-tag-chips\",children:job_tags.split(',').map(function(jobTag){return/*#__PURE__*/_jsx(Chip,{isReadOnly:true,ouiaId:\"job-tag-\".concat(jobTag,\"-chip\"),children:jobTag},jobTag);})})}),showSkipTagsDetail&&/*#__PURE__*/_jsx(Detail,{fullWidth:true,label:/*i18n*/i18n._(\"Skip Tags\"),value:/*#__PURE__*/_jsx(ChipGroup,{numChips:5,totalChips:skip_tags.split(',').length,ouiaId:\"schedule-skip-tag-chips\",children:skip_tags.split(',').map(function(skipTag){return/*#__PURE__*/_jsx(Chip,{isReadOnly:true,ouiaId:\"skip-tag-\".concat(skipTag,\"-chip\"),children:skipTag},skipTag);})})}),showVariablesDetail&&/*#__PURE__*/_jsx(VariablesDetail,{value:jsonToYaml(JSON.stringify(extra_data)),rows:4,label:/*i18n*/i18n._(\"Variables\"),name:\"extra_vars\",dataCy:\"schedule-detail-variables\"})]})]}),/*#__PURE__*/_jsxs(CardActionsRow,{children:[(summary_fields===null||summary_fields===void 0?void 0:(_summary_fields$user_=summary_fields.user_capabilities)===null||_summary_fields$user_===void 0?void 0:_summary_fields$user_.edit)&&/*#__PURE__*/_jsx(Button,{ouiaId:\"schedule-detail-edit-button\",\"aria-label\":/*i18n*/i18n._(\"Edit\"),component:Link,to:pathname.replace('details','edit'),children:/*i18n*/i18n._(\"Edit\")}),(summary_fields===null||summary_fields===void 0?void 0:(_summary_fields$user_2=summary_fields.user_capabilities)===null||_summary_fields$user_2===void 0?void 0:_summary_fields$user_2.delete)&&/*#__PURE__*/_jsx(DeleteButton,{name:name,modalTitle:/*i18n*/i18n._(\"Delete Schedule\"),onConfirm:deleteSchedule,isDisabled:isDeleteLoading,children:/*i18n*/i18n._(\"Delete\")})]}),error&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:error,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:dismissError,children:[/*i18n*/i18n._(\"Failed to delete schedule.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]})]});}export default ScheduleDetail;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/Schedule/ScheduleDetail/ScheduleDetail.js"],"names":["React","useCallback","useEffect","Link","useHistory","useLocation","styled","Chip","Divider","Title","Button","Schedule","formatDateString","useRequest","useDismissableError","JobTemplatesAPI","SchedulesAPI","WorkflowJobTemplatesAPI","parseVariableField","jsonToYaml","useConfig","parseRuleObj","FrequencyDetails","AlertModal","CardBody","CardActionsRow","ContentError","ContentLoading","CredentialChip","DetailList","Detail","UserDateDetail","ScheduleOccurrences","ScheduleToggle","DeleteButton","ErrorDetail","ChipGroup","VariablesDetail","VERBOSITY","helpText","PromptDivider","PromptTitle","PromptDetailList","FrequencyDetailsContainer","div","ScheduleDetail","hasDaysToKeepField","schedule","surveyConfig","id","created","description","diff_mode","dtend","dtstart","extra_data","inventory","job_tags","job_type","limit","modified","name","next_run","rrule","scm_branch","skip_tags","summary_fields","timezone","verbosity","history","pathname","pathRoot","substr","indexOf","config","destroy","push","deleteSchedule","request","isDeleteLoading","isLoading","deleteError","error","dismissError","promises","readCredentials","createPreview","unified_job_template","unified_job_type","readLaunch","Promise","resolve","all","data","schedulePreview","launch","results","result","credentials","preview","launchData","readContentError","fetchCredentialsAndPreview","frequencies","minute","hour","day","week","month","year","frequency","frequencyOptions","repeatFrequency","length","map","f","join","ask_credential_on_launch","inventory_needed_to_start","ask_diff_mode_on_launch","ask_inventory_on_launch","ask_job_type_on_launch","ask_limit_on_launch","ask_scm_branch_on_launch","ask_skip_tags_on_launch","ask_tags_on_launch","ask_variables_on_launch","ask_verbosity_on_launch","survey_enabled","missingRequiredInventory","hasMissingSurveyValue","missingValues","spec","forEach","question","hasDefaultValue","Boolean","default","required","extraDataKeys","Object","keys","hasMatchingKey","includes","variable","values","value","isDisabled","showCredentialsDetail","showInventoryDetail","showVariablesDetail","showTagsDetail","showSkipTagsDetail","showDiffModeDetail","showLimitDetail","showJobTypeDetail","showSCMBranchDetail","showVerbosityDetail","showPromptedFields","daysToKeep","days","localTimeZone","freq","created_by","modified_by","kind","c","split","jobTag","skipTag","JSON","stringify","user_capabilities","edit","replace","delete"],"mappings":"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","sourcesContent":["import 'styled-components/macro';\nimport React, { useCallback, useEffect } from 'react';\nimport { Link, useHistory, useLocation } from 'react-router-dom';\nimport styled from 'styled-components';\n\nimport { t } from '@lingui/macro';\nimport { Chip, Divider, Title, Button } from '@patternfly/react-core';\nimport { Schedule } from 'types';\nimport { formatDateString } from 'util/dates';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport { JobTemplatesAPI, SchedulesAPI, WorkflowJobTemplatesAPI } from 'api';\nimport { parseVariableField, jsonToYaml } from 'util/yaml';\nimport { useConfig } from 'contexts/Config';\nimport parseRuleObj from '../shared/parseRuleObj';\nimport FrequencyDetails from './FrequencyDetails';\nimport AlertModal from '../../AlertModal';\nimport { CardBody, CardActionsRow } from '../../Card';\nimport ContentError from '../../ContentError';\nimport ContentLoading from '../../ContentLoading';\nimport CredentialChip from '../../CredentialChip';\nimport { DetailList, Detail, UserDateDetail } from '../../DetailList';\nimport ScheduleOccurrences from '../ScheduleOccurrences';\nimport ScheduleToggle from '../ScheduleToggle';\nimport DeleteButton from '../../DeleteButton';\nimport ErrorDetail from '../../ErrorDetail';\nimport ChipGroup from '../../ChipGroup';\nimport { VariablesDetail } from '../../CodeEditor';\nimport { VERBOSITY } from '../../VerbositySelectField';\nimport helpText from '../../../screens/Template/shared/JobTemplate.helptext';\n\nconst PromptDivider = styled(Divider)`\n  margin-top: var(--pf-global--spacer--lg);\n  margin-bottom: var(--pf-global--spacer--lg);\n`;\n\nconst PromptTitle = styled(Title)`\n  margin-top: 40px;\n  --pf-c-title--m-md--FontWeight: 700;\n  grid-column: 1 / -1;\n`;\n\nconst PromptDetailList = styled(DetailList)`\n  padding: 0px 20px;\n`;\n\nconst FrequencyDetailsContainer = styled.div`\n  background-color: var(--pf-global--palette--black-150);\n  margin-top: var(--pf-global--spacer--lg);\n  margin-bottom: var(--pf-global--spacer--lg);\n  margin-right: calc(var(--pf-c-card--child--PaddingRight) * -1);\n  margin-left: calc(var(--pf-c-card--child--PaddingLeft) * -1);\n  padding: var(--pf-c-card--child--PaddingRight);\n\n  & > p {\n    margin-bottom: var(--pf-global--spacer--md);\n  }\n\n  & > *:not(:first-child):not(:last-child) {\n    margin-bottom: var(--pf-global--spacer--md);\n    padding-bottom: var(--pf-global--spacer--md);\n    border-bottom: 1px solid var(--pf-global--palette--black-300);\n  }\n`;\n\nfunction ScheduleDetail({ hasDaysToKeepField, schedule, surveyConfig }) {\n  const {\n    id,\n    created,\n    description,\n    diff_mode,\n    dtend,\n    dtstart,\n    extra_data,\n    inventory,\n    job_tags,\n    job_type,\n    limit,\n    modified,\n    name,\n    next_run,\n    rrule,\n    scm_branch,\n    skip_tags,\n    summary_fields,\n    timezone,\n    verbosity,\n  } = schedule;\n\n  const history = useHistory();\n  const { pathname } = useLocation();\n  const pathRoot = pathname.substr(0, pathname.indexOf('schedules'));\n  const config = useConfig();\n\n  const {\n    request: deleteSchedule,\n    isLoading: isDeleteLoading,\n    error: deleteError,\n  } = useRequest(\n    useCallback(async () => {\n      await SchedulesAPI.destroy(id);\n      history.push(`${pathRoot}schedules`);\n    }, [id, history, pathRoot])\n  );\n\n  const { error, dismissError } = useDismissableError(deleteError);\n\n  const {\n    result: [credentials, preview, launchData],\n    isLoading,\n    error: readContentError,\n    request: fetchCredentialsAndPreview,\n  } = useRequest(\n    useCallback(async () => {\n      const promises = [\n        SchedulesAPI.readCredentials(id),\n        SchedulesAPI.createPreview({\n          rrule,\n        }),\n      ];\n\n      if (\n        schedule?.summary_fields?.unified_job_template?.unified_job_type ===\n        'job'\n      ) {\n        promises.push(\n          JobTemplatesAPI.readLaunch(\n            schedule.summary_fields.unified_job_template.id\n          )\n        );\n      } else if (\n        schedule?.summary_fields?.unified_job_template?.unified_job_type ===\n        'workflow_job'\n      ) {\n        promises.push(\n          WorkflowJobTemplatesAPI.readLaunch(\n            schedule.summary_fields.unified_job_template.id\n          )\n        );\n      } else {\n        promises.push(Promise.resolve());\n      }\n\n      const [{ data }, { data: schedulePreview }, launch] = await Promise.all(\n        promises\n      );\n\n      return [data.results, schedulePreview, launch?.data];\n    }, [id, schedule, rrule]),\n    []\n  );\n\n  useEffect(() => {\n    fetchCredentialsAndPreview();\n  }, [fetchCredentialsAndPreview]);\n\n  const frequencies = {\n    minute: t`Minute`,\n    hour: t`Hour`,\n    day: t`Day`,\n    week: t`Week`,\n    month: t`Month`,\n    year: t`Year`,\n  };\n  const { frequency, frequencyOptions } = parseRuleObj(schedule);\n  const repeatFrequency = frequency.length\n    ? frequency.map((f) => frequencies[f]).join(', ')\n    : t`None (Run Once)`;\n\n  const {\n    ask_credential_on_launch,\n    inventory_needed_to_start,\n    ask_diff_mode_on_launch,\n    ask_inventory_on_launch,\n    ask_job_type_on_launch,\n    ask_limit_on_launch,\n    ask_scm_branch_on_launch,\n    ask_skip_tags_on_launch,\n    ask_tags_on_launch,\n    ask_variables_on_launch,\n    ask_verbosity_on_launch,\n    survey_enabled,\n  } = launchData || {};\n\n  const missingRequiredInventory = () => {\n    if (!inventory_needed_to_start || schedule?.summary_fields?.inventory?.id) {\n      return false;\n    }\n    return true;\n  };\n\n  const hasMissingSurveyValue = () => {\n    let missingValues = false;\n    if (survey_enabled) {\n      surveyConfig.spec.forEach((question) => {\n        const hasDefaultValue = Boolean(question.default);\n        if (question.required && !hasDefaultValue) {\n          const extraDataKeys = Object.keys(schedule?.extra_data);\n\n          const hasMatchingKey = extraDataKeys.includes(question.variable);\n          Object.values(schedule?.extra_data).forEach((value) => {\n            if (!value || !hasMatchingKey) {\n              missingValues = true;\n            } else {\n              missingValues = false;\n            }\n          });\n          if (!Object.values(schedule.extra_data).length) {\n            missingValues = true;\n          }\n        }\n      });\n    }\n    return missingValues;\n  };\n  const isDisabled = Boolean(\n    missingRequiredInventory() || hasMissingSurveyValue()\n  );\n\n  const showCredentialsDetail =\n    ask_credential_on_launch && credentials.length > 0;\n  const showInventoryDetail = ask_inventory_on_launch && inventory;\n  const showVariablesDetail =\n    (ask_variables_on_launch || survey_enabled) &&\n    ((typeof extra_data === 'string' && extra_data !== '') ||\n      (typeof extra_data === 'object' && Object.keys(extra_data).length > 0));\n  const showTagsDetail = ask_tags_on_launch && job_tags && job_tags.length > 0;\n  const showSkipTagsDetail =\n    ask_skip_tags_on_launch && skip_tags && skip_tags.length > 0;\n  const showDiffModeDetail =\n    ask_diff_mode_on_launch && typeof diff_mode === 'boolean';\n  const showLimitDetail = ask_limit_on_launch && limit;\n  const showJobTypeDetail = ask_job_type_on_launch && job_type;\n  const showSCMBranchDetail = ask_scm_branch_on_launch && scm_branch;\n  const showVerbosityDetail = ask_verbosity_on_launch && VERBOSITY()[verbosity];\n\n  const showPromptedFields =\n    showCredentialsDetail ||\n    showDiffModeDetail ||\n    showInventoryDetail ||\n    showJobTypeDetail ||\n    showLimitDetail ||\n    showSCMBranchDetail ||\n    showSkipTagsDetail ||\n    showTagsDetail ||\n    showVerbosityDetail ||\n    showVariablesDetail;\n\n  if (isLoading) {\n    return <ContentLoading />;\n  }\n\n  if (readContentError) {\n    return <ContentError error={readContentError} />;\n  }\n\n  let daysToKeep = null;\n  if (hasDaysToKeepField && extra_data) {\n    if (typeof extra_data === 'string' && extra_data !== '') {\n      daysToKeep = parseVariableField(extra_data).days;\n    }\n    if (typeof extra_data === 'object') {\n      daysToKeep = extra_data?.days;\n    }\n  }\n\n  return (\n    <CardBody>\n      <ScheduleToggle\n        schedule={schedule}\n        css=\"padding-bottom: 40px\"\n        isDisabled={isDisabled}\n      />\n      <DetailList gutter=\"sm\">\n        <Detail label={t`Name`} value={name} />\n        <Detail label={t`Description`} value={description} />\n        <Detail\n          label={t`First Run`}\n          value={formatDateString(dtstart, timezone)}\n        />\n        <Detail\n          label={t`Next Run`}\n          value={formatDateString(next_run, timezone)}\n        />\n        <Detail label={t`Last Run`} value={formatDateString(dtend, timezone)} />\n        <Detail\n          label={t`Local Time Zone`}\n          value={timezone}\n          helpText={helpText.localTimeZone(config)}\n        />\n        <Detail label={t`Repeat Frequency`} value={repeatFrequency} />\n      </DetailList>\n      {frequency.length ? (\n        <FrequencyDetailsContainer>\n          <p>\n            <strong>{t`Frequency Details`}</strong>\n          </p>\n          {frequency.map((freq) => (\n            <FrequencyDetails\n              key={freq}\n              type={freq}\n              label={frequencies[freq]}\n              options={frequencyOptions[freq]}\n              timezone={timezone}\n            />\n          ))}\n        </FrequencyDetailsContainer>\n      ) : null}\n      <DetailList gutter=\"sm\">\n        {hasDaysToKeepField ? (\n          <Detail label={t`Days of Data to Keep`} value={daysToKeep} />\n        ) : null}\n        <ScheduleOccurrences preview={preview} tz={timezone} />\n        <UserDateDetail\n          label={t`Created`}\n          date={created}\n          user={summary_fields.created_by}\n        />\n        <UserDateDetail\n          label={t`Last Modified`}\n          date={modified}\n          user={summary_fields.modified_by}\n        />\n      </DetailList>\n      {showPromptedFields && (\n        <>\n          <PromptTitle headingLevel=\"h2\">{t`Prompted Values`}</PromptTitle>\n          <PromptDivider />\n          <PromptDetailList>\n            {ask_job_type_on_launch && (\n              <Detail label={t`Job Type`} value={job_type} />\n            )}\n            {showInventoryDetail && (\n              <Detail\n                label={t`Inventory`}\n                value={\n                  summary_fields?.inventory ? (\n                    <Link\n                      to={`/inventories/${\n                        summary_fields?.inventory?.kind === 'smart'\n                          ? 'smart_inventory'\n                          : 'inventory'\n                      }/${summary_fields?.inventory?.id}/details`}\n                    >\n                      {summary_fields?.inventory?.name}\n                    </Link>\n                  ) : (\n                    ' '\n                  )\n                }\n              />\n            )}\n            {ask_verbosity_on_launch && (\n              <Detail label={t`Verbosity`} value={VERBOSITY()[verbosity]} />\n            )}\n            {ask_scm_branch_on_launch && (\n              <Detail label={t`Source Control Branch`} value={scm_branch} />\n            )}\n            {ask_limit_on_launch && <Detail label={t`Limit`} value={limit} />}\n            {showDiffModeDetail && (\n              <Detail\n                label={t`Show Changes`}\n                value={diff_mode ? t`On` : t`Off`}\n              />\n            )}\n            {showCredentialsDetail && (\n              <Detail\n                fullWidth\n                label={t`Credentials`}\n                value={\n                  <ChipGroup\n                    numChips={5}\n                    totalChips={credentials.length}\n                    ouiaId=\"schedule-credential-chips\"\n                  >\n                    {credentials.map((c) => (\n                      <CredentialChip\n                        key={c.id}\n                        credential={c}\n                        isReadOnly\n                        ouiaId={`credential-${c.id}-chip`}\n                      />\n                    ))}\n                  </ChipGroup>\n                }\n              />\n            )}\n            {showTagsDetail && (\n              <Detail\n                fullWidth\n                label={t`Job Tags`}\n                value={\n                  <ChipGroup\n                    numChips={5}\n                    totalChips={job_tags.split(',').length}\n                    ouiaId=\"schedule-job-tag-chips\"\n                  >\n                    {job_tags.split(',').map((jobTag) => (\n                      <Chip\n                        key={jobTag}\n                        isReadOnly\n                        ouiaId={`job-tag-${jobTag}-chip`}\n                      >\n                        {jobTag}\n                      </Chip>\n                    ))}\n                  </ChipGroup>\n                }\n              />\n            )}\n            {showSkipTagsDetail && (\n              <Detail\n                fullWidth\n                label={t`Skip Tags`}\n                value={\n                  <ChipGroup\n                    numChips={5}\n                    totalChips={skip_tags.split(',').length}\n                    ouiaId=\"schedule-skip-tag-chips\"\n                  >\n                    {skip_tags.split(',').map((skipTag) => (\n                      <Chip\n                        key={skipTag}\n                        isReadOnly\n                        ouiaId={`skip-tag-${skipTag}-chip`}\n                      >\n                        {skipTag}\n                      </Chip>\n                    ))}\n                  </ChipGroup>\n                }\n              />\n            )}\n            {showVariablesDetail && (\n              <VariablesDetail\n                value={jsonToYaml(JSON.stringify(extra_data))}\n                rows={4}\n                label={t`Variables`}\n                name=\"extra_vars\"\n                dataCy=\"schedule-detail-variables\"\n              />\n            )}\n          </PromptDetailList>\n        </>\n      )}\n      <CardActionsRow>\n        {summary_fields?.user_capabilities?.edit && (\n          <Button\n            ouiaId=\"schedule-detail-edit-button\"\n            aria-label={t`Edit`}\n            component={Link}\n            to={pathname.replace('details', 'edit')}\n          >\n            {t`Edit`}\n          </Button>\n        )}\n        {summary_fields?.user_capabilities?.delete && (\n          <DeleteButton\n            name={name}\n            modalTitle={t`Delete Schedule`}\n            onConfirm={deleteSchedule}\n            isDisabled={isDeleteLoading}\n          >\n            {t`Delete`}\n          </DeleteButton>\n        )}\n      </CardActionsRow>\n      {error && (\n        <AlertModal\n          isOpen={error}\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={dismissError}\n        >\n          {t`Failed to delete schedule.`}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </CardBody>\n  );\n}\n\nScheduleDetail.propTypes = {\n  schedule: Schedule.isRequired,\n};\n\nexport default ScheduleDetail;\n"]},"metadata":{},"sourceType":"module"}