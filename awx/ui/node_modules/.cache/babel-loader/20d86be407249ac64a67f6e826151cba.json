{"ast":null,"code":"import _defineProperty from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{i18n}from\"@lingui/core\";import{useContext,useState,useEffect}from'react';import{useFormikContext}from'formik';import useInventoryStep from'components/LaunchPrompt/steps/useInventoryStep';import useCredentialsStep from'components/LaunchPrompt/steps/useCredentialsStep';import useOtherPromptsStep from'components/LaunchPrompt/steps/useOtherPromptsStep';import useSurveyStep from'components/LaunchPrompt/steps/useSurveyStep';import usePreviewStep from'components/LaunchPrompt/steps/usePreviewStep';import{WorkflowStateContext}from'contexts/Workflow';import{jsonToYaml}from'util/yaml';import{stringIsUUID}from'util/strings';import useNodeTypeStep from'./NodeTypeStep/useNodeTypeStep';import useDaysToKeepStep from'./useDaysToKeepStep';import useRunTypeStep from'./useRunTypeStep';function showPreviewStep(nodeType,launchConfig){if(!['workflow_job_template','job_template'].includes(nodeType)||Object.keys(launchConfig).length===0){return false;}return!launchConfig.can_start_without_user_input||launchConfig.ask_inventory_on_launch||launchConfig.ask_variables_on_launch||launchConfig.ask_limit_on_launch||launchConfig.ask_scm_branch_on_launch||launchConfig.survey_enabled||launchConfig.variables_needed_to_start&&launchConfig.variables_needed_to_start.length>0;}var getNodeToEditDefaultValues=function getNodeToEditDefaultValues(launchConfig,surveyConfig,nodeToEdit,resourceDefaultCredentials){var _nodeToEdit$originalN,_nodeToEdit$fullUnifi,_nodeToEdit$fullUnifi2,_nodeToEdit$fullUnifi3;var identifier='';if(Object.prototype.hasOwnProperty.call(nodeToEdit,'identifier')&&nodeToEdit.identifier!==null){identifier=nodeToEdit.identifier;}else if(Object.prototype.hasOwnProperty.call(nodeToEdit===null||nodeToEdit===void 0?void 0:nodeToEdit.originalNodeObject,'identifier')&&!stringIsUUID(nodeToEdit===null||nodeToEdit===void 0?void 0:(_nodeToEdit$originalN=nodeToEdit.originalNodeObject)===null||_nodeToEdit$originalN===void 0?void 0:_nodeToEdit$originalN.identifier)){var _nodeToEdit$originalN2;identifier=nodeToEdit===null||nodeToEdit===void 0?void 0:(_nodeToEdit$originalN2=nodeToEdit.originalNodeObject)===null||_nodeToEdit$originalN2===void 0?void 0:_nodeToEdit$originalN2.identifier;}var getConvergence=function getConvergence(){var _nodeToEdit$originalN3;// There is a case where the nodeToEdit convergence value will not align with the\n// original node object value.  This allows the nodeToEdit value to take precedence over the\n// original node object.\nif(nodeToEdit){return nodeToEdit.all_parents_must_converge?'all':'any';}return nodeToEdit!==null&&nodeToEdit!==void 0&&(_nodeToEdit$originalN3=nodeToEdit.originalNodeObject)!==null&&_nodeToEdit$originalN3!==void 0&&_nodeToEdit$originalN3.all_parents_must_converge?'all':'any';};var initialValues={nodeResource:(nodeToEdit===null||nodeToEdit===void 0?void 0:nodeToEdit.fullUnifiedJobTemplate)||null,nodeType:(nodeToEdit===null||nodeToEdit===void 0?void 0:(_nodeToEdit$fullUnifi=nodeToEdit.fullUnifiedJobTemplate)===null||_nodeToEdit$fullUnifi===void 0?void 0:_nodeToEdit$fullUnifi.type)||'job_template',convergence:getConvergence(),identifier:identifier};if((nodeToEdit===null||nodeToEdit===void 0?void 0:(_nodeToEdit$fullUnifi2=nodeToEdit.fullUnifiedJobTemplate)===null||_nodeToEdit$fullUnifi2===void 0?void 0:_nodeToEdit$fullUnifi2.type)==='workflow_approval_template'){var timeout=nodeToEdit.fullUnifiedJobTemplate.timeout||0;initialValues.approvalName=nodeToEdit.fullUnifiedJobTemplate.name||'';initialValues.approvalDescription=nodeToEdit.fullUnifiedJobTemplate.description||'';initialValues.timeoutMinutes=Math.floor(timeout/60);initialValues.timeoutSeconds=timeout-Math.floor(timeout/60)*60;return initialValues;}if((nodeToEdit===null||nodeToEdit===void 0?void 0:(_nodeToEdit$fullUnifi3=nodeToEdit.fullUnifiedJobTemplate)===null||_nodeToEdit$fullUnifi3===void 0?void 0:_nodeToEdit$fullUnifi3.type)==='system_job_template'){var _nodeToEdit$promptVal,_nodeToEdit$originalN4;if(nodeToEdit!==null&&nodeToEdit!==void 0&&(_nodeToEdit$promptVal=nodeToEdit.promptValues)!==null&&_nodeToEdit$promptVal!==void 0&&_nodeToEdit$promptVal.extra_data&&Object.prototype.hasOwnProperty.call(nodeToEdit.promptValues.extra_data,'days')){initialValues.daysToKeep=parseInt(nodeToEdit.promptValues.extra_data.days,10);}else if(nodeToEdit!==null&&nodeToEdit!==void 0&&(_nodeToEdit$originalN4=nodeToEdit.originalNodeObject)!==null&&_nodeToEdit$originalN4!==void 0&&_nodeToEdit$originalN4.extra_data&&Object.prototype.hasOwnProperty.call(nodeToEdit.originalNodeObject.extra_data,'days')){initialValues.daysToKeep=parseInt(nodeToEdit.originalNodeObject.extra_data.days,10);}return initialValues;}if(!launchConfig||launchConfig==={}){return initialValues;}if(launchConfig.ask_inventory_on_launch){var _nodeToEdit$originalN5,_nodeToEdit$originalN6;// We also need to handle the case where the UJT has been deleted.\nif(nodeToEdit!==null&&nodeToEdit!==void 0&&nodeToEdit.promptValues){var _nodeToEdit$promptVal2;initialValues.inventory=nodeToEdit===null||nodeToEdit===void 0?void 0:(_nodeToEdit$promptVal2=nodeToEdit.promptValues)===null||_nodeToEdit$promptVal2===void 0?void 0:_nodeToEdit$promptVal2.inventory;}else if(nodeToEdit!==null&&nodeToEdit!==void 0&&(_nodeToEdit$originalN5=nodeToEdit.originalNodeObject)!==null&&_nodeToEdit$originalN5!==void 0&&(_nodeToEdit$originalN6=_nodeToEdit$originalN5.summary_fields)!==null&&_nodeToEdit$originalN6!==void 0&&_nodeToEdit$originalN6.inventory){var _nodeToEdit$originalN7,_nodeToEdit$originalN8;initialValues.inventory=nodeToEdit===null||nodeToEdit===void 0?void 0:(_nodeToEdit$originalN7=nodeToEdit.originalNodeObject)===null||_nodeToEdit$originalN7===void 0?void 0:(_nodeToEdit$originalN8=_nodeToEdit$originalN7.summary_fields)===null||_nodeToEdit$originalN8===void 0?void 0:_nodeToEdit$originalN8.inventory;}else{initialValues.inventory=null;}}if(launchConfig.ask_credential_on_launch){var _nodeToEdit$promptVal3;if(nodeToEdit!==null&&nodeToEdit!==void 0&&(_nodeToEdit$promptVal3=nodeToEdit.promptValues)!==null&&_nodeToEdit$promptVal3!==void 0&&_nodeToEdit$promptVal3.credentials){var _nodeToEdit$promptVal4;initialValues.credentials=nodeToEdit===null||nodeToEdit===void 0?void 0:(_nodeToEdit$promptVal4=nodeToEdit.promptValues)===null||_nodeToEdit$promptVal4===void 0?void 0:_nodeToEdit$promptVal4.credentials;}else if(nodeToEdit!==null&&nodeToEdit!==void 0&&nodeToEdit.originalNodeCredentials){var defaultCredsWithoutOverrides=[];var credentialHasOverride=function credentialHasOverride(templateDefaultCred){var hasOverride=false;nodeToEdit.originalNodeCredentials.forEach(function(nodeCredential){if(templateDefaultCred.credential_type===nodeCredential.credential_type){if(!templateDefaultCred.vault_id&&!nodeCredential.inputs.vault_id||templateDefaultCred.vault_id&&nodeCredential.inputs.vault_id&&templateDefaultCred.vault_id===nodeCredential.inputs.vault_id){hasOverride=true;}}});return hasOverride;};if(resourceDefaultCredentials){resourceDefaultCredentials.forEach(function(defaultCred){if(!credentialHasOverride(defaultCred)){defaultCredsWithoutOverrides.push(defaultCred);}});}initialValues.credentials=nodeToEdit.originalNodeCredentials.concat(defaultCredsWithoutOverrides);}else{initialValues.credentials=[];}}var sourceOfValues=(nodeToEdit===null||nodeToEdit===void 0?void 0:nodeToEdit.promptValues)||nodeToEdit.originalNodeObject;if(launchConfig.ask_job_type_on_launch){initialValues.job_type=(sourceOfValues===null||sourceOfValues===void 0?void 0:sourceOfValues.job_type)||'';}if(launchConfig.ask_limit_on_launch){initialValues.limit=(sourceOfValues===null||sourceOfValues===void 0?void 0:sourceOfValues.limit)||'';}if(launchConfig.ask_verbosity_on_launch){initialValues.verbosity=(sourceOfValues===null||sourceOfValues===void 0?void 0:sourceOfValues.verbosity)||0;}if(launchConfig.ask_tags_on_launch){initialValues.job_tags=(sourceOfValues===null||sourceOfValues===void 0?void 0:sourceOfValues.job_tags)||'';}if(launchConfig.ask_skip_tags_on_launch){initialValues.skip_tags=(sourceOfValues===null||sourceOfValues===void 0?void 0:sourceOfValues.skip_tags)||'';}if(launchConfig.ask_scm_branch_on_launch){initialValues.scm_branch=(sourceOfValues===null||sourceOfValues===void 0?void 0:sourceOfValues.scm_branch)||'';}if(launchConfig.ask_diff_mode_on_launch){initialValues.diff_mode=(sourceOfValues===null||sourceOfValues===void 0?void 0:sourceOfValues.diff_mode)||false;}if(launchConfig.ask_variables_on_launch){var newExtraData=_objectSpread({},sourceOfValues.extra_data);if(launchConfig.survey_enabled&&surveyConfig.spec){surveyConfig.spec.forEach(function(question){if(Object.prototype.hasOwnProperty.call(newExtraData,question.variable)){delete newExtraData[question.variable];}});}initialValues.extra_vars=jsonToYaml(JSON.stringify(newExtraData));}if(surveyConfig!==null&&surveyConfig!==void 0&&surveyConfig.spec){surveyConfig.spec.forEach(function(question){if(question.type==='multiselect'){initialValues[\"survey_\".concat(question.variable)]=question.default.split('\\n');}else{initialValues[\"survey_\".concat(question.variable)]=question.default;}if(sourceOfValues!==null&&sourceOfValues!==void 0&&sourceOfValues.extra_data){Object.entries(sourceOfValues===null||sourceOfValues===void 0?void 0:sourceOfValues.extra_data).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];if(key===question.variable){if(question.type==='multiselect'){initialValues[\"survey_\".concat(question.variable)]=value;}else{initialValues[\"survey_\".concat(question.variable)]=value;}}});}});}return initialValues;};export default function useWorkflowNodeSteps(launchConfig,surveyConfig,resource,askLinkType,resourceDefaultCredentials){var _useContext=useContext(WorkflowStateContext),nodeToEdit=_useContext.nodeToEdit;var _useFormikContext=useFormikContext(),resetForm=_useFormikContext.resetForm,formikValues=_useFormikContext.values,formikErrors=_useFormikContext.errors;var _useState=useState({}),_useState2=_slicedToArray(_useState,2),visited=_useState2[0],setVisited=_useState2[1];var steps=[useRunTypeStep(askLinkType),useNodeTypeStep(launchConfig),useDaysToKeepStep(),useInventoryStep(launchConfig,resource,visited),useCredentialsStep(launchConfig,resource,resourceDefaultCredentials),useOtherPromptsStep(launchConfig,resource),useSurveyStep(launchConfig,surveyConfig,resource,visited)];var hasErrors=steps.some(function(step){return step.hasError;});steps.push(usePreviewStep(launchConfig,resource,surveyConfig,hasErrors,showPreviewStep(formikValues.nodeType,launchConfig)));var pfSteps=steps.map(function(s){return s.step;}).filter(function(s){return s!=null;});var isReady=!steps.some(function(s){return!s.isReady;});useEffect(function(){if(launchConfig&&surveyConfig&&isReady){var _nodeToEdit$fullUnifi4,_formikValues$nodeRes,_launchConfig$passwor,_initialValues,_initialValues$verbos;var initialValues={};if(nodeToEdit&&nodeToEdit!==null&&nodeToEdit!==void 0&&nodeToEdit.fullUnifiedJobTemplate&&(nodeToEdit===null||nodeToEdit===void 0?void 0:(_nodeToEdit$fullUnifi4=nodeToEdit.fullUnifiedJobTemplate)===null||_nodeToEdit$fullUnifi4===void 0?void 0:_nodeToEdit$fullUnifi4.id)===((_formikValues$nodeRes=formikValues.nodeResource)===null||_formikValues$nodeRes===void 0?void 0:_formikValues$nodeRes.id)){initialValues=getNodeToEditDefaultValues(launchConfig,surveyConfig,nodeToEdit,resourceDefaultCredentials);}else{initialValues=steps.reduce(function(acc,cur){return _objectSpread(_objectSpread({},acc),cur.initialValues);},{});initialValues.identifier=formikValues.identifier;initialValues.convergence=formikValues.convergence;}var errors=formikErrors.nodeResource?{nodeResource:formikErrors.nodeResource}:{};if(!(launchConfig!==null&&launchConfig!==void 0&&launchConfig.ask_credential_on_launch)&&(launchConfig===null||launchConfig===void 0?void 0:(_launchConfig$passwor=launchConfig.passwords_needed_to_start)===null||_launchConfig$passwor===void 0?void 0:_launchConfig$passwor.length)>0){errors.nodeResource=/*i18n*/i18n._(\"Job Templates with credentials that prompt for passwords cannot be selected when creating or editing nodes\");}resetForm({errors:errors,values:_objectSpread(_objectSpread({},initialValues),{},{nodeResource:formikValues.nodeResource,nodeType:formikValues.nodeType,linkType:formikValues.linkType,verbosity:(_initialValues=initialValues)===null||_initialValues===void 0?void 0:(_initialValues$verbos=_initialValues.verbosity)===null||_initialValues$verbos===void 0?void 0:_initialValues$verbos.toString()})});}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[launchConfig,surveyConfig,isReady]);var stepWithError=steps.find(function(s){return s.contentError;});var contentError=stepWithError?stepWithError.contentError:null;return{steps:pfSteps,validateStep:function validateStep(stepId){steps.find(function(s){var _s$step;return(s===null||s===void 0?void 0:(_s$step=s.step)===null||_s$step===void 0?void 0:_s$step.id)===stepId;}).validate();},visitStep:function visitStep(prevStepId,setFieldTouched){setVisited(_objectSpread(_objectSpread({},visited),{},_defineProperty({},prevStepId,true)));steps.find(function(s){var _s$step2;return(s===null||s===void 0?void 0:(_s$step2=s.step)===null||_s$step2===void 0?void 0:_s$step2.id)===prevStepId;}).setTouched(setFieldTouched);},visitAllSteps:function visitAllSteps(setFieldTouched){setVisited({inventory:true,credentials:true,other:true,survey:true,preview:true});steps.forEach(function(s){return s.setTouched(setFieldTouched);});},contentError:contentError};}","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Template/WorkflowJobTemplateVisualizer/Modals/NodeModals/useWorkflowNodeSteps.js"],"names":["useContext","useState","useEffect","useFormikContext","useInventoryStep","useCredentialsStep","useOtherPromptsStep","useSurveyStep","usePreviewStep","WorkflowStateContext","jsonToYaml","stringIsUUID","useNodeTypeStep","useDaysToKeepStep","useRunTypeStep","showPreviewStep","nodeType","launchConfig","includes","Object","keys","length","can_start_without_user_input","ask_inventory_on_launch","ask_variables_on_launch","ask_limit_on_launch","ask_scm_branch_on_launch","survey_enabled","variables_needed_to_start","getNodeToEditDefaultValues","surveyConfig","nodeToEdit","resourceDefaultCredentials","identifier","prototype","hasOwnProperty","call","originalNodeObject","getConvergence","all_parents_must_converge","initialValues","nodeResource","fullUnifiedJobTemplate","type","convergence","timeout","approvalName","name","approvalDescription","description","timeoutMinutes","Math","floor","timeoutSeconds","promptValues","extra_data","daysToKeep","parseInt","days","inventory","summary_fields","ask_credential_on_launch","credentials","originalNodeCredentials","defaultCredsWithoutOverrides","credentialHasOverride","templateDefaultCred","hasOverride","forEach","nodeCredential","credential_type","vault_id","inputs","defaultCred","push","concat","sourceOfValues","ask_job_type_on_launch","job_type","limit","ask_verbosity_on_launch","verbosity","ask_tags_on_launch","job_tags","ask_skip_tags_on_launch","skip_tags","scm_branch","ask_diff_mode_on_launch","diff_mode","newExtraData","spec","question","variable","extra_vars","JSON","stringify","default","split","entries","key","value","useWorkflowNodeSteps","resource","askLinkType","resetForm","formikValues","values","formikErrors","errors","visited","setVisited","steps","hasErrors","some","step","hasError","pfSteps","map","s","filter","isReady","id","reduce","acc","cur","passwords_needed_to_start","linkType","toString","stepWithError","find","contentError","validateStep","stepId","validate","visitStep","prevStepId","setFieldTouched","setTouched","visitAllSteps","other","survey","preview"],"mappings":"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","sourcesContent":["import { useContext, useState, useEffect } from 'react';\nimport { useFormikContext } from 'formik';\nimport { t } from '@lingui/macro';\nimport useInventoryStep from 'components/LaunchPrompt/steps/useInventoryStep';\nimport useCredentialsStep from 'components/LaunchPrompt/steps/useCredentialsStep';\nimport useOtherPromptsStep from 'components/LaunchPrompt/steps/useOtherPromptsStep';\nimport useSurveyStep from 'components/LaunchPrompt/steps/useSurveyStep';\nimport usePreviewStep from 'components/LaunchPrompt/steps/usePreviewStep';\nimport { WorkflowStateContext } from 'contexts/Workflow';\nimport { jsonToYaml } from 'util/yaml';\nimport { stringIsUUID } from 'util/strings';\nimport useNodeTypeStep from './NodeTypeStep/useNodeTypeStep';\nimport useDaysToKeepStep from './useDaysToKeepStep';\nimport useRunTypeStep from './useRunTypeStep';\n\nfunction showPreviewStep(nodeType, launchConfig) {\n  if (\n    !['workflow_job_template', 'job_template'].includes(nodeType) ||\n    Object.keys(launchConfig).length === 0\n  ) {\n    return false;\n  }\n  return (\n    !launchConfig.can_start_without_user_input ||\n    launchConfig.ask_inventory_on_launch ||\n    launchConfig.ask_variables_on_launch ||\n    launchConfig.ask_limit_on_launch ||\n    launchConfig.ask_scm_branch_on_launch ||\n    launchConfig.survey_enabled ||\n    (launchConfig.variables_needed_to_start &&\n      launchConfig.variables_needed_to_start.length > 0)\n  );\n}\n\nconst getNodeToEditDefaultValues = (\n  launchConfig,\n  surveyConfig,\n  nodeToEdit,\n  resourceDefaultCredentials\n) => {\n  let identifier = '';\n  if (\n    Object.prototype.hasOwnProperty.call(nodeToEdit, 'identifier') &&\n    nodeToEdit.identifier !== null\n  ) {\n    ({ identifier } = nodeToEdit);\n  } else if (\n    Object.prototype.hasOwnProperty.call(\n      nodeToEdit?.originalNodeObject,\n      'identifier'\n    ) &&\n    !stringIsUUID(nodeToEdit?.originalNodeObject?.identifier)\n  ) {\n    identifier = nodeToEdit?.originalNodeObject?.identifier;\n  }\n\n  const getConvergence = () => {\n    // There is a case where the nodeToEdit convergence value will not align with the\n    // original node object value.  This allows the nodeToEdit value to take precedence over the\n    // original node object.\n    if (nodeToEdit) {\n      return nodeToEdit.all_parents_must_converge ? 'all' : 'any';\n    }\n    return nodeToEdit?.originalNodeObject?.all_parents_must_converge\n      ? 'all'\n      : 'any';\n  };\n  const initialValues = {\n    nodeResource: nodeToEdit?.fullUnifiedJobTemplate || null,\n    nodeType: nodeToEdit?.fullUnifiedJobTemplate?.type || 'job_template',\n    convergence: getConvergence(),\n    identifier,\n  };\n\n  if (\n    nodeToEdit?.fullUnifiedJobTemplate?.type === 'workflow_approval_template'\n  ) {\n    const timeout = nodeToEdit.fullUnifiedJobTemplate.timeout || 0;\n    initialValues.approvalName = nodeToEdit.fullUnifiedJobTemplate.name || '';\n    initialValues.approvalDescription =\n      nodeToEdit.fullUnifiedJobTemplate.description || '';\n    initialValues.timeoutMinutes = Math.floor(timeout / 60);\n    initialValues.timeoutSeconds = timeout - Math.floor(timeout / 60) * 60;\n\n    return initialValues;\n  }\n\n  if (nodeToEdit?.fullUnifiedJobTemplate?.type === 'system_job_template') {\n    if (\n      nodeToEdit?.promptValues?.extra_data &&\n      Object.prototype.hasOwnProperty.call(\n        nodeToEdit.promptValues.extra_data,\n        'days'\n      )\n    ) {\n      initialValues.daysToKeep = parseInt(\n        nodeToEdit.promptValues.extra_data.days,\n        10\n      );\n    } else if (\n      nodeToEdit?.originalNodeObject?.extra_data &&\n      Object.prototype.hasOwnProperty.call(\n        nodeToEdit.originalNodeObject.extra_data,\n        'days'\n      )\n    ) {\n      initialValues.daysToKeep = parseInt(\n        nodeToEdit.originalNodeObject.extra_data.days,\n        10\n      );\n    }\n\n    return initialValues;\n  }\n\n  if (!launchConfig || launchConfig === {}) {\n    return initialValues;\n  }\n\n  if (launchConfig.ask_inventory_on_launch) {\n    // We also need to handle the case where the UJT has been deleted.\n    if (nodeToEdit?.promptValues) {\n      initialValues.inventory = nodeToEdit?.promptValues?.inventory;\n    } else if (nodeToEdit?.originalNodeObject?.summary_fields?.inventory) {\n      initialValues.inventory =\n        nodeToEdit?.originalNodeObject?.summary_fields?.inventory;\n    } else {\n      initialValues.inventory = null;\n    }\n  }\n\n  if (launchConfig.ask_credential_on_launch) {\n    if (nodeToEdit?.promptValues?.credentials) {\n      initialValues.credentials = nodeToEdit?.promptValues?.credentials;\n    } else if (nodeToEdit?.originalNodeCredentials) {\n      const defaultCredsWithoutOverrides = [];\n\n      const credentialHasOverride = (templateDefaultCred) => {\n        let hasOverride = false;\n        nodeToEdit.originalNodeCredentials.forEach((nodeCredential) => {\n          if (\n            templateDefaultCred.credential_type ===\n            nodeCredential.credential_type\n          ) {\n            if (\n              (!templateDefaultCred.vault_id &&\n                !nodeCredential.inputs.vault_id) ||\n              (templateDefaultCred.vault_id &&\n                nodeCredential.inputs.vault_id &&\n                templateDefaultCred.vault_id === nodeCredential.inputs.vault_id)\n            ) {\n              hasOverride = true;\n            }\n          }\n        });\n\n        return hasOverride;\n      };\n\n      if (resourceDefaultCredentials) {\n        resourceDefaultCredentials.forEach((defaultCred) => {\n          if (!credentialHasOverride(defaultCred)) {\n            defaultCredsWithoutOverrides.push(defaultCred);\n          }\n        });\n      }\n\n      initialValues.credentials = nodeToEdit.originalNodeCredentials.concat(\n        defaultCredsWithoutOverrides\n      );\n    } else {\n      initialValues.credentials = [];\n    }\n  }\n\n  const sourceOfValues =\n    nodeToEdit?.promptValues || nodeToEdit.originalNodeObject;\n\n  if (launchConfig.ask_job_type_on_launch) {\n    initialValues.job_type = sourceOfValues?.job_type || '';\n  }\n  if (launchConfig.ask_limit_on_launch) {\n    initialValues.limit = sourceOfValues?.limit || '';\n  }\n  if (launchConfig.ask_verbosity_on_launch) {\n    initialValues.verbosity = sourceOfValues?.verbosity || 0;\n  }\n  if (launchConfig.ask_tags_on_launch) {\n    initialValues.job_tags = sourceOfValues?.job_tags || '';\n  }\n  if (launchConfig.ask_skip_tags_on_launch) {\n    initialValues.skip_tags = sourceOfValues?.skip_tags || '';\n  }\n  if (launchConfig.ask_scm_branch_on_launch) {\n    initialValues.scm_branch = sourceOfValues?.scm_branch || '';\n  }\n  if (launchConfig.ask_diff_mode_on_launch) {\n    initialValues.diff_mode = sourceOfValues?.diff_mode || false;\n  }\n\n  if (launchConfig.ask_variables_on_launch) {\n    const newExtraData = { ...sourceOfValues.extra_data };\n    if (launchConfig.survey_enabled && surveyConfig.spec) {\n      surveyConfig.spec.forEach((question) => {\n        if (\n          Object.prototype.hasOwnProperty.call(newExtraData, question.variable)\n        ) {\n          delete newExtraData[question.variable];\n        }\n      });\n    }\n    initialValues.extra_vars = jsonToYaml(JSON.stringify(newExtraData));\n  }\n\n  if (surveyConfig?.spec) {\n    surveyConfig.spec.forEach((question) => {\n      if (question.type === 'multiselect') {\n        initialValues[`survey_${question.variable}`] =\n          question.default.split('\\n');\n      } else {\n        initialValues[`survey_${question.variable}`] = question.default;\n      }\n      if (sourceOfValues?.extra_data) {\n        Object.entries(sourceOfValues?.extra_data).forEach(([key, value]) => {\n          if (key === question.variable) {\n            if (question.type === 'multiselect') {\n              initialValues[`survey_${question.variable}`] = value;\n            } else {\n              initialValues[`survey_${question.variable}`] = value;\n            }\n          }\n        });\n      }\n    });\n  }\n\n  return initialValues;\n};\n\nexport default function useWorkflowNodeSteps(\n  launchConfig,\n  surveyConfig,\n  resource,\n  askLinkType,\n  resourceDefaultCredentials\n) {\n  const { nodeToEdit } = useContext(WorkflowStateContext);\n  const {\n    resetForm,\n    values: formikValues,\n    errors: formikErrors,\n  } = useFormikContext();\n  const [visited, setVisited] = useState({});\n\n  const steps = [\n    useRunTypeStep(askLinkType),\n    useNodeTypeStep(launchConfig),\n    useDaysToKeepStep(),\n    useInventoryStep(launchConfig, resource, visited),\n    useCredentialsStep(launchConfig, resource, resourceDefaultCredentials),\n    useOtherPromptsStep(launchConfig, resource),\n    useSurveyStep(launchConfig, surveyConfig, resource, visited),\n  ];\n\n  const hasErrors = steps.some((step) => step.hasError);\n\n  steps.push(\n    usePreviewStep(\n      launchConfig,\n      resource,\n      surveyConfig,\n      hasErrors,\n      showPreviewStep(formikValues.nodeType, launchConfig)\n    )\n  );\n\n  const pfSteps = steps.map((s) => s.step).filter((s) => s != null);\n  const isReady = !steps.some((s) => !s.isReady);\n\n  useEffect(() => {\n    if (launchConfig && surveyConfig && isReady) {\n      let initialValues = {};\n      if (\n        nodeToEdit &&\n        nodeToEdit?.fullUnifiedJobTemplate &&\n        nodeToEdit?.fullUnifiedJobTemplate?.id === formikValues.nodeResource?.id\n      ) {\n        initialValues = getNodeToEditDefaultValues(\n          launchConfig,\n          surveyConfig,\n          nodeToEdit,\n          resourceDefaultCredentials\n        );\n      } else {\n        initialValues = steps.reduce(\n          (acc, cur) => ({\n            ...acc,\n            ...cur.initialValues,\n          }),\n          {}\n        );\n        initialValues.identifier = formikValues.identifier;\n        initialValues.convergence = formikValues.convergence;\n      }\n\n      const errors = formikErrors.nodeResource\n        ? {\n            nodeResource: formikErrors.nodeResource,\n          }\n        : {};\n\n      if (\n        !launchConfig?.ask_credential_on_launch &&\n        launchConfig?.passwords_needed_to_start?.length > 0\n      ) {\n        errors.nodeResource = t`Job Templates with credentials that prompt for passwords cannot be selected when creating or editing nodes`;\n      }\n\n      resetForm({\n        errors,\n        values: {\n          ...initialValues,\n          nodeResource: formikValues.nodeResource,\n          nodeType: formikValues.nodeType,\n          linkType: formikValues.linkType,\n          verbosity: initialValues?.verbosity?.toString(),\n        },\n      });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [launchConfig, surveyConfig, isReady]);\n  const stepWithError = steps.find((s) => s.contentError);\n  const contentError = stepWithError ? stepWithError.contentError : null;\n\n  return {\n    steps: pfSteps,\n    validateStep: (stepId) => {\n      steps.find((s) => s?.step?.id === stepId).validate();\n    },\n    visitStep: (prevStepId, setFieldTouched) => {\n      setVisited({\n        ...visited,\n        [prevStepId]: true,\n      });\n      steps.find((s) => s?.step?.id === prevStepId).setTouched(setFieldTouched);\n    },\n    visitAllSteps: (setFieldTouched) => {\n      setVisited({\n        inventory: true,\n        credentials: true,\n        other: true,\n        survey: true,\n        preview: true,\n      });\n      steps.forEach((s) => s.setTouched(setFieldTouched));\n    },\n    contentError,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}