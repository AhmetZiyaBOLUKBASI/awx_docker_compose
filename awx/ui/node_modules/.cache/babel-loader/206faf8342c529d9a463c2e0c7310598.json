{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{useHistory}from'react-router-dom';import{Button,Modal}from'@patternfly/react-core';import{getSearchableKeys}from'components/PaginatedTable';import useRequest from'hooks/useRequest';import{getQSConfig,parseQueryString}from'util/qs';import useSelected from'hooks/useSelected';import OptionsList from'../OptionsList';import{jsx as _jsx}from\"react/jsx-runtime\";var QS_CONFIG=function QS_CONFIG(){var order_by=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'name';return getQSConfig('associate',{page:1,page_size:5,order_by:order_by});};function AssociateModal(_ref){var _ref$header=_ref.header,header=_ref$header===void 0?/*i18n*/i18n._(\"Items\"):_ref$header,_ref$columns=_ref.columns,columns=_ref$columns===void 0?[]:_ref$columns,_ref$title=_ref.title,title=_ref$title===void 0?/*i18n*/i18n._(\"Select Items\"):_ref$title,onClose=_ref.onClose,onAssociate=_ref.onAssociate,fetchRequest=_ref.fetchRequest,optionsRequest=_ref.optionsRequest,_ref$isModalOpen=_ref.isModalOpen,isModalOpen=_ref$isModalOpen===void 0?false:_ref$isModalOpen,_ref$displayKey=_ref.displayKey,displayKey=_ref$displayKey===void 0?'name':_ref$displayKey,ouiaId=_ref.ouiaId;var history=useHistory();var _useSelected=useSelected([]),selected=_useSelected.selected,handleSelect=_useSelected.handleSelect;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,count,results,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG(displayKey),history.location.search);_context.next=3;return Promise.all([fetchRequest(params),optionsRequest()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);_yield$Promise$all2$=_yield$Promise$all2[0].data;count=_yield$Promise$all2$.count;results=_yield$Promise$all2$.results;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{items:results,itemCount:count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 10:case\"end\":return _context.stop();}}},_callee);})),[fetchRequest,optionsRequest,history.location.search,displayKey]),{items:[],itemCount:0,relatedSearchableKeys:[],searchableKeys:[]}),fetchItems=_useRequest.request,_useRequest$result=_useRequest.result,items=_useRequest$result.items,itemCount=_useRequest$result.itemCount,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,contentError=_useRequest.error,isLoading=_useRequest.isLoading;useEffect(function(){fetchItems();},[fetchItems]);var clearQSParams=function clearQSParams(){var parts=history.location.search.replace(/^\\?/,'').split('&');var _QS_CONFIG=QS_CONFIG(displayKey),namespace=_QS_CONFIG.namespace;var otherParts=parts.filter(function(param){return!param.startsWith(\"\".concat(namespace,\".\"));});history.replace(\"\".concat(history.location.pathname,\"?\").concat(otherParts.join('&')));};var handleSave=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return onAssociate(selected);case 2:clearQSParams();onClose();case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSave(){return _ref3.apply(this,arguments);};}();var handleClose=function handleClose(){clearQSParams();onClose();};return/*#__PURE__*/_jsx(Modal,{ouiaId:ouiaId,variant:\"large\",title:title,\"aria-label\":/*i18n*/i18n._(\"Association modal\"),isOpen:isModalOpen,onClose:handleClose,actions:[/*#__PURE__*/_jsx(Button,{ouiaId:\"associate-modal-save\",\"aria-label\":/*i18n*/i18n._(\"Save\"),variant:\"primary\",onClick:handleSave,isDisabled:selected.length===0,children:/*i18n*/i18n._(\"Save\")},\"select\"),/*#__PURE__*/_jsx(Button,{ouiaId:\"associate-modal-cancel\",\"aria-label\":/*i18n*/i18n._(\"Cancel\"),variant:\"link\",onClick:handleClose,children:/*i18n*/i18n._(\"Cancel\")},\"cancel\")],children:/*#__PURE__*/_jsx(OptionsList,{displayKey:displayKey,contentError:contentError,columns:columns,deselectItem:handleSelect,header:header,isLoading:isLoading,multiple:true,optionCount:itemCount,options:items,qsConfig:QS_CONFIG(displayKey),readOnly:false,selectItem:handleSelect,value:selected,searchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:\"\".concat(displayKey,\"__icontains\"),isDefault:true},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username__icontains'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username__icontains'}],sortColumns:[{name:/*i18n*/i18n._(\"Name\"),key:\"\".concat(displayKey)}],searchableKeys:searchableKeys,relatedSearchableKeys:relatedSearchableKeys})});}export default AssociateModal;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/AssociateModal/AssociateModal.js"],"names":["React","useEffect","useCallback","useHistory","Button","Modal","getSearchableKeys","useRequest","getQSConfig","parseQueryString","useSelected","OptionsList","QS_CONFIG","order_by","page","page_size","AssociateModal","header","columns","title","onClose","onAssociate","fetchRequest","optionsRequest","isModalOpen","displayKey","ouiaId","history","selected","handleSelect","params","location","search","Promise","all","data","count","results","actionsResponse","items","itemCount","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","fetchItems","request","result","contentError","error","isLoading","clearQSParams","parts","replace","split","namespace","otherParts","filter","param","startsWith","pathname","join","handleSave","handleClose","length","name","key","isDefault"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { useHistory } from 'react-router-dom';\n\nimport { t } from '@lingui/macro';\nimport { Button, Modal } from '@patternfly/react-core';\nimport { getSearchableKeys } from 'components/PaginatedTable';\nimport useRequest from 'hooks/useRequest';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport useSelected from 'hooks/useSelected';\nimport OptionsList from '../OptionsList';\n\nconst QS_CONFIG = (order_by = 'name') =>\n  getQSConfig('associate', {\n    page: 1,\n    page_size: 5,\n    order_by,\n  });\n\nfunction AssociateModal({\n  header = t`Items`,\n  columns = [],\n  title = t`Select Items`,\n  onClose,\n  onAssociate,\n  fetchRequest,\n  optionsRequest,\n  isModalOpen = false,\n  displayKey = 'name',\n  ouiaId,\n}) {\n  const history = useHistory();\n  const { selected, handleSelect } = useSelected([]);\n\n  const {\n    request: fetchItems,\n    result: { items, itemCount, relatedSearchableKeys, searchableKeys },\n    error: contentError,\n    isLoading,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(\n        QS_CONFIG(displayKey),\n        history.location.search\n      );\n      const [\n        {\n          data: { count, results },\n        },\n        actionsResponse,\n      ] = await Promise.all([fetchRequest(params), optionsRequest()]);\n\n      return {\n        items: results,\n        itemCount: count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [fetchRequest, optionsRequest, history.location.search, displayKey]),\n    {\n      items: [],\n      itemCount: 0,\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchItems();\n  }, [fetchItems]);\n\n  const clearQSParams = () => {\n    const parts = history.location.search.replace(/^\\?/, '').split('&');\n    const { namespace } = QS_CONFIG(displayKey);\n    const otherParts = parts.filter(\n      (param) => !param.startsWith(`${namespace}.`)\n    );\n    history.replace(`${history.location.pathname}?${otherParts.join('&')}`);\n  };\n\n  const handleSave = async () => {\n    await onAssociate(selected);\n    clearQSParams();\n    onClose();\n  };\n\n  const handleClose = () => {\n    clearQSParams();\n    onClose();\n  };\n\n  return (\n    <Modal\n      ouiaId={ouiaId}\n      variant=\"large\"\n      title={title}\n      aria-label={t`Association modal`}\n      isOpen={isModalOpen}\n      onClose={handleClose}\n      actions={[\n        <Button\n          ouiaId=\"associate-modal-save\"\n          aria-label={t`Save`}\n          key=\"select\"\n          variant=\"primary\"\n          onClick={handleSave}\n          isDisabled={selected.length === 0}\n        >\n          {t`Save`}\n        </Button>,\n        <Button\n          ouiaId=\"associate-modal-cancel\"\n          aria-label={t`Cancel`}\n          key=\"cancel\"\n          variant=\"link\"\n          onClick={handleClose}\n        >\n          {t`Cancel`}\n        </Button>,\n      ]}\n    >\n      <OptionsList\n        displayKey={displayKey}\n        contentError={contentError}\n        columns={columns}\n        deselectItem={handleSelect}\n        header={header}\n        isLoading={isLoading}\n        multiple\n        optionCount={itemCount}\n        options={items}\n        qsConfig={QS_CONFIG(displayKey)}\n        readOnly={false}\n        selectItem={handleSelect}\n        value={selected}\n        searchColumns={[\n          {\n            name: t`Name`,\n            key: `${displayKey}__icontains`,\n            isDefault: true,\n          },\n          {\n            name: t`Created By (Username)`,\n            key: 'created_by__username__icontains',\n          },\n          {\n            name: t`Modified By (Username)`,\n            key: 'modified_by__username__icontains',\n          },\n        ]}\n        sortColumns={[\n          {\n            name: t`Name`,\n            key: `${displayKey}`,\n          },\n        ]}\n        searchableKeys={searchableKeys}\n        relatedSearchableKeys={relatedSearchableKeys}\n      />\n    </Modal>\n  );\n}\n\nexport default AssociateModal;\n"]},"metadata":{},"sourceType":"module"}