{"ast":null,"code":"import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2;import{i18n}from\"@lingui/core\";import React,{useEffect,useRef,useCallback}from'react';import ReactAce from'react-ace';import'ace-builds/src-noconflict/mode-json';import'ace-builds/src-noconflict/mode-javascript';import'ace-builds/src-noconflict/mode-yaml';import'ace-builds/src-noconflict/mode-django';import'ace-builds/src-noconflict/theme-github';import styled from'styled-components';import debounce from'util/debounce';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LINE_HEIGHT=24;var PADDING=12;var FocusWrapper=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  && + .keyboard-help-text {\\n    opacity: 0;\\n    transition: opacity 0.1s linear;\\n  }\\n\\n  &:focus-within + .keyboard-help-text {\\n    opacity: 1;\\n  }\\n\\n  & .ace_hidden-cursors .ace_cursor {\\n    opacity: 0;\\n  }\\n\"])));var AceEditor=styled(ReactAce)(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  font-family: var(--pf-global--FontFamily--monospace);\\n  max-height: 90vh;\\n\\n  & .ace_gutter,\\n  & .ace_scroller {\\n    padding-top: 4px;\\n    padding-bottom: 4px;\\n  }\\n\\n  & .ace_mobile-menu {\\n    display: none;\\n  }\\n\\n  \",\"\\n\\n  \",\"\\n\"])),function(props){return props.hasErrors&&\"\\n    && {\\n      --pf-c-form-control--PaddingRight: var(--pf-c-form-control--invalid--PaddingRight);\\n      --pf-c-form-control--BorderBottomColor: var(--pf-c-form-control--invalid--BorderBottomColor);\\n      padding-right: 24px;\\n      padding-bottom: var(--pf-c-form-control--invalid--PaddingBottom);\\n      background: var(--pf-c-form-control--invalid--Background);\\n      border-bottom-width: var(--pf-c-form-control--invalid--BorderBottomWidth);\\n    }\";},function(props){return props.setOptions.readOnly&&\"\\n    && .ace_cursor {\\n      opacity: 0;\\n    }\\n    \";});AceEditor.displayName='AceEditor';function CodeEditor(_ref){var id=_ref.id,value=_ref.value,onChange=_ref.onChange,onFocus=_ref.onFocus,onBlur=_ref.onBlur,mode=_ref.mode,readOnly=_ref.readOnly,hasErrors=_ref.hasErrors,rows=_ref.rows,fullHeight=_ref.fullHeight,className=_ref.className;if(rows&&typeof rows!=='number'&&rows!=='auto'){// eslint-disable-next-line no-console\nconsole.warn(\"CodeEditor: Unexpected value for 'rows': \".concat(rows,\"; expected number or 'auto'\"));}var wrapper=useRef(null);var editor=useRef(null);useEffect(function(){var _editor$current$refEd;var editorInput=(_editor$current$refEd=editor.current.refEditor)===null||_editor$current$refEd===void 0?void 0:_editor$current$refEd.querySelector('textarea');if(!editorInput){return;}if(!readOnly){editorInput.tabIndex=-1;}editorInput.id=id;},[readOnly,id]);var listen=useCallback(function(event){if(wrapper.current===document.activeElement&&event.key==='Enter'){var _editor$current$refEd2;var editorInput=(_editor$current$refEd2=editor.current.refEditor)===null||_editor$current$refEd2===void 0?void 0:_editor$current$refEd2.querySelector('textarea');if(!editorInput){return;}event.preventDefault();event.stopPropagation();editorInput.focus();}},[]);useEffect(function(){var wrapperEl=wrapper.current;wrapperEl.addEventListener('keydown',listen);return function(){wrapperEl.removeEventListener('keydown',listen);};});var aceModes={javascript:'json',yaml:'yaml',jinja2:'django'};var numRows=rows==='auto'?value.split('\\n').length:rows;var height=fullHeight?'50vh':\"\".concat(numRows*LINE_HEIGHT+PADDING,\"px\");return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FocusWrapper,{ref:wrapper,tabIndex:readOnly?-1:0,children:/*#__PURE__*/_jsx(AceEditor,{mode:aceModes[mode]||'text',className:\"pf-c-form-control \".concat(className),theme:\"github\",onChange:debounce(onChange,250),value:value,onFocus:onFocus,onBlur:onBlur,name:\"\".concat(id,\"-editor\")||'code-editor',editorProps:{$blockScrolling:true},fontSize:16,width:\"100%\",height:height,hasErrors:hasErrors,setOptions:{readOnly:readOnly,highlightActiveLine:!readOnly,highlightGutterLine:!readOnly,useWorker:false,showPrintMargin:false},commands:[{name:'escape',bindKey:{win:'Esc',mac:'Esc'},exec:function exec(){wrapper.current.focus();}},{name:'tab escape',bindKey:{win:'Shift-Tab',mac:'Shift-Tab'},exec:function exec(){wrapper.current.focus();}}],ref:editor})}),!readOnly&&/*#__PURE__*/_jsx(\"div\",{className:\"pf-c-form__helper-text keyboard-help-text\",\"aria-live\":\"polite\",children:/*i18n*/i18n._(\"Press Enter to edit. Press ESC to stop editing.\")})]});}CodeEditor.defaultProps={readOnly:false,onChange:function onChange(){},rows:6,fullHeight:false,hasErrors:false,className:''};export default CodeEditor;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/CodeEditor/CodeEditor.js"],"names":["React","useEffect","useRef","useCallback","ReactAce","styled","debounce","LINE_HEIGHT","PADDING","FocusWrapper","div","AceEditor","props","hasErrors","setOptions","readOnly","displayName","CodeEditor","id","value","onChange","onFocus","onBlur","mode","rows","fullHeight","className","console","warn","wrapper","editor","editorInput","current","refEditor","querySelector","tabIndex","listen","event","document","activeElement","key","preventDefault","stopPropagation","focus","wrapperEl","addEventListener","removeEventListener","aceModes","javascript","yaml","jinja2","numRows","split","length","height","$blockScrolling","highlightActiveLine","highlightGutterLine","useWorker","showPrintMargin","name","bindKey","win","mac","exec","defaultProps"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useCallback } from 'react';\nimport { oneOf, bool, number, string, func, oneOfType } from 'prop-types';\n\nimport ReactAce from 'react-ace';\nimport 'ace-builds/src-noconflict/mode-json';\nimport 'ace-builds/src-noconflict/mode-javascript';\nimport 'ace-builds/src-noconflict/mode-yaml';\nimport 'ace-builds/src-noconflict/mode-django';\nimport 'ace-builds/src-noconflict/theme-github';\n\nimport { t } from '@lingui/macro';\nimport styled from 'styled-components';\nimport debounce from 'util/debounce';\n\nconst LINE_HEIGHT = 24;\nconst PADDING = 12;\n\nconst FocusWrapper = styled.div`\n  && + .keyboard-help-text {\n    opacity: 0;\n    transition: opacity 0.1s linear;\n  }\n\n  &:focus-within + .keyboard-help-text {\n    opacity: 1;\n  }\n\n  & .ace_hidden-cursors .ace_cursor {\n    opacity: 0;\n  }\n`;\n\nconst AceEditor = styled(ReactAce)`\n  font-family: var(--pf-global--FontFamily--monospace);\n  max-height: 90vh;\n\n  & .ace_gutter,\n  & .ace_scroller {\n    padding-top: 4px;\n    padding-bottom: 4px;\n  }\n\n  & .ace_mobile-menu {\n    display: none;\n  }\n\n  ${(props) =>\n    props.hasErrors &&\n    `\n    && {\n      --pf-c-form-control--PaddingRight: var(--pf-c-form-control--invalid--PaddingRight);\n      --pf-c-form-control--BorderBottomColor: var(--pf-c-form-control--invalid--BorderBottomColor);\n      padding-right: 24px;\n      padding-bottom: var(--pf-c-form-control--invalid--PaddingBottom);\n      background: var(--pf-c-form-control--invalid--Background);\n      border-bottom-width: var(--pf-c-form-control--invalid--BorderBottomWidth);\n    }`}\n\n  ${(props) =>\n    props.setOptions.readOnly &&\n    `\n    && .ace_cursor {\n      opacity: 0;\n    }\n    `}\n`;\nAceEditor.displayName = 'AceEditor';\n\nfunction CodeEditor({\n  id,\n  value,\n  onChange,\n  onFocus,\n  onBlur,\n  mode,\n  readOnly,\n  hasErrors,\n  rows,\n  fullHeight,\n  className,\n}) {\n  if (rows && typeof rows !== 'number' && rows !== 'auto') {\n    // eslint-disable-next-line no-console\n    console.warn(\n      `CodeEditor: Unexpected value for 'rows': ${rows}; expected number or 'auto'`\n    );\n  }\n\n  const wrapper = useRef(null);\n  const editor = useRef(null);\n\n  useEffect(() => {\n    const editorInput = editor.current.refEditor?.querySelector('textarea');\n    if (!editorInput) {\n      return;\n    }\n    if (!readOnly) {\n      editorInput.tabIndex = -1;\n    }\n    editorInput.id = id;\n  }, [readOnly, id]);\n\n  const listen = useCallback((event) => {\n    if (wrapper.current === document.activeElement && event.key === 'Enter') {\n      const editorInput = editor.current.refEditor?.querySelector('textarea');\n      if (!editorInput) {\n        return;\n      }\n      event.preventDefault();\n      event.stopPropagation();\n      editorInput.focus();\n    }\n  }, []);\n\n  useEffect(() => {\n    const wrapperEl = wrapper.current;\n    wrapperEl.addEventListener('keydown', listen);\n\n    return () => {\n      wrapperEl.removeEventListener('keydown', listen);\n    };\n  });\n\n  const aceModes = {\n    javascript: 'json',\n    yaml: 'yaml',\n    jinja2: 'django',\n  };\n\n  const numRows = rows === 'auto' ? value.split('\\n').length : rows;\n  const height = fullHeight ? '50vh' : `${numRows * LINE_HEIGHT + PADDING}px`;\n\n  return (\n    <>\n      <FocusWrapper ref={wrapper} tabIndex={readOnly ? -1 : 0}>\n        <AceEditor\n          mode={aceModes[mode] || 'text'}\n          className={`pf-c-form-control ${className}`}\n          theme=\"github\"\n          onChange={debounce(onChange, 250)}\n          value={value}\n          onFocus={onFocus}\n          onBlur={onBlur}\n          name={`${id}-editor` || 'code-editor'}\n          editorProps={{ $blockScrolling: true }}\n          fontSize={16}\n          width=\"100%\"\n          height={height}\n          hasErrors={hasErrors}\n          setOptions={{\n            readOnly,\n            highlightActiveLine: !readOnly,\n            highlightGutterLine: !readOnly,\n            useWorker: false,\n            showPrintMargin: false,\n          }}\n          commands={[\n            {\n              name: 'escape',\n              bindKey: { win: 'Esc', mac: 'Esc' },\n              exec: () => {\n                wrapper.current.focus();\n              },\n            },\n            {\n              name: 'tab escape',\n              bindKey: { win: 'Shift-Tab', mac: 'Shift-Tab' },\n              exec: () => {\n                wrapper.current.focus();\n              },\n            },\n          ]}\n          ref={editor}\n        />\n      </FocusWrapper>\n      {!readOnly && (\n        <div\n          className=\"pf-c-form__helper-text keyboard-help-text\"\n          aria-live=\"polite\"\n        >\n          {t`Press Enter to edit. Press ESC to stop editing.`}\n        </div>\n      )}\n    </>\n  );\n}\nCodeEditor.propTypes = {\n  value: string.isRequired,\n  onChange: func,\n  mode: oneOf(['javascript', 'yaml', 'jinja2']).isRequired,\n  readOnly: bool,\n  hasErrors: bool,\n  fullHeight: bool,\n  rows: oneOfType([number, string]),\n  className: string,\n};\nCodeEditor.defaultProps = {\n  readOnly: false,\n  onChange: () => {},\n  rows: 6,\n  fullHeight: false,\n  hasErrors: false,\n  className: '',\n};\n\nexport default CodeEditor;\n"]},"metadata":{},"sourceType":"module"}