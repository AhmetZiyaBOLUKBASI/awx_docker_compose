{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{useParams,useLocation}from'react-router-dom';import{Card}from'@patternfly/react-core';import{JobTemplatesAPI}from'api';import AlertModal from'components/AlertModal';import DatalistToolbar from'components/DataListToolbar';import ErrorDetail from'components/ErrorDetail';import PaginatedTable,{HeaderRow,HeaderCell,ToolbarAddButton,ToolbarDeleteButton,getSearchableKeys}from'components/PaginatedTable';import{getQSConfig,parseQueryString,mergeParams,encodeQueryString}from'util/qs';import useWsTemplates from'hooks/useWsTemplates';import useSelected from'hooks/useSelected';import useExpanded from'hooks/useExpanded';import useRequest,{useDeleteItems}from'hooks/useRequest';import{TemplateListItem}from'components/TemplateList';import useToast,{AlertVariant}from'hooks/useToast';import{relatedResourceDeleteRequests}from'util/getRelatedResourceDeleteDetails';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('template',{page:1,page_size:20,order_by:'name'});function RelatedTemplateList(_ref){var searchParams=_ref.searchParams,_ref$projectName=_ref.projectName,projectName=_ref$projectName===void 0?null:_ref$projectName;var _useParams=useParams(),projectId=_useParams.id;var location=useLocation();var _useToast=useToast(),addToast=_useToast.addToast,Toast=_useToast.Toast,toastProps=_useToast.toastProps;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,response,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,location.search);_context.next=3;return Promise.all([JobTemplatesAPI.read(mergeParams(params,searchParams)),JobTemplatesAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);response=_yield$Promise$all2[0];actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{results:response.data.results,itemCount:response.data.count,actions:actionsResponse.data.actions,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 8:case\"end\":return _context.stop();}}},_callee);})),[location]),// eslint-disable-line react-hooks/exhaustive-deps\n{results:[],itemCount:0,actions:{},relatedSearchableKeys:[],searchableKeys:[]}),_useRequest$result=_useRequest.result,results=_useRequest$result.results,itemCount=_useRequest$result.itemCount,actions=_useRequest$result.actions,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,contentError=_useRequest.error,isLoading=_useRequest.isLoading,fetchTemplates=_useRequest.request;useEffect(function(){fetchTemplates();},[fetchTemplates]);var jobTemplates=useWsTemplates(results);var _useSelected=useSelected(jobTemplates),selected=_useSelected.selected,isAllSelected=_useSelected.isAllSelected,handleSelect=_useSelected.handleSelect,clearSelected=_useSelected.clearSelected,selectAll=_useSelected.selectAll;var _useExpanded=useExpanded(jobTemplates),expanded=_useExpanded.expanded,isAllExpanded=_useExpanded.isAllExpanded,handleExpand=_useExpanded.handleExpand,expandAll=_useExpanded.expandAll;var _useDeleteItems=useDeleteItems(useCallback(function(){return Promise.all(selected.map(function(template){return JobTemplatesAPI.destroy(template.id);}));},[selected]),{qsConfig:QS_CONFIG,allItemsSelected:isAllSelected,fetchItems:fetchTemplates}),isDeleteLoading=_useDeleteItems.isLoading,deleteTemplates=_useDeleteItems.deleteItems,deletionError=_useDeleteItems.deletionError,clearDeletionError=_useDeleteItems.clearDeletionError;var handleCopy=useCallback(function(newTemplateId){addToast({id:newTemplateId,title:/*i18n*/i18n._(\"Template copied successfully\"),variant:AlertVariant.success,hasTimeout:true});},[addToast]);var handleTemplateDelete=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return deleteTemplates();case 2:clearSelected();case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleTemplateDelete(){return _ref3.apply(this,arguments);};}();var canAddJT=actions&&Object.prototype.hasOwnProperty.call(actions,'POST');var linkTo='';if(projectName){var qs=encodeQueryString({project_id:projectId,project_name:projectName});linkTo=\"/templates/job_template/add/?\".concat(qs);}else{linkTo='/templates/job_template/add';}var addButton=/*#__PURE__*/_jsx(ToolbarAddButton,{linkTo:linkTo},\"add\");var deleteDetailsRequests=relatedResourceDeleteRequests.template(selected[0]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(PaginatedTable,{contentError:contentError,hasContentLoading:isDeleteLoading||isLoading,items:jobTemplates,itemCount:itemCount,pluralizedItemName:/*i18n*/i18n._(\"Job templates\"),qsConfig:QS_CONFIG,clearSelected:clearSelected,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username__icontains'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username__icontains'},{name:/*i18n*/i18n._(\"Playbook name\"),key:'job_template__playbook__icontains'},{name:/*i18n*/i18n._(\"Label\"),key:'labels__name__icontains'}],toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,isExpandable:true,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"type\",children:/*i18n*/i18n._(\"Type\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Recent jobs\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Actions\")})]}),renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DatalistToolbar,_objectSpread(_objectSpread({},props),{},{isAllSelected:isAllSelected,onSelectAll:selectAll,isAllExpanded:isAllExpanded,onExpandAll:expandAll,qsConfig:QS_CONFIG,additionalControls:[].concat(_toConsumableArray(canAddJT?[addButton]:[]),[/*#__PURE__*/_jsx(ToolbarDeleteButton,{onDelete:handleTemplateDelete,itemsToDelete:selected,pluralizedItemName:/*i18n*/i18n._(\"Job templates\"),deleteDetailsRequests:deleteDetailsRequests,deleteMessage:/*#__PURE__*/_jsx(Trans,{id:\"{0, plural, one {This template is currently being used by some workflow nodes. Are you sure you want to delete it?} other {Deleting these templates could impact some workflow nodes that rely on them. Are you sure you want to delete anyway?}}\",values:{0:selected.length}})},\"delete\")])}));},renderRow:function renderRow(template,index){return/*#__PURE__*/_jsx(TemplateListItem,{value:template.name,template:template,detailUrl:\"/templates/\".concat(template.type,\"/\").concat(template.id),onSelect:function onSelect(){return handleSelect(template);},isExpanded:expanded.some(function(row){return row.id===template.id;}),onExpand:function onExpand(){return handleExpand(template);},onCopy:handleCopy,isSelected:selected.some(function(row){return row.id===template.id;}),fetchTemplates:fetchTemplates,rowIndex:index},template.id);},emptyStateControls:canAddJT&&addButton})}),/*#__PURE__*/_jsx(Toast,_objectSpread({},toastProps)),/*#__PURE__*/_jsxs(AlertModal,{isOpen:deletionError,variant:\"danger\",title:/*i18n*/i18n._(\"Error!\"),onClose:clearDeletionError,children:[/*i18n*/i18n._(\"Failed to delete one or more job templates.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:deletionError})]})]});}export default RelatedTemplateList;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/RelatedTemplateList/RelatedTemplateList.js"],"names":["React","useCallback","useEffect","useParams","useLocation","Card","JobTemplatesAPI","AlertModal","DatalistToolbar","ErrorDetail","PaginatedTable","HeaderRow","HeaderCell","ToolbarAddButton","ToolbarDeleteButton","getSearchableKeys","getQSConfig","parseQueryString","mergeParams","encodeQueryString","useWsTemplates","useSelected","useExpanded","useRequest","useDeleteItems","TemplateListItem","useToast","AlertVariant","relatedResourceDeleteRequests","QS_CONFIG","page","page_size","order_by","RelatedTemplateList","searchParams","projectName","projectId","id","location","addToast","Toast","toastProps","params","search","Promise","all","read","readOptions","response","actionsResponse","results","data","itemCount","count","actions","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","GET","result","contentError","error","isLoading","fetchTemplates","request","jobTemplates","selected","isAllSelected","handleSelect","clearSelected","selectAll","expanded","isAllExpanded","handleExpand","expandAll","template","destroy","qsConfig","allItemsSelected","fetchItems","isDeleteLoading","deleteTemplates","deleteItems","deletionError","clearDeletionError","handleCopy","newTemplateId","title","variant","success","hasTimeout","handleTemplateDelete","canAddJT","Object","prototype","hasOwnProperty","call","linkTo","qs","project_id","project_name","addButton","deleteDetailsRequests","name","key","isDefault","props","length","index","type","some","row"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useParams, useLocation } from 'react-router-dom';\n\nimport { t, Plural } from '@lingui/macro';\nimport { Card } from '@patternfly/react-core';\nimport { JobTemplatesAPI } from 'api';\nimport AlertModal from 'components/AlertModal';\nimport DatalistToolbar from 'components/DataListToolbar';\nimport ErrorDetail from 'components/ErrorDetail';\nimport PaginatedTable, {\n  HeaderRow,\n  HeaderCell,\n  ToolbarAddButton,\n  ToolbarDeleteButton,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\nimport {\n  getQSConfig,\n  parseQueryString,\n  mergeParams,\n  encodeQueryString,\n} from 'util/qs';\nimport useWsTemplates from 'hooks/useWsTemplates';\nimport useSelected from 'hooks/useSelected';\nimport useExpanded from 'hooks/useExpanded';\nimport useRequest, { useDeleteItems } from 'hooks/useRequest';\nimport { TemplateListItem } from 'components/TemplateList';\nimport useToast, { AlertVariant } from 'hooks/useToast';\nimport { relatedResourceDeleteRequests } from 'util/getRelatedResourceDeleteDetails';\n\nconst QS_CONFIG = getQSConfig('template', {\n  page: 1,\n  page_size: 20,\n  order_by: 'name',\n});\n\nfunction RelatedTemplateList({ searchParams, projectName = null }) {\n  const { id: projectId } = useParams();\n  const location = useLocation();\n  const { addToast, Toast, toastProps } = useToast();\n\n  const {\n    result: {\n      results,\n      itemCount,\n      actions,\n      relatedSearchableKeys,\n      searchableKeys,\n    },\n    error: contentError,\n    isLoading,\n    request: fetchTemplates,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, location.search);\n      const [response, actionsResponse] = await Promise.all([\n        JobTemplatesAPI.read(mergeParams(params, searchParams)),\n        JobTemplatesAPI.readOptions(),\n      ]);\n      return {\n        results: response.data.results,\n        itemCount: response.data.count,\n        actions: actionsResponse.data.actions,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [location]), // eslint-disable-line react-hooks/exhaustive-deps\n    {\n      results: [],\n      itemCount: 0,\n      actions: {},\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchTemplates();\n  }, [fetchTemplates]);\n\n  const jobTemplates = useWsTemplates(results);\n\n  const { selected, isAllSelected, handleSelect, clearSelected, selectAll } =\n    useSelected(jobTemplates);\n\n  const { expanded, isAllExpanded, handleExpand, expandAll } =\n    useExpanded(jobTemplates);\n\n  const {\n    isLoading: isDeleteLoading,\n    deleteItems: deleteTemplates,\n    deletionError,\n    clearDeletionError,\n  } = useDeleteItems(\n    useCallback(\n      () =>\n        Promise.all(\n          selected.map((template) => JobTemplatesAPI.destroy(template.id))\n        ),\n      [selected]\n    ),\n    {\n      qsConfig: QS_CONFIG,\n      allItemsSelected: isAllSelected,\n      fetchItems: fetchTemplates,\n    }\n  );\n\n  const handleCopy = useCallback(\n    (newTemplateId) => {\n      addToast({\n        id: newTemplateId,\n        title: t`Template copied successfully`,\n        variant: AlertVariant.success,\n        hasTimeout: true,\n      });\n    },\n    [addToast]\n  );\n\n  const handleTemplateDelete = async () => {\n    await deleteTemplates();\n    clearSelected();\n  };\n\n  const canAddJT =\n    actions && Object.prototype.hasOwnProperty.call(actions, 'POST');\n\n  let linkTo = '';\n\n  if (projectName) {\n    const qs = encodeQueryString({\n      project_id: projectId,\n      project_name: projectName,\n    });\n    linkTo = `/templates/job_template/add/?${qs}`;\n  } else {\n    linkTo = '/templates/job_template/add';\n  }\n  const addButton = <ToolbarAddButton key=\"add\" linkTo={linkTo} />;\n\n  const deleteDetailsRequests = relatedResourceDeleteRequests.template(\n    selected[0]\n  );\n\n  return (\n    <>\n      <Card>\n        <PaginatedTable\n          contentError={contentError}\n          hasContentLoading={isDeleteLoading || isLoading}\n          items={jobTemplates}\n          itemCount={itemCount}\n          pluralizedItemName={t`Job templates`}\n          qsConfig={QS_CONFIG}\n          clearSelected={clearSelected}\n          toolbarSearchColumns={[\n            {\n              name: t`Name`,\n              key: 'name__icontains',\n              isDefault: true,\n            },\n            {\n              name: t`Created By (Username)`,\n              key: 'created_by__username__icontains',\n            },\n            {\n              name: t`Modified By (Username)`,\n              key: 'modified_by__username__icontains',\n            },\n            {\n              name: t`Playbook name`,\n              key: 'job_template__playbook__icontains',\n            },\n            {\n              name: t`Label`,\n              key: 'labels__name__icontains',\n            },\n          ]}\n          toolbarSearchableKeys={searchableKeys}\n          toolbarRelatedSearchableKeys={relatedSearchableKeys}\n          headerRow={\n            <HeaderRow qsConfig={QS_CONFIG} isExpandable>\n              <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n              <HeaderCell sortKey=\"type\">{t`Type`}</HeaderCell>\n              <HeaderCell>{t`Recent jobs`}</HeaderCell>\n              <HeaderCell>{t`Actions`}</HeaderCell>\n            </HeaderRow>\n          }\n          renderToolbar={(props) => (\n            <DatalistToolbar\n              {...props}\n              isAllSelected={isAllSelected}\n              onSelectAll={selectAll}\n              isAllExpanded={isAllExpanded}\n              onExpandAll={expandAll}\n              qsConfig={QS_CONFIG}\n              additionalControls={[\n                ...(canAddJT ? [addButton] : []),\n                <ToolbarDeleteButton\n                  key=\"delete\"\n                  onDelete={handleTemplateDelete}\n                  itemsToDelete={selected}\n                  pluralizedItemName={t`Job templates`}\n                  deleteDetailsRequests={deleteDetailsRequests}\n                  deleteMessage={\n                    <Plural\n                      value={selected.length}\n                      one=\"This template is currently being used by some workflow nodes. Are you sure you want to delete it?\"\n                      other=\"Deleting these templates could impact some workflow nodes that rely on them. Are you sure you want to delete anyway?\"\n                    />\n                  }\n                />,\n              ]}\n            />\n          )}\n          renderRow={(template, index) => (\n            <TemplateListItem\n              key={template.id}\n              value={template.name}\n              template={template}\n              detailUrl={`/templates/${template.type}/${template.id}`}\n              onSelect={() => handleSelect(template)}\n              isExpanded={expanded.some((row) => row.id === template.id)}\n              onExpand={() => handleExpand(template)}\n              onCopy={handleCopy}\n              isSelected={selected.some((row) => row.id === template.id)}\n              fetchTemplates={fetchTemplates}\n              rowIndex={index}\n            />\n          )}\n          emptyStateControls={canAddJT && addButton}\n        />\n      </Card>\n      <Toast {...toastProps} />\n      <AlertModal\n        isOpen={deletionError}\n        variant=\"danger\"\n        title={t`Error!`}\n        onClose={clearDeletionError}\n      >\n        {t`Failed to delete one or more job templates.`}\n        <ErrorDetail error={deletionError} />\n      </AlertModal>\n    </>\n  );\n}\n\nexport default RelatedTemplateList;\n"]},"metadata":{},"sourceType":"module"}