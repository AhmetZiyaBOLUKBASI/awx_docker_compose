{"ast":null,"code":"import _defineProperty from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";var ws;export default function connectJobSocket(_ref,onMessage){var type=_ref.type,id=_ref.id;ws=new WebSocket(\"\".concat(window.location.protocol==='http:'?'ws:':'wss:',\"//\").concat(window.location.host).concat(window.location.pathname,\"websocket/\"));ws.onopen=function(){var xrftoken=\"; \".concat(document.cookie).split('; csrftoken=').pop().split(';').shift();var eventGroup=\"\".concat(type,\"_events\");ws.send(JSON.stringify({xrftoken:xrftoken,groups:_defineProperty({jobs:['summary','status_changed']},eventGroup,[id])}));};ws.onmessage=function(e){onMessage(JSON.parse(e.data));};ws.onclose=function(e){if(e.code!==1000){// eslint-disable-next-line no-console\nconsole.debug('Socket closed. Reconnecting...',e);setTimeout(function(){connectJobSocket({type:type,id:id},onMessage);},1000);}};ws.onerror=function(err){// eslint-disable-next-line no-console\nconsole.debug('Socket error: ',err,'Disconnecting...');ws.close();};}export function closeWebSocket(){if(ws){ws.close();}}","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Job/JobOutput/connectJobSocket.js"],"names":["ws","connectJobSocket","onMessage","type","id","WebSocket","window","location","protocol","host","pathname","onopen","xrftoken","document","cookie","split","pop","shift","eventGroup","send","JSON","stringify","groups","jobs","onmessage","e","parse","data","onclose","code","console","debug","setTimeout","onerror","err","close","closeWebSocket"],"mappings":"yGAAA,GAAIA,CAAAA,EAAJ,CAEA,cAAe,SAASC,CAAAA,gBAAT,MAAwCC,SAAxC,CAAmD,IAAvBC,CAAAA,IAAuB,MAAvBA,IAAuB,CAAjBC,EAAiB,MAAjBA,EAAiB,CAChEJ,EAAE,CAAG,GAAIK,CAAAA,SAAJ,WACAC,MAAM,CAACC,QAAP,CAAgBC,QAAhB,GAA6B,OAA7B,CAAuC,KAAvC,CAA+C,MAD/C,cAEDF,MAAM,CAACC,QAAP,CAAgBE,IAFf,SAGAH,MAAM,CAACC,QAAP,CAAgBG,QAHhB,eAAL,CAMAV,EAAE,CAACW,MAAH,CAAY,UAAM,CAChB,GAAMC,CAAAA,QAAQ,CAAG,YAAKC,QAAQ,CAACC,MAAd,EACdC,KADc,CACR,cADQ,EAEdC,GAFc,GAGdD,KAHc,CAGR,GAHQ,EAIdE,KAJc,EAAjB,CAKA,GAAMC,CAAAA,UAAU,WAAMf,IAAN,WAAhB,CACAH,EAAE,CAACmB,IAAH,CACEC,IAAI,CAACC,SAAL,CAAe,CACbT,QAAQ,CAARA,QADa,CAEbU,MAAM,kBAAIC,IAAI,CAAE,CAAC,SAAD,CAAY,gBAAZ,CAAV,EAA0CL,UAA1C,CAAuD,CAACd,EAAD,CAAvD,CAFO,CAAf,CADF,EAMD,CAbD,CAeAJ,EAAE,CAACwB,SAAH,CAAe,SAACC,CAAD,CAAO,CACpBvB,SAAS,CAACkB,IAAI,CAACM,KAAL,CAAWD,CAAC,CAACE,IAAb,CAAD,CAAT,CACD,CAFD,CAIA3B,EAAE,CAAC4B,OAAH,CAAa,SAACH,CAAD,CAAO,CAClB,GAAIA,CAAC,CAACI,IAAF,GAAW,IAAf,CAAqB,CACnB;AACAC,OAAO,CAACC,KAAR,CAAc,gCAAd,CAAgDN,CAAhD,EACAO,UAAU,CAAC,UAAM,CACf/B,gBAAgB,CAAC,CAAEE,IAAI,CAAJA,IAAF,CAAQC,EAAE,CAAFA,EAAR,CAAD,CAAeF,SAAf,CAAhB,CACD,CAFS,CAEP,IAFO,CAAV,CAGD,CACF,CARD,CAUAF,EAAE,CAACiC,OAAH,CAAa,SAACC,GAAD,CAAS,CACpB;AACAJ,OAAO,CAACC,KAAR,CAAc,gBAAd,CAAgCG,GAAhC,CAAqC,kBAArC,EACAlC,EAAE,CAACmC,KAAH,GACD,CAJD,CAKD,CAED,MAAO,SAASC,CAAAA,cAAT,EAA0B,CAC/B,GAAIpC,EAAJ,CAAQ,CACNA,EAAE,CAACmC,KAAH,GACD,CACF","sourcesContent":["let ws;\n\nexport default function connectJobSocket({ type, id }, onMessage) {\n  ws = new WebSocket(\n    `${window.location.protocol === 'http:' ? 'ws:' : 'wss:'}//${\n      window.location.host\n    }${window.location.pathname}websocket/`\n  );\n\n  ws.onopen = () => {\n    const xrftoken = `; ${document.cookie}`\n      .split('; csrftoken=')\n      .pop()\n      .split(';')\n      .shift();\n    const eventGroup = `${type}_events`;\n    ws.send(\n      JSON.stringify({\n        xrftoken,\n        groups: { jobs: ['summary', 'status_changed'], [eventGroup]: [id] },\n      })\n    );\n  };\n\n  ws.onmessage = (e) => {\n    onMessage(JSON.parse(e.data));\n  };\n\n  ws.onclose = (e) => {\n    if (e.code !== 1000) {\n      // eslint-disable-next-line no-console\n      console.debug('Socket closed. Reconnecting...', e);\n      setTimeout(() => {\n        connectJobSocket({ type, id }, onMessage);\n      }, 1000);\n    }\n  };\n\n  ws.onerror = (err) => {\n    // eslint-disable-next-line no-console\n    console.debug('Socket error: ', err, 'Disconnecting...');\n    ws.close();\n  };\n}\n\nexport function closeWebSocket() {\n  if (ws) {\n    ws.close();\n  }\n}\n"]},"metadata":{},"sourceType":"module"}