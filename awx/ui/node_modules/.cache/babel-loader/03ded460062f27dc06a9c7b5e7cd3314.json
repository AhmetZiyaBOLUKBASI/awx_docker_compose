{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _styled from\"styled-components\";import{i18n}from\"@lingui/core\";import React,{useEffect,useRef}from'react';import{useField,useFormikContext}from'formik';import{Switch,Text}from'@patternfly/react-core';import{FormFullWidthLayout,SubFormLayout}from'components/FormLayout';import CodeEditorField from'components/CodeEditor/CodeEditorField';import{useConfig}from'contexts/Config';import getDocsBaseUrl from'util/getDocsBaseUrl';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var _StyledText=_styled(Text).withConfig({displayName:\"CustomMessagesSubForm___StyledText\",componentId:\"sc-23o7iq-0\"})([\"margin-bottom:var(--pf-c-content--MarginBottom)\"]);function CustomMessagesSubForm(_ref){var defaultMessages=_ref.defaultMessages,type=_ref.type;var _useField=useField('useCustomMessages'),_useField2=_slicedToArray(_useField,3),useCustomField=_useField2[0],useCustomHelpers=_useField2[2];var showMessages=type!=='webhook';var showBodies=['email','pagerduty','webhook'].includes(type);var _useFormikContext=useFormikContext(),setFieldValue=_useFormikContext.setFieldValue;var config=useConfig();var mountedRef=useRef(null);useEffect(function(){if(!mountedRef.current){mountedRef.current=true;return;}var defs=defaultMessages[type];var resetFields=function resetFields(name,defaults){setFieldValue(\"\".concat(name,\".message\"),defaults.message||'');setFieldValue(\"\".concat(name,\".body\"),defaults.body||'');};resetFields('messages.started',defs.started);resetFields('messages.success',defs.success);resetFields('messages.error',defs.error);resetFields('messages.workflow_approval.approved',defs.workflow_approval.approved);resetFields('messages.workflow_approval.denied',defs.workflow_approval.denied);resetFields('messages.workflow_approval.running',defs.workflow_approval.running);resetFields('messages.workflow_approval.timed_out',defs.workflow_approval.timed_out);},// eslint-disable-next-line react-hooks/exhaustive-deps\n[type,setFieldValue]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Switch,{id:\"toggle-custom-messages\",label:/*i18n*/i18n._(\"Customize messages\\u2026\"),isChecked:!!useCustomField.value,onChange:function onChange(){return useCustomHelpers.setValue(!useCustomField.value);}}),useCustomField.value&&/*#__PURE__*/_jsxs(SubFormLayout,{children:[/*#__PURE__*/_jsx(_StyledText,{className:\"pf-c-content\",children:/*#__PURE__*/_jsxs(\"small\",{children:[/*i18n*/i18n._(\"Use custom messages to change the content of\\nnotifications sent when a job starts, succeeds, or fails. Use\\ncurly braces to access information about the job:\"),' ',/*#__PURE__*/_jsxs(\"code\",{children:['{{',\" job_friendly_name \",'}}']}),\",\",' ',/*#__PURE__*/_jsxs(\"code\",{children:['{{',\" url \",'}}']}),\",\",' ',/*#__PURE__*/_jsxs(\"code\",{children:['{{',\" job.status \",'}}']}),\".\",' ',/*i18n*/i18n._(\"You may apply a number of possible variables in the\\nmessage. For more information, refer to the\"),' ',/*#__PURE__*/_jsx(\"a\",{target:\"_blank\",rel:\"noopener noreferrer\",href:\"\".concat(getDocsBaseUrl(config),\"/html/userguide/notifications.html#create-custom-notifications\"),children:/*i18n*/i18n._(\"Ansible Controller Documentation.\")})]})}),/*#__PURE__*/_jsxs(FormFullWidthLayout,{children:[showMessages&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"start-message\",name:\"messages.started.message\",label:/*i18n*/i18n._(\"Start message\"),mode:\"jinja2\",rows:2}),showBodies&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"start-body\",name:\"messages.started.body\",label:/*i18n*/i18n._(\"Start message body\"),mode:\"jinja2\",rows:6}),showMessages&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"success-message\",name:\"messages.success.message\",label:/*i18n*/i18n._(\"Success message\"),mode:\"jinja2\",rows:2}),showBodies&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"success-body\",name:\"messages.success.body\",label:/*i18n*/i18n._(\"Success message body\"),mode:\"jinja2\",rows:6}),showMessages&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"error-message\",name:\"messages.error.message\",label:/*i18n*/i18n._(\"Error message\"),mode:\"jinja2\",rows:2}),showBodies&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"error-body\",name:\"messages.error.body\",label:/*i18n*/i18n._(\"Error message body\"),mode:\"jinja2\",rows:6}),showMessages&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"wf-approved-message\",name:\"messages.workflow_approval.approved.message\",label:/*i18n*/i18n._(\"Workflow approved message\"),mode:\"jinja2\",rows:2}),showBodies&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"wf-approved-body\",name:\"messages.workflow_approval.approved.body\",label:/*i18n*/i18n._(\"Workflow approved message body\"),mode:\"jinja2\",rows:6}),showMessages&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"wf-denied-message\",name:\"messages.workflow_approval.denied.message\",label:/*i18n*/i18n._(\"Workflow denied message\"),mode:\"jinja2\",rows:2}),showBodies&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"wf-denied-body\",name:\"messages.workflow_approval.denied.body\",label:/*i18n*/i18n._(\"Workflow denied message body\"),mode:\"jinja2\",rows:6}),showMessages&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"wf-running-message\",name:\"messages.workflow_approval.running.message\",label:/*i18n*/i18n._(\"Workflow pending message\"),mode:\"jinja2\",rows:2}),showBodies&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"wf-running-body\",name:\"messages.workflow_approval.running.body\",label:/*i18n*/i18n._(\"Workflow pending message body\"),mode:\"jinja2\",rows:6}),showMessages&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"wf-timed-out-message\",name:\"messages.workflow_approval.timed_out.message\",label:/*i18n*/i18n._(\"Workflow timed out message\"),mode:\"jinja2\",rows:2}),showBodies&&/*#__PURE__*/_jsx(CodeEditorField,{id:\"wf-timed-out-body\",name:\"messages.workflow_approval.timed_out.body\",label:/*i18n*/i18n._(\"Workflow timed out message body\"),mode:\"jinja2\",rows:6})]})]})]});}export default CustomMessagesSubForm;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/NotificationTemplate/shared/CustomMessagesSubForm.js"],"names":["React","useEffect","useRef","useField","useFormikContext","Switch","Text","FormFullWidthLayout","SubFormLayout","CodeEditorField","useConfig","getDocsBaseUrl","CustomMessagesSubForm","defaultMessages","type","useCustomField","useCustomHelpers","showMessages","showBodies","includes","setFieldValue","config","mountedRef","current","defs","resetFields","name","defaults","message","body","started","success","error","workflow_approval","approved","denied","running","timed_out","value","setValue"],"mappings":"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","sourcesContent":["import 'styled-components/macro';\nimport React, { useEffect, useRef } from 'react';\n\nimport { t } from '@lingui/macro';\nimport { useField, useFormikContext } from 'formik';\nimport { Switch, Text } from '@patternfly/react-core';\nimport { FormFullWidthLayout, SubFormLayout } from 'components/FormLayout';\nimport CodeEditorField from 'components/CodeEditor/CodeEditorField';\nimport { useConfig } from 'contexts/Config';\nimport getDocsBaseUrl from 'util/getDocsBaseUrl';\n\nfunction CustomMessagesSubForm({ defaultMessages, type }) {\n  const [useCustomField, , useCustomHelpers] = useField('useCustomMessages');\n  const showMessages = type !== 'webhook';\n  const showBodies = ['email', 'pagerduty', 'webhook'].includes(type);\n\n  const { setFieldValue } = useFormikContext();\n  const config = useConfig();\n  const mountedRef = useRef(null);\n  useEffect(\n    () => {\n      if (!mountedRef.current) {\n        mountedRef.current = true;\n        return;\n      }\n      const defs = defaultMessages[type];\n\n      const resetFields = (name, defaults) => {\n        setFieldValue(`${name}.message`, defaults.message || '');\n        setFieldValue(`${name}.body`, defaults.body || '');\n      };\n\n      resetFields('messages.started', defs.started);\n      resetFields('messages.success', defs.success);\n      resetFields('messages.error', defs.error);\n      resetFields(\n        'messages.workflow_approval.approved',\n        defs.workflow_approval.approved\n      );\n      resetFields(\n        'messages.workflow_approval.denied',\n        defs.workflow_approval.denied\n      );\n      resetFields(\n        'messages.workflow_approval.running',\n        defs.workflow_approval.running\n      );\n      resetFields(\n        'messages.workflow_approval.timed_out',\n        defs.workflow_approval.timed_out\n      );\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [type, setFieldValue]\n  );\n\n  return (\n    <>\n      <Switch\n        id=\"toggle-custom-messages\"\n        label={t`Customize messages…`}\n        isChecked={!!useCustomField.value}\n        onChange={() => useCustomHelpers.setValue(!useCustomField.value)}\n      />\n      {useCustomField.value && (\n        <SubFormLayout>\n          <Text\n            className=\"pf-c-content\"\n            css=\"margin-bottom: var(--pf-c-content--MarginBottom)\"\n          >\n            <small>\n              {t`Use custom messages to change the content of\n                notifications sent when a job starts, succeeds, or fails. Use\n                curly braces to access information about the job:`}{' '}\n              <code>\n                {'{{'} job_friendly_name {'}}'}\n              </code>\n              ,{' '}\n              <code>\n                {'{{'} url {'}}'}\n              </code>\n              ,{' '}\n              <code>\n                {'{{'} job.status {'}}'}\n              </code>\n              .{' '}\n              {t`You may apply a number of possible variables in the\n                message. For more information, refer to the`}{' '}\n              <a\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                href={`${getDocsBaseUrl(\n                  config\n                )}/html/userguide/notifications.html#create-custom-notifications`}\n              >\n                {t`Ansible Controller Documentation.`}\n              </a>\n            </small>\n          </Text>\n          <FormFullWidthLayout>\n            {showMessages && (\n              <CodeEditorField\n                id=\"start-message\"\n                name=\"messages.started.message\"\n                label={t`Start message`}\n                mode=\"jinja2\"\n                rows={2}\n              />\n            )}\n            {showBodies && (\n              <CodeEditorField\n                id=\"start-body\"\n                name=\"messages.started.body\"\n                label={t`Start message body`}\n                mode=\"jinja2\"\n                rows={6}\n              />\n            )}\n            {showMessages && (\n              <CodeEditorField\n                id=\"success-message\"\n                name=\"messages.success.message\"\n                label={t`Success message`}\n                mode=\"jinja2\"\n                rows={2}\n              />\n            )}\n            {showBodies && (\n              <CodeEditorField\n                id=\"success-body\"\n                name=\"messages.success.body\"\n                label={t`Success message body`}\n                mode=\"jinja2\"\n                rows={6}\n              />\n            )}\n            {showMessages && (\n              <CodeEditorField\n                id=\"error-message\"\n                name=\"messages.error.message\"\n                label={t`Error message`}\n                mode=\"jinja2\"\n                rows={2}\n              />\n            )}\n            {showBodies && (\n              <CodeEditorField\n                id=\"error-body\"\n                name=\"messages.error.body\"\n                label={t`Error message body`}\n                mode=\"jinja2\"\n                rows={6}\n              />\n            )}\n            {showMessages && (\n              <CodeEditorField\n                id=\"wf-approved-message\"\n                name=\"messages.workflow_approval.approved.message\"\n                label={t`Workflow approved message`}\n                mode=\"jinja2\"\n                rows={2}\n              />\n            )}\n            {showBodies && (\n              <CodeEditorField\n                id=\"wf-approved-body\"\n                name=\"messages.workflow_approval.approved.body\"\n                label={t`Workflow approved message body`}\n                mode=\"jinja2\"\n                rows={6}\n              />\n            )}\n            {showMessages && (\n              <CodeEditorField\n                id=\"wf-denied-message\"\n                name=\"messages.workflow_approval.denied.message\"\n                label={t`Workflow denied message`}\n                mode=\"jinja2\"\n                rows={2}\n              />\n            )}\n            {showBodies && (\n              <CodeEditorField\n                id=\"wf-denied-body\"\n                name=\"messages.workflow_approval.denied.body\"\n                label={t`Workflow denied message body`}\n                mode=\"jinja2\"\n                rows={6}\n              />\n            )}\n            {showMessages && (\n              <CodeEditorField\n                id=\"wf-running-message\"\n                name=\"messages.workflow_approval.running.message\"\n                label={t`Workflow pending message`}\n                mode=\"jinja2\"\n                rows={2}\n              />\n            )}\n            {showBodies && (\n              <CodeEditorField\n                id=\"wf-running-body\"\n                name=\"messages.workflow_approval.running.body\"\n                label={t`Workflow pending message body`}\n                mode=\"jinja2\"\n                rows={6}\n              />\n            )}\n            {showMessages && (\n              <CodeEditorField\n                id=\"wf-timed-out-message\"\n                name=\"messages.workflow_approval.timed_out.message\"\n                label={t`Workflow timed out message`}\n                mode=\"jinja2\"\n                rows={2}\n              />\n            )}\n            {showBodies && (\n              <CodeEditorField\n                id=\"wf-timed-out-body\"\n                name=\"messages.workflow_approval.timed_out.body\"\n                label={t`Workflow timed out message body`}\n                mode=\"jinja2\"\n                rows={6}\n              />\n            )}\n          </FormFullWidthLayout>\n        </SubFormLayout>\n      )}\n    </>\n  );\n}\n\nexport default CustomMessagesSubForm;\n"]},"metadata":{},"sourceType":"module"}