{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";var _excluded=[\"children\"];import React,{useEffect}from'react';import{useRouteMatch,useLocation,HashRouter,Route,Switch,Redirect,useHistory}from'react-router-dom';import{ErrorBoundary}from'react-error-boundary';import{I18nProvider}from'@lingui/react';import{i18n}from'@lingui/core';import{Card,PageSection}from'@patternfly/react-core';import{ConfigProvider,useAuthorizedPath,useUserProfile}from'contexts/Config';import{SessionProvider,useSession}from'contexts/Session';import AppContainer from'components/AppContainer';import Background from'components/Background';import ContentError from'components/ContentError';import NotFound from'screens/NotFound';import Login from'screens/Login';import{isAuthenticated}from'util/auth';import{getLanguageWithoutRegionCode}from'util/language';import Metrics from'screens/Metrics';import SubscriptionEdit from'screens/Setting/Subscription/SubscriptionEdit';import useTitle from'hooks/useTitle';import{dynamicActivate,locales}from'./i18nLoader';import getRouteConfig from'./routeConfig';import{SESSION_REDIRECT_URL}from'./constants';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ErrorFallback(_ref){var error=_ref.error;return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(ContentError,{error:error})})});}var RenderAppContainer=function RenderAppContainer(){var userProfile=useUserProfile();var navRouteConfig=getRouteConfig(userProfile);return/*#__PURE__*/_jsx(AppContainer,{navRouteConfig:navRouteConfig,children:/*#__PURE__*/_jsx(AuthorizedRoutes,{routeConfig:navRouteConfig})});};var AuthorizedRoutes=function AuthorizedRoutes(_ref2){var routeConfig=_ref2.routeConfig;var isAuthorized=useAuthorizedPath();var match=useRouteMatch();if(!isAuthorized){return/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{path:\"/subscription_management\",children:/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(SubscriptionEdit,{})})})},\"/subscription_management\"),/*#__PURE__*/_jsx(Route,{path:\"*\",children:/*#__PURE__*/_jsx(Redirect,{to:\"/subscription_management\"})})]});}return/*#__PURE__*/_jsx(Switch,{children:routeConfig.flatMap(function(_ref3){var routes=_ref3.routes;return routes;}).map(function(_ref4){var path=_ref4.path,Screen=_ref4.screen;return/*#__PURE__*/_jsx(ProtectedRoute,{path:path,children:/*#__PURE__*/_jsx(Screen,{match:match})},path);}).concat(/*#__PURE__*/_jsx(ProtectedRoute,{path:\"/metrics\",children:/*#__PURE__*/_jsx(Metrics,{})},\"metrics\"),/*#__PURE__*/_jsx(ProtectedRoute,{path:\"*\",children:/*#__PURE__*/_jsx(NotFound,{})},\"not-found\"))});};export function ProtectedRoute(_ref5){var children=_ref5.children,rest=_objectWithoutProperties(_ref5,_excluded);var _useSession=useSession(),authRedirectTo=_useSession.authRedirectTo,isUserBeingLoggedOut=_useSession.isUserBeingLoggedOut,loginRedirectOverride=_useSession.loginRedirectOverride,setAuthRedirectTo=_useSession.setAuthRedirectTo;var location=useLocation();useEffect(function(){setAuthRedirectTo(authRedirectTo==='/logout'?'/':\"\".concat(location.pathname).concat(location.search));});if(isAuthenticated(document.cookie)){return/*#__PURE__*/_jsx(Route,_objectSpread(_objectSpread({},rest),{},{children:/*#__PURE__*/_jsx(ErrorBoundary,{FallbackComponent:ErrorFallback,children:children})}));}if(loginRedirectOverride&&!window.location.href.includes('/login')&&!isUserBeingLoggedOut){window.location.replace(loginRedirectOverride);return null;}return/*#__PURE__*/_jsx(Redirect,{to:\"/login\"});}function App(){var history=useHistory();var _useLocation=useLocation(),hash=_useLocation.hash,search=_useLocation.search,pathname=_useLocation.pathname;var language=getLanguageWithoutRegionCode(navigator);if(!Object.keys(locales).includes(language)){// If there isn't a string catalog available for the browser's\n// preferred language, default to one that has strings.\nlanguage='en';}useEffect(function(){dynamicActivate(language);},[language]);useTitle();var redirectURL=window.sessionStorage.getItem(SESSION_REDIRECT_URL);if(redirectURL){window.sessionStorage.removeItem(SESSION_REDIRECT_URL);if(redirectURL!=='/'||redirectURL!=='/home')history.replace(redirectURL);}return/*#__PURE__*/_jsx(I18nProvider,{i18n:i18n,children:/*#__PURE__*/_jsx(Background,{children:/*#__PURE__*/_jsx(SessionProvider,{children:/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{exact:true,strict:true,path:\"/*/\",children:/*#__PURE__*/_jsx(Redirect,{to:\"\".concat(pathname.slice(0,-1)).concat(search).concat(hash)})}),/*#__PURE__*/_jsx(Route,{path:\"/login\",children:/*#__PURE__*/_jsx(Login,{isAuthenticated:isAuthenticated})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",children:/*#__PURE__*/_jsx(Redirect,{to:\"/home\"})}),/*#__PURE__*/_jsx(ProtectedRoute,{children:/*#__PURE__*/_jsx(ConfigProvider,{children:/*#__PURE__*/_jsx(RenderAppContainer,{})})})]})})})});}export default(function(){return/*#__PURE__*/_jsx(HashRouter,{children:/*#__PURE__*/_jsx(App,{})});});","map":{"version":3,"sources":["/awx_devel/awx/ui/src/App.js"],"names":["React","useEffect","useRouteMatch","useLocation","HashRouter","Route","Switch","Redirect","useHistory","ErrorBoundary","I18nProvider","i18n","Card","PageSection","ConfigProvider","useAuthorizedPath","useUserProfile","SessionProvider","useSession","AppContainer","Background","ContentError","NotFound","Login","isAuthenticated","getLanguageWithoutRegionCode","Metrics","SubscriptionEdit","useTitle","dynamicActivate","locales","getRouteConfig","SESSION_REDIRECT_URL","ErrorFallback","error","RenderAppContainer","userProfile","navRouteConfig","AuthorizedRoutes","routeConfig","isAuthorized","match","flatMap","routes","map","path","Screen","screen","concat","ProtectedRoute","children","rest","authRedirectTo","isUserBeingLoggedOut","loginRedirectOverride","setAuthRedirectTo","location","pathname","search","document","cookie","window","href","includes","replace","App","history","hash","language","navigator","Object","keys","redirectURL","sessionStorage","getItem","removeItem","slice"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport {\n  useRouteMatch,\n  useLocation,\n  HashRouter,\n  Route,\n  Switch,\n  Redirect,\n  useHistory,\n} from 'react-router-dom';\nimport { ErrorBoundary } from 'react-error-boundary';\nimport { I18nProvider } from '@lingui/react';\nimport { i18n } from '@lingui/core';\nimport { Card, PageSection } from '@patternfly/react-core';\nimport {\n  ConfigProvider,\n  useAuthorizedPath,\n  useUserProfile,\n} from 'contexts/Config';\nimport { SessionProvider, useSession } from 'contexts/Session';\nimport AppContainer from 'components/AppContainer';\nimport Background from 'components/Background';\nimport ContentError from 'components/ContentError';\nimport NotFound from 'screens/NotFound';\nimport Login from 'screens/Login';\nimport { isAuthenticated } from 'util/auth';\nimport { getLanguageWithoutRegionCode } from 'util/language';\nimport Metrics from 'screens/Metrics';\nimport SubscriptionEdit from 'screens/Setting/Subscription/SubscriptionEdit';\nimport useTitle from 'hooks/useTitle';\nimport { dynamicActivate, locales } from './i18nLoader';\nimport getRouteConfig from './routeConfig';\nimport { SESSION_REDIRECT_URL } from './constants';\n\nfunction ErrorFallback({ error }) {\n  return (\n    <PageSection>\n      <Card>\n        <ContentError error={error} />\n      </Card>\n    </PageSection>\n  );\n}\n\nconst RenderAppContainer = () => {\n  const userProfile = useUserProfile();\n  const navRouteConfig = getRouteConfig(userProfile);\n\n  return (\n    <AppContainer navRouteConfig={navRouteConfig}>\n      <AuthorizedRoutes routeConfig={navRouteConfig} />\n    </AppContainer>\n  );\n};\n\nconst AuthorizedRoutes = ({ routeConfig }) => {\n  const isAuthorized = useAuthorizedPath();\n  const match = useRouteMatch();\n\n  if (!isAuthorized) {\n    return (\n      <Switch>\n        <ProtectedRoute\n          key=\"/subscription_management\"\n          path=\"/subscription_management\"\n        >\n          <PageSection>\n            <Card>\n              <SubscriptionEdit />\n            </Card>\n          </PageSection>\n        </ProtectedRoute>\n        <Route path=\"*\">\n          <Redirect to=\"/subscription_management\" />\n        </Route>\n      </Switch>\n    );\n  }\n\n  return (\n    <Switch>\n      {routeConfig\n        .flatMap(({ routes }) => routes)\n        .map(({ path, screen: Screen }) => (\n          <ProtectedRoute key={path} path={path}>\n            <Screen match={match} />\n          </ProtectedRoute>\n        ))\n        .concat(\n          <ProtectedRoute key=\"metrics\" path=\"/metrics\">\n            <Metrics />\n          </ProtectedRoute>,\n          <ProtectedRoute key=\"not-found\" path=\"*\">\n            <NotFound />\n          </ProtectedRoute>\n        )}\n    </Switch>\n  );\n};\n\nexport function ProtectedRoute({ children, ...rest }) {\n  const {\n    authRedirectTo,\n    isUserBeingLoggedOut,\n    loginRedirectOverride,\n    setAuthRedirectTo,\n  } = useSession();\n  const location = useLocation();\n\n  useEffect(() => {\n    setAuthRedirectTo(\n      authRedirectTo === '/logout'\n        ? '/'\n        : `${location.pathname}${location.search}`\n    );\n  });\n\n  if (isAuthenticated(document.cookie)) {\n    return (\n      <Route {...rest}>\n        <ErrorBoundary FallbackComponent={ErrorFallback}>\n          {children}\n        </ErrorBoundary>\n      </Route>\n    );\n  }\n\n  if (\n    loginRedirectOverride &&\n    !window.location.href.includes('/login') &&\n    !isUserBeingLoggedOut\n  ) {\n    window.location.replace(loginRedirectOverride);\n    return null;\n  }\n  return <Redirect to=\"/login\" />;\n}\n\nfunction App() {\n  const history = useHistory();\n  const { hash, search, pathname } = useLocation();\n  let language = getLanguageWithoutRegionCode(navigator);\n  if (!Object.keys(locales).includes(language)) {\n    // If there isn't a string catalog available for the browser's\n    // preferred language, default to one that has strings.\n    language = 'en';\n  }\n\n  useEffect(() => {\n    dynamicActivate(language);\n  }, [language]);\n\n  useTitle();\n\n  const redirectURL = window.sessionStorage.getItem(SESSION_REDIRECT_URL);\n  if (redirectURL) {\n    window.sessionStorage.removeItem(SESSION_REDIRECT_URL);\n    if (redirectURL !== '/' || redirectURL !== '/home')\n      history.replace(redirectURL);\n  }\n\n  return (\n    <I18nProvider i18n={i18n}>\n      <Background>\n        <SessionProvider>\n          <Switch>\n            <Route exact strict path=\"/*/\">\n              <Redirect to={`${pathname.slice(0, -1)}${search}${hash}`} />\n            </Route>\n            <Route path=\"/login\">\n              <Login isAuthenticated={isAuthenticated} />\n            </Route>\n            <Route exact path=\"/\">\n              <Redirect to=\"/home\" />\n            </Route>\n            <ProtectedRoute>\n              <ConfigProvider>\n                <RenderAppContainer />\n              </ConfigProvider>\n            </ProtectedRoute>\n          </Switch>\n        </SessionProvider>\n      </Background>\n    </I18nProvider>\n  );\n}\n\nexport default () => (\n  <HashRouter>\n    <App />\n  </HashRouter>\n);\n"]},"metadata":{},"sourceType":"module"}