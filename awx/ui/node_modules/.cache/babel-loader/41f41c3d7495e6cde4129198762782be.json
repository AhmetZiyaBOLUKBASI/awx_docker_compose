{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState}from'react';import{ExpandableSection,Wizard}from'@patternfly/react-core';import{Formik,useFormikContext}from'formik';import{useDismissableError}from'hooks/useRequest';import mergeExtraVars from'util/prompt/mergeExtraVars';import getSurveyValues from'util/prompt/getSurveyValues';import ContentLoading from'../ContentLoading';import ContentError from'../ContentError';import useLaunchSteps from'./useLaunchSteps';import AlertModal from'../AlertModal';import{jsx as _jsx}from\"react/jsx-runtime\";function PromptModalForm(_ref){var launchConfig=_ref.launchConfig,onCancel=_ref.onCancel,onSubmit=_ref.onSubmit,resource=_ref.resource,surveyConfig=_ref.surveyConfig;var _useFormikContext=useFormikContext(),setFieldTouched=_useFormikContext.setFieldTouched,values=_useFormikContext.values;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showDescription=_useState2[0],setShowDescription=_useState2[1];var _useLaunchSteps=useLaunchSteps(launchConfig,surveyConfig,resource),steps=_useLaunchSteps.steps,isReady=_useLaunchSteps.isReady,validateStep=_useLaunchSteps.validateStep,visitStep=_useLaunchSteps.visitStep,visitAllSteps=_useLaunchSteps.visitAllSteps,contentError=_useLaunchSteps.contentError;var handleSubmit=function handleSubmit(){var _values$inventory,_values$credentials;var postValues={};var setValue=function setValue(key,value){if(typeof value!=='undefined'&&value!==null){postValues[key]=value;}};var surveyValues=getSurveyValues(values);setValue('credential_passwords',values.credential_passwords);setValue('inventory_id',(_values$inventory=values.inventory)===null||_values$inventory===void 0?void 0:_values$inventory.id);setValue('credentials',(_values$credentials=values.credentials)===null||_values$credentials===void 0?void 0:_values$credentials.map(function(c){return c.id;}));setValue('job_type',values.job_type);setValue('limit',values.limit);setValue('job_tags',values.job_tags);setValue('skip_tags',values.skip_tags);var extraVars=launchConfig.ask_variables_on_launch?values.extra_vars||'---':resource.extra_vars;setValue('extra_vars',mergeExtraVars(extraVars,surveyValues));setValue('scm_branch',values.scm_branch);setValue('verbosity',values.verbosity);onSubmit(postValues);};var _useDismissableError=useDismissableError(contentError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;if(error){return/*#__PURE__*/_jsx(AlertModal,{isOpen:error,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:function onClose(){dismissError();},children:/*#__PURE__*/_jsx(ContentError,{error:error})});}return/*#__PURE__*/_jsx(Wizard,{isOpen:true,onClose:onCancel,onSave:handleSubmit,onBack:/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(nextStep){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:validateStep(nextStep.id);case 1:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}(),onNext:/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(nextStep,prevStep){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(nextStep.id==='preview'){visitAllSteps(setFieldTouched);}else{visitStep(prevStep.prevId,setFieldTouched);validateStep(nextStep.id);}case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2,_x3){return _ref3.apply(this,arguments);};}(),onGoToStep:/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(nextStep,prevStep){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(nextStep.id==='preview'){visitAllSteps(setFieldTouched);}else{visitStep(prevStep.prevId,setFieldTouched);validateStep(nextStep.id);}case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x4,_x5){return _ref4.apply(this,arguments);};}(),title:/*i18n*/i18n._(\"Launch | {0}\",{0:resource.name}),description:resource.description.length>512?/*#__PURE__*/_jsx(ExpandableSection,{toggleText:showDescription?/*i18n*/i18n._(\"Hide description\"):/*i18n*/i18n._(\"Show description\"),onToggle:function onToggle(){setShowDescription(!showDescription);},isExpanded:showDescription,children:resource.description}):resource.description,steps:isReady?steps:[{name:/*i18n*/i18n._(\"Content Loading\"),component:/*#__PURE__*/_jsx(ContentLoading,{})}],backButtonText:/*i18n*/i18n._(\"Back\"),cancelButtonText:/*i18n*/i18n._(\"Cancel\"),nextButtonText:/*i18n*/i18n._(\"Next\")});}function LaunchPrompt(_ref5){var launchConfig=_ref5.launchConfig,onCancel=_ref5.onCancel,onLaunch=_ref5.onLaunch,_ref5$resource=_ref5.resource,resource=_ref5$resource===void 0?{}:_ref5$resource,surveyConfig=_ref5.surveyConfig,_ref5$resourceDefault=_ref5.resourceDefaultCredentials,resourceDefaultCredentials=_ref5$resourceDefault===void 0?[]:_ref5$resourceDefault;return/*#__PURE__*/_jsx(Formik,{initialValues:{},onSubmit:function onSubmit(values){return onLaunch(values);},children:/*#__PURE__*/_jsx(PromptModalForm,{onSubmit:function onSubmit(values){return onLaunch(values);},onCancel:onCancel,launchConfig:launchConfig,surveyConfig:surveyConfig,resource:resource,resourceDefaultCredentials:resourceDefaultCredentials})});}export{LaunchPrompt as _LaunchPrompt};export default LaunchPrompt;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/LaunchPrompt/LaunchPrompt.js"],"names":["React","useState","ExpandableSection","Wizard","Formik","useFormikContext","useDismissableError","mergeExtraVars","getSurveyValues","ContentLoading","ContentError","useLaunchSteps","AlertModal","PromptModalForm","launchConfig","onCancel","onSubmit","resource","surveyConfig","setFieldTouched","values","showDescription","setShowDescription","steps","isReady","validateStep","visitStep","visitAllSteps","contentError","handleSubmit","postValues","setValue","key","value","surveyValues","credential_passwords","inventory","id","credentials","map","c","job_type","limit","job_tags","skip_tags","extraVars","ask_variables_on_launch","extra_vars","scm_branch","verbosity","error","dismissError","nextStep","prevStep","prevId","name","description","length","component","LaunchPrompt","onLaunch","resourceDefaultCredentials","_LaunchPrompt"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport { ExpandableSection, Wizard } from '@patternfly/react-core';\nimport { t } from '@lingui/macro';\nimport { Formik, useFormikContext } from 'formik';\nimport { useDismissableError } from 'hooks/useRequest';\nimport mergeExtraVars from 'util/prompt/mergeExtraVars';\nimport getSurveyValues from 'util/prompt/getSurveyValues';\nimport ContentLoading from '../ContentLoading';\nimport ContentError from '../ContentError';\nimport useLaunchSteps from './useLaunchSteps';\nimport AlertModal from '../AlertModal';\n\nfunction PromptModalForm({\n  launchConfig,\n  onCancel,\n  onSubmit,\n  resource,\n  surveyConfig,\n}) {\n  const { setFieldTouched, values } = useFormikContext();\n  const [showDescription, setShowDescription] = useState(false);\n\n  const {\n    steps,\n    isReady,\n    validateStep,\n    visitStep,\n    visitAllSteps,\n    contentError,\n  } = useLaunchSteps(launchConfig, surveyConfig, resource);\n\n  const handleSubmit = () => {\n    const postValues = {};\n    const setValue = (key, value) => {\n      if (typeof value !== 'undefined' && value !== null) {\n        postValues[key] = value;\n      }\n    };\n    const surveyValues = getSurveyValues(values);\n    setValue('credential_passwords', values.credential_passwords);\n    setValue('inventory_id', values.inventory?.id);\n    setValue(\n      'credentials',\n      values.credentials?.map((c) => c.id)\n    );\n    setValue('job_type', values.job_type);\n    setValue('limit', values.limit);\n    setValue('job_tags', values.job_tags);\n    setValue('skip_tags', values.skip_tags);\n    const extraVars = launchConfig.ask_variables_on_launch\n      ? values.extra_vars || '---'\n      : resource.extra_vars;\n    setValue('extra_vars', mergeExtraVars(extraVars, surveyValues));\n    setValue('scm_branch', values.scm_branch);\n    setValue('verbosity', values.verbosity);\n\n    onSubmit(postValues);\n  };\n  const { error, dismissError } = useDismissableError(contentError);\n\n  if (error) {\n    return (\n      <AlertModal\n        isOpen={error}\n        variant=\"error\"\n        title={t`Error!`}\n        onClose={() => {\n          dismissError();\n        }}\n      >\n        <ContentError error={error} />\n      </AlertModal>\n    );\n  }\n\n  return (\n    <Wizard\n      isOpen\n      onClose={onCancel}\n      onSave={handleSubmit}\n      onBack={async (nextStep) => {\n        validateStep(nextStep.id);\n      }}\n      onNext={async (nextStep, prevStep) => {\n        if (nextStep.id === 'preview') {\n          visitAllSteps(setFieldTouched);\n        } else {\n          visitStep(prevStep.prevId, setFieldTouched);\n          validateStep(nextStep.id);\n        }\n      }}\n      onGoToStep={async (nextStep, prevStep) => {\n        if (nextStep.id === 'preview') {\n          visitAllSteps(setFieldTouched);\n        } else {\n          visitStep(prevStep.prevId, setFieldTouched);\n          validateStep(nextStep.id);\n        }\n      }}\n      title={t`Launch | ${resource.name}`}\n      description={\n        resource.description.length > 512 ? (\n          <ExpandableSection\n            toggleText={\n              showDescription ? t`Hide description` : t`Show description`\n            }\n            onToggle={() => {\n              setShowDescription(!showDescription);\n            }}\n            isExpanded={showDescription}\n          >\n            {resource.description}\n          </ExpandableSection>\n        ) : (\n          resource.description\n        )\n      }\n      steps={\n        isReady\n          ? steps\n          : [\n              {\n                name: t`Content Loading`,\n                component: <ContentLoading />,\n              },\n            ]\n      }\n      backButtonText={t`Back`}\n      cancelButtonText={t`Cancel`}\n      nextButtonText={t`Next`}\n    />\n  );\n}\n\nfunction LaunchPrompt({\n  launchConfig,\n  onCancel,\n  onLaunch,\n  resource = {},\n  surveyConfig,\n  resourceDefaultCredentials = [],\n}) {\n  return (\n    <Formik initialValues={{}} onSubmit={(values) => onLaunch(values)}>\n      <PromptModalForm\n        onSubmit={(values) => onLaunch(values)}\n        onCancel={onCancel}\n        launchConfig={launchConfig}\n        surveyConfig={surveyConfig}\n        resource={resource}\n        resourceDefaultCredentials={resourceDefaultCredentials}\n      />\n    </Formik>\n  );\n}\n\nexport { LaunchPrompt as _LaunchPrompt };\nexport default LaunchPrompt;\n"]},"metadata":{},"sourceType":"module"}