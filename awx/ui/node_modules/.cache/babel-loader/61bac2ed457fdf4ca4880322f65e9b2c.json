{"ast":null,"code":"import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6;import{i18n}from\"@lingui/core\";import React,{useContext}from'react';import{useHistory}from'react-router-dom';import styled from'styled-components';import{WorkflowStateContext}from'contexts/Workflow';import StatusIcon from'components/StatusIcon';import{WorkflowNodeTypeLetter}from'components/Workflow';import{secondsToHHMMSS}from'util/dates';import{stringIsUUID}from'util/strings';import{constants as wfConstants}from'components/Workflow/WorkflowUtils';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var NodeG=styled.g(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  cursor: \",\";\\n\"])),function(props){return props.job?'pointer':'default';});var JobTopLine=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  align-items: center;\\n  display: flex;\\n  margin-top: 5px;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  white-space: nowrap;\\n\\n  p {\\n    margin-left: 10px;\\n    white-space: nowrap;\\n    text-overflow: ellipsis;\\n    overflow: hidden;\\n  }\\n\"])));var Elapsed=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  margin-top: 5px;\\n  text-align: center;\\n\\n  span {\\n    font-size: 12px;\\n    font-weight: bold;\\n    background-color: #ededed;\\n    padding: 3px 12px;\\n    border-radius: 14px;\\n  }\\n\"])));var NodeContents=styled.div(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  font-size: 13px;\\n  padding: 0px 10px;\\n\"])));var NodeDefaultLabel=styled.p(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  margin-top: 20px;\\n  overflow: hidden;\\n  text-align: center;\\n  text-overflow: ellipsis;\\n  white-space: nowrap;\\n\"])));var ConvergenceLabel=styled.p(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n  font-size: 12px;\\n  color: #ffffff;\\n\"])));Elapsed.displayName='Elapsed';function WorkflowOutputNode(_ref){var _node$originalNodeObj,_node$originalNodeObj2,_node$originalNodeObj3,_node$originalNodeObj8;var mouseEnter=_ref.mouseEnter,mouseLeave=_ref.mouseLeave,node=_ref.node;var history=useHistory();var _useContext=useContext(WorkflowStateContext),nodePositions=_useContext.nodePositions;var job=node===null||node===void 0?void 0:(_node$originalNodeObj=node.originalNodeObject)===null||_node$originalNodeObj===void 0?void 0:(_node$originalNodeObj2=_node$originalNodeObj.summary_fields)===null||_node$originalNodeObj2===void 0?void 0:_node$originalNodeObj2.job;var borderColor='#93969A';if(job){if(job.status==='failed'||job.status==='error'||job.status==='canceled'){borderColor='#d9534f';}if(job.status==='successful'||job.status==='ok'){borderColor='#5cb85c';}}var handleNodeClick=function handleNodeClick(){if(job){var basePath=job.type!=='workflow_approval'?'jobs':'workflow_approvals';history.push(\"/\".concat(basePath,\"/\").concat(job.id,\"/details\"));}};var nodeName;if(node!==null&&node!==void 0&&node.identifier||node!==null&&node!==void 0&&(_node$originalNodeObj3=node.originalNodeObject)!==null&&_node$originalNodeObj3!==void 0&&_node$originalNodeObj3.identifier&&!stringIsUUID(node.originalNodeObject.identifier)){var _node$originalNodeObj4;nodeName=node!==null&&node!==void 0&&node.identifier?node===null||node===void 0?void 0:node.identifier:node===null||node===void 0?void 0:(_node$originalNodeObj4=node.originalNodeObject)===null||_node$originalNodeObj4===void 0?void 0:_node$originalNodeObj4.identifier;}else{var _node$fullUnifiedJobT,_node$originalNodeObj5,_node$originalNodeObj6,_node$originalNodeObj7;nodeName=(node===null||node===void 0?void 0:(_node$fullUnifiedJobT=node.fullUnifiedJobTemplate)===null||_node$fullUnifiedJobT===void 0?void 0:_node$fullUnifiedJobT.name)||(node===null||node===void 0?void 0:(_node$originalNodeObj5=node.originalNodeObject)===null||_node$originalNodeObj5===void 0?void 0:(_node$originalNodeObj6=_node$originalNodeObj5.summary_fields)===null||_node$originalNodeObj6===void 0?void 0:(_node$originalNodeObj7=_node$originalNodeObj6.unified_job_template)===null||_node$originalNodeObj7===void 0?void 0:_node$originalNodeObj7.name)||/*i18n*/i18n._(\"DELETED\");}return/*#__PURE__*/_jsxs(NodeG,{id:\"node-\".concat(node.id),transform:\"translate(\".concat(nodePositions[node.id].x,\",\").concat(nodePositions[node.id].y-nodePositions[1].y,\")\"),job:job,onClick:handleNodeClick,onMouseEnter:mouseEnter,onMouseLeave:mouseLeave,children:[(node.all_parents_must_converge||(node===null||node===void 0?void 0:(_node$originalNodeObj8=node.originalNodeObject)===null||_node$originalNodeObj8===void 0?void 0:_node$originalNodeObj8.all_parents_must_converge))&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"rect\",{fill:borderColor,height:wfConstants.nodeH/4,rx:2,ry:2,x:wfConstants.nodeW/2-wfConstants.nodeW/10,y:-wfConstants.nodeH/4+2,stroke:borderColor,strokeWidth:\"2px\",width:wfConstants.nodeW/5}),/*#__PURE__*/_jsx(\"foreignObject\",{height:wfConstants.nodeH/4,width:wfConstants.nodeW/5,x:wfConstants.nodeW/2-wfConstants.nodeW/10+7,y:-wfConstants.nodeH/4-1,children:/*#__PURE__*/_jsx(ConvergenceLabel,{children:/*i18n*/i18n._(\"ALL\")})})]}),/*#__PURE__*/_jsx(\"rect\",{fill:\"#FFFFFF\",height:wfConstants.nodeH,rx:\"2\",ry:\"2\",stroke:borderColor,strokeWidth:\"2px\",width:wfConstants.nodeW}),/*#__PURE__*/_jsx(\"foreignObject\",{height:\"58\",width:\"178\",x:\"1\",y:\"1\",children:/*#__PURE__*/_jsx(NodeContents,{children:job?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(JobTopLine,{children:[job.status!=='pending'&&/*#__PURE__*/_jsx(StatusIcon,{status:job.status}),/*#__PURE__*/_jsx(\"p\",{children:nodeName})]}),!!(job!==null&&job!==void 0&&job.elapsed)&&/*#__PURE__*/_jsx(Elapsed,{children:secondsToHHMMSS(job.elapsed)})]}):/*#__PURE__*/_jsx(NodeDefaultLabel,{children:nodeName})})}),(node.unifiedJobTemplate||job)&&/*#__PURE__*/_jsx(WorkflowNodeTypeLetter,{node:node})]});}export default WorkflowOutputNode;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Job/WorkflowOutput/WorkflowOutputNode.js"],"names":["React","useContext","useHistory","styled","WorkflowStateContext","StatusIcon","WorkflowNodeTypeLetter","secondsToHHMMSS","stringIsUUID","constants","wfConstants","NodeG","g","props","job","JobTopLine","div","Elapsed","NodeContents","NodeDefaultLabel","p","ConvergenceLabel","displayName","WorkflowOutputNode","mouseEnter","mouseLeave","node","history","nodePositions","originalNodeObject","summary_fields","borderColor","status","handleNodeClick","basePath","type","push","id","nodeName","identifier","fullUnifiedJobTemplate","name","unified_job_template","x","y","all_parents_must_converge","nodeH","nodeW","elapsed","unifiedJobTemplate"],"mappings":"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","sourcesContent":["import React, { useContext } from 'react';\nimport { useHistory } from 'react-router-dom';\n\nimport { t } from '@lingui/macro';\nimport styled from 'styled-components';\nimport { func, shape } from 'prop-types';\nimport { WorkflowStateContext } from 'contexts/Workflow';\nimport StatusIcon from 'components/StatusIcon';\nimport { WorkflowNodeTypeLetter } from 'components/Workflow';\nimport { secondsToHHMMSS } from 'util/dates';\nimport { stringIsUUID } from 'util/strings';\nimport { constants as wfConstants } from 'components/Workflow/WorkflowUtils';\n\nconst NodeG = styled.g`\n  cursor: ${(props) => (props.job ? 'pointer' : 'default')};\n`;\n\nconst JobTopLine = styled.div`\n  align-items: center;\n  display: flex;\n  margin-top: 5px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n\n  p {\n    margin-left: 10px;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n  }\n`;\n\nconst Elapsed = styled.div`\n  margin-top: 5px;\n  text-align: center;\n\n  span {\n    font-size: 12px;\n    font-weight: bold;\n    background-color: #ededed;\n    padding: 3px 12px;\n    border-radius: 14px;\n  }\n`;\n\nconst NodeContents = styled.div`\n  font-size: 13px;\n  padding: 0px 10px;\n`;\n\nconst NodeDefaultLabel = styled.p`\n  margin-top: 20px;\n  overflow: hidden;\n  text-align: center;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`;\n\nconst ConvergenceLabel = styled.p`\n  font-size: 12px;\n  color: #ffffff;\n`;\n\nElapsed.displayName = 'Elapsed';\n\nfunction WorkflowOutputNode({ mouseEnter, mouseLeave, node }) {\n  const history = useHistory();\n  const { nodePositions } = useContext(WorkflowStateContext);\n  const job = node?.originalNodeObject?.summary_fields?.job;\n\n  let borderColor = '#93969A';\n\n  if (job) {\n    if (\n      job.status === 'failed' ||\n      job.status === 'error' ||\n      job.status === 'canceled'\n    ) {\n      borderColor = '#d9534f';\n    }\n    if (job.status === 'successful' || job.status === 'ok') {\n      borderColor = '#5cb85c';\n    }\n  }\n\n  const handleNodeClick = () => {\n    if (job) {\n      const basePath =\n        job.type !== 'workflow_approval' ? 'jobs' : 'workflow_approvals';\n      history.push(`/${basePath}/${job.id}/details`);\n    }\n  };\n\n  let nodeName;\n\n  if (\n    node?.identifier ||\n    (node?.originalNodeObject?.identifier &&\n      !stringIsUUID(node.originalNodeObject.identifier))\n  ) {\n    nodeName = node?.identifier\n      ? node?.identifier\n      : node?.originalNodeObject?.identifier;\n  } else {\n    nodeName =\n      node?.fullUnifiedJobTemplate?.name ||\n      node?.originalNodeObject?.summary_fields?.unified_job_template?.name ||\n      t`DELETED`;\n  }\n\n  return (\n    <NodeG\n      id={`node-${node.id}`}\n      transform={`translate(${nodePositions[node.id].x},${\n        nodePositions[node.id].y - nodePositions[1].y\n      })`}\n      job={job}\n      onClick={handleNodeClick}\n      onMouseEnter={mouseEnter}\n      onMouseLeave={mouseLeave}\n    >\n      {(node.all_parents_must_converge ||\n        node?.originalNodeObject?.all_parents_must_converge) && (\n        <>\n          <rect\n            fill={borderColor}\n            height={wfConstants.nodeH / 4}\n            rx={2}\n            ry={2}\n            x={wfConstants.nodeW / 2 - wfConstants.nodeW / 10}\n            y={-wfConstants.nodeH / 4 + 2}\n            stroke={borderColor}\n            strokeWidth=\"2px\"\n            width={wfConstants.nodeW / 5}\n          />\n          <foreignObject\n            height={wfConstants.nodeH / 4}\n            width={wfConstants.nodeW / 5}\n            x={wfConstants.nodeW / 2 - wfConstants.nodeW / 10 + 7}\n            y={-wfConstants.nodeH / 4 - 1}\n          >\n            <ConvergenceLabel>{t`ALL`}</ConvergenceLabel>\n          </foreignObject>\n        </>\n      )}\n      <rect\n        fill=\"#FFFFFF\"\n        height={wfConstants.nodeH}\n        rx=\"2\"\n        ry=\"2\"\n        stroke={borderColor}\n        strokeWidth=\"2px\"\n        width={wfConstants.nodeW}\n      />\n      <foreignObject height=\"58\" width=\"178\" x=\"1\" y=\"1\">\n        <NodeContents>\n          {job ? (\n            <>\n              <JobTopLine>\n                {job.status !== 'pending' && <StatusIcon status={job.status} />}\n                <p>{nodeName}</p>\n              </JobTopLine>\n              {!!job?.elapsed && (\n                <Elapsed>{secondsToHHMMSS(job.elapsed)}</Elapsed>\n              )}\n            </>\n          ) : (\n            <NodeDefaultLabel>{nodeName}</NodeDefaultLabel>\n          )}\n        </NodeContents>\n      </foreignObject>\n      {(node.unifiedJobTemplate || job) && (\n        <WorkflowNodeTypeLetter node={node} />\n      )}\n    </NodeG>\n  );\n}\n\nWorkflowOutputNode.propTypes = {\n  mouseEnter: func.isRequired,\n  mouseLeave: func.isRequired,\n  node: shape().isRequired,\n};\n\nexport default WorkflowOutputNode;\n"]},"metadata":{},"sourceType":"module"}