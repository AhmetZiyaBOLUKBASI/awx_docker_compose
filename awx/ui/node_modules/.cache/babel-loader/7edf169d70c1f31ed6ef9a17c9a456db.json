{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{useField}from'formik';import{CredentialsAPI}from'api';import CheckboxListItem from'components/CheckboxListItem';import ContentError from'components/ContentError';import DataListToolbar from'components/DataListToolbar';import{getQSConfig,parseQueryString}from'util/qs';import useRequest from'hooks/useRequest';import PaginatedTable,{HeaderCell,HeaderRow,getSearchableKeys}from'components/PaginatedTable';import{jsx as _jsx}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('credential',{page:1,page_size:5,order_by:'name',credential_type__kind:'external'});function CredentialsStep(){var _useField=useField('credential'),_useField2=_slicedToArray(_useField,3),selectedCredential=_useField2[0],selectedCredentialHelper=_useField2[2];var history=useHistory();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,data,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,history.location.search);_context.next=3;return Promise.all([CredentialsAPI.read(_objectSpread({},params)),CredentialsAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);data=_yield$Promise$all2[0].data;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{credentials:data.results,count:data.count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 8:case\"end\":return _context.stop();}}},_callee);})),[history.location.search]),{credentials:[],count:0,relatedSearchableKeys:[],searchableKeys:[]}),_useRequest$result=_useRequest.result,credentials=_useRequest$result.credentials,count=_useRequest$result.count,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,credentialsError=_useRequest.error,isCredentialsLoading=_useRequest.isLoading,fetchCredentials=_useRequest.request;useEffect(function(){fetchCredentials();},[fetchCredentials]);if(credentialsError){return/*#__PURE__*/_jsx(ContentError,{error:credentialsError});}return/*#__PURE__*/_jsx(PaginatedTable,{contentError:credentialsError,hasContentLoading:isCredentialsLoading,itemCount:count,items:credentials,qsConfig:QS_CONFIG,headerRow:/*#__PURE__*/_jsx(HeaderRow,{isExpandable:false,qsConfig:QS_CONFIG,children:/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")})}),renderRow:function renderRow(credential,index){var _selectedCredential$v;return/*#__PURE__*/_jsx(CheckboxListItem,{rowIndex:index,isSelected:(selectedCredential===null||selectedCredential===void 0?void 0:(_selectedCredential$v=selectedCredential.value)===null||_selectedCredential$v===void 0?void 0:_selectedCredential$v.id)===credential.id,itemId:credential.id,name:credential.name,label:credential.name,onSelect:function onSelect(){return selectedCredentialHelper.setValue(credential);},onDeselect:function onDeselect(){return selectedCredentialHelper.setValue(null);},isRadio:true},credential.id);},renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{fillWidth:true}));},showPageSizeOptions:false,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username__icontains'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username__icontains'}],toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys});}export default CredentialsStep;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Credential/shared/CredentialPlugins/CredentialPluginPrompt/CredentialsStep.js"],"names":["React","useCallback","useEffect","useHistory","useField","CredentialsAPI","CheckboxListItem","ContentError","DataListToolbar","getQSConfig","parseQueryString","useRequest","PaginatedTable","HeaderCell","HeaderRow","getSearchableKeys","QS_CONFIG","page","page_size","order_by","credential_type__kind","CredentialsStep","selectedCredential","selectedCredentialHelper","history","params","location","search","Promise","all","read","readOptions","data","actionsResponse","credentials","results","count","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","result","credentialsError","error","isCredentialsLoading","isLoading","fetchCredentials","request","credential","index","value","id","name","setValue","props","key","isDefault"],"mappings":"6bAAA,MAAOA,CAAAA,KAAP,EAAgBC,WAAhB,CAA6BC,SAA7B,KAA8C,OAA9C,CACA,OAASC,UAAT,KAA2B,kBAA3B,CAGA,OAASC,QAAT,KAAyB,QAAzB,CACA,OAASC,cAAT,KAA+B,KAA/B,CACA,MAAOC,CAAAA,gBAAP,KAA6B,6BAA7B,CACA,MAAOC,CAAAA,YAAP,KAAyB,yBAAzB,CACA,MAAOC,CAAAA,eAAP,KAA4B,4BAA5B,CACA,OAASC,WAAT,CAAsBC,gBAAtB,KAA8C,SAA9C,CACA,MAAOC,CAAAA,UAAP,KAAuB,kBAAvB,CACA,MAAOC,CAAAA,cAAP,EACEC,UADF,CAEEC,SAFF,CAGEC,iBAHF,KAIO,2BAJP,C,2CAMA,GAAMC,CAAAA,SAAS,CAAGP,WAAW,CAAC,YAAD,CAAe,CAC1CQ,IAAI,CAAE,CADoC,CAE1CC,SAAS,CAAE,CAF+B,CAG1CC,QAAQ,CAAE,MAHgC,CAI1CC,qBAAqB,CAAE,UAJmB,CAAf,CAA7B,CAOA,QAASC,CAAAA,eAAT,EAA2B,CACzB,cACEjB,QAAQ,CAAC,YAAD,CADV,wCAAOkB,kBAAP,eAA6BC,wBAA7B,eAEA,GAAMC,CAAAA,OAAO,CAAGrB,UAAU,EAA1B,CAEA,gBAKIQ,UAAU,CACZV,WAAW,sEAAC,2PACJwB,MADI,CACKf,gBAAgB,CAACM,SAAD,CAAYQ,OAAO,CAACE,QAAR,CAAiBC,MAA7B,CADrB,uBAEgCC,CAAAA,OAAO,CAACC,GAAR,CAAY,CACpDxB,cAAc,CAACyB,IAAf,kBAAyBL,MAAzB,EADoD,CAEpDpB,cAAc,CAAC0B,WAAf,EAFoD,CAAZ,CAFhC,kGAEDC,IAFC,wBAEDA,IAFC,CAEOC,eAFP,wDAMH,CACLC,WAAW,CAAEF,IAAI,CAACG,OADb,CAELC,KAAK,CAAEJ,IAAI,CAACI,KAFP,CAGLC,qBAAqB,CAAE,CACrB,CAAAJ,eAAe,OAAf,EAAAA,eAAe,SAAf,+BAAAA,eAAe,CAAED,IAAjB,sEAAuBM,qBAAvB,GAAgD,EAD3B,EAErBC,GAFqB,CAEjB,SAACC,GAAD,QAASA,CAAAA,GAAG,CAACC,KAAJ,CAAU,CAAV,CAAa,CAAC,CAAd,CAAT,EAFiB,CAHlB,CAMLC,cAAc,CAAE3B,iBAAiB,yBAACkB,eAAe,CAACD,IAAhB,CAAqBW,OAAtB,iDAAC,uBAA8BC,GAA/B,CAN5B,CANG,wDAAD,GAcR,CAACpB,OAAO,CAACE,QAAR,CAAiBC,MAAlB,CAdQ,CADC,CAgBZ,CAAEO,WAAW,CAAE,EAAf,CAAmBE,KAAK,CAAE,CAA1B,CAA6BC,qBAAqB,CAAE,EAApD,CAAwDK,cAAc,CAAE,EAAxE,CAhBY,CALd,gCACEG,MADF,CACYX,WADZ,oBACYA,WADZ,CACyBE,KADzB,oBACyBA,KADzB,CACgCC,qBADhC,oBACgCA,qBADhC,CACuDK,cADvD,oBACuDA,cADvD,CAESI,gBAFT,aAEEC,KAFF,CAGaC,oBAHb,aAGEC,SAHF,CAIWC,gBAJX,aAIEC,OAJF,CAwBAjD,SAAS,CAAC,UAAM,CACdgD,gBAAgB,GACjB,CAFQ,CAEN,CAACA,gBAAD,CAFM,CAAT,CAIA,GAAIJ,gBAAJ,CAAsB,CACpB,mBAAO,KAAC,YAAD,EAAc,KAAK,CAAEA,gBAArB,EAAP,CACD,CAED,mBACE,KAAC,cAAD,EACE,YAAY,CAAEA,gBADhB,CAEE,iBAAiB,CAAEE,oBAFrB,CAGE,SAAS,CAAEZ,KAHb,CAIE,KAAK,CAAEF,WAJT,CAKE,QAAQ,CAAElB,SALZ,CAME,SAAS,cACP,KAAC,SAAD,EAAW,YAAY,CAAE,KAAzB,CAAgC,QAAQ,CAAEA,SAA1C,uBACE,KAAC,UAAD,EAAY,OAAO,CAAC,MAApB,kBAA4B,cAA5B,EADF,EAPJ,CAWE,SAAS,CAAE,mBAACoC,UAAD,CAAaC,KAAb,+CACT,KAAC,gBAAD,EACE,QAAQ,CAAEA,KADZ,CAEE,UAAU,CAAE,CAAA/B,kBAAkB,OAAlB,EAAAA,kBAAkB,SAAlB,+BAAAA,kBAAkB,CAAEgC,KAApB,sEAA2BC,EAA3B,IAAkCH,UAAU,CAACG,EAF3D,CAGE,MAAM,CAAEH,UAAU,CAACG,EAHrB,CAKE,IAAI,CAAEH,UAAU,CAACI,IALnB,CAME,KAAK,CAAEJ,UAAU,CAACI,IANpB,CAOE,QAAQ,CAAE,0BAAMjC,CAAAA,wBAAwB,CAACkC,QAAzB,CAAkCL,UAAlC,CAAN,EAPZ,CAQE,UAAU,CAAE,4BAAM7B,CAAAA,wBAAwB,CAACkC,QAAzB,CAAkC,IAAlC,CAAN,EARd,CASE,OAAO,KATT,EAIOL,UAAU,CAACG,EAJlB,CADS,EAXb,CAwBE,aAAa,CAAE,uBAACG,KAAD,qBAAW,KAAC,eAAD,gCAAqBA,KAArB,MAA4B,SAAS,KAArC,GAAX,EAxBjB,CAyBE,mBAAmB,CAAE,KAzBvB,CA0BE,oBAAoB,CAAE,CACpB,CACEF,IAAI,SAAE,cADR,CAEEG,GAAG,CAAE,iBAFP,CAGEC,SAAS,CAAE,IAHb,CADoB,CAMpB,CACEJ,IAAI,SAAE,+BADR,CAEEG,GAAG,CAAE,iCAFP,CANoB,CAUpB,CACEH,IAAI,SAAE,gCADR,CAEEG,GAAG,CAAE,kCAFP,CAVoB,CA1BxB,CAyCE,qBAAqB,CAAEjB,cAzCzB,CA0CE,4BAA4B,CAAEL,qBA1ChC,EADF,CA8CD,CAED,cAAehB,CAAAA,eAAf","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\n\nimport { t } from '@lingui/macro';\nimport { useField } from 'formik';\nimport { CredentialsAPI } from 'api';\nimport CheckboxListItem from 'components/CheckboxListItem';\nimport ContentError from 'components/ContentError';\nimport DataListToolbar from 'components/DataListToolbar';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport useRequest from 'hooks/useRequest';\nimport PaginatedTable, {\n  HeaderCell,\n  HeaderRow,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\n\nconst QS_CONFIG = getQSConfig('credential', {\n  page: 1,\n  page_size: 5,\n  order_by: 'name',\n  credential_type__kind: 'external',\n});\n\nfunction CredentialsStep() {\n  const [selectedCredential, , selectedCredentialHelper] =\n    useField('credential');\n  const history = useHistory();\n\n  const {\n    result: { credentials, count, relatedSearchableKeys, searchableKeys },\n    error: credentialsError,\n    isLoading: isCredentialsLoading,\n    request: fetchCredentials,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, history.location.search);\n      const [{ data }, actionsResponse] = await Promise.all([\n        CredentialsAPI.read({ ...params }),\n        CredentialsAPI.readOptions(),\n      ]);\n      return {\n        credentials: data.results,\n        count: data.count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [history.location.search]),\n    { credentials: [], count: 0, relatedSearchableKeys: [], searchableKeys: [] }\n  );\n\n  useEffect(() => {\n    fetchCredentials();\n  }, [fetchCredentials]);\n\n  if (credentialsError) {\n    return <ContentError error={credentialsError} />;\n  }\n\n  return (\n    <PaginatedTable\n      contentError={credentialsError}\n      hasContentLoading={isCredentialsLoading}\n      itemCount={count}\n      items={credentials}\n      qsConfig={QS_CONFIG}\n      headerRow={\n        <HeaderRow isExpandable={false} qsConfig={QS_CONFIG}>\n          <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n        </HeaderRow>\n      }\n      renderRow={(credential, index) => (\n        <CheckboxListItem\n          rowIndex={index}\n          isSelected={selectedCredential?.value?.id === credential.id}\n          itemId={credential.id}\n          key={credential.id}\n          name={credential.name}\n          label={credential.name}\n          onSelect={() => selectedCredentialHelper.setValue(credential)}\n          onDeselect={() => selectedCredentialHelper.setValue(null)}\n          isRadio\n        />\n      )}\n      renderToolbar={(props) => <DataListToolbar {...props} fillWidth />}\n      showPageSizeOptions={false}\n      toolbarSearchColumns={[\n        {\n          name: t`Name`,\n          key: 'name__icontains',\n          isDefault: true,\n        },\n        {\n          name: t`Created By (Username)`,\n          key: 'created_by__username__icontains',\n        },\n        {\n          name: t`Modified By (Username)`,\n          key: 'modified_by__username__icontains',\n        },\n      ]}\n      toolbarSearchableKeys={searchableKeys}\n      toolbarRelatedSearchableKeys={relatedSearchableKeys}\n    />\n  );\n}\n\nexport default CredentialsStep;\n"]},"metadata":{},"sourceType":"module"}