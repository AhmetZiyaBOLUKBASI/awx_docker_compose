{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState,useEffect}from'react';import{Select,SelectOption,SelectVariant}from'@patternfly/react-core';import{LabelsAPI}from'api';import useIsMounted from'hooks/useIsMounted';import{useSyncedSelectValue}from'../MultiSelect';import{jsx as _jsx}from\"react/jsx-runtime\";function loadLabelOptions(_x,_x2,_x3){return _loadLabelOptions.apply(this,arguments);}function _loadLabelOptions(){_loadLabelOptions=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(setLabels,onError,isMounted){var labels,_yield$LabelsAPI$read,data,_yield$LabelsAPI$read2,results;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(isMounted.current){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:_context2.prev=2;_context2.next=5;return LabelsAPI.read({page:1,page_size:200,order_by:'name'});case 5:_yield$LabelsAPI$read=_context2.sent;data=_yield$LabelsAPI$read.data;labels=data.results;setLabels(labels);if(!(data.next&&data.next.includes('page=2'))){_context2.next=15;break;}_context2.next=12;return LabelsAPI.read({page:2,page_size:200,order_by:'name'});case 12:_yield$LabelsAPI$read2=_context2.sent;results=_yield$LabelsAPI$read2.data.results;setLabels(labels.concat(results));case 15:_context2.next=20;break;case 17:_context2.prev=17;_context2.t0=_context2[\"catch\"](2);onError(_context2.t0);case 20:case\"end\":return _context2.stop();}}},_callee2,null,[[2,17]]);}));return _loadLabelOptions.apply(this,arguments);}function LabelSelect(_ref){var value=_ref.value,placeholder=_ref.placeholder,onChange=_ref.onChange,onError=_ref.onError,createText=_ref.createText;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isExpanded=_useState4[0],setIsExpanded=_useState4[1];var isMounted=useIsMounted();var _useSyncedSelectValue=useSyncedSelectValue(value,onChange),selections=_useSyncedSelectValue.selections,_onSelect=_useSyncedSelectValue.onSelect,options=_useSyncedSelectValue.options,setOptions=_useSyncedSelectValue.setOptions;var toggleExpanded=function toggleExpanded(toggleValue){setIsExpanded(toggleValue);};useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return loadLabelOptions(setOptions,onError,isMounted);case 2:if(isMounted.current){_context.next=4;break;}return _context.abrupt(\"return\");case 4:setIsLoading(false);case 5:case\"end\":return _context.stop();}}},_callee);}))();/* eslint-disable-next-line react-hooks/exhaustive-deps */},[]);var renderOptions=function renderOptions(opts){return opts.map(function(option){return/*#__PURE__*/_jsx(SelectOption,{\"aria-label\":option.name,value:option,children:option.name},option.id);});};var onFilter=function onFilter(event){if(event){var str=event.target.value.toLowerCase();var matches=options.filter(function(o){return o.name.toLowerCase().includes(str);});return renderOptions(matches);}return null;};return/*#__PURE__*/_jsx(Select,{variant:SelectVariant.typeaheadMulti,onToggle:toggleExpanded,onSelect:function onSelect(e,item){if(typeof item==='string'){item={id:item,name:item};}_onSelect(e,item);},onClear:function onClear(){return onChange([]);},onFilter:onFilter,isCreatable:true,onCreateOption:function onCreateOption(label){label=label.trim();if(!options.includes(label)){setOptions(options.concat({name:label,id:label}));}return label;},isDisabled:isLoading,selections:selections,isOpen:isExpanded,typeAheadAriaLabel:/*i18n*/i18n._(\"Select Labels\"),placeholderText:placeholder,createText:createText,noResultsFoundText:/*i18n*/i18n._(\"No results found\"),ouiaId:\"template-label-select\",children:renderOptions(options)});}LabelSelect.defaultProps={placeholder:''};export default LabelSelect;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/LabelSelect/LabelSelect.js"],"names":["React","useState","useEffect","Select","SelectOption","SelectVariant","LabelsAPI","useIsMounted","useSyncedSelectValue","loadLabelOptions","setLabels","onError","isMounted","current","read","page","page_size","order_by","data","labels","results","next","includes","concat","LabelSelect","value","placeholder","onChange","createText","isLoading","setIsLoading","isExpanded","setIsExpanded","selections","onSelect","options","setOptions","toggleExpanded","toggleValue","renderOptions","opts","map","option","name","id","onFilter","event","str","target","toLowerCase","matches","filter","o","typeaheadMulti","e","item","label","trim","defaultProps"],"mappings":"uVAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CAEA,OAASC,MAAT,CAAiBC,YAAjB,CAA+BC,aAA/B,KAAoD,wBAApD,CAEA,OAASC,SAAT,KAA0B,KAA1B,CACA,MAAOC,CAAAA,YAAP,KAAyB,oBAAzB,CACA,OAASC,oBAAT,KAAqC,gBAArC,C,mDAEeC,CAAAA,gB,oKAAf,kBAAgCC,SAAhC,CAA2CC,OAA3C,CAAoDC,SAApD,8LACOA,SAAS,CAACC,OADjB,2GAM2BP,CAAAA,SAAS,CAACQ,IAAV,CAAe,CACpCC,IAAI,CAAE,CAD8B,CAEpCC,SAAS,CAAE,GAFyB,CAGpCC,QAAQ,CAAE,MAH0B,CAAf,CAN3B,6CAMYC,IANZ,uBAMYA,IANZ,CAWIC,MAAM,CAAGD,IAAI,CAACE,OAAd,CACAV,SAAS,CAACS,MAAD,CAAT,CAZJ,KAaQD,IAAI,CAACG,IAAL,EAAaH,IAAI,CAACG,IAAL,CAAUC,QAAV,CAAmB,QAAnB,CAbrB,oDAgBgBhB,CAAAA,SAAS,CAACQ,IAAV,CAAe,CACvBC,IAAI,CAAE,CADiB,CAEvBC,SAAS,CAAE,GAFY,CAGvBC,QAAQ,CAAE,MAHa,CAAf,CAhBhB,+CAegBG,OAfhB,wBAeQF,IAfR,CAegBE,OAfhB,CAqBMV,SAAS,CAACS,MAAM,CAACI,MAAP,CAAcH,OAAd,CAAD,CAAT,CArBN,6FAwBIT,OAAO,cAAP,CAxBJ,uE,mDA4BA,QAASa,CAAAA,WAAT,MAA4E,IAArDC,CAAAA,KAAqD,MAArDA,KAAqD,CAA9CC,WAA8C,MAA9CA,WAA8C,CAAjCC,QAAiC,MAAjCA,QAAiC,CAAvBhB,OAAuB,MAAvBA,OAAuB,CAAdiB,UAAc,MAAdA,UAAc,CAC1E,cAAkC3B,QAAQ,CAAC,IAAD,CAA1C,wCAAO4B,SAAP,eAAkBC,YAAlB,eACA,eAAoC7B,QAAQ,CAAC,KAAD,CAA5C,yCAAO8B,UAAP,eAAmBC,aAAnB,eACA,GAAMpB,CAAAA,SAAS,CAAGL,YAAY,EAA9B,CACA,0BAAsDC,oBAAoB,CACxEiB,KADwE,CAExEE,QAFwE,CAA1E,CAAQM,UAAR,uBAAQA,UAAR,CAAoBC,SAApB,uBAAoBA,QAApB,CAA8BC,OAA9B,uBAA8BA,OAA9B,CAAuCC,UAAvC,uBAAuCA,UAAvC,CAKA,GAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACC,WAAD,CAAiB,CACtCN,aAAa,CAACM,WAAD,CAAb,CACD,CAFD,CAIApC,SAAS,CAAC,UAAM,CACd,wDAAC,yJACOO,CAAAA,gBAAgB,CAAC2B,UAAD,CAAazB,OAAb,CAAsBC,SAAtB,CADvB,WAEMA,SAAS,CAACC,OAFhB,iEAKCiB,YAAY,CAAC,KAAD,CAAZ,CALD,sDAAD,KAOA,0DACD,CATQ,CASN,EATM,CAAT,CAWA,GAAMS,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,IAAD,QACpBA,CAAAA,IAAI,CAACC,GAAL,CAAS,SAACC,MAAD,qBACP,KAAC,YAAD,EAA8B,aAAYA,MAAM,CAACC,IAAjD,CAAuD,KAAK,CAAED,MAA9D,UACGA,MAAM,CAACC,IADV,EAAmBD,MAAM,CAACE,EAA1B,CADO,EAAT,CADoB,EAAtB,CAOA,GAAMC,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACC,KAAD,CAAW,CAC1B,GAAIA,KAAJ,CAAW,CACT,GAAMC,CAAAA,GAAG,CAAGD,KAAK,CAACE,MAAN,CAAavB,KAAb,CAAmBwB,WAAnB,EAAZ,CACA,GAAMC,CAAAA,OAAO,CAAGf,OAAO,CAACgB,MAAR,CAAe,SAACC,CAAD,QAAOA,CAAAA,CAAC,CAACT,IAAF,CAAOM,WAAP,GAAqB3B,QAArB,CAA8ByB,GAA9B,CAAP,EAAf,CAAhB,CACA,MAAOR,CAAAA,aAAa,CAACW,OAAD,CAApB,CACD,CACD,MAAO,KAAP,CACD,CAPD,CAQA,mBACE,KAAC,MAAD,EACE,OAAO,CAAE7C,aAAa,CAACgD,cADzB,CAEE,QAAQ,CAAEhB,cAFZ,CAGE,QAAQ,CAAE,kBAACiB,CAAD,CAAIC,IAAJ,CAAa,CACrB,GAAI,MAAOA,CAAAA,IAAP,GAAgB,QAApB,CAA8B,CAC5BA,IAAI,CAAG,CAAEX,EAAE,CAAEW,IAAN,CAAYZ,IAAI,CAAEY,IAAlB,CAAP,CACD,CACDrB,SAAQ,CAACoB,CAAD,CAAIC,IAAJ,CAAR,CACD,CARH,CASE,OAAO,CAAE,yBAAM5B,CAAAA,QAAQ,CAAC,EAAD,CAAd,EATX,CAUE,QAAQ,CAAEkB,QAVZ,CAWE,WAAW,KAXb,CAYE,cAAc,CAAE,wBAACW,KAAD,CAAW,CACzBA,KAAK,CAAGA,KAAK,CAACC,IAAN,EAAR,CACA,GAAI,CAACtB,OAAO,CAACb,QAAR,CAAiBkC,KAAjB,CAAL,CAA8B,CAC5BpB,UAAU,CAACD,OAAO,CAACZ,MAAR,CAAe,CAAEoB,IAAI,CAAEa,KAAR,CAAeZ,EAAE,CAAEY,KAAnB,CAAf,CAAD,CAAV,CACD,CACD,MAAOA,CAAAA,KAAP,CACD,CAlBH,CAmBE,UAAU,CAAE3B,SAnBd,CAoBE,UAAU,CAAEI,UApBd,CAqBE,MAAM,CAAEF,UArBV,CAsBE,kBAAkB,SAAE,uBAtBtB,CAuBE,eAAe,CAAEL,WAvBnB,CAwBE,UAAU,CAAEE,UAxBd,CAyBE,kBAAkB,SAAE,0BAzBtB,CA0BE,MAAM,CAAC,uBA1BT,UA4BGW,aAAa,CAACJ,OAAD,CA5BhB,EADF,CAgCD,CAYDX,WAAW,CAACkC,YAAZ,CAA2B,CACzBhC,WAAW,CAAE,EADY,CAA3B,CAIA,cAAeF,CAAAA,WAAf","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { func, arrayOf, number, shape, string, oneOfType } from 'prop-types';\nimport { Select, SelectOption, SelectVariant } from '@patternfly/react-core';\nimport { t } from '@lingui/macro';\nimport { LabelsAPI } from 'api';\nimport useIsMounted from 'hooks/useIsMounted';\nimport { useSyncedSelectValue } from '../MultiSelect';\n\nasync function loadLabelOptions(setLabels, onError, isMounted) {\n  if (!isMounted.current) {\n    return;\n  }\n  let labels;\n  try {\n    const { data } = await LabelsAPI.read({\n      page: 1,\n      page_size: 200,\n      order_by: 'name',\n    });\n    labels = data.results;\n    setLabels(labels);\n    if (data.next && data.next.includes('page=2')) {\n      const {\n        data: { results },\n      } = await LabelsAPI.read({\n        page: 2,\n        page_size: 200,\n        order_by: 'name',\n      });\n      setLabels(labels.concat(results));\n    }\n  } catch (err) {\n    onError(err);\n  }\n}\n\nfunction LabelSelect({ value, placeholder, onChange, onError, createText }) {\n  const [isLoading, setIsLoading] = useState(true);\n  const [isExpanded, setIsExpanded] = useState(false);\n  const isMounted = useIsMounted();\n  const { selections, onSelect, options, setOptions } = useSyncedSelectValue(\n    value,\n    onChange\n  );\n\n  const toggleExpanded = (toggleValue) => {\n    setIsExpanded(toggleValue);\n  };\n\n  useEffect(() => {\n    (async () => {\n      await loadLabelOptions(setOptions, onError, isMounted);\n      if (!isMounted.current) {\n        return;\n      }\n      setIsLoading(false);\n    })();\n    /* eslint-disable-next-line react-hooks/exhaustive-deps */\n  }, []);\n\n  const renderOptions = (opts) =>\n    opts.map((option) => (\n      <SelectOption key={option.id} aria-label={option.name} value={option}>\n        {option.name}\n      </SelectOption>\n    ));\n\n  const onFilter = (event) => {\n    if (event) {\n      const str = event.target.value.toLowerCase();\n      const matches = options.filter((o) => o.name.toLowerCase().includes(str));\n      return renderOptions(matches);\n    }\n    return null;\n  };\n  return (\n    <Select\n      variant={SelectVariant.typeaheadMulti}\n      onToggle={toggleExpanded}\n      onSelect={(e, item) => {\n        if (typeof item === 'string') {\n          item = { id: item, name: item };\n        }\n        onSelect(e, item);\n      }}\n      onClear={() => onChange([])}\n      onFilter={onFilter}\n      isCreatable\n      onCreateOption={(label) => {\n        label = label.trim();\n        if (!options.includes(label)) {\n          setOptions(options.concat({ name: label, id: label }));\n        }\n        return label;\n      }}\n      isDisabled={isLoading}\n      selections={selections}\n      isOpen={isExpanded}\n      typeAheadAriaLabel={t`Select Labels`}\n      placeholderText={placeholder}\n      createText={createText}\n      noResultsFoundText={t`No results found`}\n      ouiaId=\"template-label-select\"\n    >\n      {renderOptions(options)}\n    </Select>\n  );\n}\nLabelSelect.propTypes = {\n  value: arrayOf(\n    shape({\n      id: oneOfType([number, string]).isRequired,\n      name: string.isRequired,\n    })\n  ).isRequired,\n  placeholder: string,\n  onChange: func.isRequired,\n  onError: func.isRequired,\n};\nLabelSelect.defaultProps = {\n  placeholder: '',\n};\n\nexport default LabelSelect;\n"]},"metadata":{},"sourceType":"module"}