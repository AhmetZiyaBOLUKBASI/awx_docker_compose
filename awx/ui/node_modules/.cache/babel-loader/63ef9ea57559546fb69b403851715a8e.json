{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _styled2 from\"styled-components\";import _styled from\"styled-components\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import React,{useState,useContext,useEffect}from'react';import{useParams}from'react-router-dom';import{Button,Radio,DropdownItem}from'@patternfly/react-core';import styled from'styled-components';import{KebabifiedContext}from'contexts/Kebabified';import{GroupsAPI,InventoriesAPI}from'api';import{Group}from'types';import ErrorDetail from'components/ErrorDetail';import AlertModal from'components/AlertModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ListItem=styled.li.withConfig({displayName:\"InventoryGroupsDeleteModal__ListItem\",componentId:\"sfp64g-0\"})([\"display:flex;font-weight:600;color:var(--pf-global--danger-color--100);\"]);var _StyledDiv=styled(\"div\").withConfig({displayName:\"InventoryGroupsDeleteModal___StyledDiv\",componentId:\"sfp64g-1\"})([\"padding:24px 0;\"]);var _StyledRadio=styled(Radio).withConfig({displayName:\"InventoryGroupsDeleteModal___StyledRadio\",componentId:\"sfp64g-2\"})([\"margin-top:5px;\"]);var InventoryGroupsDeleteModal=function InventoryGroupsDeleteModal(_ref){var onAfterDelete=_ref.onAfterDelete,isDisabled=_ref.isDisabled,groups=_ref.groups;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),radioOption=_useState2[0],setRadioOption=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isModalOpen=_useState4[0],setIsModalOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isDeleteLoading=_useState6[0],setIsDeleteLoading=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),deletionError=_useState8[0],setDeletionError=_useState8[1];var _useParams=useParams(),inventoryId=_useParams.id;var _useContext=useContext(KebabifiedContext),isKebabified=_useContext.isKebabified,onKebabModalChange=_useContext.onKebabModalChange;useEffect(function(){if(isKebabified){onKebabModalChange(isModalOpen);}},[isKebabified,isModalOpen,onKebabModalChange]);var handleDelete=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(option){var i,group;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsDeleteLoading(true);_context.prev=1;i=0;case 3:if(!(i<groups.length)){_context.next=16;break;}group=groups[i];if(!(option==='delete')){_context.next=10;break;}_context.next=8;return GroupsAPI.destroy(+group.id);case 8:_context.next=13;break;case 10:if(!(option==='promote')){_context.next=13;break;}_context.next=13;return InventoriesAPI.promoteGroup(inventoryId,+group.id);case 13:i++;_context.next=3;break;case 16:_context.next=21;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](1);setDeletionError(_context.t0);case 21:_context.prev=21;setIsModalOpen(false);setIsDeleteLoading(false);onAfterDelete();return _context.finish(21);case 26:case\"end\":return _context.stop();}}},_callee,null,[[1,18,21,26]]);}));return function handleDelete(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[isKebabified?/*#__PURE__*/_jsx(DropdownItem,{isDisabled:isDisabled||isDeleteLoading,component:\"button\",\"aria-label\":/*i18n*/i18n._(\"Delete\"),onClick:function onClick(){return setIsModalOpen(true);},ouiaId:\"group-delete-dropdown-item\",children:/*i18n*/i18n._(\"Delete\")},\"delete\"):/*#__PURE__*/_jsx(Button,{variant:\"secondary\",\"aria-label\":/*i18n*/i18n._(\"Delete\"),onClick:function onClick(){return setIsModalOpen(true);},isDisabled:isDisabled||isDeleteLoading,ouiaId:\"group-delete-button\",children:/*i18n*/i18n._(\"Delete\")}),isModalOpen&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:isModalOpen,variant:\"danger\",title:/*#__PURE__*/_jsx(Trans,{id:\"{0, plural, one {Delete Group?} other {Delete Groups?}}\",values:{0:groups.length}}),onClose:function onClose(){return setIsModalOpen(false);},actions:[/*#__PURE__*/_jsx(Button,{\"aria-label\":/*i18n*/i18n._(\"Confirm Delete\"),onClick:function onClick(){return handleDelete(radioOption);},variant:\"danger\",isDisabled:radioOption===null,ouiaId:\"delete-modal-confirm-button\",children:/*i18n*/i18n._(\"Delete\")},\"delete\"),/*#__PURE__*/_jsx(Button,{\"aria-label\":/*i18n*/i18n._(\"Close\"),onClick:function onClick(){return setIsModalOpen(false);},variant:\"link\",ouiaId:\"delete-modal-cancel-button\",children:/*i18n*/i18n._(\"Cancel\")},\"cancel\")],children:[/*#__PURE__*/_jsx(Trans,{id:\"{0, plural, one {Are you sure you want delete the group below?} other {Are you sure you want delete the groups below?}}\",values:{0:groups.length}}),/*#__PURE__*/_jsx(_StyledDiv,{children:groups.map(function(group){return/*#__PURE__*/_jsx(ListItem,{children:group.name},group.id);})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Radio,{id:\"radio-delete\",label:/*i18n*/i18n._(\"Delete All Groups and Hosts\"),name:\"option\",onChange:function onChange(){return setRadioOption('delete');},ouiaId:\"delete-all-radio-button\"},\"radio-delete\"),/*#__PURE__*/_jsx(_StyledRadio,{id:\"radio-promote\",label:/*i18n*/i18n._(\"Promote Child Groups and Hosts\"),name:\"option\",onChange:function onChange(){return setRadioOption('promote');},ouiaId:\"promote-radio-button\"},\"radio-promote\")]})]}),deletionError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:deletionError,variant:\"error\",\"aria-label\":/*i18n*/i18n._(\"deletion error\"),title:/*i18n*/i18n._(\"Error!\"),onClose:function onClose(){return setDeletionError(null);},children:[/*i18n*/i18n._(\"Failed to delete one or more groups.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:deletionError})]})]});};InventoryGroupsDeleteModal.defaultProps={groups:[]};export default InventoryGroupsDeleteModal;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Inventory/shared/InventoryGroupsDeleteModal.js"],"names":["React","useState","useContext","useEffect","useParams","Button","Radio","DropdownItem","styled","KebabifiedContext","GroupsAPI","InventoriesAPI","Group","ErrorDetail","AlertModal","ListItem","li","InventoryGroupsDeleteModal","onAfterDelete","isDisabled","groups","radioOption","setRadioOption","isModalOpen","setIsModalOpen","isDeleteLoading","setIsDeleteLoading","deletionError","setDeletionError","inventoryId","id","isKebabified","onKebabModalChange","handleDelete","option","i","length","group","destroy","promoteGroup","map","name","defaultProps"],"mappings":"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","sourcesContent":["import 'styled-components/macro';\nimport React, { useState, useContext, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { func, bool, arrayOf } from 'prop-types';\nimport { t, Plural } from '@lingui/macro';\nimport { Button, Radio, DropdownItem } from '@patternfly/react-core';\nimport styled from 'styled-components';\nimport { KebabifiedContext } from 'contexts/Kebabified';\nimport { GroupsAPI, InventoriesAPI } from 'api';\nimport { Group } from 'types';\nimport ErrorDetail from 'components/ErrorDetail';\nimport AlertModal from 'components/AlertModal';\n\nconst ListItem = styled.li`\n  display: flex;\n  font-weight: 600;\n  color: var(--pf-global--danger-color--100);\n`;\n\nconst InventoryGroupsDeleteModal = ({ onAfterDelete, isDisabled, groups }) => {\n  const [radioOption, setRadioOption] = useState(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [isDeleteLoading, setIsDeleteLoading] = useState(false);\n  const [deletionError, setDeletionError] = useState(null);\n  const { id: inventoryId } = useParams();\n  const { isKebabified, onKebabModalChange } = useContext(KebabifiedContext);\n\n  useEffect(() => {\n    if (isKebabified) {\n      onKebabModalChange(isModalOpen);\n    }\n  }, [isKebabified, isModalOpen, onKebabModalChange]);\n  const handleDelete = async (option) => {\n    setIsDeleteLoading(true);\n\n    try {\n      /* eslint-disable no-await-in-loop */\n      /* Delete groups sequentially to avoid api integrity errors */\n      /* https://eslint.org/docs/rules/no-await-in-loop#when-not-to-use-it */\n      for (let i = 0; i < groups.length; i++) {\n        const group = groups[i];\n        if (option === 'delete') {\n          await GroupsAPI.destroy(+group.id);\n        } else if (option === 'promote') {\n          await InventoriesAPI.promoteGroup(inventoryId, +group.id);\n        }\n      }\n      /* eslint-enable no-await-in-loop */\n    } catch (error) {\n      setDeletionError(error);\n    } finally {\n      setIsModalOpen(false);\n      setIsDeleteLoading(false);\n      onAfterDelete();\n    }\n  };\n  return (\n    <>\n      {isKebabified ? (\n        <DropdownItem\n          key=\"delete\"\n          isDisabled={isDisabled || isDeleteLoading}\n          component=\"button\"\n          aria-label={t`Delete`}\n          onClick={() => setIsModalOpen(true)}\n          ouiaId=\"group-delete-dropdown-item\"\n        >\n          {t`Delete`}\n        </DropdownItem>\n      ) : (\n        <Button\n          variant=\"secondary\"\n          aria-label={t`Delete`}\n          onClick={() => setIsModalOpen(true)}\n          isDisabled={isDisabled || isDeleteLoading}\n          ouiaId=\"group-delete-button\"\n        >\n          {t`Delete`}\n        </Button>\n      )}\n      {isModalOpen && (\n        <AlertModal\n          isOpen={isModalOpen}\n          variant=\"danger\"\n          title={\n            <Plural\n              value={groups.length}\n              one=\"Delete Group?\"\n              other=\"Delete Groups?\"\n            />\n          }\n          onClose={() => setIsModalOpen(false)}\n          actions={[\n            <Button\n              aria-label={t`Confirm Delete`}\n              onClick={() => handleDelete(radioOption)}\n              variant=\"danger\"\n              key=\"delete\"\n              isDisabled={radioOption === null}\n              ouiaId=\"delete-modal-confirm-button\"\n            >\n              {t`Delete`}\n            </Button>,\n            <Button\n              aria-label={t`Close`}\n              onClick={() => setIsModalOpen(false)}\n              variant=\"link\"\n              key=\"cancel\"\n              ouiaId=\"delete-modal-cancel-button\"\n            >\n              {t`Cancel`}\n            </Button>,\n          ]}\n        >\n          <Plural\n            value={groups.length}\n            one=\"Are you sure you want delete the group below?\"\n            other=\"Are you sure you want delete the groups below?\"\n          />\n\n          <div css=\"padding: 24px 0;\">\n            {groups.map((group) => (\n              <ListItem key={group.id}>{group.name}</ListItem>\n            ))}\n          </div>\n          <div>\n            <Radio\n              id=\"radio-delete\"\n              key=\"radio-delete\"\n              label={t`Delete All Groups and Hosts`}\n              name=\"option\"\n              onChange={() => setRadioOption('delete')}\n              ouiaId=\"delete-all-radio-button\"\n            />\n            <Radio\n              css=\"margin-top: 5px;\"\n              id=\"radio-promote\"\n              key=\"radio-promote\"\n              label={t`Promote Child Groups and Hosts`}\n              name=\"option\"\n              onChange={() => setRadioOption('promote')}\n              ouiaId=\"promote-radio-button\"\n            />\n          </div>\n        </AlertModal>\n      )}\n      {deletionError && (\n        <AlertModal\n          isOpen={deletionError}\n          variant=\"error\"\n          aria-label={t`deletion error`}\n          title={t`Error!`}\n          onClose={() => setDeletionError(null)}\n        >\n          {t`Failed to delete one or more groups.`}\n          <ErrorDetail error={deletionError} />\n        </AlertModal>\n      )}\n    </>\n  );\n};\n\nInventoryGroupsDeleteModal.propTypes = {\n  onAfterDelete: func.isRequired,\n  groups: arrayOf(Group),\n  isDisabled: bool.isRequired,\n};\n\nInventoryGroupsDeleteModal.defaultProps = {\n  groups: [],\n};\n\nexport default InventoryGroupsDeleteModal;\n"]},"metadata":{},"sourceType":"module"}