{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{Button,EmptyState,EmptyStateIcon,EmptyStateBody,Modal,Title}from'@patternfly/react-core';import{TableComposable,Tbody,Td,Th,Thead,Tr}from'@patternfly/react-table';import{ExclamationTriangleIcon}from'@patternfly/react-icons';import{ConfigAPI}from'api';import{formatDateString}from'util/dates';import useRequest from'hooks/useRequest';import useSelected from'hooks/useSelected';import ErrorDetail from'components/ErrorDetail';import ContentEmpty from'components/ContentEmpty';import ContentLoading from'components/ContentLoading';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function SubscriptionModal(_ref){var _ref$subscriptionCred=_ref.subscriptionCreds,subscriptionCreds=_ref$subscriptionCred===void 0?{}:_ref$subscriptionCred,_ref$selectedSubscrip=_ref.selectedSubscription,selectedSubscription=_ref$selectedSubscrip===void 0?null:_ref$selectedSubscrip,onClose=_ref.onClose,onConfirm=_ref.onConfirm;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$ConfigAPI$read,data,repeatId;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!subscriptionCreds.username||!subscriptionCreds.password)){_context.next=2;break;}return _context.abrupt(\"return\",[]);case 2:_context.next=4;return ConfigAPI.readSubscriptions(subscriptionCreds.username,subscriptionCreds.password);case 4:_yield$ConfigAPI$read=_context.sent;data=_yield$ConfigAPI$read.data;// Ensure unique ids for each subscription\n// because it is possible to have multiple\n// subscriptions with the same pool_id\nrepeatId=1;data.forEach(function(i){i.id=repeatId++;});return _context.abrupt(\"return\",data);case 9:case\"end\":return _context.stop();}}},_callee);})),[]),// eslint-disable-line react-hooks/exhaustive-deps\n[]),isLoading=_useRequest.isLoading,error=_useRequest.error,fetchSubscriptions=_useRequest.request,subscriptions=_useRequest.result;var _useSelected=useSelected(subscriptions),selected=_useSelected.selected,setSelected=_useSelected.setSelected;var handleConfirm=function handleConfirm(){var _selected=_slicedToArray(selected,1),subscription=_selected[0];onConfirm(subscription);onClose();};useEffect(function(){fetchSubscriptions();},[fetchSubscriptions]);useEffect(function(){if(selectedSubscription!==null&&selectedSubscription!==void 0&&selectedSubscription.id){setSelected([selectedSubscription]);}},[]);// eslint-disable-line react-hooks/exhaustive-deps\nreturn/*#__PURE__*/_jsxs(Modal,{\"aria-label\":/*i18n*/i18n._(\"Subscription selection modal\"),isOpen:true,onClose:onClose,title:/*i18n*/i18n._(\"Select a subscription\"),width:\"50%\",actions:[/*#__PURE__*/_jsx(Button,{\"aria-label\":/*i18n*/i18n._(\"Confirm selection\"),isDisabled:selected.length===0,onClick:handleConfirm,variant:\"primary\",ouiaId:\"subscription-modal-confirm\",children:/*#__PURE__*/_jsx(Trans,{id:\"Select\"})},\"confirm\"),/*#__PURE__*/_jsx(Button,{\"aria-label\":/*i18n*/i18n._(\"Cancel\"),onClick:onClose,variant:\"link\",ouiaId:\"subscription-modal-cancel\",children:/*#__PURE__*/_jsx(Trans,{id:\"Cancel\"})},\"cancel\")],children:[isLoading&&/*#__PURE__*/_jsx(ContentLoading,{}),!isLoading&&error&&/*#__PURE__*/_jsxs(EmptyState,{variant:\"full\",children:[/*#__PURE__*/_jsx(EmptyStateIcon,{icon:ExclamationTriangleIcon}),/*#__PURE__*/_jsx(Title,{size:\"lg\",headingLevel:\"h3\",children:/*#__PURE__*/_jsx(Trans,{id:\"No subscriptions found\"})}),/*#__PURE__*/_jsxs(EmptyStateBody,{children:[/*#__PURE__*/_jsx(Trans,{id:\"We were unable to locate licenses associated with this account.\"}),' ',/*#__PURE__*/_jsx(Button,{\"aria-label\":/*i18n*/i18n._(\"Close subscription modal\"),onClick:onClose,variant:\"link\",isInline:true,ouiaId:\"subscription-modal-close\",children:/*#__PURE__*/_jsx(Trans,{id:\"Return to subscription management.\"})})]}),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]}),!isLoading&&!error&&(subscriptions===null||subscriptions===void 0?void 0:subscriptions.length)===0&&/*#__PURE__*/_jsx(ContentEmpty,{title:/*i18n*/i18n._(\"No subscriptions found\"),message:/*i18n*/i18n._(\"We were unable to locate subscriptions associated with this account.\")}),!isLoading&&!error&&(subscriptions===null||subscriptions===void 0?void 0:subscriptions.length)>0&&/*#__PURE__*/_jsxs(TableComposable,{variant:\"compact\",\"aria-label\":/*i18n*/i18n._(\"Subscriptions table\"),children:[/*#__PURE__*/_jsx(Thead,{children:/*#__PURE__*/_jsxs(Tr,{ouiaId:\"subscription-table-header\",children:[/*#__PURE__*/_jsx(Th,{}),/*#__PURE__*/_jsx(Th,{children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(Th,{modifier:\"fitContent\",children:/*i18n*/i18n._(\"Managed nodes\")}),/*#__PURE__*/_jsx(Th,{modifier:\"fitContent\",children:/*i18n*/i18n._(\"Expires\")})]})}),/*#__PURE__*/_jsx(Tbody,{children:subscriptions.map(function(subscription){return/*#__PURE__*/_jsxs(Tr,{id:\"row-\".concat(subscription.id),ouiaId:\"subscription-row-\".concat(subscription.pool_id),children:[/*#__PURE__*/_jsx(Td,{select:{onSelect:function onSelect(){return setSelected([subscription]);},isSelected:selected.some(function(row){return row.id===subscription.id;}),variant:'radio',rowIndex:\"row-\".concat(subscription.id)}}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Trial\"),children:subscription.subscription_name}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Managed nodes\"),children:subscription.instance_count}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Expires\"),modifier:\"nowrap\",children:formatDateString(new Date(subscription.license_date*1000).toISOString(),'UTC')})]},\"row-\".concat(subscription.id));})})]})]});}export default SubscriptionModal;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Setting/Subscription/SubscriptionEdit/SubscriptionModal.js"],"names":["React","useCallback","useEffect","Button","EmptyState","EmptyStateIcon","EmptyStateBody","Modal","Title","TableComposable","Tbody","Td","Th","Thead","Tr","ExclamationTriangleIcon","ConfigAPI","formatDateString","useRequest","useSelected","ErrorDetail","ContentEmpty","ContentLoading","SubscriptionModal","subscriptionCreds","selectedSubscription","onClose","onConfirm","username","password","readSubscriptions","data","repeatId","forEach","i","id","isLoading","error","fetchSubscriptions","request","subscriptions","result","selected","setSelected","handleConfirm","subscription","length","map","pool_id","onSelect","isSelected","some","row","variant","rowIndex","subscription_name","instance_count","Date","license_date","toISOString"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from 'react';\n\nimport { t, Trans } from '@lingui/macro';\nimport {\n  Button,\n  EmptyState,\n  EmptyStateIcon,\n  EmptyStateBody,\n  Modal,\n  Title,\n} from '@patternfly/react-core';\nimport {\n  TableComposable,\n  Tbody,\n  Td,\n  Th,\n  Thead,\n  Tr,\n} from '@patternfly/react-table';\nimport { ExclamationTriangleIcon } from '@patternfly/react-icons';\n\nimport { ConfigAPI } from 'api';\nimport { formatDateString } from 'util/dates';\nimport useRequest from 'hooks/useRequest';\nimport useSelected from 'hooks/useSelected';\nimport ErrorDetail from 'components/ErrorDetail';\nimport ContentEmpty from 'components/ContentEmpty';\nimport ContentLoading from 'components/ContentLoading';\n\nfunction SubscriptionModal({\n  subscriptionCreds = {},\n  selectedSubscription = null,\n  onClose,\n  onConfirm,\n}) {\n  const {\n    isLoading,\n    error,\n    request: fetchSubscriptions,\n    result: subscriptions,\n  } = useRequest(\n    useCallback(async () => {\n      if (!subscriptionCreds.username || !subscriptionCreds.password) {\n        return [];\n      }\n      const { data } = await ConfigAPI.readSubscriptions(\n        subscriptionCreds.username,\n        subscriptionCreds.password\n      );\n\n      // Ensure unique ids for each subscription\n      // because it is possible to have multiple\n      // subscriptions with the same pool_id\n      let repeatId = 1;\n      data.forEach((i) => {\n        i.id = repeatId++;\n      });\n\n      return data;\n    }, []), // eslint-disable-line react-hooks/exhaustive-deps\n    []\n  );\n\n  const { selected, setSelected } = useSelected(subscriptions);\n\n  const handleConfirm = () => {\n    const [subscription] = selected;\n    onConfirm(subscription);\n    onClose();\n  };\n\n  useEffect(() => {\n    fetchSubscriptions();\n  }, [fetchSubscriptions]);\n\n  useEffect(() => {\n    if (selectedSubscription?.id) {\n      setSelected([selectedSubscription]);\n    }\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return (\n    <Modal\n      aria-label={t`Subscription selection modal`}\n      isOpen\n      onClose={onClose}\n      title={t`Select a subscription`}\n      width=\"50%\"\n      actions={[\n        <Button\n          aria-label={t`Confirm selection`}\n          isDisabled={selected.length === 0}\n          key=\"confirm\"\n          onClick={handleConfirm}\n          variant=\"primary\"\n          ouiaId=\"subscription-modal-confirm\"\n        >\n          <Trans>Select</Trans>\n        </Button>,\n        <Button\n          aria-label={t`Cancel`}\n          key=\"cancel\"\n          onClick={onClose}\n          variant=\"link\"\n          ouiaId=\"subscription-modal-cancel\"\n        >\n          <Trans>Cancel</Trans>\n        </Button>,\n      ]}\n    >\n      {isLoading && <ContentLoading />}\n      {!isLoading && error && (\n        <EmptyState variant=\"full\">\n          <EmptyStateIcon icon={ExclamationTriangleIcon} />\n          <Title size=\"lg\" headingLevel=\"h3\">\n            <Trans>No subscriptions found</Trans>\n          </Title>\n          <EmptyStateBody>\n            <Trans>\n              We were unable to locate licenses associated with this account.\n            </Trans>{' '}\n            <Button\n              aria-label={t`Close subscription modal`}\n              onClick={onClose}\n              variant=\"link\"\n              isInline\n              ouiaId=\"subscription-modal-close\"\n            >\n              <Trans>Return to subscription management.</Trans>\n            </Button>\n          </EmptyStateBody>\n          <ErrorDetail error={error} />\n        </EmptyState>\n      )}\n      {!isLoading && !error && subscriptions?.length === 0 && (\n        <ContentEmpty\n          title={t`No subscriptions found`}\n          message={t`We were unable to locate subscriptions associated with this account.`}\n        />\n      )}\n      {!isLoading && !error && subscriptions?.length > 0 && (\n        <TableComposable variant=\"compact\" aria-label={t`Subscriptions table`}>\n          <Thead>\n            <Tr ouiaId=\"subscription-table-header\">\n              <Th />\n              <Th>{t`Name`}</Th>\n              <Th modifier=\"fitContent\">{t`Managed nodes`}</Th>\n              <Th modifier=\"fitContent\">{t`Expires`}</Th>\n            </Tr>\n          </Thead>\n          <Tbody>\n            {subscriptions.map((subscription) => (\n              <Tr\n                key={`row-${subscription.id}`}\n                id={`row-${subscription.id}`}\n                ouiaId={`subscription-row-${subscription.pool_id}`}\n              >\n                <Td\n                  select={{\n                    onSelect: () => setSelected([subscription]),\n                    isSelected: selected.some(\n                      (row) => row.id === subscription.id\n                    ),\n                    variant: 'radio',\n                    rowIndex: `row-${subscription.id}`,\n                  }}\n                />\n                <Td dataLabel={t`Trial`}>{subscription.subscription_name}</Td>\n                <Td dataLabel={t`Managed nodes`}>\n                  {subscription.instance_count}\n                </Td>\n                <Td dataLabel={t`Expires`} modifier=\"nowrap\">\n                  {formatDateString(\n                    new Date(subscription.license_date * 1000).toISOString(),\n                    'UTC'\n                  )}\n                </Td>\n              </Tr>\n            ))}\n          </Tbody>\n        </TableComposable>\n      )}\n    </Modal>\n  );\n}\n\nexport default SubscriptionModal;\n"]},"metadata":{},"sourceType":"module"}