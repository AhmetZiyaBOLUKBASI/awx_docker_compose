{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{useState,useEffect}from'react';import useWebsocket from'hooks/useWebsocket';import useThrottle from'hooks/useThrottle';export default function useWsPendingApprovalCount(initialCount,fetchApprovalsCount){var _useState=useState(initialCount),_useState2=_slicedToArray(_useState,2),pendingApprovalCount=_useState2[0],setPendingApprovalCount=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),reloadCount=_useState4[0],setReloadCount=_useState4[1];var throttledFetch=useThrottle(reloadCount,1000);var lastMessage=useWebsocket({jobs:['status_changed'],control:['limit_reached_1']});useEffect(function(){setPendingApprovalCount(initialCount);},[initialCount]);useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(throttledFetch){_context.next=2;break;}return _context.abrupt(\"return\");case 2:setReloadCount(false);fetchApprovalsCount();case 4:case\"end\":return _context.stop();}}},_callee);}))();},[throttledFetch,fetchApprovalsCount]);useEffect(function(){if((lastMessage===null||lastMessage===void 0?void 0:lastMessage.type)==='workflow_approval'){setReloadCount(true);}},[lastMessage]);return pendingApprovalCount;}","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/AppContainer/useWsPendingApprovalCount.js"],"names":["useState","useEffect","useWebsocket","useThrottle","useWsPendingApprovalCount","initialCount","fetchApprovalsCount","pendingApprovalCount","setPendingApprovalCount","reloadCount","setReloadCount","throttledFetch","lastMessage","jobs","control","type"],"mappings":"wTAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,MAAOC,CAAAA,YAAP,KAAyB,oBAAzB,CACA,MAAOC,CAAAA,WAAP,KAAwB,mBAAxB,CAEA,cAAe,SAASC,CAAAA,yBAAT,CACbC,YADa,CAEbC,mBAFa,CAGb,CACA,cACEN,QAAQ,CAACK,YAAD,CADV,wCAAOE,oBAAP,eAA6BC,uBAA7B,eAEA,eAAsCR,QAAQ,CAAC,KAAD,CAA9C,yCAAOS,WAAP,eAAoBC,cAApB,eACA,GAAMC,CAAAA,cAAc,CAAGR,WAAW,CAACM,WAAD,CAAc,IAAd,CAAlC,CACA,GAAMG,CAAAA,WAAW,CAAGV,YAAY,CAAC,CAC/BW,IAAI,CAAE,CAAC,gBAAD,CADyB,CAE/BC,OAAO,CAAE,CAAC,iBAAD,CAFsB,CAAD,CAAhC,CAKAb,SAAS,CAAC,UAAM,CACdO,uBAAuB,CAACH,YAAD,CAAvB,CACD,CAFQ,CAEN,CAACA,YAAD,CAFM,CAAT,CAIAJ,SAAS,CAAC,UAAM,CACd,wDAAC,sIACMU,cADN,iEAICD,cAAc,CAAC,KAAD,CAAd,CACAJ,mBAAmB,GALpB,sDAAD,KAOD,CARQ,CAQN,CAACK,cAAD,CAAiBL,mBAAjB,CARM,CAAT,CAUAL,SAAS,CAAC,UAAM,CACd,GAAI,CAAAW,WAAW,OAAX,EAAAA,WAAW,SAAX,QAAAA,WAAW,CAAEG,IAAb,IAAsB,mBAA1B,CAA+C,CAC7CL,cAAc,CAAC,IAAD,CAAd,CACD,CACF,CAJQ,CAIN,CAACE,WAAD,CAJM,CAAT,CAMA,MAAOL,CAAAA,oBAAP,CACD","sourcesContent":["import { useState, useEffect } from 'react';\nimport useWebsocket from 'hooks/useWebsocket';\nimport useThrottle from 'hooks/useThrottle';\n\nexport default function useWsPendingApprovalCount(\n  initialCount,\n  fetchApprovalsCount\n) {\n  const [pendingApprovalCount, setPendingApprovalCount] =\n    useState(initialCount);\n  const [reloadCount, setReloadCount] = useState(false);\n  const throttledFetch = useThrottle(reloadCount, 1000);\n  const lastMessage = useWebsocket({\n    jobs: ['status_changed'],\n    control: ['limit_reached_1'],\n  });\n\n  useEffect(() => {\n    setPendingApprovalCount(initialCount);\n  }, [initialCount]);\n\n  useEffect(() => {\n    (async () => {\n      if (!throttledFetch) {\n        return;\n      }\n      setReloadCount(false);\n      fetchApprovalsCount();\n    })();\n  }, [throttledFetch, fetchApprovalsCount]);\n\n  useEffect(() => {\n    if (lastMessage?.type === 'workflow_approval') {\n      setReloadCount(true);\n    }\n  }, [lastMessage]);\n\n  return pendingApprovalCount;\n}\n"]},"metadata":{},"sourceType":"module"}