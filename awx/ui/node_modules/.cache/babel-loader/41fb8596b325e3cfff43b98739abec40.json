{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect,useState}from'react';import{useParams,useLocation,Link}from'react-router-dom';import{DropdownItem}from'@patternfly/react-core';import{GroupsAPI,InventoriesAPI}from'api';import useRequest,{useDismissableError}from'hooks/useRequest';import{getQSConfig,parseQueryString,mergeParams}from'util/qs';import useSelected from'hooks/useSelected';import DataListToolbar from'components/DataListToolbar';import PaginatedTable,{HeaderCell,HeaderRow,getSearchableKeys}from'components/PaginatedTable';import AddDropDownButton from'components/AddDropDownButton';import AdHocCommands from'components/AdHocCommands/AdHocCommands';import AlertModal from'components/AlertModal';import ErrorDetail from'components/ErrorDetail';import AssociateModal from'components/AssociateModal';import DisassociateButton from'components/DisassociateButton';import InventoryGroupRelatedGroupListItem from'./InventoryRelatedGroupListItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('group',{page:1,page_size:20,order_by:'name'});function InventoryRelatedGroupList(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isModalOpen=_useState2[0],setIsModalOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isAdHocLaunchLoading=_useState4[0],setIsAdHocLaunchLoading=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),associateError=_useState6[0],setAssociateError=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),disassociateError=_useState8[0],setDisassociateError=_useState8[1];var _useParams=useParams(),inventoryId=_useParams.id,groupId=_useParams.groupId;var location=useLocation();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actions$data,_actions$data$actions;var params,_yield$Promise$all,_yield$Promise$all2,response,actions,adHocOptions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,location.search);_context.next=3;return Promise.all([GroupsAPI.readChildren(groupId,params),InventoriesAPI.readGroupsOptions(inventoryId),InventoriesAPI.readAdHocOptions(inventoryId)]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,3);response=_yield$Promise$all2[0];actions=_yield$Promise$all2[1];adHocOptions=_yield$Promise$all2[2];return _context.abrupt(\"return\",{moduleOptions:adHocOptions.data.actions.GET.module_name.choices,isAdHocDisabled:!adHocOptions.data.actions.POST,groups:response.data.results,itemCount:response.data.count,relatedSearchableKeys:((actions===null||actions===void 0?void 0:(_actions$data=actions.data)===null||_actions$data===void 0?void 0:_actions$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actions$data$actions=actions.data.actions)===null||_actions$data$actions===void 0?void 0:_actions$data$actions.GET),canAdd:actions.data.actions&&Object.prototype.hasOwnProperty.call(actions.data.actions,'POST')});case 9:case\"end\":return _context.stop();}}},_callee);})),[groupId,location.search,inventoryId]),{groups:[],itemCount:0,canAdd:false,moduleOptions:[],isAdHocDisabled:true}),fetchRelated=_useRequest.request,_useRequest$result=_useRequest.result,groups=_useRequest$result.groups,itemCount=_useRequest$result.itemCount,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,canAdd=_useRequest$result.canAdd,moduleOptions=_useRequest$result.moduleOptions,isAdHocDisabled=_useRequest$result.isAdHocDisabled,isLoading=_useRequest.isLoading,contentError=_useRequest.error;useEffect(function(){fetchRelated();},[fetchRelated]);var fetchGroupsToAssociate=useCallback(function(params){return GroupsAPI.readPotentialGroups(groupId,mergeParams(params,{not__id:groupId,not__parents:groupId}));},[groupId]);var associateGroup=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(selectedGroups){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return Promise.all(selectedGroups.map(function(selected){return GroupsAPI.associateChildGroup(groupId,selected.id);}));case 3:_context2.next=8;break;case 5:_context2.prev=5;_context2.t0=_context2[\"catch\"](0);setAssociateError(_context2.t0);case 8:fetchRelated();case 9:case\"end\":return _context2.stop();}}},_callee2,null,[[0,5]]);}));return function(_x){return _ref2.apply(this,arguments);};}(),[groupId,fetchRelated]);var _useSelected=useSelected(groups),selected=_useSelected.selected,isAllSelected=_useSelected.isAllSelected,handleSelect=_useSelected.handleSelect,setSelected=_useSelected.setSelected;var disassociateGroups=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return Promise.all(selected.map(function(_ref4){var childId=_ref4.id;return GroupsAPI.disassociateChildGroup(parseInt(groupId,10),childId);}));case 3:_context3.next=8;break;case 5:_context3.prev=5;_context3.t0=_context3[\"catch\"](0);setDisassociateError(_context3.t0);case 8:fetchRelated();setSelected([]);case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[0,5]]);})),[groupId,selected,setSelected,fetchRelated]);var fetchGroupsOptions=useCallback(function(){return InventoriesAPI.readGroupsOptions(inventoryId);},[inventoryId]);var _useDismissableError=useDismissableError(associateError||disassociateError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;var addFormUrl=\"/inventories/inventory/\".concat(inventoryId,\"/groups/\").concat(groupId,\"/nested_groups/add\");var addExistingGroup=/*i18n*/i18n._(\"Add existing group\");var addNewGroup=/*i18n*/i18n._(\"Add new group\");var addButton=/*#__PURE__*/_jsx(AddDropDownButton,{ouiaId:\"add-existing-group-button\",dropdownItems:[/*#__PURE__*/_jsx(DropdownItem,{onClick:function onClick(){return setIsModalOpen(true);},\"aria-label\":addExistingGroup,ouiaId:\"add-existing-group-dropdown-item\",children:addExistingGroup},addExistingGroup),/*#__PURE__*/_jsx(DropdownItem,{ouiaId:\"add-new-group-button\",component:Link,to:\"\".concat(addFormUrl),\"aria-label\":addNewGroup,children:addNewGroup},addNewGroup)]},\"add\");return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PaginatedTable,{contentError:contentError,hasContentLoading:isLoading||isAdHocLaunchLoading,items:groups,itemCount:itemCount,pluralizedItemName:/*i18n*/i18n._(\"Related Groups\"),qsConfig:QS_CONFIG,onRowClick:handleSelect,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username__icontains'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username__icontains'}],toolbarSortColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name'}],toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{isAllSelected:isAllSelected,onSelectAll:function onSelectAll(isSelected){return setSelected(isSelected?_toConsumableArray(groups):[]);},qsConfig:QS_CONFIG,additionalControls:[].concat(_toConsumableArray(canAdd?[addButton]:[]),_toConsumableArray(!isAdHocDisabled?[/*#__PURE__*/_jsx(AdHocCommands,{adHocItems:selected,hasListItems:itemCount>0,onLaunchLoading:setIsAdHocLaunchLoading,moduleOptions:moduleOptions})]:[]),[/*#__PURE__*/_jsx(DisassociateButton,{onDisassociate:disassociateGroups,itemsToDisassociate:selected,modalTitle:/*i18n*/i18n._(\"Disassociate related group(s)?\")},\"disassociate\")])}));},headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Actions\")})]}),renderRow:function renderRow(group,index){return/*#__PURE__*/_jsx(InventoryGroupRelatedGroupListItem,{rowIndex:index,group:group,detailUrl:\"/inventories/inventory/\".concat(inventoryId,\"/groups/\").concat(group.id,\"/details\"),editUrl:\"/inventories/inventory/\".concat(inventoryId,\"/groups/\").concat(group.id,\"/edit\"),isSelected:selected.some(function(row){return row.id===group.id;}),onSelect:function onSelect(){return handleSelect(group);}},group.id);},emptyStateControls:canAdd&&addButton}),isModalOpen&&/*#__PURE__*/_jsx(AssociateModal,{header:/*i18n*/i18n._(\"Groups\"),fetchRequest:fetchGroupsToAssociate,optionsRequest:fetchGroupsOptions,isModalOpen:isModalOpen,onAssociate:associateGroup,onClose:function onClose(){return setIsModalOpen(false);},title:/*i18n*/i18n._(\"Select Groups\")}),error&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:error,onClose:dismissError,title:/*i18n*/i18n._(\"Error!\"),variant:\"error\",children:[associateError?/*i18n*/i18n._(\"Failed to associate.\"):/*i18n*/i18n._(\"Failed to disassociate one or more groups.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]})]});}export default InventoryRelatedGroupList;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Inventory/InventoryRelatedGroups/InventoryRelatedGroupList.js"],"names":["React","useCallback","useEffect","useState","useParams","useLocation","Link","DropdownItem","GroupsAPI","InventoriesAPI","useRequest","useDismissableError","getQSConfig","parseQueryString","mergeParams","useSelected","DataListToolbar","PaginatedTable","HeaderCell","HeaderRow","getSearchableKeys","AddDropDownButton","AdHocCommands","AlertModal","ErrorDetail","AssociateModal","DisassociateButton","InventoryGroupRelatedGroupListItem","QS_CONFIG","page","page_size","order_by","InventoryRelatedGroupList","isModalOpen","setIsModalOpen","isAdHocLaunchLoading","setIsAdHocLaunchLoading","associateError","setAssociateError","disassociateError","setDisassociateError","inventoryId","id","groupId","location","params","search","Promise","all","readChildren","readGroupsOptions","readAdHocOptions","response","actions","adHocOptions","moduleOptions","data","GET","module_name","choices","isAdHocDisabled","POST","groups","results","itemCount","count","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","canAdd","Object","prototype","hasOwnProperty","call","fetchRelated","request","result","isLoading","contentError","error","fetchGroupsToAssociate","readPotentialGroups","not__id","not__parents","associateGroup","selectedGroups","selected","associateChildGroup","isAllSelected","handleSelect","setSelected","disassociateGroups","childId","disassociateChildGroup","parseInt","fetchGroupsOptions","dismissError","addFormUrl","addExistingGroup","addNewGroup","addButton","name","key","isDefault","props","isSelected","group","index","some","row"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\n\nimport { t } from '@lingui/macro';\nimport { useParams, useLocation, Link } from 'react-router-dom';\n\nimport { DropdownItem } from '@patternfly/react-core';\nimport { GroupsAPI, InventoriesAPI } from 'api';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport { getQSConfig, parseQueryString, mergeParams } from 'util/qs';\nimport useSelected from 'hooks/useSelected';\n\nimport DataListToolbar from 'components/DataListToolbar';\nimport PaginatedTable, {\n  HeaderCell,\n  HeaderRow,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\nimport AddDropDownButton from 'components/AddDropDownButton';\nimport AdHocCommands from 'components/AdHocCommands/AdHocCommands';\nimport AlertModal from 'components/AlertModal';\nimport ErrorDetail from 'components/ErrorDetail';\nimport AssociateModal from 'components/AssociateModal';\nimport DisassociateButton from 'components/DisassociateButton';\nimport InventoryGroupRelatedGroupListItem from './InventoryRelatedGroupListItem';\n\nconst QS_CONFIG = getQSConfig('group', {\n  page: 1,\n  page_size: 20,\n  order_by: 'name',\n});\nfunction InventoryRelatedGroupList() {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [isAdHocLaunchLoading, setIsAdHocLaunchLoading] = useState(false);\n  const [associateError, setAssociateError] = useState(null);\n  const [disassociateError, setDisassociateError] = useState(null);\n  const { id: inventoryId, groupId } = useParams();\n  const location = useLocation();\n\n  const {\n    request: fetchRelated,\n    result: {\n      groups,\n      itemCount,\n      relatedSearchableKeys,\n      searchableKeys,\n      canAdd,\n      moduleOptions,\n      isAdHocDisabled,\n    },\n    isLoading,\n    error: contentError,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, location.search);\n      const [response, actions, adHocOptions] = await Promise.all([\n        GroupsAPI.readChildren(groupId, params),\n        InventoriesAPI.readGroupsOptions(inventoryId),\n        InventoriesAPI.readAdHocOptions(inventoryId),\n      ]);\n\n      return {\n        moduleOptions: adHocOptions.data.actions.GET.module_name.choices,\n        isAdHocDisabled: !adHocOptions.data.actions.POST,\n        groups: response.data.results,\n        itemCount: response.data.count,\n        relatedSearchableKeys: (actions?.data?.related_search_fields || []).map(\n          (val) => val.slice(0, -8)\n        ),\n        searchableKeys: getSearchableKeys(actions.data.actions?.GET),\n        canAdd:\n          actions.data.actions &&\n          Object.prototype.hasOwnProperty.call(actions.data.actions, 'POST'),\n      };\n    }, [groupId, location.search, inventoryId]),\n    {\n      groups: [],\n      itemCount: 0,\n      canAdd: false,\n      moduleOptions: [],\n      isAdHocDisabled: true,\n    }\n  );\n  useEffect(() => {\n    fetchRelated();\n  }, [fetchRelated]);\n\n  const fetchGroupsToAssociate = useCallback(\n    (params) =>\n      GroupsAPI.readPotentialGroups(\n        groupId,\n        mergeParams(params, { not__id: groupId, not__parents: groupId })\n      ),\n    [groupId]\n  );\n\n  const associateGroup = useCallback(\n    async (selectedGroups) => {\n      try {\n        await Promise.all(\n          selectedGroups.map((selected) =>\n            GroupsAPI.associateChildGroup(groupId, selected.id)\n          )\n        );\n      } catch (err) {\n        setAssociateError(err);\n      }\n      fetchRelated();\n    },\n    [groupId, fetchRelated]\n  );\n\n  const { selected, isAllSelected, handleSelect, setSelected } =\n    useSelected(groups);\n\n  const disassociateGroups = useCallback(async () => {\n    try {\n      await Promise.all(\n        selected.map(({ id: childId }) =>\n          GroupsAPI.disassociateChildGroup(parseInt(groupId, 10), childId)\n        )\n      );\n    } catch (err) {\n      setDisassociateError(err);\n    }\n    fetchRelated();\n    setSelected([]);\n  }, [groupId, selected, setSelected, fetchRelated]);\n\n  const fetchGroupsOptions = useCallback(\n    () => InventoriesAPI.readGroupsOptions(inventoryId),\n    [inventoryId]\n  );\n\n  const { error, dismissError } = useDismissableError(\n    associateError || disassociateError\n  );\n\n  const addFormUrl = `/inventories/inventory/${inventoryId}/groups/${groupId}/nested_groups/add`;\n\n  const addExistingGroup = t`Add existing group`;\n  const addNewGroup = t`Add new group`;\n  const addButton = (\n    <AddDropDownButton\n      key=\"add\"\n      ouiaId=\"add-existing-group-button\"\n      dropdownItems={[\n        <DropdownItem\n          key={addExistingGroup}\n          onClick={() => setIsModalOpen(true)}\n          aria-label={addExistingGroup}\n          ouiaId=\"add-existing-group-dropdown-item\"\n        >\n          {addExistingGroup}\n        </DropdownItem>,\n        <DropdownItem\n          ouiaId=\"add-new-group-button\"\n          component={Link}\n          to={`${addFormUrl}`}\n          key={addNewGroup}\n          aria-label={addNewGroup}\n        >\n          {addNewGroup}\n        </DropdownItem>,\n      ]}\n    />\n  );\n\n  return (\n    <>\n      <PaginatedTable\n        contentError={contentError}\n        hasContentLoading={isLoading || isAdHocLaunchLoading}\n        items={groups}\n        itemCount={itemCount}\n        pluralizedItemName={t`Related Groups`}\n        qsConfig={QS_CONFIG}\n        onRowClick={handleSelect}\n        toolbarSearchColumns={[\n          {\n            name: t`Name`,\n            key: 'name__icontains',\n            isDefault: true,\n          },\n          {\n            name: t`Created By (Username)`,\n            key: 'created_by__username__icontains',\n          },\n          {\n            name: t`Modified By (Username)`,\n            key: 'modified_by__username__icontains',\n          },\n        ]}\n        toolbarSortColumns={[\n          {\n            name: t`Name`,\n            key: 'name',\n          },\n        ]}\n        toolbarSearchableKeys={searchableKeys}\n        toolbarRelatedSearchableKeys={relatedSearchableKeys}\n        renderToolbar={(props) => (\n          <DataListToolbar\n            {...props}\n            isAllSelected={isAllSelected}\n            onSelectAll={(isSelected) =>\n              setSelected(isSelected ? [...groups] : [])\n            }\n            qsConfig={QS_CONFIG}\n            additionalControls={[\n              ...(canAdd ? [addButton] : []),\n              ...(!isAdHocDisabled\n                ? [\n                    <AdHocCommands\n                      adHocItems={selected}\n                      hasListItems={itemCount > 0}\n                      onLaunchLoading={setIsAdHocLaunchLoading}\n                      moduleOptions={moduleOptions}\n                    />,\n                  ]\n                : []),\n              <DisassociateButton\n                key=\"disassociate\"\n                onDisassociate={disassociateGroups}\n                itemsToDisassociate={selected}\n                modalTitle={t`Disassociate related group(s)?`}\n              />,\n            ]}\n          />\n        )}\n        headerRow={\n          <HeaderRow qsConfig={QS_CONFIG}>\n            <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n            <HeaderCell>{t`Actions`}</HeaderCell>\n          </HeaderRow>\n        }\n        renderRow={(group, index) => (\n          <InventoryGroupRelatedGroupListItem\n            key={group.id}\n            rowIndex={index}\n            group={group}\n            detailUrl={`/inventories/inventory/${inventoryId}/groups/${group.id}/details`}\n            editUrl={`/inventories/inventory/${inventoryId}/groups/${group.id}/edit`}\n            isSelected={selected.some((row) => row.id === group.id)}\n            onSelect={() => handleSelect(group)}\n          />\n        )}\n        emptyStateControls={canAdd && addButton}\n      />\n      {isModalOpen && (\n        <AssociateModal\n          header={t`Groups`}\n          fetchRequest={fetchGroupsToAssociate}\n          optionsRequest={fetchGroupsOptions}\n          isModalOpen={isModalOpen}\n          onAssociate={associateGroup}\n          onClose={() => setIsModalOpen(false)}\n          title={t`Select Groups`}\n        />\n      )}\n      {error && (\n        <AlertModal\n          isOpen={error}\n          onClose={dismissError}\n          title={t`Error!`}\n          variant=\"error\"\n        >\n          {associateError\n            ? t`Failed to associate.`\n            : t`Failed to disassociate one or more groups.`}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\nexport default InventoryRelatedGroupList;\n"]},"metadata":{},"sourceType":"module"}