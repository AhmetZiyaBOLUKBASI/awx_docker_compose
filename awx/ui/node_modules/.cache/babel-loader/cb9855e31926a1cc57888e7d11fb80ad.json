{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect,useState}from'react';import{useField,useFormikContext,withFormik}from'formik';import{Form,FormGroup,Checkbox,TextInput,Title}from'@patternfly/react-core';import{required}from'util/validators';import FieldWithPrompt from'components/FieldWithPrompt';import FormField,{FormSubmitError}from'components/FormField';import{FormColumnLayout,FormFullWidthLayout,FormCheckboxLayout,SubFormLayout}from'components/FormLayout';import OrganizationLookup from'components/Lookup/OrganizationLookup';import{InventoryLookup}from'components/Lookup';import{VariablesField}from'components/CodeEditor';import FormActionGroup from'components/FormActionGroup';import ContentError from'components/ContentError';import CheckboxField from'components/FormField/CheckboxField';import Popover from'components/Popover';import{WorkFlowJobTemplate}from'types';import LabelSelect from'components/LabelSelect';import WebhookSubForm from'./WebhookSubForm';import helpText from'./WorkflowJobTemplate.helptext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var urlOrigin=window.location.origin;function WorkflowJobTemplateForm(_ref){var template=_ref.template,handleSubmit=_ref.handleSubmit,handleCancel=_ref.handleCancel,submitError=_ref.submitError,isOrgAdmin=_ref.isOrgAdmin;var _useFormikContext=useFormikContext(),setFieldValue=_useFormikContext.setFieldValue,setFieldTouched=_useFormikContext.setFieldTouched;var _useState=useState(Boolean(template.webhook_service)),_useState2=_slicedToArray(_useState,2),enableWebhooks=_useState2[0],setEnableWebhooks=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),hasContentError=_useState4[0],setContentError=_useState4[1];var _useField=useField('ask_inventory_on_launch'),_useField2=_slicedToArray(_useField,1),askInventoryOnLaunchField=_useField2[0];var _useField3=useField('inventory'),_useField4=_slicedToArray(_useField3,3),inventoryField=_useField4[0],inventoryMeta=_useField4[1],inventoryHelpers=_useField4[2];var _useField5=useField('labels'),_useField6=_slicedToArray(_useField5,3),labelsField=_useField6[0],labelsHelpers=_useField6[2];var _useField7=useField('limit'),_useField8=_slicedToArray(_useField7,3),limitField=_useField8[0],limitMeta=_useField8[1],limitHelpers=_useField8[2];var _useField9=useField('organization'),_useField10=_slicedToArray(_useField9,3),organizationField=_useField10[0],organizationMeta=_useField10[1],organizationHelpers=_useField10[2];var _useField11=useField('scm_branch'),_useField12=_slicedToArray(_useField11,3),scmField=_useField12[0],scmHelpers=_useField12[2];var _useField13=useField('webhook_service'),_useField14=_slicedToArray(_useField13,3),webhookServiceMeta=_useField14[1],webhookServiceHelpers=_useField14[2];var _useField15=useField('webhook_url'),_useField16=_slicedToArray(_useField15,3),webhookUrlMeta=_useField16[1],webhookUrlHelpers=_useField16[2];var _useField17=useField('webhook_key'),_useField18=_slicedToArray(_useField17,3),webhookKeyMeta=_useField18[1],webhookKeyHelpers=_useField18[2];var _useField19=useField('webhook_credential'),_useField20=_slicedToArray(_useField19,3),webhookCredentialMeta=_useField20[1],webhookCredentialHelpers=_useField20[2];useEffect(function(){if(enableWebhooks){webhookServiceHelpers.setValue(webhookServiceMeta.initialValue);webhookUrlHelpers.setValue(webhookUrlMeta.initialValue);webhookKeyHelpers.setValue(webhookKeyMeta.initialValue);webhookCredentialHelpers.setValue(webhookCredentialMeta.initialValue);}else{webhookServiceHelpers.setValue('');webhookUrlHelpers.setValue('');webhookKeyHelpers.setValue('');webhookCredentialHelpers.setValue(null);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[enableWebhooks]);var handleOrganizationChange=useCallback(function(value){setFieldValue('organization',value);setFieldTouched('organization',true,false);},[setFieldValue,setFieldTouched]);var handleInventoryUpdate=useCallback(function(value){setFieldValue('inventory',value);setFieldTouched('inventory',true,false);},[setFieldValue,setFieldTouched]);if(hasContentError){return/*#__PURE__*/_jsx(ContentError,{error:hasContentError});}return/*#__PURE__*/_jsxs(Form,{autoComplete:\"off\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(FormColumnLayout,{children:[/*#__PURE__*/_jsx(FormField,{id:\"wfjt-name\",name:\"name\",type:\"text\",label:/*i18n*/i18n._(\"Name\"),validate:required(null),isRequired:true}),/*#__PURE__*/_jsx(FormField,{id:\"wfjt-description\",name:\"description\",type:\"text\",label:/*i18n*/i18n._(\"Description\")}),/*#__PURE__*/_jsx(OrganizationLookup,{helperTextInvalid:organizationMeta.error,isValid:!organizationMeta.touched||!organizationMeta.error,onBlur:function onBlur(){return organizationHelpers.setTouched();},onChange:handleOrganizationChange,value:organizationField.value,touched:organizationMeta.touched,error:organizationMeta.error,required:isOrgAdmin,autoPopulate:isOrgAdmin,validate:isOrgAdmin?required(/*i18n*/i18n._(\"Select a value for this field\")):undefined}),/*#__PURE__*/_jsx(FormGroup,{fieldId:\"inventory-lookup\",validated:!(inventoryMeta.touched||askInventoryOnLaunchField.value)||!inventoryMeta.error?'default':'error',helperTextInvalid:inventoryMeta.error,children:/*#__PURE__*/_jsx(InventoryLookup,{promptId:\"wfjt-ask-inventory-on-launch\",promptName:\"ask_inventory_on_launch\",tooltip:helpText.inventory,fieldId:\"wfjt-inventory\",isPromptableField:true,value:inventoryField.value,onBlur:function onBlur(){return inventoryHelpers.setTouched();},onChange:handleInventoryUpdate,touched:inventoryMeta.touched,error:inventoryMeta.error})}),/*#__PURE__*/_jsx(FieldWithPrompt,{fieldId:\"wfjt-limit\",label:/*i18n*/i18n._(\"Limit\"),promptId:\"template-ask-limit-on-launch\",promptName:\"ask_limit_on_launch\",tooltip:helpText.limit,children:/*#__PURE__*/_jsx(TextInput,{id:\"wfjt-limit\",value:limitField.value,validated:!limitMeta.touched||!limitMeta.error?'default':'error',onChange:function onChange(value){limitHelpers.setValue(value);}})}),/*#__PURE__*/_jsx(FieldWithPrompt,{fieldId:\"wfjt-scm-branch\",label:/*i18n*/i18n._(\"Source control branch\"),promptId:\"wfjt-ask-scm-branch-on-launch\",promptName:\"ask_scm_branch_on_launch\",tooltip:helpText.sourceControlBranch,children:/*#__PURE__*/_jsx(TextInput,{id:\"wfjt-scm-branch\",value:scmField.value,onChange:function onChange(value){scmHelpers.setValue(value);},\"aria-label\":/*i18n*/i18n._(\"source control branch\")})})]}),/*#__PURE__*/_jsx(FormFullWidthLayout,{children:/*#__PURE__*/_jsx(FormGroup,{label:/*i18n*/i18n._(\"Labels\"),labelIcon:/*#__PURE__*/_jsx(Popover,{content:helpText.labels}),fieldId:\"template-labels\",children:/*#__PURE__*/_jsx(LabelSelect,{value:labelsField.value,onChange:function onChange(labels){return labelsHelpers.setValue(labels);},onError:setContentError,createText:/*i18n*/i18n._(\"Create\")})})}),/*#__PURE__*/_jsx(FormFullWidthLayout,{children:/*#__PURE__*/_jsx(VariablesField,{id:\"wfjt-variables\",name:\"extra_vars\",label:/*i18n*/i18n._(\"Variables\"),promptId:\"template-ask-variables-on-launch\",tooltip:helpText.variables})}),/*#__PURE__*/_jsx(FormGroup,{fieldId:\"options\",label:/*i18n*/i18n._(\"Options\"),children:/*#__PURE__*/_jsxs(FormCheckboxLayout,{isInline:true,children:[/*#__PURE__*/_jsx(Checkbox,{\"aria-label\":/*i18n*/i18n._(\"Enable Webhook\"),label:/*#__PURE__*/_jsxs(\"span\",{children:[/*i18n*/i18n._(\"Enable Webhook\"),\"\\xA0\",/*#__PURE__*/_jsx(Popover,{content:helpText.enableWebhook})]}),id:\"wfjt-enabled-webhooks\",ouiaId:\"wfjt-enabled-webhooks\",isChecked:enableWebhooks,onChange:function onChange(checked){setEnableWebhooks(checked);}}),/*#__PURE__*/_jsx(CheckboxField,{name:\"allow_simultaneous\",id:\"allow_simultaneous\",tooltip:helpText.enableConcurrentJobs,label:/*i18n*/i18n._(\"Enable Concurrent Jobs\")})]})}),enableWebhooks&&/*#__PURE__*/_jsxs(SubFormLayout,{children:[/*#__PURE__*/_jsx(Title,{size:\"md\",headingLevel:\"h4\",children:/*i18n*/i18n._(\"Webhook details\")}),/*#__PURE__*/_jsx(WebhookSubForm,{templateType:template.type})]}),submitError&&/*#__PURE__*/_jsx(FormSubmitError,{error:submitError}),/*#__PURE__*/_jsx(FormActionGroup,{onCancel:handleCancel,onSubmit:handleSubmit})]});}WorkflowJobTemplateForm.defaultProps={submitError:null,template:{name:'',description:'',inventory:undefined,project:undefined},isOrgAdmin:false};var FormikApp=withFormik({mapPropsToValues:function mapPropsToValues(_ref2){var _template$summary_fie,_template$summary_fie2,_template$summary_fie3,_template$summary_fie4,_template$summary_fie5,_template$related;var _ref2$template=_ref2.template,template=_ref2$template===void 0?{}:_ref2$template;return{name:template.name||'',description:template.description||'',inventory:(template===null||template===void 0?void 0:(_template$summary_fie=template.summary_fields)===null||_template$summary_fie===void 0?void 0:_template$summary_fie.inventory)||null,organization:(template===null||template===void 0?void 0:(_template$summary_fie2=template.summary_fields)===null||_template$summary_fie2===void 0?void 0:_template$summary_fie2.organization)||null,labels:((_template$summary_fie3=template.summary_fields)===null||_template$summary_fie3===void 0?void 0:(_template$summary_fie4=_template$summary_fie3.labels)===null||_template$summary_fie4===void 0?void 0:_template$summary_fie4.results)||[],extra_vars:template.extra_vars||'---',limit:template.limit||'',scm_branch:template.scm_branch||'',allow_simultaneous:template.allow_simultaneous||false,webhook_credential:(template===null||template===void 0?void 0:(_template$summary_fie5=template.summary_fields)===null||_template$summary_fie5===void 0?void 0:_template$summary_fie5.webhook_credential)||null,webhook_service:template.webhook_service||'',ask_limit_on_launch:template.ask_limit_on_launch||false,ask_inventory_on_launch:template.ask_inventory_on_launch||false,ask_variables_on_launch:template.ask_variables_on_launch||false,ask_scm_branch_on_launch:template.ask_scm_branch_on_launch||false,webhook_url:template!==null&&template!==void 0&&(_template$related=template.related)!==null&&_template$related!==void 0&&_template$related.webhook_receiver?\"\".concat(urlOrigin).concat(template.related.webhook_receiver):'',webhook_key:template.webhook_key||''};},handleSubmit:function(){var _handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values,_ref3){var props,setErrors;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:props=_ref3.props,setErrors=_ref3.setErrors;_context.prev=1;_context.next=4;return props.handleSubmit(values);case 4:_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](1);setErrors(_context.t0);case 9:case\"end\":return _context.stop();}}},_callee,null,[[1,6]]);}));function handleSubmit(_x,_x2){return _handleSubmit.apply(this,arguments);}return handleSubmit;}()})(WorkflowJobTemplateForm);export{WorkflowJobTemplateForm as _WorkflowJobTemplateForm};export default FormikApp;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/Template/shared/WorkflowJobTemplateForm.js"],"names":["React","useCallback","useEffect","useState","useField","useFormikContext","withFormik","Form","FormGroup","Checkbox","TextInput","Title","required","FieldWithPrompt","FormField","FormSubmitError","FormColumnLayout","FormFullWidthLayout","FormCheckboxLayout","SubFormLayout","OrganizationLookup","InventoryLookup","VariablesField","FormActionGroup","ContentError","CheckboxField","Popover","WorkFlowJobTemplate","LabelSelect","WebhookSubForm","helpText","urlOrigin","window","location","origin","WorkflowJobTemplateForm","template","handleSubmit","handleCancel","submitError","isOrgAdmin","setFieldValue","setFieldTouched","Boolean","webhook_service","enableWebhooks","setEnableWebhooks","hasContentError","setContentError","askInventoryOnLaunchField","inventoryField","inventoryMeta","inventoryHelpers","labelsField","labelsHelpers","limitField","limitMeta","limitHelpers","organizationField","organizationMeta","organizationHelpers","scmField","scmHelpers","webhookServiceMeta","webhookServiceHelpers","webhookUrlMeta","webhookUrlHelpers","webhookKeyMeta","webhookKeyHelpers","webhookCredentialMeta","webhookCredentialHelpers","setValue","initialValue","handleOrganizationChange","value","handleInventoryUpdate","error","touched","setTouched","undefined","inventory","limit","sourceControlBranch","labels","variables","enableWebhook","checked","enableConcurrentJobs","type","defaultProps","name","description","project","FormikApp","mapPropsToValues","summary_fields","organization","results","extra_vars","scm_branch","allow_simultaneous","webhook_credential","ask_limit_on_launch","ask_inventory_on_launch","ask_variables_on_launch","ask_scm_branch_on_launch","webhook_url","related","webhook_receiver","webhook_key","values","props","setErrors","_WorkflowJobTemplateForm"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { t } from '@lingui/macro';\nimport PropTypes, { shape } from 'prop-types';\nimport { useField, useFormikContext, withFormik } from 'formik';\nimport {\n  Form,\n  FormGroup,\n  Checkbox,\n  TextInput,\n  Title,\n} from '@patternfly/react-core';\nimport { required } from 'util/validators';\nimport FieldWithPrompt from 'components/FieldWithPrompt';\nimport FormField, { FormSubmitError } from 'components/FormField';\nimport {\n  FormColumnLayout,\n  FormFullWidthLayout,\n  FormCheckboxLayout,\n  SubFormLayout,\n} from 'components/FormLayout';\nimport OrganizationLookup from 'components/Lookup/OrganizationLookup';\nimport { InventoryLookup } from 'components/Lookup';\nimport { VariablesField } from 'components/CodeEditor';\nimport FormActionGroup from 'components/FormActionGroup';\nimport ContentError from 'components/ContentError';\nimport CheckboxField from 'components/FormField/CheckboxField';\nimport Popover from 'components/Popover';\nimport { WorkFlowJobTemplate } from 'types';\nimport LabelSelect from 'components/LabelSelect';\nimport WebhookSubForm from './WebhookSubForm';\nimport helpText from './WorkflowJobTemplate.helptext';\n\nconst urlOrigin = window.location.origin;\n\nfunction WorkflowJobTemplateForm({\n  template,\n  handleSubmit,\n  handleCancel,\n  submitError,\n  isOrgAdmin,\n}) {\n  const { setFieldValue, setFieldTouched } = useFormikContext();\n  const [enableWebhooks, setEnableWebhooks] = useState(\n    Boolean(template.webhook_service)\n  );\n  const [hasContentError, setContentError] = useState(null);\n  const [askInventoryOnLaunchField] = useField('ask_inventory_on_launch');\n  const [inventoryField, inventoryMeta, inventoryHelpers] =\n    useField('inventory');\n  const [labelsField, , labelsHelpers] = useField('labels');\n  const [limitField, limitMeta, limitHelpers] = useField('limit');\n  const [organizationField, organizationMeta, organizationHelpers] =\n    useField('organization');\n  const [scmField, , scmHelpers] = useField('scm_branch');\n  const [, webhookServiceMeta, webhookServiceHelpers] =\n    useField('webhook_service');\n  const [, webhookUrlMeta, webhookUrlHelpers] = useField('webhook_url');\n  const [, webhookKeyMeta, webhookKeyHelpers] = useField('webhook_key');\n  const [, webhookCredentialMeta, webhookCredentialHelpers] =\n    useField('webhook_credential');\n\n  useEffect(() => {\n    if (enableWebhooks) {\n      webhookServiceHelpers.setValue(webhookServiceMeta.initialValue);\n      webhookUrlHelpers.setValue(webhookUrlMeta.initialValue);\n      webhookKeyHelpers.setValue(webhookKeyMeta.initialValue);\n      webhookCredentialHelpers.setValue(webhookCredentialMeta.initialValue);\n    } else {\n      webhookServiceHelpers.setValue('');\n      webhookUrlHelpers.setValue('');\n      webhookKeyHelpers.setValue('');\n      webhookCredentialHelpers.setValue(null);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [enableWebhooks]);\n\n  const handleOrganizationChange = useCallback(\n    (value) => {\n      setFieldValue('organization', value);\n      setFieldTouched('organization', true, false);\n    },\n    [setFieldValue, setFieldTouched]\n  );\n\n  const handleInventoryUpdate = useCallback(\n    (value) => {\n      setFieldValue('inventory', value);\n      setFieldTouched('inventory', true, false);\n    },\n    [setFieldValue, setFieldTouched]\n  );\n\n  if (hasContentError) {\n    return <ContentError error={hasContentError} />;\n  }\n\n  return (\n    <Form autoComplete=\"off\" onSubmit={handleSubmit}>\n      <FormColumnLayout>\n        <FormField\n          id=\"wfjt-name\"\n          name=\"name\"\n          type=\"text\"\n          label={t`Name`}\n          validate={required(null)}\n          isRequired\n        />\n        <FormField\n          id=\"wfjt-description\"\n          name=\"description\"\n          type=\"text\"\n          label={t`Description`}\n        />\n        <OrganizationLookup\n          helperTextInvalid={organizationMeta.error}\n          isValid={!organizationMeta.touched || !organizationMeta.error}\n          onBlur={() => organizationHelpers.setTouched()}\n          onChange={handleOrganizationChange}\n          value={organizationField.value}\n          touched={organizationMeta.touched}\n          error={organizationMeta.error}\n          required={isOrgAdmin}\n          autoPopulate={isOrgAdmin}\n          validate={\n            isOrgAdmin ? required(t`Select a value for this field`) : undefined\n          }\n        />\n        <FormGroup\n          fieldId=\"inventory-lookup\"\n          validated={\n            !(inventoryMeta.touched || askInventoryOnLaunchField.value) ||\n            !inventoryMeta.error\n              ? 'default'\n              : 'error'\n          }\n          helperTextInvalid={inventoryMeta.error}\n        >\n          <InventoryLookup\n            promptId=\"wfjt-ask-inventory-on-launch\"\n            promptName=\"ask_inventory_on_launch\"\n            tooltip={helpText.inventory}\n            fieldId=\"wfjt-inventory\"\n            isPromptableField\n            value={inventoryField.value}\n            onBlur={() => inventoryHelpers.setTouched()}\n            onChange={handleInventoryUpdate}\n            touched={inventoryMeta.touched}\n            error={inventoryMeta.error}\n          />\n        </FormGroup>\n        <FieldWithPrompt\n          fieldId=\"wfjt-limit\"\n          label={t`Limit`}\n          promptId=\"template-ask-limit-on-launch\"\n          promptName=\"ask_limit_on_launch\"\n          tooltip={helpText.limit}\n        >\n          <TextInput\n            id=\"wfjt-limit\"\n            value={limitField.value}\n            validated={\n              !limitMeta.touched || !limitMeta.error ? 'default' : 'error'\n            }\n            onChange={(value) => {\n              limitHelpers.setValue(value);\n            }}\n          />\n        </FieldWithPrompt>\n\n        <FieldWithPrompt\n          fieldId=\"wfjt-scm-branch\"\n          label={t`Source control branch`}\n          promptId=\"wfjt-ask-scm-branch-on-launch\"\n          promptName=\"ask_scm_branch_on_launch\"\n          tooltip={helpText.sourceControlBranch}\n        >\n          <TextInput\n            id=\"wfjt-scm-branch\"\n            value={scmField.value}\n            onChange={(value) => {\n              scmHelpers.setValue(value);\n            }}\n            aria-label={t`source control branch`}\n          />\n        </FieldWithPrompt>\n      </FormColumnLayout>\n      <FormFullWidthLayout>\n        <FormGroup\n          label={t`Labels`}\n          labelIcon={<Popover content={helpText.labels} />}\n          fieldId=\"template-labels\"\n        >\n          <LabelSelect\n            value={labelsField.value}\n            onChange={(labels) => labelsHelpers.setValue(labels)}\n            onError={setContentError}\n            createText={t`Create`}\n          />\n        </FormGroup>\n      </FormFullWidthLayout>\n      <FormFullWidthLayout>\n        <VariablesField\n          id=\"wfjt-variables\"\n          name=\"extra_vars\"\n          label={t`Variables`}\n          promptId=\"template-ask-variables-on-launch\"\n          tooltip={helpText.variables}\n        />\n      </FormFullWidthLayout>\n      <FormGroup fieldId=\"options\" label={t`Options`}>\n        <FormCheckboxLayout isInline>\n          <Checkbox\n            aria-label={t`Enable Webhook`}\n            label={\n              <span>\n                {t`Enable Webhook`}\n                &nbsp;\n                <Popover content={helpText.enableWebhook} />\n              </span>\n            }\n            id=\"wfjt-enabled-webhooks\"\n            ouiaId=\"wfjt-enabled-webhooks\"\n            isChecked={enableWebhooks}\n            onChange={(checked) => {\n              setEnableWebhooks(checked);\n            }}\n          />\n          <CheckboxField\n            name=\"allow_simultaneous\"\n            id=\"allow_simultaneous\"\n            tooltip={helpText.enableConcurrentJobs}\n            label={t`Enable Concurrent Jobs`}\n          />\n        </FormCheckboxLayout>\n      </FormGroup>\n\n      {enableWebhooks && (\n        <SubFormLayout>\n          <Title size=\"md\" headingLevel=\"h4\">\n            {t`Webhook details`}\n          </Title>\n          <WebhookSubForm templateType={template.type} />\n        </SubFormLayout>\n      )}\n\n      {submitError && <FormSubmitError error={submitError} />}\n      <FormActionGroup onCancel={handleCancel} onSubmit={handleSubmit} />\n    </Form>\n  );\n}\n\nWorkflowJobTemplateForm.propTypes = {\n  template: WorkFlowJobTemplate,\n  handleSubmit: PropTypes.func.isRequired,\n  handleCancel: PropTypes.func.isRequired,\n  submitError: shape({}),\n  isOrgAdmin: PropTypes.bool,\n};\n\nWorkflowJobTemplateForm.defaultProps = {\n  submitError: null,\n  template: {\n    name: '',\n    description: '',\n    inventory: undefined,\n    project: undefined,\n  },\n  isOrgAdmin: false,\n};\n\nconst FormikApp = withFormik({\n  mapPropsToValues({ template = {} }) {\n    return {\n      name: template.name || '',\n      description: template.description || '',\n      inventory: template?.summary_fields?.inventory || null,\n      organization: template?.summary_fields?.organization || null,\n      labels: template.summary_fields?.labels?.results || [],\n      extra_vars: template.extra_vars || '---',\n      limit: template.limit || '',\n      scm_branch: template.scm_branch || '',\n      allow_simultaneous: template.allow_simultaneous || false,\n      webhook_credential: template?.summary_fields?.webhook_credential || null,\n      webhook_service: template.webhook_service || '',\n      ask_limit_on_launch: template.ask_limit_on_launch || false,\n      ask_inventory_on_launch: template.ask_inventory_on_launch || false,\n      ask_variables_on_launch: template.ask_variables_on_launch || false,\n      ask_scm_branch_on_launch: template.ask_scm_branch_on_launch || false,\n      webhook_url: template?.related?.webhook_receiver\n        ? `${urlOrigin}${template.related.webhook_receiver}`\n        : '',\n      webhook_key: template.webhook_key || '',\n    };\n  },\n  handleSubmit: async (values, { props, setErrors }) => {\n    try {\n      await props.handleSubmit(values);\n    } catch (errors) {\n      setErrors(errors);\n    }\n  },\n})(WorkflowJobTemplateForm);\n\nexport { WorkflowJobTemplateForm as _WorkflowJobTemplateForm };\nexport default FormikApp;\n"]},"metadata":{},"sourceType":"module"}