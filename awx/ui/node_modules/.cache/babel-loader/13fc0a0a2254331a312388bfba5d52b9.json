{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect,useState}from'react';import{useLocation}from'react-router-dom';import{Card,PageSection}from'@patternfly/react-core';import{SystemJobTemplatesAPI}from'api';import AlertModal from'components/AlertModal';import DatalistToolbar from'components/DataListToolbar';import ErrorDetail from'components/ErrorDetail';import PaginatedTable,{HeaderRow,HeaderCell,getSearchableKeys}from'components/PaginatedTable';import{useConfig}from'contexts/Config';import{parseQueryString,getQSConfig}from'util/qs';import useRequest from'hooks/useRequest';import ManagementJobListItem from'./ManagementJobListItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('system_job_templates',{page:1,page_size:20});var buildSearchKeys=function buildSearchKeys(options){var _options$data,_options$data$actions,_options$data2;var actions=(options===null||options===void 0?void 0:(_options$data=options.data)===null||_options$data===void 0?void 0:(_options$data$actions=_options$data.actions)===null||_options$data$actions===void 0?void 0:_options$data$actions.GET)||{};var searchableKeys=getSearchableKeys(actions);var relatedSearchableKeys=((options===null||options===void 0?void 0:(_options$data2=options.data)===null||_options$data2===void 0?void 0:_options$data2.related_search_fields)||[]).map(function(val){return val.slice(0,-8);});return{searchableKeys:searchableKeys,relatedSearchableKeys:relatedSearchableKeys};};var loadManagementJobs=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(search){var params,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,items,count,options;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,search);_context.next=3;return Promise.all([SystemJobTemplatesAPI.read(params),SystemJobTemplatesAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);_yield$Promise$all2$=_yield$Promise$all2[0].data;items=_yield$Promise$all2$.results;count=_yield$Promise$all2$.count;options=_yield$Promise$all2[1];return _context.abrupt(\"return\",{items:items,count:count,options:options});case 10:case\"end\":return _context.stop();}}},_callee);}));return function loadManagementJobs(_x){return _ref.apply(this,arguments);};}();function ManagementJobList(){var _useLocation=useLocation(),search=_useLocation.search;var _useConfig=useConfig(),me=_useConfig.me;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),launchError=_useState2[0],setLaunchError=_useState2[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",loadManagementJobs(search));case 1:case\"end\":return _context2.stop();}}},_callee2);})),[search]),{}),request=_useRequest.request,_useRequest$error=_useRequest.error,error=_useRequest$error===void 0?false:_useRequest$error,_useRequest$isLoading=_useRequest.isLoading,isLoading=_useRequest$isLoading===void 0?true:_useRequest$isLoading,_useRequest$result=_useRequest.result,_useRequest$result$op=_useRequest$result.options,options=_useRequest$result$op===void 0?{}:_useRequest$result$op,_useRequest$result$it=_useRequest$result.items,items=_useRequest$result$it===void 0?[]:_useRequest$result$it,_useRequest$result$co=_useRequest$result.count,count=_useRequest$result$co===void 0?0:_useRequest$result$co;useEffect(function(){request();},[request]);var _buildSearchKeys=buildSearchKeys(options),searchableKeys=_buildSearchKeys.searchableKeys,relatedSearchableKeys=_buildSearchKeys.relatedSearchableKeys;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(PaginatedTable,{qsConfig:QS_CONFIG,contentError:error,hasContentLoading:isLoading,items:items,itemCount:count,pluralizedItemName:/*i18n*/i18n._(\"Management Jobs\"),emptyContentMessage:' ',toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true}],renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DatalistToolbar,_objectSpread(_objectSpread({},props),{},{qsConfig:QS_CONFIG}));},headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Description\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Actions\")})]}),renderRow:function renderRow(_ref3){var id=_ref3.id,name=_ref3.name,description=_ref3.description,job_type=_ref3.job_type;return/*#__PURE__*/_jsx(ManagementJobListItem,{id:id,name:name,jobType:job_type,description:description,isSuperUser:me===null||me===void 0?void 0:me.is_superuser,isPrompted:['cleanup_activitystream','cleanup_jobs'].includes(job_type),onLaunchError:setLaunchError},id);}})})}),/*#__PURE__*/_jsxs(AlertModal,{isOpen:Boolean(launchError),variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:function onClose(){return setLaunchError(null);},children:[/*i18n*/i18n._(\"Failed to launch job.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:launchError})]})]});}export default ManagementJobList;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/ManagementJob/ManagementJobList/ManagementJobList.js"],"names":["React","useCallback","useEffect","useState","useLocation","Card","PageSection","SystemJobTemplatesAPI","AlertModal","DatalistToolbar","ErrorDetail","PaginatedTable","HeaderRow","HeaderCell","getSearchableKeys","useConfig","parseQueryString","getQSConfig","useRequest","ManagementJobListItem","QS_CONFIG","page","page_size","buildSearchKeys","options","actions","data","GET","searchableKeys","relatedSearchableKeys","related_search_fields","map","val","slice","loadManagementJobs","search","params","Promise","all","read","readOptions","items","results","count","ManagementJobList","me","launchError","setLaunchError","request","error","isLoading","result","name","key","isDefault","props","id","description","job_type","is_superuser","includes","Boolean"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { t } from '@lingui/macro';\n\nimport { useLocation } from 'react-router-dom';\nimport { Card, PageSection } from '@patternfly/react-core';\n\nimport { SystemJobTemplatesAPI } from 'api';\nimport AlertModal from 'components/AlertModal';\nimport DatalistToolbar from 'components/DataListToolbar';\nimport ErrorDetail from 'components/ErrorDetail';\nimport PaginatedTable, {\n  HeaderRow,\n  HeaderCell,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\nimport { useConfig } from 'contexts/Config';\nimport { parseQueryString, getQSConfig } from 'util/qs';\nimport useRequest from 'hooks/useRequest';\n\nimport ManagementJobListItem from './ManagementJobListItem';\n\nconst QS_CONFIG = getQSConfig('system_job_templates', {\n  page: 1,\n  page_size: 20,\n});\n\nconst buildSearchKeys = (options) => {\n  const actions = options?.data?.actions?.GET || {};\n  const searchableKeys = getSearchableKeys(actions);\n\n  const relatedSearchableKeys = (\n    options?.data?.related_search_fields || []\n  ).map((val) => val.slice(0, -8));\n\n  return { searchableKeys, relatedSearchableKeys };\n};\n\nconst loadManagementJobs = async (search) => {\n  const params = parseQueryString(QS_CONFIG, search);\n  const [\n    {\n      data: { results: items, count },\n    },\n    options,\n  ] = await Promise.all([\n    SystemJobTemplatesAPI.read(params),\n    SystemJobTemplatesAPI.readOptions(),\n  ]);\n\n  return { items, count, options };\n};\n\nfunction ManagementJobList() {\n  const { search } = useLocation();\n  const { me } = useConfig();\n  const [launchError, setLaunchError] = useState(null);\n\n  const {\n    request,\n    error = false,\n    isLoading = true,\n    result: { options = {}, items = [], count = 0 },\n  } = useRequest(\n    useCallback(async () => loadManagementJobs(search), [search]),\n    {}\n  );\n\n  useEffect(() => {\n    request();\n  }, [request]);\n\n  const { searchableKeys, relatedSearchableKeys } = buildSearchKeys(options);\n\n  return (\n    <>\n      <PageSection>\n        <Card>\n          <PaginatedTable\n            qsConfig={QS_CONFIG}\n            contentError={error}\n            hasContentLoading={isLoading}\n            items={items}\n            itemCount={count}\n            pluralizedItemName={t`Management Jobs`}\n            emptyContentMessage={' '}\n            toolbarSearchableKeys={searchableKeys}\n            toolbarRelatedSearchableKeys={relatedSearchableKeys}\n            toolbarSearchColumns={[\n              {\n                name: t`Name`,\n                key: 'name__icontains',\n                isDefault: true,\n              },\n            ]}\n            renderToolbar={(props) => (\n              <DatalistToolbar {...props} qsConfig={QS_CONFIG} />\n            )}\n            headerRow={\n              <HeaderRow qsConfig={QS_CONFIG}>\n                <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n                <HeaderCell>{t`Description`}</HeaderCell>\n                <HeaderCell>{t`Actions`}</HeaderCell>\n              </HeaderRow>\n            }\n            renderRow={({ id, name, description, job_type }) => (\n              <ManagementJobListItem\n                key={id}\n                id={id}\n                name={name}\n                jobType={job_type}\n                description={description}\n                isSuperUser={me?.is_superuser}\n                isPrompted={['cleanup_activitystream', 'cleanup_jobs'].includes(\n                  job_type\n                )}\n                onLaunchError={setLaunchError}\n              />\n            )}\n          />\n        </Card>\n      </PageSection>\n      <AlertModal\n        isOpen={Boolean(launchError)}\n        variant=\"error\"\n        title={t`Error!`}\n        onClose={() => setLaunchError(null)}\n      >\n        {t`Failed to launch job.`}\n        <ErrorDetail error={launchError} />\n      </AlertModal>\n    </>\n  );\n}\n\nexport default ManagementJobList;\n"]},"metadata":{},"sourceType":"module"}