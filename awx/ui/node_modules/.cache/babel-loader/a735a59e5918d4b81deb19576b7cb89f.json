{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{useLocation,useParams}from'react-router-dom';import PaginatedTable,{HeaderRow,HeaderCell,getSearchableKeys}from'components/PaginatedTable';import useRequest from'hooks/useRequest';import{UsersAPI}from'api';import{getQSConfig,parseQueryString}from'util/qs';import UserOrganizationListItem from'./UserOrganizationListItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('organizations',{page:1,page_size:20,order_by:'name',type:'organization'});function UserOrganizationList(){var location=useLocation();var _useParams=useParams(),id=_useParams.id;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actions$data$actions,_actions$data;var params,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,results,orgCount,actions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,location.search);_context.next=3;return Promise.all([UsersAPI.readOrganizations(id,params),UsersAPI.readOrganizationOptions(id)]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);_yield$Promise$all2$=_yield$Promise$all2[0].data;results=_yield$Promise$all2$.results;orgCount=_yield$Promise$all2$.count;actions=_yield$Promise$all2[1];return _context.abrupt(\"return\",{searchableKeys:getSearchableKeys((_actions$data$actions=actions.data.actions)===null||_actions$data$actions===void 0?void 0:_actions$data$actions.GET),relatedSearchableKeys:((actions===null||actions===void 0?void 0:(_actions$data=actions.data)===null||_actions$data===void 0?void 0:_actions$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),organizations:results,count:orgCount});case 10:case\"end\":return _context.stop();}}},_callee);})),[id,location.search]),{organizations:[],count:0,searchableKeys:[],relatedSearchableKeys:[]}),_useRequest$result=_useRequest.result,organizations=_useRequest$result.organizations,count=_useRequest$result.count,searchableKeys=_useRequest$result.searchableKeys,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,contentError=_useRequest.error,isLoading=_useRequest.isLoading,fetchOrgs=_useRequest.request;useEffect(function(){fetchOrgs();},[fetchOrgs]);return/*#__PURE__*/_jsx(PaginatedTable,{items:organizations,contentError:contentError,toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,hasContentLoading:isLoading,itemCount:count,pluralizedItemName:/*i18n*/i18n._(\"Organizations\"),qsConfig:QS_CONFIG,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true}],headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,isSelectable:false,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Description\")})]}),renderRow:function renderRow(organization,index){return/*#__PURE__*/_jsx(UserOrganizationListItem,{value:organization.name,organization:organization,detailUrl:\"/organizations/\".concat(organization.id,\"/details\"),onSelect:function onSelect(){},isSelected:false,rowIndex:index},organization.id);}});}export default UserOrganizationList;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/screens/User/UserOrganizations/UserOrganizationList.js"],"names":["React","useCallback","useEffect","useLocation","useParams","PaginatedTable","HeaderRow","HeaderCell","getSearchableKeys","useRequest","UsersAPI","getQSConfig","parseQueryString","UserOrganizationListItem","QS_CONFIG","page","page_size","order_by","type","UserOrganizationList","location","id","params","search","Promise","all","readOrganizations","readOrganizationOptions","data","results","orgCount","count","actions","searchableKeys","GET","relatedSearchableKeys","related_search_fields","map","val","slice","organizations","result","contentError","error","isLoading","fetchOrgs","request","name","key","isDefault","organization","index"],"mappings":"uVAAA,MAAOA,CAAAA,KAAP,EAAgBC,WAAhB,CAA6BC,SAA7B,KAA8C,OAA9C,CACA,OAASC,WAAT,CAAsBC,SAAtB,KAAuC,kBAAvC,CAGA,MAAOC,CAAAA,cAAP,EACEC,SADF,CAEEC,UAFF,CAGEC,iBAHF,KAIO,2BAJP,CAKA,MAAOC,CAAAA,UAAP,KAAuB,kBAAvB,CACA,OAASC,QAAT,KAAyB,KAAzB,CACA,OAASC,WAAT,CAAsBC,gBAAtB,KAA8C,SAA9C,CACA,MAAOC,CAAAA,wBAAP,KAAqC,4BAArC,C,wFAEA,GAAMC,CAAAA,SAAS,CAAGH,WAAW,CAAC,eAAD,CAAkB,CAC7CI,IAAI,CAAE,CADuC,CAE7CC,SAAS,CAAE,EAFkC,CAG7CC,QAAQ,CAAE,MAHmC,CAI7CC,IAAI,CAAE,cAJuC,CAAlB,CAA7B,CAOA,QAASC,CAAAA,oBAAT,EAAgC,CAC9B,GAAMC,CAAAA,QAAQ,CAAGjB,WAAW,EAA5B,CACA,eAAeC,SAAS,EAAxB,CAAQiB,EAAR,YAAQA,EAAR,CAEA,gBAKIZ,UAAU,CACZR,WAAW,sEAAC,2QACJqB,MADI,CACKV,gBAAgB,CAACE,SAAD,CAAYM,QAAQ,CAACG,MAArB,CADrB,uBAOAC,CAAAA,OAAO,CAACC,GAAR,CAAY,CACpBf,QAAQ,CAACgB,iBAAT,CAA2BL,EAA3B,CAA+BC,MAA/B,CADoB,CAEpBZ,QAAQ,CAACiB,uBAAT,CAAiCN,EAAjC,CAFoB,CAAZ,CAPA,8IAINO,IAJM,CAIEC,OAJF,sBAIEA,OAJF,CAIkBC,QAJlB,sBAIWC,KAJX,CAMRC,OANQ,wDAWH,CACLC,cAAc,CAAEzB,iBAAiB,wBAACwB,OAAO,CAACJ,IAAR,CAAaI,OAAd,gDAAC,sBAAsBE,GAAvB,CAD5B,CAELC,qBAAqB,CAAE,CAAC,CAAAH,OAAO,OAAP,EAAAA,OAAO,SAAP,uBAAAA,OAAO,CAAEJ,IAAT,sDAAeQ,qBAAf,GAAwC,EAAzC,EAA6CC,GAA7C,CACrB,SAACC,GAAD,QAASA,CAAAA,GAAG,CAACC,KAAJ,CAAU,CAAV,CAAa,CAAC,CAAd,CAAT,EADqB,CAFlB,CAKLC,aAAa,CAAEX,OALV,CAMLE,KAAK,CAAED,QANF,CAXG,yDAAD,GAmBR,CAACT,EAAD,CAAKD,QAAQ,CAACG,MAAd,CAnBQ,CADC,CAqBZ,CACEiB,aAAa,CAAE,EADjB,CAEET,KAAK,CAAE,CAFT,CAGEE,cAAc,CAAE,EAHlB,CAIEE,qBAAqB,CAAE,EAJzB,CArBY,CALd,gCACEM,MADF,CACYD,aADZ,oBACYA,aADZ,CAC2BT,KAD3B,oBAC2BA,KAD3B,CACkCE,cADlC,oBACkCA,cADlC,CACkDE,qBADlD,oBACkDA,qBADlD,CAESO,YAFT,aAEEC,KAFF,CAGEC,SAHF,aAGEA,SAHF,CAIWC,SAJX,aAIEC,OAJF,CAkCA5C,SAAS,CAAC,UAAM,CACd2C,SAAS,GACV,CAFQ,CAEN,CAACA,SAAD,CAFM,CAAT,CAIA,mBACE,KAAC,cAAD,EACE,KAAK,CAAEL,aADT,CAEE,YAAY,CAAEE,YAFhB,CAGE,qBAAqB,CAAET,cAHzB,CAIE,4BAA4B,CAAEE,qBAJhC,CAKE,iBAAiB,CAAES,SALrB,CAME,SAAS,CAAEb,KANb,CAOE,kBAAkB,SAAE,uBAPtB,CAQE,QAAQ,CAAEjB,SARZ,CASE,oBAAoB,CAAE,CACpB,CAAEiC,IAAI,SAAE,cAAR,CAAiBC,GAAG,CAAE,iBAAtB,CAAyCC,SAAS,CAAE,IAApD,CADoB,CATxB,CAYE,SAAS,cACP,MAAC,SAAD,EAAW,QAAQ,CAAEnC,SAArB,CAAgC,YAAY,CAAE,KAA9C,wBACE,KAAC,UAAD,EAAY,OAAO,CAAC,MAApB,kBAA4B,cAA5B,EADF,cAEE,KAAC,UAAD,mBAAa,qBAAb,EAFF,GAbJ,CAkBE,SAAS,CAAE,mBAACoC,YAAD,CAAeC,KAAf,qBACT,KAAC,wBAAD,EAEE,KAAK,CAAED,YAAY,CAACH,IAFtB,CAGE,YAAY,CAAEG,YAHhB,CAIE,SAAS,0BAAoBA,YAAY,CAAC7B,EAAjC,YAJX,CAKE,QAAQ,CAAE,mBAAM,CAAE,CALpB,CAME,UAAU,CAAE,KANd,CAOE,QAAQ,CAAE8B,KAPZ,EACOD,YAAY,CAAC7B,EADpB,CADS,EAlBb,EADF,CAgCD,CAED,cAAeF,CAAAA,oBAAf","sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useLocation, useParams } from 'react-router-dom';\nimport { t } from '@lingui/macro';\n\nimport PaginatedTable, {\n  HeaderRow,\n  HeaderCell,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\nimport useRequest from 'hooks/useRequest';\nimport { UsersAPI } from 'api';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport UserOrganizationListItem from './UserOrganizationListItem';\n\nconst QS_CONFIG = getQSConfig('organizations', {\n  page: 1,\n  page_size: 20,\n  order_by: 'name',\n  type: 'organization',\n});\n\nfunction UserOrganizationList() {\n  const location = useLocation();\n  const { id } = useParams();\n\n  const {\n    result: { organizations, count, searchableKeys, relatedSearchableKeys },\n    error: contentError,\n    isLoading,\n    request: fetchOrgs,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, location.search);\n      const [\n        {\n          data: { results, count: orgCount },\n        },\n        actions,\n      ] = await Promise.all([\n        UsersAPI.readOrganizations(id, params),\n        UsersAPI.readOrganizationOptions(id),\n      ]);\n      return {\n        searchableKeys: getSearchableKeys(actions.data.actions?.GET),\n        relatedSearchableKeys: (actions?.data?.related_search_fields || []).map(\n          (val) => val.slice(0, -8)\n        ),\n        organizations: results,\n        count: orgCount,\n      };\n    }, [id, location.search]),\n    {\n      organizations: [],\n      count: 0,\n      searchableKeys: [],\n      relatedSearchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchOrgs();\n  }, [fetchOrgs]);\n\n  return (\n    <PaginatedTable\n      items={organizations}\n      contentError={contentError}\n      toolbarSearchableKeys={searchableKeys}\n      toolbarRelatedSearchableKeys={relatedSearchableKeys}\n      hasContentLoading={isLoading}\n      itemCount={count}\n      pluralizedItemName={t`Organizations`}\n      qsConfig={QS_CONFIG}\n      toolbarSearchColumns={[\n        { name: t`Name`, key: 'name__icontains', isDefault: true },\n      ]}\n      headerRow={\n        <HeaderRow qsConfig={QS_CONFIG} isSelectable={false}>\n          <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n          <HeaderCell>{t`Description`}</HeaderCell>\n        </HeaderRow>\n      }\n      renderRow={(organization, index) => (\n        <UserOrganizationListItem\n          key={organization.id}\n          value={organization.name}\n          organization={organization}\n          detailUrl={`/organizations/${organization.id}/details`}\n          onSelect={() => {}}\n          isSelected={false}\n          rowIndex={index}\n        />\n      )}\n    />\n  );\n}\n\nexport default UserOrganizationList;\n"]},"metadata":{},"sourceType":"module"}