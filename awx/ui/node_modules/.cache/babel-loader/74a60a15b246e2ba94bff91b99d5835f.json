{"ast":null,"code":"import _toArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toArray.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _styled from\"styled-components\";import{i18n}from\"@lingui/core\";import React,{useState,useEffect}from'react';import{useLocation}from'react-router-dom';import{Button,ButtonVariant,InputGroup,Select,SelectOption,SelectVariant,TextInput,ToolbarGroup,ToolbarItem,ToolbarFilter}from'@patternfly/react-core';import{SearchIcon}from'@patternfly/react-icons';import styled from'styled-components';import{parseQueryString}from'util/qs';import{QSConfig,SearchColumns,SearchableKeys}from'types';import AdvancedSearch from'./AdvancedSearch';import getChipsByKey from'./getChipsByKey';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var NoOptionDropdown=styled.div.withConfig({displayName:\"Search__NoOptionDropdown\",componentId:\"sc-1t23hhk-0\"})([\"align-self:stretch;border:1px solid var(--pf-global--BorderColor--300);padding:5px 15px;white-space:nowrap;border-bottom-color:var(--pf-global--BorderColor--200);\"]);var _StyledDiv=styled(\"div\").withConfig({displayName:\"Search___StyledDiv\",componentId:\"sc-1t23hhk-1\"})([\"\",\"\"],function(p){return p._css;});function Search(_ref){var columns=_ref.columns,onSearch=_ref.onSearch,onReplaceSearch=_ref.onReplaceSearch,onRemove=_ref.onRemove,qsConfig=_ref.qsConfig,searchableKeys=_ref.searchableKeys,relatedSearchableKeys=_ref.relatedSearchableKeys,onShowAdvancedSearch=_ref.onShowAdvancedSearch,isDisabled=_ref.isDisabled,maxSelectHeight=_ref.maxSelectHeight,enableNegativeFiltering=_ref.enableNegativeFiltering,enableRelatedFuzzyFiltering=_ref.enableRelatedFuzzyFiltering,handleIsAnsibleFactsSelected=_ref.handleIsAnsibleFactsSelected,isFilterCleared=_ref.isFilterCleared;var location=useLocation();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isSearchDropdownOpen=_useState2[0],setIsSearchDropdownOpen=_useState2[1];var _useState3=useState(function(){var _defaultColumn$;var defaultColumn=columns.filter(function(col){return col.isDefault;});if(defaultColumn.length!==1){throw new Error('One (and only one) searchColumn must be marked isDefault: true');}return(_defaultColumn$=defaultColumn[0])===null||_defaultColumn$===void 0?void 0:_defaultColumn$.key;}()),_useState4=_slicedToArray(_useState3,2),searchKey=_useState4[0],setSearchKey=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),searchValue=_useState6[0],setSearchValue=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isFilterDropdownOpen=_useState8[0],setIsFilterDropdownOpen=_useState8[1];var params=parseQueryString(qsConfig,location.search);if(params!==null&&params!==void 0&&params.host_filter){params.ansible_facts=params.host_filter.substring('ansible_facts__'.length);delete params.host_filter;}var searchChips=getChipsByKey(params,columns,qsConfig);var _useState9=useState(JSON.parse(JSON.stringify(searchChips))),_useState10=_slicedToArray(_useState9,2),chipsByKey=_useState10[0],setChipsByKey=_useState10[1];useEffect(function(){Object.keys(chipsByKey).forEach(function(el){chipsByKey[el].chips=[];});setChipsByKey(_objectSpread(_objectSpread({},chipsByKey),searchChips));},[location.search]);// eslint-disable-line react-hooks/exhaustive-deps\nvar handleDropdownSelect=function handleDropdownSelect(_ref2){var target=_ref2.target;var _columns$find=columns.find(function(_ref3){var name=_ref3.name;return name===target.innerText;}),actualSearchKey=_columns$find.key;onShowAdvancedSearch(actualSearchKey==='advanced');setIsFilterDropdownOpen(false);setSearchKey(actualSearchKey);};var handleSearch=function handleSearch(e){// keeps page from fully reloading\ne.preventDefault();if(searchValue){onSearch(searchKey,searchValue);setSearchValue('');}};var handleTextKeyDown=function handleTextKeyDown(e){if(e.key&&e.key==='Enter'){handleSearch(e);}};var handleFilterDropdownSelect=function handleFilterDropdownSelect(key,event,actualValue){if(event.target.checked){onSearch(key,actualValue);}else{onRemove(key,actualValue);}};var _columns$find2=columns.find(function(_ref4){var key=_ref4.key;return key===searchKey;}),searchColumnName=_columns$find2.name;var searchOptions=columns.filter(function(_ref5){var key=_ref5.key;return key!==searchKey;}).map(function(_ref6){var key=_ref6.key,name=_ref6.name;return/*#__PURE__*/_jsx(SelectOption,{\"data-cy\":\"select-option-\".concat(key),id:\"select-option-\".concat(key),value:name,children:name},key);});return/*#__PURE__*/_jsxs(ToolbarGroup,{variant:\"filter-group\",children:[/*#__PURE__*/_jsx(ToolbarItem,{children:searchOptions.length>0?/*#__PURE__*/_jsx(Select,{variant:SelectVariant.single,className:\"simpleKeySelect\",\"aria-label\":/*i18n*/i18n._(\"Simple key select\"),typeAheadAriaLabel:/*i18n*/i18n._(\"Simple key select\"),onToggle:setIsSearchDropdownOpen,onSelect:handleDropdownSelect,selections:searchColumnName,isOpen:isSearchDropdownOpen,ouiaId:\"simple-key-select\",isDisabled:isDisabled,noResultsFoundText:/*i18n*/i18n._(\"No results found\"),children:searchOptions}):/*#__PURE__*/_jsx(NoOptionDropdown,{children:searchColumnName})}),columns.map(function(_ref7){var _chipsByKey$key,_chipsByKey$key$chips;var key=_ref7.key,name=_ref7.name,options=_ref7.options,isBoolean=_ref7.isBoolean,_ref7$booleanLabels=_ref7.booleanLabels,booleanLabels=_ref7$booleanLabels===void 0?{}:_ref7$booleanLabels;return/*#__PURE__*/_jsx(ToolbarFilter,{chips:chipsByKey[key]?chipsByKey[key].chips:[],deleteChip:function deleteChip(unusedKey,chip){var _chip$key$split=chip.key.split(':'),_chip$key$split2=_toArray(_chip$key$split),columnKey=_chip$key$split2[0],value=_chip$key$split2.slice(1);onRemove(columnKey,value.join(':'));},categoryName:chipsByKey[key]?chipsByKey[key].label:key,showToolbarItem:searchKey===key,children:key==='advanced'&&/*#__PURE__*/_jsx(AdvancedSearch,{onSearch:onSearch,searchableKeys:searchableKeys,relatedSearchableKeys:relatedSearchableKeys,maxSelectHeight:maxSelectHeight,enableNegativeFiltering:enableNegativeFiltering,enableRelatedFuzzyFiltering:enableRelatedFuzzyFiltering,handleIsAnsibleFactsSelected:handleIsAnsibleFactsSelected,isFilterCleared:isFilterCleared})||options&&/*#__PURE__*/_jsx(Select,{variant:SelectVariant.checkbox,\"aria-label\":name,typeAheadAriaLabel:name,onToggle:setIsFilterDropdownOpen,onSelect:function onSelect(event,selection){return handleFilterDropdownSelect(key,event,selection);},selections:(_chipsByKey$key=chipsByKey[key])===null||_chipsByKey$key===void 0?void 0:_chipsByKey$key.chips.map(function(chip){var _chip$key$split3=chip.key.split(':'),_chip$key$split4=_toArray(_chip$key$split3),value=_chip$key$split4.slice(1);return value.join(':');}),isOpen:isFilterDropdownOpen,placeholderText:/*i18n*/i18n._(\"Filter By {name}\",{name:name}),ouiaId:\"filter-by-\".concat(key),isDisabled:isDisabled,maxHeight:maxSelectHeight,noResultsFoundText:/*i18n*/i18n._(\"No results found\"),children:options.map(function(_ref8){var _ref9=_slicedToArray(_ref8,2),optionKey=_ref9[0],optionLabel=_ref9[1];return/*#__PURE__*/_jsx(SelectOption,{value:optionKey,inputId:\"select-option-\".concat(optionKey),children:optionLabel},optionKey);})})||isBoolean&&/*#__PURE__*/_jsxs(Select,{\"aria-label\":name,onToggle:setIsFilterDropdownOpen,onSelect:function onSelect(event,selection){return onReplaceSearch(key,selection);},selections:(_chipsByKey$key$chips=chipsByKey[key].chips[0])===null||_chipsByKey$key$chips===void 0?void 0:_chipsByKey$key$chips.label,isOpen:isFilterDropdownOpen,placeholderText:/*i18n*/i18n._(\"Filter By {name}\",{name:name}),ouiaId:\"filter-by-\".concat(key),isDisabled:isDisabled,maxHeight:maxSelectHeight,noResultsFoundText:/*i18n*/i18n._(\"No results found\"),children:[/*#__PURE__*/_jsx(SelectOption,{value:\"true\",children:booleanLabels.true||/*i18n*/i18n._(\"Yes\")},\"true\"),/*#__PURE__*/_jsx(SelectOption,{value:\"false\",children:booleanLabels.false||/*i18n*/i18n._(\"No\")},\"false\")]})||/*#__PURE__*/_jsxs(InputGroup,{children:[/*#__PURE__*/_jsx(TextInput,{\"data-cy\":\"search-text-input\",type:qsConfig.integerFields.find(function(field){return field===searchKey;})&&'number'||'search',\"aria-label\":/*i18n*/i18n._(\"Search text input\"),value:searchValue,onChange:setSearchValue,onKeyDown:handleTextKeyDown,isDisabled:isDisabled}),/*#__PURE__*/_jsx(_StyledDiv,{_css:!searchValue&&\"cursor:not-allowed\",children:/*#__PURE__*/_jsx(Button,{ouiaId:\"search-submit-button\",variant:ButtonVariant.control,isDisabled:!searchValue||isDisabled,\"aria-label\":/*i18n*/i18n._(\"Search submit button\"),onClick:handleSearch,children:/*#__PURE__*/_jsx(SearchIcon,{})})})]})},key);}),Object.keys(chipsByKey).filter(function(val){return columns.map(function(val2){return val2.key;}).indexOf(val)===-1;}).map(function(leftoverKey){return/*#__PURE__*/_jsx(ToolbarFilter,{chips:chipsByKey[leftoverKey]?chipsByKey[leftoverKey].chips:[],deleteChip:function deleteChip(unusedKey,chip){var _chip$key$split5=chip.key.split(':'),_chip$key$split6=_toArray(_chip$key$split5),columnKey=_chip$key$split6[0],value=_chip$key$split6.slice(1);if(columnKey==='ansible_facts'){onRemove('host_filter',\"\".concat(columnKey,\"__\").concat(value));}else{onRemove(columnKey,value.join(':'));}},categoryName:chipsByKey[leftoverKey]?chipsByKey[leftoverKey].label:leftoverKey},leftoverKey);})]});}Search.defaultProps={onSearch:null,onRemove:null,isDisabled:false,maxSelectHeight:'300px',enableNegativeFiltering:true,enableRelatedFuzzyFiltering:true,searchableKeys:[]};export default Search;","map":{"version":3,"sources":["/awx_devel/awx/ui/src/components/Search/Search.js"],"names":["React","useState","useEffect","useLocation","Button","ButtonVariant","InputGroup","Select","SelectOption","SelectVariant","TextInput","ToolbarGroup","ToolbarItem","ToolbarFilter","SearchIcon","styled","parseQueryString","QSConfig","SearchColumns","SearchableKeys","AdvancedSearch","getChipsByKey","NoOptionDropdown","div","Search","columns","onSearch","onReplaceSearch","onRemove","qsConfig","searchableKeys","relatedSearchableKeys","onShowAdvancedSearch","isDisabled","maxSelectHeight","enableNegativeFiltering","enableRelatedFuzzyFiltering","handleIsAnsibleFactsSelected","isFilterCleared","location","isSearchDropdownOpen","setIsSearchDropdownOpen","defaultColumn","filter","col","isDefault","length","Error","key","searchKey","setSearchKey","searchValue","setSearchValue","isFilterDropdownOpen","setIsFilterDropdownOpen","params","search","host_filter","ansible_facts","substring","searchChips","JSON","parse","stringify","chipsByKey","setChipsByKey","Object","keys","forEach","el","chips","handleDropdownSelect","target","find","name","innerText","actualSearchKey","handleSearch","e","preventDefault","handleTextKeyDown","handleFilterDropdownSelect","event","actualValue","checked","searchColumnName","searchOptions","map","single","options","isBoolean","booleanLabels","unusedKey","chip","split","columnKey","value","join","label","checkbox","selection","optionKey","optionLabel","true","false","integerFields","field","control","val","val2","indexOf","leftoverKey","defaultProps"],"mappings":"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","sourcesContent":["import 'styled-components/macro';\nimport React, { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\n\nimport { t } from '@lingui/macro';\nimport { useLocation } from 'react-router-dom';\nimport {\n  Button,\n  ButtonVariant,\n  InputGroup,\n  Select,\n  SelectOption,\n  SelectVariant,\n  TextInput,\n  ToolbarGroup,\n  ToolbarItem,\n  ToolbarFilter,\n} from '@patternfly/react-core';\nimport { SearchIcon } from '@patternfly/react-icons';\nimport styled from 'styled-components';\nimport { parseQueryString } from 'util/qs';\nimport { QSConfig, SearchColumns, SearchableKeys } from 'types';\nimport AdvancedSearch from './AdvancedSearch';\nimport getChipsByKey from './getChipsByKey';\n\nconst NoOptionDropdown = styled.div`\n  align-self: stretch;\n  border: 1px solid var(--pf-global--BorderColor--300);\n  padding: 5px 15px;\n  white-space: nowrap;\n  border-bottom-color: var(--pf-global--BorderColor--200);\n`;\n\nfunction Search({\n  columns,\n  onSearch,\n  onReplaceSearch,\n  onRemove,\n  qsConfig,\n  searchableKeys,\n  relatedSearchableKeys,\n  onShowAdvancedSearch,\n  isDisabled,\n  maxSelectHeight,\n  enableNegativeFiltering,\n  enableRelatedFuzzyFiltering,\n  handleIsAnsibleFactsSelected,\n  isFilterCleared,\n}) {\n  const location = useLocation();\n  const [isSearchDropdownOpen, setIsSearchDropdownOpen] = useState(false);\n  const [searchKey, setSearchKey] = useState(\n    (() => {\n      const defaultColumn = columns.filter((col) => col.isDefault);\n\n      if (defaultColumn.length !== 1) {\n        throw new Error(\n          'One (and only one) searchColumn must be marked isDefault: true'\n        );\n      }\n\n      return defaultColumn[0]?.key;\n    })()\n  );\n  const [searchValue, setSearchValue] = useState('');\n  const [isFilterDropdownOpen, setIsFilterDropdownOpen] = useState(false);\n\n  const params = parseQueryString(qsConfig, location.search);\n  if (params?.host_filter) {\n    params.ansible_facts = params.host_filter.substring(\n      'ansible_facts__'.length\n    );\n    delete params.host_filter;\n  }\n\n  const searchChips = getChipsByKey(params, columns, qsConfig);\n  const [chipsByKey, setChipsByKey] = useState(\n    JSON.parse(JSON.stringify(searchChips))\n  );\n\n  useEffect(() => {\n    Object.keys(chipsByKey).forEach((el) => {\n      chipsByKey[el].chips = [];\n    });\n    setChipsByKey({ ...chipsByKey, ...searchChips });\n  }, [location.search]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const handleDropdownSelect = ({ target }) => {\n    const { key: actualSearchKey } = columns.find(\n      ({ name }) => name === target.innerText\n    );\n    onShowAdvancedSearch(actualSearchKey === 'advanced');\n    setIsFilterDropdownOpen(false);\n    setSearchKey(actualSearchKey);\n  };\n\n  const handleSearch = (e) => {\n    // keeps page from fully reloading\n    e.preventDefault();\n\n    if (searchValue) {\n      onSearch(searchKey, searchValue);\n      setSearchValue('');\n    }\n  };\n\n  const handleTextKeyDown = (e) => {\n    if (e.key && e.key === 'Enter') {\n      handleSearch(e);\n    }\n  };\n\n  const handleFilterDropdownSelect = (key, event, actualValue) => {\n    if (event.target.checked) {\n      onSearch(key, actualValue);\n    } else {\n      onRemove(key, actualValue);\n    }\n  };\n\n  const { name: searchColumnName } = columns.find(\n    ({ key }) => key === searchKey\n  );\n\n  const searchOptions = columns\n    .filter(({ key }) => key !== searchKey)\n    .map(({ key, name }) => (\n      <SelectOption\n        data-cy={`select-option-${key}`}\n        id={`select-option-${key}`}\n        key={key}\n        value={name}\n      >\n        {name}\n      </SelectOption>\n    ));\n\n  return (\n    <ToolbarGroup variant=\"filter-group\">\n      <ToolbarItem>\n        {searchOptions.length > 0 ? (\n          <Select\n            variant={SelectVariant.single}\n            className=\"simpleKeySelect\"\n            aria-label={t`Simple key select`}\n            typeAheadAriaLabel={t`Simple key select`}\n            onToggle={setIsSearchDropdownOpen}\n            onSelect={handleDropdownSelect}\n            selections={searchColumnName}\n            isOpen={isSearchDropdownOpen}\n            ouiaId=\"simple-key-select\"\n            isDisabled={isDisabled}\n            noResultsFoundText={t`No results found`}\n          >\n            {searchOptions}\n          </Select>\n        ) : (\n          <NoOptionDropdown>{searchColumnName}</NoOptionDropdown>\n        )}\n      </ToolbarItem>\n      {columns.map(({ key, name, options, isBoolean, booleanLabels = {} }) => (\n        <ToolbarFilter\n          chips={chipsByKey[key] ? chipsByKey[key].chips : []}\n          deleteChip={(unusedKey, chip) => {\n            const [columnKey, ...value] = chip.key.split(':');\n            onRemove(columnKey, value.join(':'));\n          }}\n          categoryName={chipsByKey[key] ? chipsByKey[key].label : key}\n          key={key}\n          showToolbarItem={searchKey === key}\n        >\n          {(key === 'advanced' && (\n            <AdvancedSearch\n              onSearch={onSearch}\n              searchableKeys={searchableKeys}\n              relatedSearchableKeys={relatedSearchableKeys}\n              maxSelectHeight={maxSelectHeight}\n              enableNegativeFiltering={enableNegativeFiltering}\n              enableRelatedFuzzyFiltering={enableRelatedFuzzyFiltering}\n              handleIsAnsibleFactsSelected={handleIsAnsibleFactsSelected}\n              isFilterCleared={isFilterCleared}\n            />\n          )) ||\n            (options && (\n              <Select\n                variant={SelectVariant.checkbox}\n                aria-label={name}\n                typeAheadAriaLabel={name}\n                onToggle={setIsFilterDropdownOpen}\n                onSelect={(event, selection) =>\n                  handleFilterDropdownSelect(key, event, selection)\n                }\n                selections={chipsByKey[key]?.chips.map((chip) => {\n                  const [, ...value] = chip.key.split(':');\n                  return value.join(':');\n                })}\n                isOpen={isFilterDropdownOpen}\n                placeholderText={t`Filter By ${name}`}\n                ouiaId={`filter-by-${key}`}\n                isDisabled={isDisabled}\n                maxHeight={maxSelectHeight}\n                noResultsFoundText={t`No results found`}\n              >\n                {options.map(([optionKey, optionLabel]) => (\n                  <SelectOption\n                    key={optionKey}\n                    value={optionKey}\n                    inputId={`select-option-${optionKey}`}\n                  >\n                    {optionLabel}\n                  </SelectOption>\n                ))}\n              </Select>\n            )) ||\n            (isBoolean && (\n              <Select\n                aria-label={name}\n                onToggle={setIsFilterDropdownOpen}\n                onSelect={(event, selection) => onReplaceSearch(key, selection)}\n                selections={chipsByKey[key].chips[0]?.label}\n                isOpen={isFilterDropdownOpen}\n                placeholderText={t`Filter By ${name}`}\n                ouiaId={`filter-by-${key}`}\n                isDisabled={isDisabled}\n                maxHeight={maxSelectHeight}\n                noResultsFoundText={t`No results found`}\n              >\n                <SelectOption key=\"true\" value=\"true\">\n                  {booleanLabels.true || t`Yes`}\n                </SelectOption>\n                <SelectOption key=\"false\" value=\"false\">\n                  {booleanLabels.false || t`No`}\n                </SelectOption>\n              </Select>\n            )) || (\n              <InputGroup>\n                {/* TODO: add support for dates:\n          qsConfig.dateFields.filter(field => field === key).length && \"date\" */}\n                <TextInput\n                  data-cy=\"search-text-input\"\n                  type={\n                    (qsConfig.integerFields.find(\n                      (field) => field === searchKey\n                    ) &&\n                      'number') ||\n                    'search'\n                  }\n                  aria-label={t`Search text input`}\n                  value={searchValue}\n                  onChange={setSearchValue}\n                  onKeyDown={handleTextKeyDown}\n                  isDisabled={isDisabled}\n                />\n                <div css={!searchValue && `cursor:not-allowed`}>\n                  <Button\n                    ouiaId=\"search-submit-button\"\n                    variant={ButtonVariant.control}\n                    isDisabled={!searchValue || isDisabled}\n                    aria-label={t`Search submit button`}\n                    onClick={handleSearch}\n                  >\n                    <SearchIcon />\n                  </Button>\n                </div>\n              </InputGroup>\n            )}\n        </ToolbarFilter>\n      ))}\n      {/* Add a ToolbarFilter for any key that doesn't have it's own\n      search column so the chips show up */}\n      {Object.keys(chipsByKey)\n        .filter((val) => columns.map((val2) => val2.key).indexOf(val) === -1)\n        .map((leftoverKey) => (\n          <ToolbarFilter\n            chips={chipsByKey[leftoverKey] ? chipsByKey[leftoverKey].chips : []}\n            deleteChip={(unusedKey, chip) => {\n              const [columnKey, ...value] = chip.key.split(':');\n              if (columnKey === 'ansible_facts') {\n                onRemove('host_filter', `${columnKey}__${value}`);\n              } else {\n                onRemove(columnKey, value.join(':'));\n              }\n            }}\n            categoryName={\n              chipsByKey[leftoverKey]\n                ? chipsByKey[leftoverKey].label\n                : leftoverKey\n            }\n            key={leftoverKey}\n          />\n        ))}\n    </ToolbarGroup>\n  );\n}\n\nSearch.propTypes = {\n  qsConfig: QSConfig.isRequired,\n  columns: SearchColumns.isRequired,\n  onSearch: PropTypes.func,\n  onRemove: PropTypes.func,\n  onShowAdvancedSearch: PropTypes.func.isRequired,\n  isDisabled: PropTypes.bool,\n  maxSelectHeight: PropTypes.string,\n  enableNegativeFiltering: PropTypes.bool,\n  enableRelatedFuzzyFiltering: PropTypes.bool,\n  searchableKeys: SearchableKeys,\n};\n\nSearch.defaultProps = {\n  onSearch: null,\n  onRemove: null,\n  isDisabled: false,\n  maxSelectHeight: '300px',\n  enableNegativeFiltering: true,\n  enableRelatedFuzzyFiltering: true,\n  searchableKeys: [],\n};\n\nexport default Search;\n"]},"metadata":{},"sourceType":"module"}